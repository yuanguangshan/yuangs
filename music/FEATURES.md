# 🎵 收藏和历史功能使用指南

## ✨ 新增功能

### 1. **播放历史记录** 📖

- **位置**：顶部导航栏 - 📖 按钮
- **功能**：
  - 自动记录所有播放过的歌曲
  - 最多保存 100 条历史记录
  - 显示播放时间（刚刚、X 分钟前、X 小时前、X 天前）
  - 点击历史记录可直接播放
  - 支持单独删除某条记录
  - 支持一键清空所有历史

### 2. **我的收藏** ❤️

- **位置**：
  - 顶部导航栏 - ❤️ 按钮（查看收藏列表）
  - 播放器中间 - 🤍/❤️ 按钮（快速收藏当前歌曲）
- **功能**：
  - 点击播放器中的爱心按钮快速收藏/取消收藏
  - 已收藏显示红心 ❤️，未收藏显示白心 🤍
  - 收藏时有心跳动画效果
  - 显示收藏时间
  - 点击收藏的歌曲可直接播放
  - 支持单独取消收藏
  - 支持一键清空所有收藏

### 3. **导入/导出功能** 📤📥

- **历史记录导出**：

  - 点击历史弹窗中的 📤 按钮
  - 自动下载 JSON 格式文件
  - 文件名：`music-history-YYYY-MM-DD.json`

- **历史记录导入**：

  - 点击历史弹窗中的 📥 按钮
  - 选择之前导出的 JSON 文件
  - 自动导入并显示成功条数

- **收藏导出**：

  - 点击收藏弹窗中的 📤 按钮
  - 自动下载 JSON 格式文件
  - 文件名：`music-favorites-YYYY-MM-DD.json`

- **收藏导入**：
  - 点击收藏弹窗中的 📥 按钮
  - 选择之前导出的 JSON 文件
  - 自动导入并显示成功条数

## 🎯 使用场景

### 场景 1：备份收藏和历史

1. 点击 📖 或 ❤️ 按钮打开弹窗
2. 点击 📤 导出按钮
3. 保存 JSON 文件到安全位置
4. 换设备或清空浏览器数据后，点击 📥 导入即可恢复

### 场景 2：分享歌单

1. 导出你的收藏列表
2. 将 JSON 文件分享给朋友
3. 朋友导入后即可获得相同的歌单

### 场景 3：快速收藏喜欢的歌

1. 播放歌曲时，点击播放器中的 🤍 按钮
2. 按钮变为 ❤️ 表示收藏成功
3. 随时点击顶部 ❤️ 查看所有收藏

### 场景 4：回顾播放历史

1. 点击顶部 📖 按钮
2. 查看最近播放的歌曲
3. 点击任意歌曲重新播放

## 💾 数据存储

- **存储方式**：使用浏览器 localStorage
- **存储位置**：
  - 历史记录：`music_history`
  - 收藏列表：`music_favorites`
- **数据持久化**：只要不清除浏览器数据，记录永久保存
- **跨设备同步**：需要手动导出/导入 JSON 文件

## 🎨 界面特点

- **玻璃拟态设计**：与整体风格一致的毛玻璃效果
- **流畅动画**：收藏时的心跳动画、弹窗滑入动画
- **响应式布局**：自动适配手机和桌面端
- **直观操作**：悬停显示删除按钮，避免误操作

## ⚠️ 注意事项

1. **清空操作不可恢复**：清空历史或收藏前会有确认提示，请谨慎操作
2. **导入会覆盖**：导入 JSON 文件会完全覆盖当前数据，建议先导出备份
3. **文件格式**：只支持导入标准的 JSON 格式文件
4. **存储限制**：历史记录最多保存 100 条，超出后自动删除最早的记录

## 🔧 技术实现

- **数据管理**：独立的 `FavoritesManager` 和 `HistoryManager` 模块
- **本地存储**：localStorage API
- **文件操作**：Blob API + FileReader API
- **时间格式化**：智能相对时间显示
- **防重复**：自动去重，避免重复记录

## 📝 JSON 文件格式示例

### 收藏列表格式

```json
[
  {
    "trackId": "123456",
    "trackName": "歌曲名称",
    "artistName": "艺术家",
    "artworkUrl100": "封面URL",
    "previewUrl": "试听URL",
    "favoritedAt": 1701518400000
  }
]
```

### 历史记录格式

```json
[
  {
    "trackId": "123456",
    "trackName": "歌曲名称",
    "artistName": "艺术家",
    "artworkUrl100": "封面URL",
    "previewUrl": "试听URL",
    "playedAt": 1701518400000
  }
]
```

---

**享受你的音乐之旅！** 🎧✨
