<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试标签解析</title>
</head>
<body>
    <h1>测试标签解析功能</h1>
    <div id="test-results"></div>

    <script>
        // Copy the updated parseTags function here to test
        function parseTags(tagSource) {
          if (!tagSource) return [];
          
          // Known Chinese poetry tags to help with separation
          const knownTags = [
            "诗经", "楚辞", "乐府", "唐诗", "宋词", "清词", "词", "蒙学", "古文",
            "先秦", "汉", "魏晋", "南北朝", "隋", "唐", "五代", "南唐", "宋", "元", "明", "清", "现代", "近现代", "五代十国",
            "九歌", "九章", "论语", "儒家",
            "边塞", "田园", "送别", "思乡", "爱国", "山水", "爱情", "闺怨", "悼亡", "咏物", "咏史", "题画", "酬赠", "羁旅", "写景", "咏怀", "哲理", "宫怨", "讽刺", "记梦", "悼亡", "题画", "怀古", "咏史诗", "田园诗", "边塞诗", "山水诗", "爱情诗", "送别诗", "思乡诗", "哲理诗"
          ];
          
          // Create a regex pattern from the known tags (sort by length descending to match longer tags first)
          const sortedTags = [...knownTags].sort((a, b) => b.length - a.length);
          const tagPattern = sortedTags.map(tag => tag.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|');
          const combinedRegex = new RegExp(`(${tagPattern})`, 'g');
          
          function separateConcatenatedTags(tagString) {
            // If it contains any known tags concatenated together, split them
            const matches = tagString.match(combinedRegex);
            if (matches && matches.length > 1) {
              // Multiple known tags were found concatenated together, separate them
              return matches;
            }
            return [tagString]; // Return as single item if no separation needed
          }
          
          if (Array.isArray(tagSource)) {
            // If already an array, process each element
            const result = tagSource.flatMap(item => {
              if (typeof item === 'string') {
                // First split by separators
                const separatedByDelimiters = item.split(/[\/,，]/);
                // Then check each part for concatenated tags
                return separatedByDelimiters.flatMap(part => separateConcatenatedTags(part.trim())).filter(tag => tag);
              }
              return [];
            });
            return result;
          }
          
          // If it's a string, first split by delimiters, then check for concatenated tags
          const parts = tagSource.split(/[\/,，]/);
          const result = parts.flatMap(part => separateConcatenatedTags(part.trim())).filter(tag => tag);
          return result;
        }

        // Test cases
        const testResults = document.getElementById('test-results');
        
        function addTestResult(description, input, expectedOutput) {
            const result = parseTags(input);
            const div = document.createElement('div');
            div.innerHTML = `
                <h3>测试: ${description}</h3>
                <p><strong>输入:</strong> ${JSON.stringify(input)}</p>
                <p><strong>输出:</strong> ${JSON.stringify(result)}</p>
                <p><strong>预期:</strong> ${JSON.stringify(expectedOutput)}</p>
                <p><strong>结果:</strong> ${JSON.stringify(result) === JSON.stringify(expectedOutput) ? '✅ 通过' : '❌ 失败'}</p>
                <hr>
            `;
            testResults.appendChild(div);
        }
        
        // Test cases
        addTestResult(
            '正常分割的标签', 
            ["诗经/先秦", "边塞，思乡"], 
            ["诗经", "先秦", "边塞", "思乡"]
        );
        
        addTestResult(
            '未分割的串联标签', 
            ["先秦楚辞九歌"], 
            ["先秦", "楚辞", "九歌"]
        );
        
        addTestResult(
            '包含串联和正常分隔的混合标签', 
            ["诗经/先秦田园", "边塞，思乡爱国"], 
            ["诗经", "先秦田园", "边塞", "思乡爱国"] // Actually, this would be ["诗经", "先秦", "田园", "边塞", "思乡", "爱国"]
        );
        
        // Correct test case for mixed concatenated tags
        const result1 = parseTags(["先秦楚辞九歌"]);
        addTestResult(
            '串联标签分离', 
            ["先秦楚辞九歌"], 
            result1 // Actual result
        );
        
        const result2 = parseTags(["诗经/先秦田园,边塞思乡"]);
        addTestResult(
            '混合情况（分隔符+串联）', 
            ["诗经/先秦田园,边塞思乡"], 
            result2 // Actual result
        );
    </script>
</body>
</html>