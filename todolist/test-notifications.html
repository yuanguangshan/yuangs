<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通知功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .notification-info {
            margin: 20px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>通知功能测试</h1>
    
    <div class="notification-info">
        <h3>通知权限状态: <span id="permissionStatus">未知</span></h3>
        <p>当前状态: <span id="currentStatus">-</span></p>
    </div>
    
    <button id="requestPermission" class="btn">请求通知权限</button>
    <button id="showNotification" class="btn">显示测试通知</button>
    <button id="registerSW" class="btn">注册服务Worker</button>
    
    <script>
        // Check current notification permission
        function updatePermissionStatus() {
            document.getElementById('permissionStatus').textContent = Notification.permission;
            document.getElementById('currentStatus').textContent = 
                Notification.permission === 'granted' ? '权限已授予' : 
                Notification.permission === 'denied' ? '权限被拒绝' : 
                '未请求权限';
        }
        
        // Update permission status on page load
        updatePermissionStatus();
        
        // Request notification permission
        document.getElementById('requestPermission').addEventListener('click', async () => {
            const permission = await Notification.requestPermission();
            updatePermissionStatus();
            console.log('Notification permission:', permission);
        });
        
        // Show test notification
        document.getElementById('showNotification').addEventListener('click', () => {
            if (Notification.permission === 'granted') {
                const notification = new Notification('测试通知', {
                    body: '这是一个测试通知！',
                    icon: '/icon-512x512.svg',
                    tag: 'test-notification'
                });
                
                notification.onclick = () => {
                    console.log('Notification clicked');
                };
            } else {
                alert('请先授予通知权限！');
            }
        });
        
        // Register service worker
        document.getElementById('registerSW').addEventListener('click', () => {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                        alert('Service Worker 注册成功！');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                        alert('Service Worker 注册失败！');
                    });
            } else {
                alert('浏览器不支持 Service Worker');
            }
        });
    </script>
</body>
</html>