# The name of your Worker
name = "chats"

# The main entry point for your Worker
main = "src/worker.js"

# A recent compatibility date
compatibility_date = "2024-03-01"

# --- Durable Object Binding ---
[[durable_objects.bindings]]
name = "CHAT_ROOM_DO"
# Point to the NEW class name
class_name = "HibernatingChatRoom" 

# --- R2 Storage Bucket Binding ---
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "yuangs"

# --- CRITICAL MIGRATION RULE ---
# This block is the key to unlock your deployment.
# It tells Cloudflare to migrate data from the old class to the new one.
[[migrations]]
# Give this migration a NEW, UNIQUE name
tag = "the-final-fix-001"
# The EXACT name of the class from your PREVIOUS, BROKEN deployment
old_classes = ["ChatRoomDurableObject"] 
# The EXACT name of the NEW class in THIS deployment
new_class = "HibernatingChatRoom"

[[migrations]]
tag = "the-final-fix-001"
renames = [
  { from = "ChatRoomDurableObject", to = "HibernatingChatRoom" }
]