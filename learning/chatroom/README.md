# ğŸ“± Real-time Chat Room

ä¸€ä¸ªåŸºäº Cloudflare Workers å’Œ Durable Objects æ„å»ºçš„ç°ä»£åŒ–å®æ—¶èŠå¤©å®¤ï¼Œæ”¯æŒå¤šæˆ¿é—´ã€å›¾ç‰‡åˆ†äº«å’Œç§»åŠ¨ç«¯ä¼˜åŒ–ã€‚

[Chat Room Preview](https://img.shields.io/badge/Status-Production%20Ready-brightgreen)
[Cloudflare Workers](https://img.shields.io/badge/Platform-Cloudflare%20Workers-orange)
[License](https://img.shields.io/badge/License-MIT-blue)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **ğŸ”¥ å®æ—¶é€šä¿¡**ï¼šåŸºäº WebSocket çš„å³æ—¶æ¶ˆæ¯ä¼ é€’
- **ğŸ  å¤šæˆ¿é—´æ”¯æŒ**ï¼šé€šè¿‡ URL è·¯å¾„åˆ›å»ºå’ŒåŠ å…¥ä¸åŒèŠå¤©å®¤
- **ğŸ‘¥ åœ¨çº¿ç”¨æˆ·åˆ—è¡¨**ï¼šå®æ—¶æ˜¾ç¤ºå½“å‰æˆ¿é—´åœ¨çº¿ç”¨æˆ·
- **ğŸ’¾ æ¶ˆæ¯æŒä¹…åŒ–**ï¼šåŸºäº Durable Objects çš„æ¶ˆæ¯å†å²å­˜å‚¨
- **ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–**ï¼šå®Œç¾é€‚é…æ‰‹æœºå’Œå¹³æ¿è®¾å¤‡

### ğŸ–¼ï¸ å›¾ç‰‡åŠŸèƒ½
- **ğŸ“ å›¾ç‰‡å‘é€**ï¼šæ”¯æŒæ‹–æ‹½å’Œç‚¹å‡»ä¸Šä¼ å›¾ç‰‡
- **ğŸ—œï¸ æ™ºèƒ½å‹ç¼©**ï¼šå‰ç«¯è‡ªåŠ¨å‹ç¼©å›¾ç‰‡èŠ‚çœå¸¦å®½
- **â˜ï¸ R2 å­˜å‚¨**ï¼šå›¾ç‰‡æ°¸ä¹…å­˜å‚¨åœ¨ Cloudflare R2
- **ğŸ” é¢„è§ˆæŸ¥çœ‹**ï¼šç‚¹å‡»å›¾ç‰‡å…¨å±é¢„è§ˆ
- **ğŸ“ å›¾æ–‡æ··åˆ**ï¼šæ”¯æŒå›¾ç‰‡é…æ–‡å­—è¯´æ˜

### ğŸ¨ ç”¨æˆ·ä½“éªŒ
- **ğŸŒˆ ç°ä»£åŒ– UI**ï¼šæ¸å˜è‰²å½©å’Œæµç•…åŠ¨ç”»
- **ğŸ“² å“åº”å¼è®¾è®¡**ï¼šæ¡Œé¢å’Œç§»åŠ¨ç«¯å®Œç¾é€‚é…
- **âŒ¨ï¸ å¿«æ·é”®æ”¯æŒ**ï¼šEnter å‘é€ï¼ŒShift+Enter æ¢è¡Œ
- **ğŸ”„ æ–­çº¿é‡è¿**ï¼šç½‘ç»œå¼‚å¸¸æ—¶è‡ªåŠ¨é‡è¿æç¤º
- **ğŸš€ PWA å°±ç»ª**ï¼šæ”¯æŒæ·»åŠ åˆ°ä¸»å±å¹•

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ (HTML)   â”‚â—„â”€â”€â–ºâ”‚ Cloudflare Worker â”‚â—„â”€â”€â–ºâ”‚ Durable Object  â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚                 â”‚
â”‚ â€¢ WebSocket     â”‚    â”‚ â€¢ è·¯ç”±å¤„ç†       â”‚    â”‚ â€¢ çŠ¶æ€ç®¡ç†      â”‚
â”‚ â€¢ å›¾ç‰‡å‹ç¼©      â”‚    â”‚ â€¢ é™æ€æ–‡ä»¶æœåŠ¡   â”‚    â”‚ â€¢ æ¶ˆæ¯å­˜å‚¨      â”‚
â”‚ â€¢ å“åº”å¼ UI     â”‚    â”‚ â€¢ WebSocket å‡çº§ â”‚    â”‚ â€¢ ç”¨æˆ·ä¼šè¯      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  Cloudflare R2  â”‚
                       â”‚                 â”‚
                       â”‚ â€¢ å›¾ç‰‡å­˜å‚¨      â”‚
                       â”‚ â€¢ CDN åˆ†å‘      â”‚
                       â”‚ â€¢ æ°¸ä¹…ä¿å­˜      â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **å‰ç«¯**ï¼šåŸç”Ÿ HTML/CSS/JavaScriptï¼ˆæ— æ¡†æ¶ä¾èµ–ï¼‰
- **åç«¯**ï¼šCloudflare Workers + Durable Objects
- **å­˜å‚¨**ï¼šCloudflare R2 + Durable Objects Storage
- **é€šä¿¡**ï¼šWebSocket + è‡ªå®šä¹‰æ¶ˆæ¯åè®®
- **éƒ¨ç½²**ï¼šWrangler CLI

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚
- Node.js 16+
- Cloudflare è´¦æˆ·
- Wrangler CLI

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <your-repo-url>
cd chatroom
```

### 2. å®‰è£…ä¾èµ–
```bash
npm install -g wrangler
```

### 3. é…ç½® R2 å­˜å‚¨æ¡¶
```bash
# åˆ›å»º R2 å­˜å‚¨æ¡¶
wrangler r2 bucket create yuangs

# é…ç½®å…¬å¼€è®¿é—®ï¼ˆå¯é€‰ï¼‰
wrangler r2 bucket cors put yuangs â€”cors-file cors.json
```

### 4. é…ç½®ç¯å¢ƒ
ä¿®æ”¹ `wrangler.toml` ä¸­çš„é…ç½®ï¼š
```toml
[[r2_buckets]]
binding = â€R2_BUCKETâ€œ
bucket_name = â€yuangsâ€œ  # æ‚¨çš„ R2 å­˜å‚¨æ¡¶åç§°
```

æ›´æ–°ä»£ç ä¸­çš„ R2 å…¬å¼€åŸŸåï¼š
```javascript
// src/chatroom_do.js ç¬¬ 60 è¡Œå·¦å³
const imageUrl = `https://your-r2-domain.r2.dev/${key}`;
```

### 5. éƒ¨ç½²
```bash
wrangler deploy
```

### 6. è®¿é—®åº”ç”¨
```
https://your-worker.your-subdomain.workers.dev/room-name
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
chatroom/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ worker.js           # Worker ä¸»å…¥å£
â”‚   â””â”€â”€ chatroom_do.js      # Durable Object å®ç°
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html          # å‰ç«¯é¡µé¢
â”œâ”€â”€ wrangler.toml           # Worker é…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

### æ–‡ä»¶è¯´æ˜

#### `src/worker.js`
- Worker ä¸»å…¥å£æ–‡ä»¶
- å¤„ç† HTTP è¯·æ±‚è·¯ç”±
- é™æ€æ–‡ä»¶æœåŠ¡
- WebSocket å‡çº§

#### `src/chatroom_do.js`
- Durable Object å®ç°
- ç®¡ç†èŠå¤©å®¤çŠ¶æ€
- WebSocket è¿æ¥å¤„ç†
- æ¶ˆæ¯å­˜å‚¨å’Œå¹¿æ’­
- R2 å›¾ç‰‡ä¸Šä¼ 

#### `public/index.html`
- å•é¡µåº”ç”¨å‰ç«¯
- å“åº”å¼ UI è®¾è®¡
- WebSocket å®¢æˆ·ç«¯
- å›¾ç‰‡å‹ç¼©å’Œé¢„è§ˆ

## ğŸ”§ é…ç½®é€‰é¡¹

### R2 å­˜å‚¨é…ç½®
```toml
[[r2_buckets]]
binding = â€R2_BUCKETâ€œ
bucket_name = â€your-bucket-nameâ€œ
```

### æ¶ˆæ¯åè®®
```javascript
// æ–‡æœ¬æ¶ˆæ¯
{
  type: â€™chatâ€˜,
  payload: {
    text: â€™Hello world!â€˜
  }
}

// å›¾ç‰‡æ¶ˆæ¯
{
  type: â€™chatâ€˜,
  payload: {
    type: â€™imageâ€˜,
    image: â€™data:image/jpeg;base64,...â€˜,
    filename: â€™photo.jpgâ€˜,
    size: 123456,
    caption: â€™å¯é€‰è¯´æ˜æ–‡å­—â€˜
  }
}
```

## ğŸ“± ä½¿ç”¨æŒ‡å—

### åŸºæœ¬æ“ä½œ
1. **åŠ å…¥æˆ¿é—´**ï¼šè®¿é—® `/æˆ¿é—´å` è·¯å¾„
2. **å‘é€æ¶ˆæ¯**ï¼šåœ¨è¾“å…¥æ¡†è¾“å…¥æ–‡å­—ï¼ŒæŒ‰ Enter å‘é€
3. **æ¢è¡Œ**ï¼šæŒ‰ Shift+Enter åœ¨æ¶ˆæ¯ä¸­æ¢è¡Œ
4. **å‘é€å›¾ç‰‡**ï¼šç‚¹å‡» ğŸ“ æŒ‰é’®é€‰æ‹©å›¾ç‰‡

### ç§»åŠ¨ç«¯ä½¿ç”¨
- **ä¾§è¾¹æ **ï¼šç‚¹å‡» â˜° æŒ‰é’®æŸ¥çœ‹åœ¨çº¿ç”¨æˆ·
- **å›¾ç‰‡æŸ¥çœ‹**ï¼šç‚¹å‡»å›¾ç‰‡å…¨å±é¢„è§ˆ
- **è¾“å…¥ä¼˜åŒ–**ï¼šæ”¯æŒè½¯é”®ç›˜è‡ªåŠ¨é€‚é…

### æˆ¿é—´ç®¡ç†
- **åˆ›å»ºæˆ¿é—´**ï¼šç›´æ¥è®¿é—®æ–°çš„æˆ¿é—´åå³å¯åˆ›å»º
- **æˆ¿é—´æŒä¹…åŒ–**ï¼šèŠå¤©è®°å½•è‡ªåŠ¨ä¿å­˜
- **ç”¨æˆ·é™åˆ¶**ï¼šæ— éœ€æ³¨å†Œï¼Œè¾“å…¥ç”¨æˆ·åå³å¯ä½¿ç”¨

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
wrangler dev

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
wrangler tail
```

### è‡ªå®šä¹‰åŠŸèƒ½

#### æ·»åŠ æ–°æ¶ˆæ¯ç±»å‹
1. åœ¨ `chatroom_do.js` ä¸­å®šä¹‰æ–°çš„æ¶ˆæ¯ç±»å‹å¸¸é‡
2. åœ¨ `handleChatMessage` ä¸­æ·»åŠ å¤„ç†é€»è¾‘
3. åœ¨å‰ç«¯ `appendChatMessage` ä¸­æ·»åŠ æ˜¾ç¤ºé€»è¾‘

#### ä¿®æ”¹ UI æ ·å¼
æ‰€æœ‰æ ·å¼éƒ½åœ¨ `index.html` çš„ `<style>` æ ‡ç­¾ä¸­ï¼Œæ”¯æŒï¼š
- CSS å˜é‡è‡ªå®šä¹‰ä¸»é¢˜è‰²
- å“åº”å¼æ–­ç‚¹è°ƒæ•´
- åŠ¨ç”»æ•ˆæœå®šåˆ¶

#### æ‰©å±•å­˜å‚¨åŠŸèƒ½
å¯ä»¥åœ¨ Durable Object ä¸­æ·»åŠ æ›´å¤šæŒä¹…åŒ–æ•°æ®ï¼š
```javascript
await this.state.storage.put(â€custom-dataâ€œ, data);
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

- **è¾“å…¥éªŒè¯**ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡ HTML è½¬ä¹‰
- **æ–‡ä»¶ç±»å‹é™åˆ¶**ï¼šä»…æ”¯æŒå›¾ç‰‡æ–‡ä»¶ä¸Šä¼ 
- **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼šå‰ç«¯å‹ç¼©å›¾ç‰‡é¿å…è¿‡å¤§æ–‡ä»¶
- **CORS é…ç½®**ï¼šR2 å­˜å‚¨æ¡¶é…ç½®é€‚å½“çš„è·¨åŸŸç­–ç•¥

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–
- **å›¾ç‰‡æ‡’åŠ è½½**ï¼šä½¿ç”¨ `loading=â€lazyâ€œ` å±æ€§
- **å›¾ç‰‡å‹ç¼©**ï¼šCanvas API å‹ç¼©åˆ° 800x600
- **CSS ä¼˜åŒ–**ï¼šä½¿ç”¨ CSS å˜æ¢è€Œéé‡ç»˜
- **äº‹ä»¶èŠ‚æµ**ï¼šè¾“å…¥æ¡†é«˜åº¦è°ƒæ•´ä½¿ç”¨èŠ‚æµ

### åç«¯ä¼˜åŒ–
- **æ¶ˆæ¯é™åˆ¶**ï¼šå†…å­˜ä¸­æœ€å¤šä¿å­˜ 100 æ¡æ¶ˆæ¯
- **å­˜å‚¨èŠ‚æµ**ï¼š5ç§’å†…æœ€å¤šä¿å­˜ä¸€æ¬¡åˆ°æŒä¹…åŒ–å­˜å‚¨
- **å¹¶å‘æ§åˆ¶**ï¼šä½¿ç”¨ `blockConcurrencyWhile` é¿å…ç«æ€

## ğŸŒ éƒ¨ç½²é€‰é¡¹

### Cloudflare Workers
```bash
wrangler deploy
```

### è‡ªå®šä¹‰åŸŸå
åœ¨ Cloudflare æ§åˆ¶å°ä¸­é…ç½®è‡ªå®šä¹‰åŸŸåç»‘å®šã€‚

### ç¯å¢ƒå˜é‡
```toml
[env.production]
[[env.production.r2_buckets]]
binding = â€R2_BUCKETâ€œ
bucket_name = â€chatroom-prodâ€œ
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m â€™Add some AmazingFeatureâ€˜`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“‹ å¾…åŠäº‹é¡¹

- [ ] æ·»åŠ ç”¨æˆ·å¤´åƒæ”¯æŒ
- [ ] å®ç°æ¶ˆæ¯å›å¤åŠŸèƒ½
- [ ] æ·»åŠ  @ æåŠåŠŸèƒ½
- [ ] æ”¯æŒ Markdown æ ¼å¼
- [ ] æ·»åŠ è¡¨æƒ…ç¬¦å·é€‰æ‹©å™¨
- [ ] å®ç°ç§äººæ¶ˆæ¯
- [ ] æ·»åŠ ç®¡ç†å‘˜åŠŸèƒ½
- [ ] æ”¯æŒéŸ³é¢‘æ¶ˆæ¯
- [ ] å®ç°æ¶ˆæ¯æœç´¢
- [ ] æ·»åŠ ä¸»é¢˜åˆ‡æ¢

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) è®¸å¯è¯ã€‚

## ğŸ™ è‡´è°¢

- [Cloudflare Workers](https://workers.cloudflare.com/) - æ— æœåŠ¡å™¨è®¡ç®—å¹³å°
- [Durable Objects](https://developers.cloudflare.com/workers/learning/using-durable-objects/) - æœ‰çŠ¶æ€è®¡ç®—
- [Cloudflare R2](https://developers.cloudflare.com/r2/) - å¯¹è±¡å­˜å‚¨æœåŠ¡

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
- åˆ›å»º [Issue](https://github.com/your-username/chatroom/issues)
- å‘é€é‚®ä»¶è‡³ï¼šyour-email@example.com
- è®¿é—® [é¡¹ç›®ä¸»é¡µ](https://your-chatroom.workers.dev)

â€”

â­ **å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª Starï¼**