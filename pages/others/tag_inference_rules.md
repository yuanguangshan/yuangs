# 标签自动推断规则说明

## 概述

标签推断系统分为两大类：**朝代/类型标签** 和 **主题标签**，通过分析作者、标题和内容自动添加相关标签。

---

## 一、朝代/类型标签推断

### 推断依据

#### 1. **作者名匹配**
基于历史作者数据库进行朝代判定：

| 朝代 | 代表作者 |
|------|---------|
| **先秦** | 屈原、宋玉、荀子、庄子、孟子、孔子、老子、韩非子 |
| **汉** | 司马相如、卓文君、刘邦、项羽、刘彻 |
| **魏晋** | 曹操、曹丕、曹植、陶渊明、阮籍、嵇康、谢灵运、鲍照 |
| **唐** | 李白、杜甫、王维、白居易、孟浩然、王昌龄、李商隐、杜牧等 |
| **南唐** | 李煜、李璟、冯延巳 |
| **宋** | 苏轼、李清照、辛弃疾、柳永、岳飞、陆游、欧阳修等 |
| **清** | 纳兰性德、纳兰容若、顾贞观、陈维崧、朱彝尊 |
| **现代** | 毛泽东 |

**示例**：
- 作者 = "李白" → 添加标签 `['唐', '唐诗']`
- 作者 = "苏轼" → 添加标签 `['宋', '宋词']`
- 作者 = "纳兰性德" → 添加标签 `['清', '清词']`

#### 2. **标题关键词匹配**
通过标题中的特定词汇判断类型：

| 关键词 | 推断标签 |
|--------|---------|
| "楚辞"、"九歌"、"离骚" | `楚辞` |
| "咏"、"题"、"赋" | `咏物` |
| 节日名称（清明、重阳、中秋等） | `节日` |

**示例**：
- 标题 = "九歌·湘夫人" → 添加标签 `['先秦', '楚辞']`
- 标题 = "咏柳" → 添加标签 `['咏物']`

#### 3. **现有标签识别**
保留并补充原有标签：

- 如果已有 `诗经` 标签 → 添加 `先秦`
- 如果已有 `唐诗` 标签 → 添加 `唐`
- 如果已有 `宋词` 标签 → 添加 `宋`
- 如果已有 `蒙学` 标签 → 保持不变

---

## 二、主题标签推断

### 推断规则（基于关键词匹配）

#### 1. **边塞诗** 🏜️
**关键词**：关、塞、戍、征、胡、羌、烽火、长城、玉门、阴山、龙城

**匹配范围**：标题 + 内容

**示例**：
```
"秦时明月汉时关，万里长征人未还" → 边塞
```

#### 2. **田园诗** 🌾
**关键词**：田、农、耕、桑、麻、菊、篱、归、隐、山居、渔樵

**匹配范围**：标题 + 内容

**示例**：
```
"采菊东篱下，悠然见南山" → 田园
```

#### 3. **送别诗** 👋
**关键词**：送、别、离、行、赠、饯、征人、游子、客

**匹配范围**：标题 + 内容

**示例**：
```
标题："送杜少府之任蜀州" → 送别
"劝君更尽一杯酒，西出阳关无故人" → 送别
```

#### 4. **思乡诗** 🏠
**关键词**：思、乡、故、归、家、月、梦、泪、愁

**匹配范围**：标题 + 内容

**示例**：
```
"举头望明月，低头思故乡" → 思乡
```

#### 5. **爱国诗** 🇨🇳
**关键词**：国、君、社稷、天下、报国、忠、义

**匹配范围**：标题 + 内容

**示例**：
```
"王师北定中原日，家祭无忘告乃翁" → 爱国
```

#### 6. **咏物诗** 🌸
**关键词**：咏、题、赋

**匹配范围**：仅标题

**示例**：
```
标题："咏柳" → 咏物
标题："题西林壁" → 咏物
```

#### 7. **山水诗** ⛰️
**关键词**：山、水、江、河、湖、海、峰、岭、溪、泉

**匹配范围**：仅内容

**示例**：
```
"日照香炉生紫烟，遥看瀑布挂前川" → 山水
```

#### 8. **爱情诗** 💕
**关键词**：相思、佳人、美人、情、恋、夫妇、君子好逑

**匹配范围**：仅内容

**示例**：
```
"窈窕淑女，君子好逑" → 爱情
"在天愿作比翼鸟，在地愿为连理枝" → 爱情
```

#### 9. **节日诗** 🎊
**关键词**：清明、重阳、中秋、元夕、端午、七夕

**匹配范围**：标题 + 内容

**示例**：
```
标题："九月九日忆山东兄弟" → 节日（重阳）
"清明时节雨纷纷" → 节日（清明）
```

---

## 三、标签优先级和组合

### 标签顺序
1. **朝代标签**（先秦、唐、宋等）
2. **类型标签**（诗经、唐诗、宋词等）
3. **体裁标签**（五言绝句、七言律诗等）
4. **主题标签**（边塞、田园、思乡等）

### 多标签示例

**示例 1：王维《九月九日忆山东兄弟》**
```json
{
  "author": "王维",
  "rhythmic": "九月九日忆山东兄弟",
  "tags": ["唐", "唐诗", "七言绝句", "思乡", "节日"]
}
```
- `唐` - 作者王维在唐代作者列表中
- `唐诗` - 自动添加
- `七言绝句` - 原有标签保留
- `思乡` - 内容包含"思"、"乡"
- `节日` - 标题包含"九月九日"（重阳节）

**示例 2：杜甫《春望》**
```json
{
  "author": "杜甫",
  "rhythmic": "春望",
  "tags": ["唐", "唐诗", "五言律诗", "思乡", "爱国", "山水"]
}
```
- `唐` - 作者杜甫
- `唐诗` - 自动添加
- `五言律诗` - 原有标签
- `思乡` - "家书抵万金"
- `爱国` - "国破山河在"
- `山水` - "山河"

---

## 四、特殊处理

### 1. 诗经
- 作者 = "诗经" 或已有 `诗经` 标签
- 自动添加：`['先秦', '诗经']`

### 2. 蒙学经典
- 已有 `蒙学` 标签
- 保持原有标签不变（如"三字经"、"声律启蒙"）

### 3. 去重逻辑
- 相同标签不会重复添加
- 主题标签会追加到现有标签列表末尾

---

## 五、代码实现

完整推断逻辑见：[`merge_poetry.py`](file:///Users/ygs/chinese-poetry/merge_poetry.py)

核心函数：
- `infer_theme_tags(poem)` - 主题标签推断（第29-72行）
- `categorize_poem(poem, source)` - 朝代/类型标签推断（第74-161行）

---

## 六、统计结果

根据推断规则，当前数据库的主题分布：

| 主题 | 数量 | 占比 |
|------|------|------|
| 思乡 | 981 | 68.8% |
| 山水 | 758 | 53.2% |
| 送别 | 612 | 42.9% |
| 田园 | 464 | 32.6% |
| 爱国 | 326 | 22.9% |
| 边塞 | 298 | 20.9% |
| 爱情 | 277 | 19.4% |
| 咏物 | 44 | 3.1% |
| 节日 | 33 | 2.3% |

**注**：一首诗可能同时拥有多个主题标签
