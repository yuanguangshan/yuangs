<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœŸè´§å“ç§ç›‘æ§</title>
    <!-- å¼•å…¥ ECharts è„šæœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        /* å›¾è¡¨å®¹å™¨æ ·å¼ */
        .chart-container {
            position: relative;
            width: 100%;
            height: 450px;
            margin-bottom: 60px;
        }

        .chart {
            width: 100%;
            height: 100%;
        }

        /* ä¸‹è½½æŒ‰é’®æ ·å¼ */
        .download-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            padding: 8px 15px;
            background-color: #007ACC;
            color: white;
            border: none;
            cursor: pointer;
            z-index: 10;
            border-radius: 5px;
            font-size: 14px;
            opacity: 0.8;
        }

        .download-btn:hover {
            background-color: #005A9E;
            opacity: 1;
        }

        /* é¡µé¢æ•´ä½“èƒŒæ™¯å’Œå­—ä½“ */
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 30px;
        }

        /* å›¾è¡¨æ ‡é¢˜æ ·å¼ */
        .chart-title {
            text-align: center;
            font-size: 20px;
            margin-bottom: 10px;
            color: #333;
        }
    </style>
</head>
<body>

<h1 id="current-time">ğŸ—æœŸè´§å“ç§å®æ—¶ç›‘æ§ğŸ—</h1>


<!-- ç¬¬ä¸€ä¸ªå›¾è¡¨å®¹å™¨ï¼šæœŸè´§å“ç§èµ°åŠ¿å¯¹æ¯” -->
<div class="chart-container">
    <!-- <div class="chart-title">å›¾è¡¨1</div> -->
    <div id="main1" class="chart"></div>
    <button id="download-btn1" class="download-btn">ä¸‹è½½</button>
</div>

<!-- ç¬¬äºŒä¸ªå›¾è¡¨å®¹å™¨ï¼šå¢ä»“ç‡ vs æ¶¨è·Œå¹… -->
<div class="chart-container">
    <!-- <div class="chart-title">å›¾è¡¨2</div> -->
    <div id="main3" class="chart"></div>
    <button id="download-btn3" class="download-btn">ä¸‹è½½</button>
</div>

<!-- ç¬¬ä¸‰ä¸ªå›¾è¡¨å®¹å™¨ï¼šæŠ•æœºåº¦ vs æ¶¨å¹… -->
<div class="chart-container">
    <!-- <div class="chart-title">å›¾è¡¨2</div> -->
    <div id="main2" class="chart"></div>
    <button id="download-btn2" class="download-btn">ä¸‹è½½</button>
</div>

<!-- ç¬¬å››ä¸ªå›¾è¡¨å®¹å™¨ï¼šæœŸè´§å“ç§å„å‘¨æœŸæŒ‡æ ‡å¯¹æ¯” -->
<div class="chart-container">
    <!-- <div class="chart-title">å›¾è¡¨4</div> -->
    <div id="main4" class="chart"></div>
    <button id="download-btn4" class="download-btn">ä¸‹è½½</button>
</div>

<!-- ç¬¬äº”ä¸ªå›¾è¡¨å®¹å™¨ï¼šæœŸè´§å“ç§æŒ‡æ ‡å¯¹æ¯” -->
<div class="chart-container">
    <div id="main5" class="chart"></div>
</div>

<script>
    
    // è·å–å½“å‰æ—¶é—´å¹¶åˆ¤æ–­æ˜¯å¦ä¸ºæ—¥ç›˜æ—¶æ®µ
    function isDaySession() {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        
        // åˆ¤æ–­æ˜¯å¦åœ¨æ—¥ç›˜æ—¶æ®µï¼ˆ8:30 - 15:30ï¼‰
        const startOfDaySession = 8 * 60 + 30;  // 8:30 è½¬æ¢ä¸ºåˆ†é’Ÿ
        const endOfDaySession = 15 * 60 + 30;   // 15:30 è½¬æ¢ä¸ºåˆ†é’Ÿ
        const currentTimeInMinutes = hours * 60 + minutes;

        return currentTimeInMinutes >= startOfDaySession && currentTimeInMinutes <= endOfDaySession;
    }


    // æ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦ä¸ºæ—¥ç›˜æ—¶æ®µï¼Œé€‰æ‹©å¯¹åº”çš„ API åœ°å€
    const apiUrl = isDaySession() ? 'https://q.want.biz' : 'https://q.want.biz/night'; // ç¤ºä¾‹ API URL
    console.log(`Fetching data from: ${apiUrl}`); // è°ƒè¯•è¾“å‡º
    

    // å£°æ˜äº”ä¸ªå›¾è¡¨å®ä¾‹ã€‚
    const chart1 = echarts.init(document.getElementById('main1'));
    const chart2 = echarts.init(document.getElementById('main2'));
    const chart3 = echarts.init(document.getElementById('main3'));
    const chart4 = echarts.init(document.getElementById('main4'));
    const chart5 = echarts.init(document.getElementById('main5'));

    // æŒ‡æ ‡å­—æ®µæ˜ å°„
    const fieldMapping = {
        qrspj: 'æ˜¨æ”¶ç›˜ä»·',
        zdf5: '5æ—¥æ¶¨å¹…',
        zdf6: '6æ—¥æ¶¨å¹…',
        zjlx: 'èµ„é‡‘æµå‘',
        dm: 'ä»£ç ',
        zsjd: 'å±•ç¤ºç²¾åº¦',
        lx: 'å“ç§ç±»å‹ä»£å·',
        zdf0: 'è¿‘ä¸€å¹´æ¶¨å¹…',
        avg2: 'è®¡ç®—å‡ä»·',
        ccl: 'æŒä»“é‡',
        ly: 'è®¡ç®—æ¥æº',
        zdf250: '250æ—¥æ¶¨å¹…',
        zdf3: '3æ—¥æ¶¨å¹…',
        dt: 'è·Œåœ',
        bpgs: 'æ¡£ä½æ•°',
        mcj: 'å–å‡ºä»·',
        mcl: 'å–å‡ºé‡',
        zdflm: 'æœ¬æœˆæ¶¨å¹…',
        jjsj: 'ä»Šç»“ç®—ä»·',
        zf: 'æŒ¯å¹…',
        mmpl: 'é‡æ¡£ä½',
        tjd: 'æŠ•æœºåº¦',
        xsfx: 'ç°æ‰‹æ–¹å‘',
        name: 'åˆçº¦åç§°',
        zt: 'æ¶¨åœ',
        spgs: 'æ¡£ä½',
        mmpjg: 'ä»·æ ¼æ¡£ä½',
        zjsj: 'æ˜¨ç»“ç®—ä»·',
        spsj: 'æ”¶ç›˜æ—¶é—´',
        np: 'å†…ç›˜',
        rz: 'æ—¥å¢ä»“',
        kpsj: 'å¼€ç›˜æ—¶é—´',
        sc: 'å¸‚åœºä»£ç ',
        uid: 'å”¯ä¸€id',
        vol: 'æˆäº¤é‡',
        jysj: 'äº¤æ˜“æ—¶é—´',
        cjbs: 'æˆäº¤ç¬”æ•°',
        wp: 'å¤–ç›˜',
        zdf20: '20æ—¥æ¶¨å¹…',
        cje: 'æˆäº¤é¢',
        mrj: 'ä¹°å…¥ä»·',
        utime: 'æ›´æ–°æ—¶é—´',
        mrl: 'ä¹°å…¥é‡',
        h: 'æœ€é«˜ä»·',
        j: 'å‡ä»·',
        zccl: 'æ˜¨æŒä»“é‡',
        l: 'æœ€ä½ä»·',
        o: 'å¼€ç›˜ä»·',
        zdfly: 'ä»Šå¹´æ¶¨å¹…',
        p: 'æœ€æ–°ä»·',
        cclbh: 'æŒä»“å˜é‡',
        lb: 'é‡æ¯”',
        zde: 'æ¶¨è·Œé¢',
        jyzt: 'äº¤æ˜“çŠ¶æ€',
        xs: 'ç°æ‰‹',
        zdf: 'æ¶¨è·Œå¹…',
        cdzj: 'æ²‰æ·€èµ„é‡‘'
    };

    // è·å– URL å‚æ•°ä¸­çš„æŒ‡æ ‡å€¼
    const urlParams = new URLSearchParams(window.location.search);
    const metric1 = urlParams.get('i') || 'cje'; // é»˜è®¤ç¬¬ä¸€ä¸ªæŒ‡æ ‡ä¸ºæˆäº¤é¢ cje
    const metric2 = urlParams.get('j') || 'zdf'; // é»˜è®¤ç¬¬äºŒä¸ªæŒ‡æ ‡ä¸ºæ¶¨è·Œå¹… zdf

    // è·å–æ•°æ®å¹¶è°ƒç”¨ç»˜å›¾å‡½æ•°
    // Click the bar to view more detailed lhbdata to analyse the trend!!!
    async function fetchData() {
        try {
            const response = await fetch(apiUrl);
            const apiData = await response.json(); // å‡è®¾è¿”å›çš„æ•°æ®ç»“æ„ä¸ä¹‹å‰çš„ç›¸ä¼¼

            // è¿‡æ»¤æ²‰æ·€èµ„é‡‘å¤§äº 15 äº¿çš„å“ç§
            let filteredData = apiData.list.filter(item => item.cdzj > 15 * 1e8);

            // æ£€æŸ¥æ˜¯å¦æœ‰æœªæ”¶ç›˜çš„å“ç§ (jyzt === 0)
            const hasOpenMarkets = filteredData.some(item => item.jyzt === 0);

            // å¦‚æœæœ‰æœªæ”¶ç›˜çš„å“ç§ï¼Œåˆ™åªæ˜¾ç¤ºæœªæ”¶ç›˜çš„å“ç§
            if (hasOpenMarkets) {
                filteredData = filteredData.filter(item => item.jyzt === 0);
            }

            // è°ƒç”¨äº”ä¸ªå›¾è¡¨çš„ç»˜åˆ¶å‡½æ•°
            renderChart1(filteredData);  // æœŸè´§å“ç§èµ°åŠ¿å¯¹æ¯”
            renderChart2(filteredData);  // æŠ•æœºåº¦ vs æ¶¨å¹…å›¾è¡¨
            renderChart3(filteredData);  // å¢ä»“ç‡ vs æ¶¨è·Œå¹…å›¾è¡¨
            renderChart4(filteredData);  // å„å‘¨æœŸæ¶¨è·Œå¹…å¯¹æ¯”
            renderChart5(filteredData, metric1, metric2);  // æœŸè´§å“ç§æŒ‡æ ‡å¯¹æ¯”
        } catch (error) {
            console.error('æ•°æ®è·å–å¤±è´¥:', error);
        }
    }

    // ç»˜åˆ¶ç¬¬ä¸€ä¸ªå›¾è¡¨: æœŸè´§å“ç§èµ°åŠ¿å¯¹æ¯”
    function renderChart1(dataList) {
        const processedData = dataList.map(item => {
            const openChange = parseFloat(((item.o - item.zjsj) / item.zjsj * 100).toFixed(2));  // å¼€ç›˜æ¶¨å¹…
            const closeChange = parseFloat(((item.p - item.zjsj) / item.zjsj * 100).toFixed(2)); // æ”¶ç›˜æ¶¨å¹…
            const lowChange = parseFloat(((item.l - item.zjsj) / item.zjsj * 100).toFixed(2));   // æœ€ä½æ¶¨å¹…
            const highChange = parseFloat(((item.h - item.zjsj) / item.zjsj * 100).toFixed(2));  // æœ€é«˜æ¶¨å¹…
            return {
                name: item.name,
                dm: item.dm,
                data: [openChange, closeChange, lowChange, highChange], // ä¿å­˜æ¶¨è·Œå¹…æ•°æ®
                closeChange // ä¿å­˜æ”¶ç›˜æ¶¨å¹…ç”¨æ¥æ’åº
            };
        });

        const sortedData = processedData.sort((a, b) => b.closeChange - a.closeChange);
        const categories = sortedData.map(item => item.name);
        const sortedProcessedData = sortedData.map(item => item);

        const option = {
            title: {
                text: 'æœŸè´§å“ç§èµ°åŠ¿å¯¹æ¯”',
                left: 'center',
                textStyle: {
                    fontSize: 18,
                    color: '#333'
                }
            },
            backgroundColor: '#EAECEDFF', // èƒŒæ™¯é¢œè‰²
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                },

            },
            xAxis: {
                type: 'category',
                data: categories,
                axisLabel: {
                    interval: 0,
                    rotate: 270, // è°ƒæ•´ä¸º45åº¦è§’ï¼Œé¿å…è¿‡é•¿æ—¶é‡å 
                    fontSize: 12,
                    color: '#333'
                },
                axisLine: {
                    lineStyle: {
                        color: '#aaa'
                    }
                }
            },
            yAxis: {
                type: 'value',
                axisLabel: {
                    formatter: value => value.toFixed(2) + ' %',
                    fontSize: 12,
                    color: '#333'
                },
                splitLine: {
                    lineStyle: {
                        color: '#eee'
                    }
                },
                axisLine: {
                    lineStyle: {
                        color: '#aaa'
                    }
                }
            },
            dataZoom: [
                {
                    type: 'inside',
                    start: 0,
                    end: 100
                },
                {
                    start: 0,
                    end: 100
                }
            ],
            series: [{
                name: 'æ¶¨è·Œå¹…',
                type: 'candlestick',
                data: sortedProcessedData.map(item => ({
                    value: item.data,
                    dm: item.dm,
                    name: item.name
                })),
                itemStyle: {
                    color: '#EF5350',    // é˜³çº¿é¢œè‰²
                    color0: '#53A626FF',   // é˜´çº¿é¢œè‰²
                    borderColor: '#EF5350',
                    borderColor0: '#26A69A'
                },
                markPoint: {
                    label: {
                        formatter: '{c}%',
                        color: '#fff'
                    },
                    data: [
                        {
                            type: 'max',
                            name: 'max',
                            valueDim: 'close'
                        },
                        {
                            type: 'min',
                            name: 'min',
                            valueDim: 'close'
                        }
                    ],
                    symbolSize: 66,
                    itemStyle: {
                        color: '#A722EFFF'
                    }
                }
            }]
        };

        chart1.setOption(option);

        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        chart1.off('click'); // å…ˆç§»é™¤ä¹‹å‰çš„ç‚¹å‡»äº‹ä»¶ï¼Œé¿å…å¤šæ¬¡ç»‘å®š
        chart1.on('click', function (params) {
            const dataItem = params.data;
            const dm = dataItem.dm;
            const codeWithoutNumbers = stripNumbers(dm);

            const date = getCorrectDate();
            const formattedDate = formatDate(date); // æ ¼å¼åŒ–æ—¥æœŸä¸º 'YYYY-MM-DD'

            // æ„å»ºURL
            const baseUrl = 'https://data.want.biz/ranking/' + codeWithoutNumbers + '/all/' + formattedDate;
            const queryString = '?variety=' + codeWithoutNumbers + '&sort_by=%E5%87%80%E6%8C%81%E4%BB%93%E6%95%B0%E5%80%BC&order=desc#profits';

            const url = baseUrl + queryString;

            // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
            window.open(url, '_blank');
        });
    }

    // å»é™¤å­—ç¬¦ä¸²ä¸­çš„æ•°å­—
    function stripNumbers(str) {
        return str.replace(/\d+/g, '');
    }

    // è·å–æ­£ç¡®çš„æ—¥æœŸ
    function getCorrectDate() {
        const now = new Date();
        const hour = now.getHours();
        let date;

        if (hour >= 0 && hour < 16) {
            // ç™½å¤©ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªäº¤æ˜“æ—¥
            date = getLastTradingDay();
        } else if (hour >= 16 || hour <= 24) {
            // æ™šä¸Šï¼Œä½¿ç”¨å½“å‰äº¤æ˜“æ—¥
            date = now;
        } else {
            // éäº¤æ˜“æ—¶é—´ï¼Œé»˜è®¤ä½¿ç”¨ä¸Šä¸€ä¸ªäº¤æ˜“æ—¥
            date = getLastTradingDay();
        }
        return date;
    }

    // è·å–ä¸Šä¸€ä¸ªäº¤æ˜“æ—¥ï¼ˆä¸åŒ…æ‹¬å‘¨æœ«ï¼‰
    function getLastTradingDay() {
        const today = new Date();
        let lastTradingDay = new Date(today);
        const dayOfWeek = today.getDay(); // 0ï¼ˆå‘¨æ—¥ï¼‰ åˆ° 6ï¼ˆå‘¨å…­ï¼‰

        if (dayOfWeek === 0) { // å‘¨æ—¥
            lastTradingDay.setDate(today.getDate() - 2); // å‘¨äº”
        } else if (dayOfWeek === 1) { // å‘¨ä¸€
            lastTradingDay.setDate(today.getDate() - 3); // å‘¨äº”
        } else {
            lastTradingDay.setDate(today.getDate() - 1); // æ˜¨å¤©
        }
        return lastTradingDay;
    }

    // æ ¼å¼åŒ–æ—¥æœŸä¸º 'YYYY-MM-DD'
    function formatDate(date) {
        const year = date.getFullYear();
        const month = date.getMonth() + 1; // æœˆä»½ä»0å¼€å§‹
        const day = date.getDate();

        const monthStr = month < 10 ? '0' + month : month;
        const dayStr = day < 10 ? '0' + day : day;

        return year + '-' + monthStr + '-' + dayStr;
    }

    // ç»˜åˆ¶ç¬¬äºŒä¸ªå›¾è¡¨: æŠ•æœºåº¦ vs æ¶¨å¹…
    function renderChart2(dataList) {
        dataList.sort((a, b) => b.zdf - a.zdf);
        const categories = dataList.map(item => item.name);
        const tjdData = dataList.map(item => item.tjd);
        const zdfData = dataList.map(item => item.zdf);

        const option = {
            title: {
                text: 'æŠ•æœºåº¦ä¸æ¶¨è·Œå¹…',
                left: 'center',
                textStyle: {
                    fontSize: 18,
                    color: '#333'
                }
            },
            backgroundColor: '#EAECEDFF',
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            legend: {
                data: ['æŠ•æœºåº¦', 'æ¶¨å¹…'],
                top: '8%',
                textStyle: {
                    fontSize: 12
                }
            },
            xAxis: {
                type: 'category',
                data: categories,
                axisLabel: {
                    interval: 0,
                    rotate: 270,
                    fontSize: 12,
                    color: '#333'
                },
                axisLine: {
                    lineStyle: {
                        color: '#aaa'
                    }
                }
            },
            yAxis: [
                {
                    type: 'value',
                    name: 'æŠ•æœºåº¦/100',
                    position: 'left',
                    axisLabel: {
                        fontSize: 12,
                        color: '#333'
                    },
                    splitLine: {
                        lineStyle: {
                            color: '#eee'
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#aaa'
                        }
                    }
                },
                {
                    type: 'value',
                    name: 'æ¶¨å¹… (%)',
                    position: 'right',
                    axisLabel: {
                        formatter: '{value} %',
                        fontSize: 12,
                        color: '#333'
                    },
                    splitLine: {
                        show: false
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#aaa'
                        }
                    }
                }
            ],
            dataZoom: [
                {
                    type: 'inside',
                    start: 0,
                    end: 100
                },
                {
                    start: 0,
                    end: 100
                }
            ],
            series: [
                {
                    name: 'æŠ•æœºåº¦',
                    type: 'bar',
                    data: tjdData,
                    yAxisIndex: 0,
                    itemStyle: {
                        color: '#42A5F5'
                    },
                    barWidth: '45%'
                },
                {
                    name: 'æ¶¨å¹…',
                    type: 'line',
                    data: zdfData,
                    yAxisIndex: 1,
                    itemStyle: {
                        color: '#FF7043'
                    },
                    lineStyle: {
                        width: 2
                    },
                    smooth: true
                }
            ]
        };

        chart2.setOption(option);
    }

    // ç»˜åˆ¶ç¬¬ä¸‰ä¸ªå›¾è¡¨: å¢ä»“ç‡ vs æ¶¨è·Œå¹…
    function renderChart3(dataList) {
        dataList.sort((a, b) => b.zdf - a.zdf);
        const categories = dataList.map(item => item.name);
        const zdfData = dataList.map(item => item.zdf);
        const zclData = dataList.map(item => parseFloat(((item.rz / (item.ccl - item.rz)) * 100).toFixed(2)));

        const option = {
            title: {
                text: 'æœŸè´§å“ç§å¢ä»“ç‡ä¸æ¶¨è·Œå¹…å¯¹æ¯”',
                left: 'center',
                textStyle: {
                    fontSize: 18,
                    color: '#333'
                }
            },
            backgroundColor: '#EAECEDFF',
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            legend: {
                data: ['å¢ä»“ç‡', 'æ¶¨è·Œå¹…'],
                top: '8%',
                textStyle: {
                    fontSize: 12
                }
            },
            xAxis: {
                type: 'category',
                data: categories,
                axisLabel: {
                    interval: 0,
                    rotate: 270,
                    fontSize: 12,
                    color: '#333'
                },
                axisLine: {
                    lineStyle: {
                        color: '#aaa'
                    }
                }
            },
            yAxis: [
                {
                    type: 'value',
                    name: 'å¢ä»“ç‡ (%)',
                    position: 'left',
                    axisLabel: {
                        formatter: '{value} %',
                        fontSize: 12,
                        color: '#333'
                    },
                    splitLine: {
                        lineStyle: {
                            color: '#eee'
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#aaa'
                        }
                    }
                },
                {
                    type: 'value',
                    name: 'æ¶¨è·Œå¹… (%)',
                    position: 'right',
                    axisLabel: {
                        formatter: '{value} %',
                        fontSize: 12,
                        color: '#333'
                    },
                    splitLine: {
                        show: false
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#aaa'
                        }
                    }
                }
            ],
            dataZoom: [
                {
                    type: 'inside',
                    start: 0,
                    end: 100
                },
                {
                    start: 0,
                    end: 100
                }
            ],
            series: [
                {
                    name: 'å¢ä»“ç‡',
                    type: 'bar',
                    data: zclData,
                    yAxisIndex: 0,
                    itemStyle: {
                        color: '#42A5F5'
                    },
                    barWidth: '45%'
                },
                {
                    name: 'æ¶¨è·Œå¹…',
                    type: 'line',
                    data: zdfData,
                    yAxisIndex: 1,
                    itemStyle: {
                        color: '#EF5350'
                    },
                    lineStyle: {
                        width: 2
                    },
                    smooth: true
                }
            ]
        };

        chart3.setOption(option);

        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        chart3.off('click'); // å…ˆç§»é™¤ä¹‹å‰çš„ç‚¹å‡»äº‹ä»¶ï¼Œé¿å…å¤šæ¬¡ç»‘å®š
        chart3.on('click', function (params) {
            // è·å–ç‚¹å‡»çš„æ•°æ®é¡¹
            const dataIndex = params.dataIndex;
            const dm = dataList[dataIndex].dm;
            const codeWithoutNumbers = stripNumbers(dm);
            
            // æ„å»ºURL
            const url = 'https://wealth.want.biz/pages/longshort.html?variety=' + codeWithoutNumbers;
            
            // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
            window.open(url, '_blank');
        });
    }

    // ç»˜åˆ¶ç¬¬å››ä¸ªå›¾è¡¨: å„å‘¨æœŸæ¶¨è·Œå¹…å¯¹æ¯”
    function renderChart4(dataList) {
        const categories = dataList.map(item => item.name);
        const zdfData = dataList.map(item => item.zdf);
        const zdf3Data = dataList.map(item => item.zdf3);
        const zdf5Data = dataList.map(item => item.zdf5);
        const zdf20Data = dataList.map(item => item.zdf20);
        const zdflyData = dataList.map(item => item.zdfly);
        const zdf0Data = dataList.map(item => item.zdf0);
        const zdf250Data = dataList.map(item => item.zdf250);

        const option = {
            title: {
                text: 'æœŸè´§å“ç§å„å‘¨æœŸæ¶¨è·Œå¹…å¯¹æ¯”',
                left: 'center',
                textStyle: {
                    fontSize: 18,
                    color: '#333'
                }
            },
            backgroundColor: '#EAECEDFF',
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'line'
                }
            },
            legend: {
                data: ['å½“æ—¥æ¶¨å¹…', '3æ—¥æ¶¨å¹…', '5æ—¥æ¶¨å¹…', '20æ—¥æ¶¨å¹…', 'ä»Šå¹´æ¶¨å¹…', 'è¿‘ä¸€å¹´æ¶¨å¹…', '250æ—¥æ¶¨å¹…'],
                top: '8%',
                textStyle: {
                    fontSize: 12
                },
                type: 'scroll',
                orient: 'horizontal',
                width: '80%'
            },
            xAxis: {
                type: 'category',
                data: categories,
                boundaryGap: false,
                axisLabel: {
                    interval: 0,
                    rotate: 270,
                    fontSize: 12,
                    color: '#333'
                },
                axisLine: {
                    lineStyle: {
                        color: '#aaa'
                    }
                }
            },
            yAxis: {
                type: 'value',
                name: 'æ¶¨è·Œå¹… (%)',
                axisLabel: {
                    formatter: '{value} %',
                    fontSize: 12,
                    color: '#333'
                },
                splitLine: {
                    lineStyle: {
                        color: '#eee'
                    }
                },
                axisLine: {
                    lineStyle: {
                        color: '#aaa'
                    }
                }
            },
            dataZoom: [
                {
                    type: 'inside',
                    start: 0,
                    end: 100
                },
                {
                    start: 0,
                    end: 100
                }
            ],
            series: [
                {
                    name: 'å½“æ—¥æ¶¨å¹…',
                    type: 'line',
                    data: zdfData,
                    itemStyle: {
                        color: '#FF5722'
                    },
                    lineStyle: {width: 2},
                    smooth: true
                },
                {
                    name: '3æ—¥æ¶¨å¹…',
                    type: 'line',
                    data: zdf3Data,
                    itemStyle: {
                        color: '#8BC34A'
                    },
                    lineStyle: {width: 2},
                    smooth: true
                },
                {
                    name: '5æ—¥æ¶¨å¹…',
                    type: 'line',
                    data: zdf5Data,
                    itemStyle: {
                        color: '#42A5F5'
                    },
                    lineStyle: {width: 2},
                    smooth: true
                },
                {
                    name: '20æ—¥æ¶¨å¹…',
                    type: 'line',
                    data: zdf20Data,
                    itemStyle: {
                        color: '#AB47BC'
                    },
                    lineStyle: {width: 2},
                    smooth: true
                },
                {
                    name: 'ä»Šå¹´æ¶¨å¹…',
                    type: 'line',
                    data: zdflyData,
                    itemStyle: {
                        color: '#FFA726'
                    },
                    lineStyle: {width: 2},
                    smooth: true
                },
                {
                    name: 'è¿‘ä¸€å¹´æ¶¨å¹…',
                    type: 'line',
                    data: zdf0Data,
                    itemStyle: {
                        color: '#26A69A'
                    },
                    lineStyle: {width: 2},
                    smooth: true
                },
                {
                    name: '250æ—¥æ¶¨å¹…',
                    type: 'line',
                    data: zdf250Data,
                    itemStyle: {
                        color: '#EC407A'
                    },
                    lineStyle: {width: 2},
                    smooth: true
                }
            ]
        };

        chart4.setOption(option);
    }

    // ç»˜åˆ¶ç¬¬äº”ä¸ªå›¾è¡¨: æœŸè´§å“ç§æŒ‡æ ‡å¯¹æ¯”
    function renderChart5(dataList, metric1, metric2) {
        dataList.sort((a, b) => b[metric1] - a[metric1]);
        const categories = dataList.map(item => item.name);
        const metric1Data = dataList.map(item => item[metric1]);
        const metric2Data = dataList.map(item => item[metric2]);

        const option = {
            title: {
                text: `æœŸè´§å“ç§${fieldMapping[metric1]}ä¸${fieldMapping[metric2]}å¯¹æ¯”`,
                left: 'center',
                textStyle: {
                    fontSize: 18,
                    color: '#333'
                }
            },
            backgroundColor: '#EAECEDFF',
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                },
                formatter: function (params) {
                    let tooltipText = params[0].name;
                    params.forEach(param => {
                        tooltipText += `<br/>${param.marker}${param.seriesName}: ${param.value}`;
                    });
                    return tooltipText;
                }
            },
            legend: {
                data: [fieldMapping[metric1], fieldMapping[metric2]],
                top: '8%',
                textStyle: {
                    fontSize: 12
                }
            },
            xAxis: {
                type: 'category',
                data: categories,
                axisLabel: {
                    interval: 0,
                    rotate: 270,
                    fontSize: 12,
                    color: '#333'
                },
                axisLine: {
                    lineStyle: {
                        color: '#aaa'
                    }
                }
            },
            yAxis: [
                {
                    type: 'value',
                    name: fieldMapping[metric1],
                    position: 'left',
                    axisLabel: {
                        fontSize: 12,
                        color: '#333'
                    },
                    splitLine: {
                        lineStyle: {
                            color: '#eee'
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#aaa'
                        }
                    }
                },
                {
                    type: 'value',
                    name: fieldMapping[metric2],
                    position: 'right',
                    axisLabel: {
                        fontSize: 12,
                        color: '#333'
                    },
                    splitLine: {
                        show: false
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#aaa'
                        }
                    }
                }
            ],
            dataZoom: [
                {
                    type: 'inside',
                    start: 0,
                    end: 100
                },
                {
                    start: 0,
                    end: 100
                }
            ],
            series: [
                {
                    name: fieldMapping[metric1],
                    type: 'bar',
                    data: metric1Data.map(value => value.toFixed(2)),
                    yAxisIndex: 0,
                    itemStyle: {
                        color: '#42A5F5'
                    },
                    barWidth: '45%'
                },
                {
                    name: fieldMapping[metric2],
                    type: 'line',
                    data: metric2Data,
                    yAxisIndex: 1,
                    itemStyle: {
                        color: '#FF7043'
                    },
                    lineStyle: {
                        width: 2
                    },
                    smooth: true
                }
            ]
        };

        chart5.setOption(option);
    }

    // ä¸ºæ¯ä¸ªå›¾è¡¨æ·»åŠ ä¸‹è½½åŠŸèƒ½çš„äº‹ä»¶ç›‘å¬å™¨
    document.getElementById('download-btn1').addEventListener('click', () => {
        downloadChart(chart1, 'æœŸè´§å“ç§èµ°åŠ¿å¯¹æ¯”.png');
    });

    document.getElementById('download-btn2').addEventListener('click', () => {
        downloadChart(chart2, 'æŠ•æœºåº¦ä¸æ¶¨å¹…å¯¹æ¯”.png');
    });

    document.getElementById('download-btn3').addEventListener('click', () => {
        downloadChart(chart3, 'å¢ä»“ç‡ä¸æ¶¨è·Œå¹…å¯¹æ¯”.png');
    });

    document.getElementById('download-btn4').addEventListener('click', () => {
        downloadChart(chart4, 'å„å‘¨æœŸæ¶¨è·Œå¹…åº¦å¯¹æ¯”.png');
    });

    // ä¸‹è½½å›¾è¡¨å‡½æ•°
    function downloadChart(chartInstance, fileName) {
        const url = chartInstance.getDataURL({
            backgroundColor: '#EAECEDFF',
            pixelRatio: 2
        });
        const link = document.createElement('a');
        link.href = url;
        link.download = fileName;
        link.click();
    }

    // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®å¹¶ç»˜åˆ¶å›¾è¡¨
    fetchData();

    // çª—å£å¤§å°æ”¹å˜æ—¶ï¼Œé‡ç½®å›¾è¡¨å¤§å°
    window.addEventListener('resize', () => {
        chart1.resize();
        chart2.resize();
        chart3.resize();
        chart4.resize();
        chart5.resize();
    });


    // åœ¨éäº¤æ˜“æ—¶æ®µï¼Œä¸æ›´æ–°ï¼Œåœ¨äº¤æ˜“æ—¶æ®µï¼Œæ¯20ç§’æ›´æ–°ä¸€æ¬¡æ•°æ®
    setInterval(() => {
        const now = new Date();
        const hour = now.getHours();
        if ((hour >= 9 && hour < 15) || (hour >= 21 && hour < 24)) {
            fetchData();
            // è·å–å½“å‰æ—¶é—´
            const currentTime = new Date().toLocaleTimeString();

            // åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºå½“å‰æ—¶é—´
            document.getElementById('current-time').textContent = `æœŸè´§å“ç§å®æ—¶ç›‘æ§(${currentTime})`;
        }
    }, 15000);

//TODO
</script>
</body>
</html>