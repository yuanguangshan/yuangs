<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æå®¢éŸ³ä¹æ’­æ”¾å™¨ (éšæœºæ¢ç´¢ç‰ˆ)</title>
    <style>
        :root {
            --primary: #1db954;
            --accent: #ff5722; 
            --weather: #2196F3;
            --dark: #121212;
            --gray: #181818;
            --light: #b3b3b3;
            --white: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        
        body {
            background-color: var(--dark);
            color: var(--white);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: relative;
            /* åŠ¨æ€èƒŒæ™¯æ”¯æŒ */
            background-size: cover;
            background-position: center;
            transition: background-image 0.5s ease;
        }

        /* èƒŒæ™¯é®ç½©ï¼Œç¡®ä¿æ–‡å­—æ¸…æ™° */
        body::before {
            content: '';
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(18, 18, 18, 0.85); /* æ·±è‰²é®ç½© */
            z-index: 0;
            pointer-events: none;
        }

        /* 1. é¡¶éƒ¨æœç´¢æ  */
        .search-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 70px;
            background: rgba(18, 18, 18, 0.8);
            backdrop-filter: blur(20px);
            z-index: 50;
            display: flex;
            align-items: center;
            padding: 0 15px;
            gap: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 20px;
            border: 1px solid #333;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
            outline: none;
            min-width: 0;
            transition: background 0.2s;
        }
        input:focus { background: rgba(255,255,255,0.2); border-color: var(--primary); }

        /* é€šç”¨æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
            font-size: 13px;
            transition: transform 0.1s;
            display: flex; align-items: center; justify-content: center;
        }
        .btn:active { transform: scale(0.95); }

        .search-btn { background: var(--primary); }
        .random-btn { background: var(--accent); font-size: 16px; padding: 8px 12px; }
        .weather-btn { background: var(--weather); font-size: 16px; padding: 8px 12px; }

        /* 2. ä¸­é—´å†…å®¹åŒº */
        .results-container {
            position: absolute;
            top: 70px;
            bottom: 90px;
            left: 0;
            width: 100%;
            overflow-y: auto;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            z-index: 1;
        }

        .song-card {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        .song-card:hover { background: rgba(255,255,255,0.1); }
        .song-card:active { transform: scale(0.98); }
        .song-card img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 8px;
            background: #000;
        }
        .song-title {
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }
        .song-artist {
            font-size: 12px;
            color: var(--light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* 3. åº•éƒ¨æ’­æ”¾å™¨ */
        .player-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 90px;
            background: rgba(18, 18, 18, 0.95);
            border-top: 1px solid #333;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
        }

        .now-playing { display: flex; align-items: center; width: 35%; overflow: hidden; }
        .now-playing img {
            width: 50px; height: 50px; border-radius: 50%;
            margin-right: 10px; border: 2px solid #111;
            animation: rotate 10s linear infinite; animation-play-state: paused;
            background: #333;
        }
        .now-playing img.playing { animation-play-state: running; }
        @keyframes rotate { from {transform: rotate(0deg);} to {transform: rotate(360deg);} }
        .track-info { display: flex; flex-direction: column; overflow: hidden; }
        .track-info .name { font-size: 13px; font-weight: bold; white-space: nowrap; }
        .track-info .artist { font-size: 11px; color: var(--light); white-space: nowrap; }

        .controls { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .playback-controls {
            display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 6px;
        }
        .control-btn {
            width: 36px; height: 36px; border-radius: 50%; border: none;
            background: var(--white); color: black; font-size: 16px;
            cursor: pointer; display: flex;
            align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        .control-btn:active { transform: scale(0.95); }
        .play-btn {
            width: 40px; height: 40px; border-radius: 50%; border: none;
            background: var(--white); color: black; font-size: 18px;
            cursor: pointer; display: flex;
            align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .progress-area { width: 100%; max-width: 300px; display: flex; align-items: center; gap: 8px; font-size: 10px; color: var(--light); }
        #progress-bar { flex: 1; height: 4px; background: #555; border-radius: 2px; cursor: pointer; position: relative; }
        #progress-fill { height: 100%; background: var(--primary); width: 0%; border-radius: 2px; }

        .extras { width: 25%; display: flex; justify-content: flex-end; }
        .lyrics-btn {
            background: transparent; border: 1px solid #666; color: var(--light);
            padding: 4px 12px; border-radius: 12px; font-size: 12px; cursor: pointer;
        }

        /* 4. æ­Œè¯ä¸ç™¾ç§‘é®ç½© */
        .lyrics-overlay {
            position: fixed; top: 70px; bottom: 90px; left: 0; width: 100%;
            background: rgba(0,0,0,0.92); z-index: 80; display: none;
            flex-direction: column; align-items: center; padding: 40px 20px;
            text-align: center; overflow-y: auto;
            backdrop-filter: blur(5px);
        }
        .lyrics-overlay.show { display: flex; }
        .close-lyrics { position: absolute; top: 10px; right: 15px; background: none; border: none; color: #666; font-size: 28px; cursor: pointer; }
        .lyrics-content { white-space: pre-wrap; line-height: 2; color: #ddd; font-size: 16px; margin-top: 20px; padding-bottom: 50px; }

        /* æ­Œæ‰‹ç™¾ç§‘æ ·å¼ */
        .artist-wiki {
            width: 100%;
            max-width: 600px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #ccc;
            line-height: 1.6;
            text-align: left;
            display: none;
            border-left: 3px solid var(--primary);
        }
        .artist-wiki.show { display: block; animation: fadeIn 0.5s; }

        /* 5. å¼¹å¹•æ¡æ ·å¼ (ä¼˜åŒ–ç‰ˆ) */
        .comment-bar {
            position: fixed;
            bottom: 120px; 
            left: 0;
            width: 100%;
            height: 250px; 
            z-index: 90;
            pointer-events: none;
            overflow: hidden;
            display: none; 
            /* é¡¶éƒ¨å’Œåº•éƒ¨æ¸å˜é€æ˜ï¼Œé˜²æ­¢å¤ªçªå…€ */
            mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
        }
        .comment-bar.show { display: block; }
        
        .comment-item {
            position: absolute;
            left: 100%;
            display: flex; align-items: center; gap: 10px;
            color: white; font-size: 14px; white-space: nowrap;
            background: rgba(0,0,0,0.6); 
            padding: 6px 16px; border-radius: 20px;
            animation: slideLeft linear forwards; 
            text-shadow: 1px 1px 2px black;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .comment-avatar { width: 28px; height: 28px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.5); }
        
        @keyframes slideLeft {
            from { transform: translateX(0); }
            to { transform: translateX(-150vw); } /* ç¡®ä¿å®Œå…¨ç§»å‡ºå±å¹• */
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <!-- 1. é¡¶éƒ¨æœç´¢ -->
    <div class="search-container">
        <input type="text" id="search-input" placeholder="è¾“å…¥æ­Œæ‰‹æˆ–æ­Œæ›²å..." value="">
        <button class="btn search-btn" onclick="searchMusic()">æœç´¢</button>
        <button class="btn random-btn" onclick="randomSearch()" title="æ‰‹æ°”ä¸é”™">ğŸ²</button>
        <button class="btn weather-btn" onclick="searchByWeather()" title="çœ‹å¤©å¬æ­Œ">ğŸŒ¤</button>
    </div>

    <!-- 2. ä¸­é—´åˆ—è¡¨ -->
    <div class="results-container" id="results">
        <div style="text-align:center; padding-top:60px; color:#888; grid-column:1/-1;">
            <div style="font-size:40px; margin-bottom:10px;">ğŸ§</div>
            ç‚¹å‡» ğŸ² è¯•è¯•æ‰‹æ°”ï¼Œæˆ–è€…è¾“å…¥å…³é”®è¯æœç´¢<br>
            <span style="font-size:12px; opacity:0.6;">(æ”¯æŒ Apple Music è¯•å¬)</span>
        </div>
    </div>

    <!-- 3. æ­Œè¯ä¸è¯¦æƒ…é®ç½© -->
    <div class="lyrics-overlay" id="lyrics-overlay">
        <button class="close-lyrics" onclick="toggleLyrics()">Ã—</button>
        <h3 id="lyrics-title" style="color:var(--primary); margin-bottom:5px;"></h3>
        <div id="lyrics-artist" style="color:var(--light); font-size:12px; margin-bottom:15px;"></div>
        
        <!-- æ­Œæ‰‹ç™¾ç§‘å®¹å™¨ -->
        <div id="artist-wiki" class="artist-wiki"></div>
        <div class="lyrics-content" id="lyrics-text">æ­Œè¯åŠ è½½ä¸­...</div>
    </div>

    <!-- 4. å¼¹å¹•æ¡ -->
    <div class="comment-bar" id="comment-bar"></div>

    <!-- 5. åº•éƒ¨æ’­æ”¾å™¨ -->
    <div class="player-bar">
        <audio id="audio-player" crossorigin="anonymous"></audio>
        <div class="now-playing">
            <img id="player-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="CD" style="background:#333">
            <div class="track-info">
                <div class="name" id="player-name">æå®¢éŸ³ä¹</div>
                <div class="artist" id="player-artist">Ready</div>
            </div>
        </div>
        <div class="controls">
            <div class="playback-controls">
                <button class="control-btn" onclick="playPrevious()" id="prev-btn">â®</button>
                <button class="play-btn" onclick="togglePlay()" id="play-btn">â–¶</button>
                <button class="control-btn" onclick="playNext()" id="next-btn">â­</button>
            </div>
            <div class="progress-area">
                <span id="curr-time">0:00</span>
                <div id="progress-bar" onclick="seek(event)"><div id="progress-fill"></div></div>
                <span id="total-time">0:30</span>
            </div>
        </div>
        <div class="extras">
            <button class="lyrics-btn" onclick="toggleLyrics()">è¯¦æƒ…</button>
        </div>
    </div>

    <script>
        // --- å…¨å±€çŠ¶æ€ç®¡ç† ---
        const STATE = {
            currentTrack: null,
            commentInterval: null,
            commentHistory: [], // å¼¹å¹•ç¼“å­˜æ± 
            fetchCount: 0,
            isPlaying: false,
            // å¼¹å¹•è½¨é“å ç”¨çŠ¶æ€ (5ä¸ªè½¨é“)
            tracks: [false, false, false, false, false]
        };

        const DOM = {
            audio: document.getElementById('audio-player'),
            results: document.getElementById('results'),
            lyricsOverlay: document.getElementById('lyrics-overlay'),
            searchInput: document.getElementById('search-input'),
            playerCover: document.getElementById('player-cover'),
            playerName: document.getElementById('player-name'),
            playerArtist: document.getElementById('player-artist'),
            playBtn: document.getElementById('play-btn'),
            progressFill: document.getElementById('progress-fill'),
            currTime: document.getElementById('curr-time'),
            commentBar: document.getElementById('comment-bar'),
            lyricsText: document.getElementById('lyrics-text'),
            lyricsTitle: document.getElementById('lyrics-title'),
            lyricsArtist: document.getElementById('lyrics-artist'),
            wikiDiv: document.getElementById('artist-wiki')
        };
        
        // --- 1000 ä¸ªéšæœºéŸ³ä¹æœç´¢å…³é”®è¯åº“ (å®Œæ•´ä¿ç•™) ---
        const keywords = [
          "Love", "Happy", "Sad", "Lonely", "Crazy", "Beautiful", "Memory", "Forever", "Heart", "Soul",
          "Dream", "Kiss", "Miss", "Baby", "Sorry", "Believe", "Free", "Smile", "Cry", "Hope",
          "Hate", "Broken", "Wild", "Sweet", "Sweetheart", "Pain", "Joy", "Tears", "Fear", "Faith",
          "Desire", "Despair", "Passion", "Paradise", "Heaven", "Hell", "Promise", "Truth", "Lies", "Secret",
          "Lost", "Found", "Alone", "Together", "Stronger", "Weaker", "Brave", "Shy", "Proud", "Ashamed",
          "Jealous", "Envy", "Regret", "Blessing", "Curse", "Wish", "Magic", "Miracle", "Comfort", "Silence",
          "Freedom", "Control", "Chaos", "Order", "Light", "Dark", "Shadow", "Bright", "Cold", "Warm",
          "Calm", "Angry", "Mad", "Crazy Love", "True Love", "First Love", "Last Love", "Young Love", "Endless Love", "Secret Love",
          "Heartbreak", "Heartache", "Heartbeat", "Heartbeat Love", "Deep Love", "Deep Feelings", "Inner Voice", "Inner Fire", "Soulmate", "Soul Love",
          "Night", "Summer", "Rain", "Sky", "Ocean", "Sun", "Moon", "Star", "Fire", "Ice",
          "California", "New York", "London", "Tokyo", "Paris", "Home", "Road", "City", "World", "Space",
          "Yesterday", "Tomorrow", "Today", "Tonight", "Morning", "Midnight", "Noon", "Sunrise", "Sunset", "Dawn",
          "Weekend", "Holiday", "Winter", "Autumn", "Spring", "Summer Night", "Summer Love", "Summer Rain", "Winter Night", "Winter Love",
          "New Year", "Birthday", "Anniversary", "First Time", "Last Night", "One Day", "Someday", "One More Time", "One More Night", "One More Chance",
          "Moment", "Forever Night", "Forever Young", "Young & Wild", "Old Days", "Good Old Days", "Golden Days", "Better Days", "Dark Days", "End Of Time",
          "River", "Mountain", "Forest", "Desert", "Island", "Beach", "Sea", "Storm", "Thunder", "Lightning",
          "Wind", "Snow", "Rainbow", "Cloud", "Galaxy", "Universe", "Street", "Highway", "Bridge", "Valley",
          "Garden", "Field", "Castle", "Palace", "Jungle", "Harbor", "Harbour", "Harbor Lights", "Harbor Night", "Ocean Waves",
          "City Lights", "Neon Lights", "Skyline", "Backstreet", "Downtown", "Uptown", "Subway", "Train", "Station", "Airport",
          "Hotel", "Motel", "Bar", "Club", "Cafe", "Restaurant", "Room", "Bedroom", "Living Room", "Kitchen",
          "Rooftop", "Basement", "Balcony", "Window", "Door", "Bridge To Heaven", "Bridge Of Love", "Long Road", "Lonely Road", "Open Road",
          "Road Trip", "Journey", "Travel", "Run", "Fly", "Walk", "Talk", "Touch", "Feel", "Stop",
          "Go", "Stay", "Leave", "Return", "Come Back", "Turn Back", "Turn Around", "Drive", "Ride", "Sail",
          "Flight", "Escape", "Chase", "Hunt", "Race", "Race Car", "Highway Night", "Highway Star", "Freeway", "Crossroads",
          "Border", "Borderline", "Checkpoint", "Destination", "Nowhere", "Anywhere", "Somewhere", "Far Away", "Close To You", "Next To Me",
          "Rock", "Jazz", "Blues", "Pop", "Disco", "Dance", "Party", "Magic", "Power", "Glory",
          "King", "Queen", "Angel", "Devil", "Hero", "Legend", "Life", "Time", "Yesterday", "Tomorrow",
          "Funk", "Soul Music", "R&B", "Hip Hop", "Rap", "Trap", "House", "Techno", "Trance", "Dubstep",
          "Electro", "Indie", "Alternative", "Metal", "Punk", "Classic", "Symphony", "Opera", "Ballad", "Acoustic",
          "Chill", "Chillout", "Lo-Fi", "LoFi", "Ambient", "Instrumental", "Cover", "Remix", "Mashup", "Live",
          "Unplugged", "Acoustic Live", "Studio", "Mixtape", "Playlist", "Session", "Jam", "Freestyle", "Battle", "Showtime",
          "Blue", "Red", "Yellow", "Black", "White", "Pink", "Green", "Gold", "Silver", "Purple",
          "Orange", "Brown", "Gray", "Grey", "Violet", "Indigo", "Scarlet", "Crimson", "Emerald", "Sapphire",
          "Golden", "Golden Heart", "Golden Night", "Golden Sky", "Black Night", "Black Heart", "Black Rose", "Blue Sky", "Blue Moon", "Blue Night",
          "Red Rose", "Red Moon", "White Night", "White Rose", "Pink Sky", "Pink Love", "Green Light", "Neon", "Neon Love", "Neon Night",
          "Stranger", "Friend", "Best Friend", "Enemy", "Lover", "Dreamer", "Believer", "Dancer", "Singer", "Player",
          "Warrior", "Soldier", "Rebel", "Outlaw", "Angel Eyes", "Fallen Angel", "Dark Angel", "Guardian Angel", "King Of Hearts", "Drama Queen",
          "Heartbreaker", "Storyteller", "Runner", "Rider", "Fighter", "Survivor", "Winner", "Loser", "Champion", "Starboy",
          "Good Girl", "Bad Girl", "Good Boy", "Bad Boy", "Lonely Boy", "Lonely Girl", "City Boy", "City Girl", "Wild Boy", "Wild Girl",
          "Kiss Me", "Hold Me", "Touch Me", "Feel Me", "Call Me", "Call Me Maybe", "Catch Me", "Save Me", "Need You", "Miss You",
          "Love You", "Hate You", "Without You", "With You", "For You", "About You", "By Your Side", "Next To You", "Over You", "Under You",
          "Let Go", "Let Me Go", "Let It Go", "Carry On", "Move On", "Turn Up", "Turn Down", "Slow Down", "Speed Up", "Wake Up",
          "Stay With Me", "Stay", "Don't Go", "Don't Stop", "Don't Leave", "Come On", "Come Home", "Come Closer", "Hold On", "Hold Tight",
          "Dreams", "Nightmare", "Fantasy", "Illusion", "Vision", "Destiny", "Fate", "Chance", "Luck", "Karma",
          "Shadow Of Love", "Shadow Of The Night", "Echoes", "Memories", "Flashback", "Afterglow", "Reborn", "Rebirth", "Revival", "Awakening",
          "Addiction", "Obsession", "Temptation", "Salvation", "Redemption", "Revolution", "Evolution", "Change", "Transformation", "Metamorphosis",
          "Infinity", "Eternity", "Zero", "One", "Million", "Million Reasons", "Million Dreams", "Thousand Miles", "Thousand Years", "Hundred Days",
          "Beatles", "Queen", "Jackson", "Taylor", "Adele", "Coldplay", "Ed Sheeran", "Eminem", "Rihanna", "Beyonce",
          "Bruno Mars", "Justin", "Linkin Park", "Nirvana", "Elvis", "Madonna", "Drake", "Weeknd", "Gaga", "Maroon 5",
          "Kanye", "Swift", "Billie", "Dua Lipa", "Ariana", "Shakira", "Whitney", "Mariah", "Celine", "Katy Perry",
          "Imagine Dragons", "OneRepublic", "Fall Out Boy", "Green Day", "Red Hot Chili Peppers", "Metallica", "ACDC", "U2", "Oasis", "Blur",
          "Radiohead", "Muse", "The Killers", "Paramore", "Linkin", "Backstreet Boys", "NSYNC", "Spice Girls", "ABBA", "Bee Gees",
          "Guitar", "Electric Guitar", "Acoustic Guitar", "Piano", "Grand Piano", "Keyboard", "Bass", "Drums", "Violin", "Cello",
          "Saxophone", "Trumpet", "Trombone", "Flute", "Clarinet", "Harp", "Ukulele", "Banjo", "Harmonica", "Organ",
          "Synth", "Synthwave", "808", "Beat", "Beats", "Rhythm", "Melody", "Harmony", "Chords", "Bassline",
          "Choir", "Voice", "Vocal", "Whisper", "Shout", "Scream", "Echo", "Reverb", "Silence Sound", "Noise",
          "Heartbeat Sound", "Drum & Bass", "Guitar Solo", "Piano Man", "Piano Girl", "Rock Guitar", "Jazz Piano", "Sax Solo", "Violin Song", "String Quartet",
          "Party", "Birthday Party", "House Party", "Beach Party", "Pool Party", "After Party", "Night Club", "Dance Floor", "Festival", "Carnival",
          "Parade", "Rave", "Concert", "Tour", "World Tour", "Live Show", "Opening Night", "Closing Time", "Night Out", "Girls Night",
          "Boys Night", "Saturday Night", "Friday Night", "Sunday Morning", "Weekend Party", "Midnight Party", "Club Night", "Bar Night", "Bar Song", "Drinking Song",
          "Love Story", "Sad Story", "True Story", "Our Story", "My Story", "Your Story", "Story Of My Life", "Story Of Us", "Broken Story", "Fairytale",
          "Fairy Tale", "Happy Ending", "Sad Ending", "New Beginning", "Fresh Start", "First Date", "Blind Date", "One Night", "One Night Stand", "Secret Night",
          "Secret Lover", "Forbidden Love", "Hidden Love", "Long Distance", "Long Distance Love", "Best Friend Love", "Friends Forever", "Friends To Lovers", "More Than Friends", "No More Tears",
          "One Kiss", "Two Hearts", "Three Words", "Four Seasons", "Five Nights", "Seven Days", "Ten Years", "24 Hours", "365 Days", "24 7",
          "First Kiss", "Second Chance", "Third Eye", "Lucky One", "Lucky Star", "Lucky Day", "Number One", "Top Ten", "Level Up", "Next Level",
          "Zero Gravity", "Room 101", "Room 303", "Area 51", "High Five", "Midnight Train", "Midnight Sky", "Midnight City", "2AM", "3AM",
          "Money", "Work", "School", "Friend", "Best", "Good", "Bad", "High", "Low", "Christmas",
          "Job", "Boss", "Office", "College", "Campus", "Homework", "Exam", "Graduation", "Taxi", "Subway Train",
          "Coffee", "Tea", "Wine", "Whiskey", "Beer", "Cigarettes", "Smoke", "Traffic", "Rush Hour", "Payday",
          "Broke", "Rich", "Millionaire", "Street Life", "City Life", "Night Life", "Love Life", "Double Life", "Secret Life", "New Life",
          "Christmas Night", "Christmas Love", "Christmas Eve", "Silent Night", "New Year Party", "New Year Love", "Valentine", "Valentine's Day", "Halloween Night", "Halloween Party",
          "Easter", "Spring Break", "Summer Break", "Winter Wonderland", "Snowfall", "Snow Night", "Snow Love", "Rainy Day", "Rainy Night", "Stormy Night",
          "Fireworks", "Lanterns", "Midnight Fireworks", "Festival Lights", "Summer Festival", "Music Festival", "Love Festival", "Carnival Night", "Carnival Love", "Holiday Love",
          "Internet", "Online", "Offline", "WiFi", "Bluetooth", "Digital Love", "Virtual Love", "Virtual Reality", "Fantasy World", "Cyber Love",
          "Screen", "Timeline", "News Feed", "Notification", "Message", "DM", "Inbox", "Outbox", "Voice Mail", "Hotline",
          "Stream", "Streaming", "Playlist Love", "Shuffle", "Repeat", "Replay", "Rewind", "Fast Forward", "Skip", "Play Button",
          "Never Give Up", "Stand Up", "Rise Up", "Wake Up Call", "Stronger Than Ever", "Born To Run", "Born To Die", "Born This Way", "Born For You", "Born Again",
          "Fight For Love", "Fight For You", "Fight For Life", "Believe In Me", "Believe In You", "Believe In Love", "Chasing Dreams", "Chasing Stars", "Chasing Cars", "Reach For The Sky",
          "Higher", "Higher Ground", "On Top", "Top Of The World", "Sky High", "Limitless", "No Limits", "No Fear", "Fearless", "Unstoppable",
          "Broken Dreams", "Broken Wings", "Broken Heart", "Broken Love", "Empty Heart", "Empty Room", "Empty Streets", "Lonely Night", "Lonely Road", "Lonely World",
          "Fade Away", "Fall Apart", "Falling Down", "Falling", "Drowning", "Bleeding Love", "Crying In The Rain", "Tears In Heaven", "Tears Of Love", "Nothing Left",
          "Nowhere To Go", "Lost In You", "Lost In Love", "Lost In The Dark", "Lost In The Night", "Missing You", "Miss You So", "Need You Now", "Without Me", "Without Love",
          "Dance With Me", "Dance All Night", "Last Dance", "Slow Dance", "Fast Dance", "Midnight Dance", "Crazy Dance", "Dance In The Dark", "Dance In The Rain", "Dance In The Moonlight",
          "Rhythm Of The Night", "Rhythm Of Love", "Rhythm Divine", "Feel The Beat", "Drop The Beat", "Drop It", "Turn The Music Up", "Turn The Music On", "Turn The Lights Down", "Turn The Lights Off",
          "Move Your Body", "Shake It", "Hands Up", "Hands Down", "Jump", "Jump Around", "Step By Step", "Two Step", "Footloose", "Groove",
          "Into The Night", "Into The Sky", "Into The Wild", "Into You", "Into The Dark", "Out Of Love", "Out Of Time", "Out Of Control", "Out Of My Mind", "Out Of The Blue",
          "All Of Me", "All Of You", "All Of Us", "All My Life", "All My Love", "All Night", "All Day", "All The Time", "For The First Time", "For The Last Time",
          "Just The Way You Are", "Just A Dream", "Just A Kiss", "Just Like Heaven", "Just Like You", "Only You", "Only Love", "Only One", "One And Only", "One More Try",
          "Miami", "Los Angeles", "Chicago", "Houston", "Seattle", "Boston", "Berlin", "Rome", "Barcelona", "Madrid",
          "Amsterdam", "Moscow", "Hong Kong", "Shanghai", "Beijing", "Seoul", "Bangkok", "Sydney", "Melbourne", "Rio",
          "Vegas", "Las Vegas", "Hawaii", "Ibiza", "Brooklyn", "Bronx", "Harlem", "Soho", "Hollywood", "Broadway",
          "Fire And Ice", "Fire And Rain", "Fire In The Sky", "Fire In My Heart", "Rain And Thunder", "Rain On Me", "Snow And Ice", "Sun And Moon", "Sun And Rain", "Moon And Back",
          "Hearts And Bones", "Hearts On Fire", "Hearts Of Gold", "Tears And Rain", "Salt And Pepper", "Sugar And Spice", "Wine And Roses", "Blood And Tears", "Blood And Wine", "Blood On The Dance Floor",
          "Chill Vibes", "Good Vibes", "Summer Vibes", "Beach Vibes", "Night Vibes", "City Vibes", "Love Vibes", "Sad Vibes", "LoFi Vibes", "Coffee Break",
          "Morning Coffee", "Night Coffee", "Midnight Coffee", "Sunset Drive", "Midnight Drive", "Night Drive", "City Drive", "Late Night", "Late Night Call", "Late Night Drive",
          "Lazy Sunday", "Sunday Morning", "Sunday Night", "Monday Blues", "Friday Feeling", "Friday Night Lights", "Saturday Love", "Saturday Night Fever", "Weekend Love", "Weekend Mood",
          "Beautiful Day", "Beautiful Girl", "Beautiful Boy", "Beautiful Life", "Beautiful World", "Crazy In Love", "Crazy For You", "Crazy Night", "Crazy World", "End Of The World",
          "Shape Of You", "Thinking Of You", "Thinking Out Loud", "Back To You", "Back To Black", "Back To Life", "Back Home", "Back In Time", "Stay With You", "Stay The Night",
          "Say You Love Me", "Say Something", "Say My Name", "Call My Name", "Call Your Name", "Kiss The Rain", "Walk On Water", "Walk Away", "Runaway", "Runaway Love",
          "Take Me Home", "Take Me Back", "Take It Easy", "Take It Slow", "Take On Me", "Let Me Love You", "Let Me In", "Let It Be", "Let It Rain", "Let It Shine",
          "Sky", "Stars", "Moonlight", "Starlight", "Spotlight", "Headlights", "City Lights", "Bright Lights", "Street Lights", "Northern Lights",
          "Angel Of Mine", "Devil Inside", "Hero Of War", "Local Hero", "Teenage Dream", "Teenage Love", "Teenage Heart", "Teenage Riot", "Teen Spirit", "Broken Spirit",
          "Wild Heart", "Wild Dreams", "Wild Nights", "Wild Things", "Wild World", "Sweet Dreams", "Sweet Home", "Sweet Child", "Sweet Life", "Sweet Escape",
          "Golden Hour", "Midnight Hour", "Rush Of Blood", "Signs", "Signals", "Codes", "Secret Code", "Password", "Key To My Heart", "Key To The City"
        ];

        // --- åˆå§‹åŒ–é€»è¾‘ ---
        document.addEventListener('DOMContentLoaded', () => {
            randomSearch();
            DOM.searchInput.addEventListener('keypress', (e) => {
                if(e.key === 'Enter') searchMusic();
            });
        });

        // --- éšæœºæœç´¢ ---
        function randomSearch() {
            const randomIndex = Math.floor(Math.random() * keywords.length);
            DOM.searchInput.value = keywords[randomIndex];
            searchMusic();
        }

        async function searchMusic() {
            const query = DOM.searchInput.value.trim();
            if(!query) return;

            DOM.results.innerHTML = '<div style="text-align:center; padding:50px; color:#888;">æ­£åœ¨è¿æ¥ iTunes...</div>';

            try {
                // ä½¿ç”¨ HTTPS æ¥å£ï¼Œé¿å…æ··åˆå†…å®¹è­¦å‘Š
                const res = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=24`);
                const data = await res.json();
                renderResults(data.results);
            } catch (e) {
                DOM.results.innerHTML = `<div style="color:#ff5252; text-align:center; padding:50px;">ç½‘ç»œè¯·æ±‚å¤±è´¥ (${e.message})</div>`;
            }
        }

        function renderResults(songs) {
            DOM.results.innerHTML = '';
            if(songs.length === 0) {
                DOM.results.innerHTML = '<div style="text-align:center; padding:50px; color:#888;">æœªæ‰¾åˆ°ç›¸å…³æ­Œæ›²</div>';
                return;
            }

            songs.forEach(song => {
                const highResImage = song.artworkUrl100.replace('100x100bb', '300x300bb');
                const card = document.createElement('div');
                card.className = 'song-card';
                card.onclick = () => playSong(song, highResImage);

                card.innerHTML = `
                    <img src="${highResImage}" loading="lazy">
                    <div class="song-title" title="${song.trackName}">${song.trackName}</div>
                    <div class="song-artist">${song.artistName}</div>
                `;
                
                // ç§»åŠ¨ç«¯/æ¡Œé¢ç«¯ å¤–éƒ¨é“¾æ¥å¤„ç†
                const titleEl = card.querySelector('.song-title');
                titleEl.onclick = (e) => {
                    e.stopPropagation();
                    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                    if (isMobile) window.location.href = song.trackViewUrl;
                    else window.open(song.trackViewUrl, '_blank');
                };

                DOM.results.appendChild(card);
            });
        }

        // --- æ ¸å¿ƒæ’­æ”¾é€»è¾‘ (é‡æ„ç‰ˆï¼šéé˜»å¡) ---
        function playSong(song, imageUrl) {
            STATE.currentTrack = song;

            // 1. UI ç«‹å³å“åº”
            DOM.playerName.innerText = song.trackName;
            DOM.playerArtist.innerText = song.artistName;
            DOM.playerCover.src = imageUrl;
            
            // 2. æ²‰æµ¸å¼èƒŒæ™¯ï¼šè®¾ç½®èƒŒæ™¯å›¾å¹¶æ·»åŠ æ¨¡ç³Š
            document.body.style.backgroundImage = `url(${imageUrl})`;
            
            // 3. éŸ³é¢‘å¤„ç† (ä¸ç­‰å¾…é™„å±ä¿¡æ¯)
            DOM.audio.src = song.previewUrl;
            DOM.audio.play()
                .then(() => updatePlayBtnState(true))
                .catch(e => {
                    console.log("è‡ªåŠ¨æ’­æ”¾è¢«æ‹¦æˆª:", e);
                    updatePlayBtnState(false);
                });

            // 4. é‡ç½®é™„å± UI
            DOM.lyricsTitle.innerText = song.trackName;
            DOM.lyricsArtist.innerText = song.artistName;
            DOM.lyricsText.innerHTML = '<span style="opacity:0.6; font-size:14px;">æ­£åœ¨è¿æ¥æ­Œè¯åº“...</span>';
            DOM.wikiDiv.innerHTML = '';
            DOM.wikiDiv.classList.remove('show');

            // 5. å¹¶è¡Œå¼‚æ­¥åŠ è½½ï¼šå¼¹å¹•ã€æ­Œè¯ã€ç™¾ç§‘
            startFakeComments(); 
            
            // ä½¿ç”¨ Promise.allSettled ç¡®ä¿ä¸€ä¸ªå¤±è´¥ä¸å½±å“å¦ä¸€ä¸ª
            Promise.allSettled([
                fetchLyrics(song.artistName, song.trackName),
                fetchArtistInfo(song.artistName)
            ]);
        }

        function togglePlay() {
            if(!DOM.audio.src) return;
            if(DOM.audio.paused) {
                DOM.audio.play();
                updatePlayBtnState(true);
            } else {
                DOM.audio.pause();
                updatePlayBtnState(false);
            }
        }

        function playNext() {
            // è·å–å½“å‰æ’­æ”¾åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ­Œæ›²
            const songCards = document.querySelectorAll('.song-card');
            if (songCards.length === 0) return;

            // æ‰¾åˆ°å½“å‰æ’­æ”¾æ­Œæ›²åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®
            let currentIndex = -1;
            for (let i = 0; i < songCards.length; i++) {
                const card = songCards[i];
                const songTitle = card.querySelector('.song-title').textContent;
                const artistName = card.querySelector('.song-artist').textContent;

                if (songTitle === STATE.currentTrack.trackName &&
                    artistName === STATE.currentTrack.artistName) {
                    currentIndex = i;
                    break;
                }
            }

            // å¦‚æœæ‰¾ä¸åˆ°å½“å‰æ­Œæ›²ï¼Œä»ç¬¬ä¸€é¦–å¼€å§‹æ’­æ”¾
            if (currentIndex === -1) {
                songCards[0].click();
                return;
            }

            // æ’­æ”¾ä¸‹ä¸€é¦–ï¼ˆå¾ªç¯æ’­æ”¾ï¼‰
            const nextIndex = (currentIndex + 1) % songCards.length;
            songCards[nextIndex].click();
        }

        function playPrevious() {
            // è·å–å½“å‰æ’­æ”¾åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ­Œæ›²
            const songCards = document.querySelectorAll('.song-card');
            if (songCards.length === 0) return;

            // æ‰¾åˆ°å½“å‰æ’­æ”¾æ­Œæ›²åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®
            let currentIndex = -1;
            for (let i = 0; i < songCards.length; i++) {
                const card = songCards[i];
                const songTitle = card.querySelector('.song-title').textContent;
                const artistName = card.querySelector('.song-artist').textContent;

                if (songTitle === STATE.currentTrack.trackName &&
                    artistName === STATE.currentTrack.artistName) {
                    currentIndex = i;
                    break;
                }
            }

            // å¦‚æœæ‰¾ä¸åˆ°å½“å‰æ­Œæ›²ï¼Œä»ç¬¬ä¸€é¦–å¼€å§‹æ’­æ”¾
            if (currentIndex === -1) {
                songCards[0].click();
                return;
            }

            // æ’­æ”¾ä¸Šä¸€é¦–ï¼ˆå¾ªç¯æ’­æ”¾ï¼‰
            const prevIndex = (currentIndex - 1 + songCards.length) % songCards.length;
            songCards[prevIndex].click();
        }

        function updatePlayBtnState(isPlaying) {
            STATE.isPlaying = isPlaying;
            DOM.playBtn.innerText = isPlaying ? 'â¸' : 'â–¶';
            if(isPlaying) DOM.playerCover.classList.add('playing');
            else DOM.playerCover.classList.remove('playing');
        }

        // --- åˆ›æ„1: çœ‹å¤©å¬æ­Œ (ä¼˜åŒ–ç‰ˆ: HTTPS & å®Œæ•´æ˜ å°„) ---
        async function searchByWeather() {
            const btn = document.querySelector('.weather-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'âŒ›';
            
            try {
                // 1. GeoJS (HTTPS) è·å–å®šä½
                const geoRes = await fetch('https://get.geojs.io/v1/ip/geo.json');
                const geo = await geoRes.json();
                
                // 2. Open-Meteo è·å–å¤©æ°”
                const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${geo.latitude}&longitude=${geo.longitude}&current_weather=true`);
                const weatherData = await weatherRes.json();
                const wcode = weatherData.current_weather.weathercode;
                
                // 3. æ™ºèƒ½æ˜ å°„
                let keyword = "Pop";
                let desc = "æœªçŸ¥";
                
                if (wcode <= 3) { keyword = "Sunny Beach"; desc = "æ™´æœ—"; }
                else if (wcode >= 45 && wcode <= 48) { keyword = "Foggy Jazz"; desc = "é›¾æ°”"; }
                else if (wcode >= 51 && wcode <= 67) { keyword = "Rainy Mood"; desc = "ä¸‹é›¨"; }
                else if (wcode >= 71) { keyword = "Winter Snow"; desc = "ä¸‹é›ª"; }
                else if (wcode >= 80) { keyword = "Summer Rain"; desc = "é˜µé›¨"; }
                else if (wcode >= 95) { keyword = "Thunderstorm"; desc = "é›·æš´"; }
                else { keyword = "Cloudy Chill"; desc = "å¤šäº‘"; }

                DOM.searchInput.value = keyword;
                searchMusic();
                alert(`ğŸ“ å®šä½: ${geo.city}\nğŸŒ¤ å¤©æ°”: ${desc}\nğŸµ æ¨è: ${keyword}`);
                
            } catch (e) {
                alert("è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–éšç§è®¾ç½®");
                console.error(e);
            } finally {
                btn.innerHTML = originalText;
            }
        }

        // --- åˆ›æ„2: æ­Œæ‰‹å°ç™¾ç§‘ (HTTPS) ---
        async function fetchArtistInfo(artistName) {
            let cleanName = artistName.split(/&|,|feat\.|ft\./)[0].trim();
            
            // ä¼˜å…ˆä¸­æ–‡
            let url = `https://zh.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(cleanName)}`;
            
            try {
                let res = await fetch(url);
                if(!res.ok) {
                    // é™çº§åˆ°è‹±æ–‡
                    url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(cleanName)}`;
                    res = await fetch(url);
                }
                
                if(res.ok) {
                    const data = await res.json();
                    if (data.extract) {
                        const wikiLink = data.content_urls?.desktop?.page || '#';
                        DOM.wikiDiv.innerHTML = `
                            <div style="font-weight:bold; color:var(--primary); margin-bottom:5px;">${data.title} å°ç™¾ç§‘</div>
                            <div>${data.extract}</div>
                            <div style="margin-top:10px; text-align:right;">
                                <a href="${wikiLink}" target="_blank" style="color:var(--light); font-size:12px;">Wikipedia &rarr;</a>
                            </div>
                        `;
                        DOM.wikiDiv.classList.add('show');
                    }
                }
            } catch (e) {
                // å¿½ç•¥ç™¾ç§‘é”™è¯¯
            }
        }

        // --- åˆ›æ„4: ä¼ªÂ·å¼¹å¹•ç³»ç»Ÿ (æ¸…æ´—åçš„é€»è¾‘ï¼šæ™ºèƒ½ç¼“å­˜ + è½¨é“ç®¡ç†) ---
        function startFakeComments() {
            DOM.commentBar.classList.add('show');
            DOM.commentBar.innerHTML = ''; // åˆ‡æ­Œæ¸…ç©º
            
            if (STATE.commentInterval) clearInterval(STATE.commentInterval);
            
            processComment(); // ç«‹å³å‘å°„ä¸€æ¡
            // éšæœºé—´éš” 3-5 ç§’å‘å°„
            STATE.commentInterval = setInterval(processComment, 3500);
        }

        async function processComment() {
            // æ™ºèƒ½ç­–ç•¥ï¼šå¦‚æœè¯·æ±‚è¶…è¿‡20æ¬¡ï¼Œæˆ–è€…ç¼“å­˜æœ‰æ•°æ®ä¸”è¿æ°”å¥½(40%)ï¼Œåˆ™å¤ç”¨ç¼“å­˜ï¼Œä¸å†æ¶ˆè€—æµé‡
            const useCache = STATE.commentHistory.length > 0 && (STATE.fetchCount > 20 || Math.random() < 0.4);
            
            if (useCache) {
                const randomItem = STATE.commentHistory[Math.floor(Math.random() * STATE.commentHistory.length)];
                renderComment(randomItem);
            } else {
                await fetchNewComment();
            }
        }

        async function fetchNewComment() {
            try {
                // å¹¶è¡Œè·å–å¤´åƒå’Œæ–‡æ¡ˆ
                const [userRes, textRes] = await Promise.all([
                    fetch('https://randomuser.me/api/?inc=name,picture&nat=us,cn'),
                    // 50% æ¦‚ç‡ Kanye, 50% æ¦‚ç‡ä¸€è¨€
                    Math.random() > 0.5 ? fetch('https://api.kanye.rest/') : fetch('https://v1.hitokoto.cn/?c=a&c=b')
                ]);

                const userData = await userRes.json();
                const textData = await textRes.json();

                const commentData = {
                    name: userData.results[0].name.first,
                    avatar: userData.results[0].picture.thumbnail,
                    text: textData.quote || textData.hitokoto
                };

                // å†™å…¥ç¼“å­˜æ± 
                STATE.commentHistory.push(commentData);
                if(STATE.commentHistory.length > 50) STATE.commentHistory.shift(); // ä¿æŒæ± å­å¤§å°
                STATE.fetchCount++;

                renderComment(commentData);
            } catch(e) {
                // é™é»˜å¤±è´¥
            }
        }

        function renderComment(data) {
            // å¯»æ‰¾ç©ºé—²è½¨é“ (0-4)
            let trackIndex = STATE.tracks.findIndex(t => !t);
            if (trackIndex === -1) trackIndex = Math.floor(Math.random() * 5); // å®åœ¨æ²¡æœ‰å°±éšæœºæŒ¤
            
            // å ç”¨è½¨é“
            STATE.tracks[trackIndex] = true;

            const item = document.createElement('div');
            item.className = 'comment-item';
            
            // å®‰å…¨æ„å»º DOM
            const img = document.createElement('img');
            img.className = 'comment-avatar';
            img.src = data.avatar;
            
            const nameSpan = document.createElement('span');
            nameSpan.style.color = '#ffeb3b';
            nameSpan.style.fontWeight = 'bold';
            nameSpan.textContent = data.name + ':';
            
            const textSpan = document.createElement('span');
            textSpan.textContent = data.text;
            
            item.appendChild(img);
            item.appendChild(nameSpan);
            item.appendChild(textSpan);

            // è®¡ç®— CSS
            item.style.top = (trackIndex * 45 + 10) + 'px'; 
            const duration = 15 + Math.random() * 5; // 15-20ç§’
            item.style.animationDuration = duration + 's';

            // åŠ¨ç”»ç»“æŸå›è°ƒ
            item.onanimationend = () => {
                item.remove();
                STATE.tracks[trackIndex] = false; // é‡Šæ”¾è½¨é“
            };
            
            DOM.commentBar.appendChild(item);
        }

        // --- æ­Œè¯ & çŒ«å’ªå…œåº• ---
        async function fetchLyrics(artist, title) {
            try {
                const cleanTitle = title.split('(')[0].split('-')[0].trim();
                const cleanArtist = artist.split('&')[0].split(',')[0].trim();
                const res = await fetch(`https://api.lyrics.ovh/v1/${cleanArtist}/${cleanTitle}`);
                
                if(!res.ok) throw new Error('No lyrics');
                const data = await res.json();
                
                if(data.lyrics) {
                    DOM.lyricsText.innerText = data.lyrics;
                } else {
                    showRandomCat();
                }
            } catch (e) {
                showRandomCat();
            }
        }

        async function showRandomCat() {
            DOM.lyricsText.innerHTML = '<div style="margin-bottom:20px;">æš‚æ— æ­Œè¯ï¼Œæ­£åœ¨å¬å”¤çŒ«å’ª... ğŸ±</div>';
            try {
                const res = await fetch('https://api.thecatapi.com/v1/images/search');
                const data = await res.json();
                if(data?.[0]?.url) {
                    DOM.lyricsText.innerHTML = `
                        <div style="font-size:14px; margin-bottom:15px; color:#aaa;">æš‚æ— æ­Œè¯ï¼Œè¯·æ¬£èµçŒ«ç‰‡</div>
                        <img src="${data[0].url}" style="max-width:80%; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.5);">
                    `;
                } else {
                    DOM.lyricsText.innerText = "æš‚æ— æ­Œè¯";
                }
            } catch(e) {
                DOM.lyricsText.innerText = "æš‚æ— æ­Œè¯";
            }
        }

        // --- æ’­æ”¾å®Œæˆè‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€é¦– ---
        DOM.audio.onended = () => {
            updatePlayBtnState(false);

            // è·å–å½“å‰æ’­æ”¾åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ­Œæ›²
            const songCards = document.querySelectorAll('.song-card');
            if (songCards.length === 0) return;

            // æ‰¾åˆ°å½“å‰æ’­æ”¾æ­Œæ›²åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®
            let currentIndex = -1;
            for (let i = 0; i < songCards.length; i++) {
                const card = songCards[i];
                const songTitle = card.querySelector('.song-title').textContent;
                const artistName = card.querySelector('.song-artist').textContent;

                if (songTitle === STATE.currentTrack.trackName &&
                    artistName === STATE.currentTrack.artistName) {
                    currentIndex = i;
                    break;
                }
            }

            // å¦‚æœæ‰¾ä¸åˆ°å½“å‰æ­Œæ›²ï¼Œä»ç¬¬ä¸€é¦–å¼€å§‹æ’­æ”¾
            if (currentIndex === -1) {
                songCards[0].click();
                return;
            }

            // æ’­æ”¾ä¸‹ä¸€é¦–ï¼ˆå¾ªç¯æ’­æ”¾ï¼‰
            const nextIndex = (currentIndex + 1) % songCards.length;
            songCards[nextIndex].click();
        };

        // --- è¿›åº¦æ¡æ§åˆ¶ ---
        DOM.audio.ontimeupdate = () => {
            if(isNaN(DOM.audio.duration)) return;
            const percent = (DOM.audio.currentTime / DOM.audio.duration) * 100;
            DOM.progressFill.style.width = percent + '%';

            const curM = Math.floor(DOM.audio.currentTime / 60);
            const curS = Math.floor(DOM.audio.currentTime % 60);
            DOM.currTime.innerText = `${curM}:${curS<10?'0'+curS:curS}`;
        };

        function seek(e) {
            if(!DOM.audio.src) return;
            const bar = document.getElementById('progress-bar');
            const percent = e.offsetX / bar.clientWidth;
            DOM.audio.currentTime = percent * DOM.audio.duration;
        }

        function toggleLyrics() { DOM.lyricsOverlay.classList.toggle('show'); }

    </script>
</body>
</html>