<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Apple iTunes Lookup 跳转演示</title>
<style>
  :root {
    --bg: #0f1220; --card:#171a2b; --text:#e9ecf3; --muted:#a9afc6; --accent:#6ea8ff;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; background:var(--bg); color:var(--text);}
  header{padding:20px 16px; text-align:center;}
  header h1{margin:.2em 0; font-size:20px;}
  header p{margin:0; color:var(--muted); font-size:13px;}
  main{max-width:720px; margin:16px auto; padding:0 16px;}
  .card{background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:16px;}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
  input, select {
    flex:1 1 220px; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.1);
    background:#121531; color:var(--text); font-size:14px; outline:none;
  }
  button{
    padding:10px 14px; border-radius:10px; border:0; background:linear-gradient(135deg,#6ea8ff,#8e7dff);
    color:white; font-weight:700; cursor:pointer;
  }
  .tip{color:var(--muted); font-size:12px; margin-top:10px; line-height:1.6;}
  .list{display:flex; gap:8px; flex-wrap:wrap; margin-top:12px;}
  .idbtn{
    background:#1b2145; color:#cfe1ff; border:1px solid rgba(255,255,255,.08);
    padding:8px 10px; border-radius:999px; cursor:pointer; font-size:13px;
  }
  .log{margin-top:12px; background:#0f1330; color:#d7defb; padding:10px; border-radius:8px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; max-height:200px; overflow:auto; white-space:pre-wrap;}
  a.demo{color:#9bd0ff; word-break:break-all;}
</style>
</head>
<body>
  <header>
    <h1>iTunes Lookup ➜ Apple Music 跳转演示</h1>
    <p>输入歌曲 ID（trackId，例如 968861895），调用公开接口获取 trackViewUrl 并跳转</p>
  </header>

  <main>
    <div class="card">
      <div class="row" style="margin-bottom:10px;">
        <input id="trackId" placeholder="请输入歌曲 ID（如 968861895）" value="968861895" />
        <select id="country">
          <option value="us">美国 us</option>
          <option value="cn" selected>中国 cn</option>
          <option value="gb">英国 gb</option>
          <option value="jp">日本 jp</option>
          <option value="de">德国 de</option>
        </select>
        <button id="goBtn">查询并跳转</button>
      </div>
      <div class="tip">
        • 使用接口：https://itunes.apple.com/lookup?id=TRACK_ID&country=COUNTRY<br>
        • 返回 JSON 中的 results[0].trackViewUrl 即为 Apple Music 曲目页链接（已包含专辑 ID 与 ?i=trackId）。<br>
        • 备注：如需只拿专辑 ID，可读 results[0].collectionId。
      </div>

      <div class="list" id="quick">
        <span class="idbtn" data-id="968861895">示例ID：968861895</span>
        <span class="idbtn" data-id="1440936017">示例ID：1440936017</span>
        <span class="idbtn" data-id="1445273905">示例ID：1445273905</span>
      </div>

      <div class="log" id="log">等待操作……</div>
    </div>
  </main>

<script>
  const $ = (s)=>document.querySelector(s);
  const logEl = $('#log');

  function log(msg){
    logEl.textContent = typeof msg === 'string' ? msg : JSON.stringify(msg, null, 2);
  }

  async function lookupAndOpen() {
    const id = $('#trackId').value.trim();
    const country = $('#country').value.trim() || 'us';
    if(!/^\d+$/.test(id)){ log('请输入数字形式的 trackId'); return; }

    const url = `https://itunes.apple.com/lookup?id=${encodeURIComponent(id)}&country=${encodeURIComponent(country)}`;
    log(`请求：${url}\n\n正在查询……`);
    try{
      const res = await fetch(url, { mode: 'cors' });
      if(!res.ok){ throw new Error(`HTTP ${res.status}`); }
      const data = await res.json();
      if(!data.resultCount || !data.results || !data.results.length){
        log('未找到结果，请检查 trackId 或切换 country 再试。');
        return;
      }
      const r = data.results[0];
      const trackViewUrl = r.trackViewUrl || r.collectionViewUrl;
      if(!trackViewUrl){
        log(data);
        return;
      }
      log(`已获取链接：\n${trackViewUrl}\n\n将跳转到该页面……`);
      // 直接跳转
      window.location.href = trackViewUrl;
    }catch(e){
      log(`请求失败：${e.message || e}`);
    }
  }

  $('#goBtn').addEventListener('click', lookupAndOpen);

  // 点击示例 ID 快速填充
  document.getElementById('quick').addEventListener('click', (e)=>{
    const btn = e.target.closest('.idbtn');
    if(!btn) return;
    $('#trackId').value = btn.dataset.id;
    log(`已填入示例 ID：${btn.dataset.id}`);
  });

  // 回车触发
  $('#trackId').addEventListener('keydown', (e)=>{ if(e.key === 'Enter') lookupAndOpen(); });
</script>
</body>
</html>