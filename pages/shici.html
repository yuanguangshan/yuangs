<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>诗词 · 雅苑</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Light theme variables - Xiaohongshu Style */
            --xhs-pink: #FE2C55;
            --xhs-pink-light: #FF6B8A;
            --xhs-pink-lighter: #FFE5EB;
            --xhs-pink-pale: #FFF5F7;
            --bg-gradient-start: #FFFFFF;
            --bg-gradient-end: #FFF5F7;
            --bg-gradient-mid: #FFFAFC;
            --container-bg: rgba(255, 255, 255, 0.98);
            --container-shadow: rgba(254, 44, 85, 0.08);
            --header-gradient-start: #FE2C55;
            --header-gradient-end: #FF6B8A;
            --header-gradient-mid: #FE4569;
            --header-color: white;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --text-light: #BBBBBB;
            --bg-light: #FAFAFA;
            --bg-lighter: #F5F5F5;
            --border-color: #EEEEEE;
            --filter-bg: rgba(255, 255, 255, 0.95);
            --poem-desc-bg: rgba(255, 255, 255, 0.98);
            --poem-desc-border: #FE2C55;
            --search-result-bg: #FAFAFA;
            --search-result-hover: #FFF5F7;
            --refresh-btn-gradient-start: #FE2C55;
            --refresh-btn-gradient-end: #FF6B8A;
            --refresh-btn-color: white;
            --clear-btn-bg: #999999;
            --clear-btn-hover: #666666;
            --search-btn-bg: #FE2C55;
            --search-btn-hover: #E02548;
            --footer-color: #999999;
            --accent-glow: rgba(254, 44, 85, 0.2);
            --card-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            --card-shadow-hover: 0 4px 20px rgba(254, 44, 85, 0.15);
        }

        .dark-mode {
            /* Dark theme variables - Xiaohongshu Dark Style with improved contrast */
            --xhs-pink: #FF6B8A;
            --xhs-pink-light: #FF8FA8;
            --xhs-pink-lighter: #FFB3C6;
            --xhs-pink-pale: #3A1A25;
            --bg-gradient-start: #0A0A0A;
            --bg-gradient-end: #1A0F1F;
            --bg-gradient-mid: #120C16;
            --container-bg: rgba(30, 30, 30, 0.97);
            --container-shadow: rgba(0, 0, 0, 0.7);
            --header-gradient-start: #E02548;
            --header-gradient-end: #FF6B8A;
            --header-gradient-mid: #F23669;
            --header-color: #FFFFFF;
            --text-primary: #FFFFFF;
            --text-secondary: #E0E0E0;
            --text-tertiary: #C0C0C0;
            --text-light: #A0A0A0;
            --bg-light: #1F1F1F;
            --bg-lighter: #262626;
            --border-color: #555555;
            --filter-bg: rgba(30, 30, 30, 0.95);
            --poem-desc-bg: rgba(25, 25, 25, 0.98);
            --poem-desc-border: #FF6B8A;
            --search-result-bg: #262626;
            --search-result-hover: #3A2A3A;
            --refresh-btn-gradient-start: #E02548;
            --refresh-btn-gradient-end: #FF6B8A;
            --refresh-btn-color: #FFFFFF;
            --clear-btn-bg: #666666;
            --clear-btn-hover: #777777;
            --search-btn-bg: #E02548;
            --search-btn-hover: #C01830;
            --footer-color: #B0B0B0;
            --accent-glow: rgba(255, 107, 138, 0.4);
            --card-shadow: 0 2px 12px rgba(0, 0, 0, 0.5);
            --card-shadow-hover: 0 4px 20px rgba(255, 107, 138, 0.3);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-mid) 50%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            padding: 0;
            color: var(--text-primary);
            transition: background 0.5s ease;
        }

        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
        }

        .container {
            max-width: 1200px;
            width: 100%;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            overflow: visible;
            margin: 0 auto;
            padding: 0 15px;
        }

        @media (min-width: 768px) {
            .container {
                margin: 20px auto;
            }
        }

        header {
            text-align: center;
            padding: 20px 15px;
            background: var(--container-bg);
            color: var(--text-primary);
            position: relative;
            box-shadow: var(--card-shadow);
            border-radius: 20px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            header {
                padding: 30px 20px;
            }
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            text-shadow: none;
            letter-spacing: 0.02em;
            font-weight: 600;
            font-family: 'Noto Serif SC', 'STSong', 'Songti SC', serif;
            color: var(--xhs-pink);
        }

        .subtitle {
            font-size: 0.95rem;
            opacity: 0.75;
            font-weight: 400;
            letter-spacing: 0.01em;
            color: var(--text-secondary);
        }



        .menu-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            /* Align with container edge */
            background: var(--bg-lighter);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 1.1rem;
            cursor: pointer;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: var(--card-shadow);
        }

        .menu-toggle:hover {
            background: var(--xhs-pink-lighter);
            transform: scale(1.05);
            box-shadow: var(--card-shadow-hover);
        }

        @media (min-width: 768px) {
            .menu-toggle {
                top: 20px;
                right: 30px;
                /* Align with controls section */
                width: 45px;
                height: 45px;
            }
        }

        /* Menu overlay styles */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            z-index: 1001;
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding-top: 60px;
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .menu-content {
            background: var(--container-bg);
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .menu-overlay.active .menu-content {
            transform: translateY(0);
        }

        .menu-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .menu-title {
            margin: 0;
            font-size: 1.4rem;
            color: var(--xhs-pink);
            font-family: 'Noto Serif SC', serif;
        }

        .close-menu-btn {
            background: var(--bg-lighter);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .close-menu-btn:hover {
            background: var(--xhs-pink-lighter);
            color: white;
            transform: scale(1.1);
        }

        .menu-options {
            padding: 20px;
        }

        .menu-section {
            margin-bottom: 10px;
        }

        .menu-option {
            display: block;
            width: 100%;
            padding: 15px;
            background: var(--bg-lighter);
            border: none;
            border-radius: 10px;
            text-align: left;
            font-size: 1rem;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-option:hover {
            background: var(--xhs-pink-lighter);
            color: white;
            transform: translateX(5px);
        }

        .history-list,
        .favorites-list {
            padding: 10px 15px 15px;
            margin-top: -5px;
            margin-bottom: 10px;
            max-height: 300px;
            overflow-y: auto;
            background: var(--xhs-pink-pale);
            border-radius: 0 0 10px 10px;
        }

        .history-list h4,
        .favorites-list h4 {
            margin: 0 0 10px 0;
            font-size: 0.9rem;
            color: var(--xhs-pink);
            font-weight: 600;
        }

        .history-item,
        .favorite-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-item:hover,
        .favorite-item:hover {
            background: var(--xhs-pink-pale);
            border-radius: 5px;
        }

        .history-item:last-child,
        .favorite-item:last-child {
            border-bottom: none;
        }

        .history-item .title,
        .favorite-item .title {
            font-weight: bold;
            color: var(--text-primary);
        }

        .history-item .author,
        .favorite-item .author {
            font-size: 0.9rem;
            color: var(--text-tertiary);
        }

        .header-search-btn {
            position: absolute;
            top: 10px;
            right: 60px;
            /* Position to the left of the dark mode toggle */
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--header-color);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-search-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        @media (min-width: 768px) {
            .dark-mode-toggle {
                top: 20px;
                right: 20px;
                width: 45px;
                height: 45px;
            }

            .header-search-btn {
                top: 20px;
                right: 75px;
                /* Adjust for larger screen */
                width: 45px;
                height: 45px;
            }
        }

        .poem-content {
            display: flex;
            flex-direction: column;
            padding: 0;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .poem-content {
                flex-direction: row;
                padding: 20px;
                min-height: 600px;
            }
        }

        @media (max-width: 767px) {
            .poem-content {
                padding: 5px;
            }
        }

        .poem-section {
            background: var(--container-bg);
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            padding: 0px;
            transition: box-shadow 0.3s ease;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .poem-section:hover {
            box-shadow: var(--card-shadow-hover);
        }

        @media (min-width: 768px) {
            .poem-section {
                padding: 0px;
                /* Reduced from 20px to 10px */
            }
        }

        .image-section {
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            min-height: 280px;
            max-height: 380px;
        }

        @media (min-width: 768px) {
            .image-section {
                padding: 0;
                margin: 0;
                min-height: 380px;
                max-height: 380px;
            }
        }

        .poem-image {
            width: 100%;
            max-width: 100%;
            height: 100%;
            aspect-ratio: 4/3;
            border-radius: 15px 15px 0 0;
            object-fit: cover;
            box-shadow: none;
            transition: transform 0.3s ease;
            border: none;
            margin: 0;
            padding: 0;
        }

        .poem-image:hover {
            transform: scale(1.01);
            box-shadow: none;
        }

        .text-section {
            position: relative;
            /* Elegant solid gradient background - no pixelation */
            background: linear-gradient(
                135deg,
                #fefdfb 0%,
                #fdfcf7 25%,
                #fcfaf4 50%,
                #fbf9f0 75%,
                #faf8ed 100%
            );
            padding: 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            flex: 1;
            border-radius: 0 0 15px 15px;
            /* Enhanced inner shadow for realistic paper depth */
            box-shadow:
                inset 0 1px 0 rgba(255, 255, 255, 0.8),
                inset 0 -1px 0 rgba(200, 180, 150, 0.3),
                inset 1px 0 0 rgba(200, 180, 150, 0.2),
                inset -1px 0 0 rgba(255, 255, 255, 0.5),
                inset 0 0 10px rgba(0, 0, 0, 0.08);
        }

        /* Subtle paper texture overlay using pseudo-element */
        .text-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Very subtle paper fiber texture */
            background-image:
                repeating-linear-gradient(
                    0deg,
                    rgba(0, 0, 0, 0.008) 0px,
                    rgba(0, 0, 0, 0.008) 1px,
                    transparent 1px,
                    transparent 3px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(0, 0, 0, 0.008) 0px,
                    rgba(0, 0, 0, 0.008) 1px,
                    transparent 1px,
                    transparent 3px
                );
            opacity: 0.5;
            border-radius: 0 0 15px 15px;
            pointer-events: none;
        }

        /* Dark mode text-section - elegant solid gradient */
        .dark-mode .text-section {
            background: linear-gradient(
                135deg,
                #2d2d2d 0%,
                #282828 25%,
                #242424 50%,
                #202020 75%,
                #1c1c1c 100%
            );
            color: var(--text-primary);
            box-shadow:
                inset 0 1px 0 rgba(255, 255, 255, 0.05),
                inset 0 -1px 0 rgba(100, 100, 100, 0.2),
                inset 1px 0 0 rgba(100, 100, 100, 0.1),
                inset -1px 0 0 rgba(255, 255, 255, 0.03),
                inset 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .dark-mode .text-section::before {
            background-image:
                repeating-linear-gradient(
                    0deg,
                    rgba(255, 255, 255, 0.008) 0px,
                    rgba(255, 255, 255, 0.008) 1px,
                    transparent 1px,
                    transparent 3px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(255, 255, 255, 0.008) 0px,
                    rgba(255, 255, 255, 0.008) 1px,
                    transparent 1px,
                    transparent 3px
                );
            opacity: 0.3;
        }

        /* Ensure poem text colors in dark mode have good contrast */
        .dark-mode .poem-verse {
            color: var(--text-secondary);
        }

        .dark-mode .poem-verse.vertical-mode,
        .dark-mode .poem-verse.horizontal-mode {
            color: var(--text-primary);
        }

        /* Vertical text layout for regular poems (shi) */
        .text-section.vertical-text {
            align-items: center;
        }

        .poem-verse.vertical-layout {
            display: flex;
            flex-direction: column;
            writing-mode: vertical-rl;
            text-orientation: upright;
            font-family: 'Noto Serif SC', 'STSong', 'Songti SC', serif;
            font-size: 1.4rem;
            letter-spacing: 0.4em;
            line-height: 1.7;
            color: var(--text-secondary);
            text-align: center;
            margin: 0 auto;
            height: auto;
            white-space: nowrap;
        }

        .vertical-line {
            display: inline-flex;
            flex-direction: column;
        }

        .vertical-char {
            margin: 2px 0;
        }

        /* Enhanced styles for improved default mode */

        /* Dynasty tag styling */
        .poem-author-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
            justify-content: center;
        }

        .dynasty-tag {
            background-color: var(--xhs-pink);
            color: white;
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: sans-serif;
            /* 衬线体配无衬线标签 */
            vertical-align: middle;
        }

        .dark-mode .dynasty-tag {
            background-color: var(--xhs-pink-light);
            color: #ffffff;
        }

        /* 正文排版容器 */
        .poem-verse-container {
            position: relative;
            padding: 10px;
            min-height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 竖排模式 (关键优化) */
        .poem-verse.vertical-mode {
            writing-mode: vertical-rl;
            text-orientation: upright;
            font-size: 1.6rem;
            letter-spacing: 0.4em;
            line-height: 2.1;
            /* Reduced from 2.5 */
            height: auto;
            max-height: 500px;
            /* 防止过高 */
            text-align: justify;
            margin: 0 auto;
            font-family: 'Noto Serif SC', serif;
        }

        .dark-mode .poem-verse.vertical-mode {
            color: var(--text-primary);
        }

        /* 横排模式优化 */
        .poem-verse.horizontal-mode {
            font-size: 1.6rem;
            line-height: 1.9;
            text-align: center;
            max-width: 95%;
        }

        .dark-mode .poem-verse.horizontal-mode {
            color: var(--text-primary);
        }

        /* Couplets for 7-character poems - display two lines together */
        /* 确保这是最新的样式 */
        .couplet-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0;
            /* 关键：去掉外边距 */
            padding: 10px 0;
            /* 关键：只用内边距控制，10px-12px 比较合适 */
            border-bottom: 1px dashed rgba(128, 128, 128, 0.15);
            width: 100%;
        }

        /* 稍微增加一点行内文字的紧凑度，让两行诗靠近，这样组与组的区分度更好 */
        .horizontal-mode .couplet-row {
            line-height: 1.6;
        }

        .dark-mode .couplet-row {
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }

        /* This seal will be used in the main display */
        .main-seal {
            position: absolute;
            bottom: 25px;
            right: 25px;
            width: 40px;
            height: 40px;
            font-size: 18px;
            border: 2px solid #d44c4c;
            color: #d44c4c;
            background: rgba(255, 255, 255, 0.8);
            opacity: 0.8;
            transform: rotate(-5deg);
            pointer-events: none;
            /* 不挡鼠标 */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
        }

        .dark-mode .main-seal {
            background: rgba(40, 40, 40, 0.9);
            color: #FF6B8A;
            border-color: #FF6B8A;
        }

        /* Adjusted description section styling */
        .desc-section {
            /* 变成一个稍微深一点的背景，像书的封底 */
            background: #fdfdfd;
            border-left: 4px solid var(--xhs-pink-lighter);
            /* 左侧装饰线 */
        }

        .dark-mode .desc-section {
            background: #222222;
            border-left: 4px solid var(--xhs-pink-light);
            /* 左侧装饰线 in dark mode */
        }

        .poem-desc {
            font-size: 1rem;
            color: #555;
            text-align: justify;
            /* 两端对齐更像书 */
        }

        .dark-mode .poem-desc {
            color: var(--text-tertiary);
        }

        /* 首字下沉效果 (可选) */
        .poem-desc::first-letter {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--xhs-pink);
            float: left;
            margin-right: 4px;
            line-height: 1;
        }

        .dark-mode .poem-desc::first-letter {
            color: var(--xhs-pink-light);
        }

        /* Seal decoration for default mode */
        .seal-default-mode {
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background-color: rgba(180, 30, 30, 0.7);
            color: white;
            border-radius: 50%;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: serif;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 11;
            opacity: 0.8;
        }

        @media (min-width: 768px) {
            .text-section {
                padding: 10px;
            }
        }

        .poem-title {
            font-size: 2.0rem;
            /* Reduced from 2.2rem to 2.0rem */
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 12px;
            font-weight: 700;
            font-family: 'Noto Serif SC', 'STSong', 'Songti SC', serif;
            letter-spacing: 0.05em;
            line-height: 1.3;
            padding: 0 10px;
            position: relative;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .inline-search-btn {
            background: rgba(99, 102, 241, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 0.9rem;
            cursor: pointer;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .inline-search-btn.absolute-position {
            position: absolute;
            top: 20px;
            /* Adjust to align with title */
            right: 10px;
            /* Position to the right */
        }

        .inline-search-btn:hover {
            background: rgba(107, 114, 128, 0.3);
            transform: scale(1.15);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .ai-interpret-btn {
            background: rgba(99, 102, 241, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 0.9rem;
            cursor: pointer;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .ai-interpret-btn.absolute-position {
            position: absolute;
            top: 20px;
            /* Align with title text */
            right: 10px;
            /* Position to the right of the title */
        }

        .ai-interpret-btn:hover {
            background: rgba(107, 114, 128, 0.3);
            transform: scale(1.15);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .positioned-title {
            position: relative;
        }

        .poem-author {
            font-size: 1.3rem;
            /* Increased from 1.1rem to 1.3rem */
            color: var(--text-tertiary);
            text-align: center;
            margin-bottom: 12px;
            font-style: normal;
            font-family: 'Noto Serif SC', 'STSong', 'Songti SC', serif;
            letter-spacing: 0.02em;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .poem-type {
            font-size: 1.1rem;
            /* Increased from 0.9rem to 1.1rem */
            color: var(--xhs-pink);
            text-align: center;
            margin-bottom: 18px;
            background: var(--xhs-pink-lighter);
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            align-self: center;
            font-weight: 500;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .poem-verse {
            font-size: 1.6rem;
            /* Increased from 1.2rem to 1.6rem for larger text */
            line-height: 1.9;
            /* Adjusted line height for better readability */
            color: var(--text-secondary);
            text-align: center;
            margin: 0;
            font-weight: 400;
            font-family: 'Noto Serif SC', 'STSong', 'Songti SC', serif;
            letter-spacing: 0.03em;
            white-space: normal;
            /* Allow line breaks */
            word-wrap: break-word;
            /* Break long words if needed */
        }

        /* Ensure <br> tags create line breaks */
        .poem-verse br {
            display: block;
        }

        /* Make sure poem verse allows line breaks */
        .poem-verse {
            overflow-wrap: break-word;
            word-wrap: break-word;
        }

        /* Paragraph breaks between sections of poems */
        .poem-paragraph-break {
            display: block;
            height: 1.5em;
            /* Create visual separation between poem sections */
        }

        .desc-section {
            background: var(--container-bg);
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            padding: 10px;
            /* Reduced from 20px to 10px */
            transition: box-shadow 0.3s ease;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .desc-section:hover {
            box-shadow: var(--card-shadow-hover);
        }

        @media (min-width: 768px) {
            .desc-section {
                padding: 15px;
                /* Reduced from 20px to 15px */
            }
        }

        .poem-desc {
            font-size: 1.1rem;
            /* Increased from 0.95rem to 1.1rem */
            line-height: 1.7;
            /* Reduced from 1.8 to 1.7 */
            color: var(--text-tertiary);
            padding: 0;
            background: transparent;
            border-radius: 0;
            border-left: none;
            height: 100%;
            overflow-y: auto;
            flex: 1;
        }

        .poem-desc a {
            color: #4da6ff;
            text-decoration: underline;
        }

        .poem-desc a:hover {
            color: #66b3ff;
        }

        @media (min-width: 768px) {
            .poem-desc {
                padding: 20px;
            }
        }

        .poem-desc h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .controls {
            text-align: center;
            padding: 0;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .controls {
                padding: 30px;
            }
        }

        .refresh-btn {
            background: linear-gradient(135deg, var(--refresh-btn-gradient-start) 0%, var(--refresh-btn-gradient-end) 100%);
            color: var(--refresh-btn-color);
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--card-shadow);
            font-weight: 600;
            letter-spacing: 0.01em;
            position: relative;
            overflow: hidden;
        }

        .refresh-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .refresh-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--card-shadow-hover);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #666;
        }

        .poem-meta {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .poem-meta span {
            background: #e9ecef;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            color: #555;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: var(--footer-color);
            font-size: 0.85rem;
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            footer {
                padding: 20px;
            }
        }

        /* Animation for content loading */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.8s ease forwards;
        }

        .filter-section {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            padding: 18px;
            background: var(--container-bg);
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            transition: box-shadow 0.3s ease;
        }

        .filter-section:hover {
            box-shadow: var(--card-shadow-hover);
        }

        .filter-section label {
            font-weight: bold;
            color: var(--text-primary);
            white-space: nowrap;
            display: flex;
            align-items: center;
            min-height: 40px;
            /* Consistent height */
            padding: 0 5px;
            /* Uniform padding */
            box-sizing: border-box;
            /* Include padding in height calculation */
        }

        .filter-section select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background: var(--container-bg);
            color: var(--text-primary);
            font-size: 1rem;
            min-width: 120px;
            flex: 1;
            min-width: 0;
            /* Allow it to shrink below min-width */
            height: 40px;
            /* Fixed height to ensure consistency */
            min-height: 40px;
            /* Consistent height */
            box-sizing: border-box;
            /* Include padding in height calculation */
            line-height: 1.2;
            /* Control text alignment inside the select */
        }

        .filter-section button {
            padding: 8px 16px;
            background: var(--clear-btn-bg);
            color: var(--refresh-btn-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            min-height: 40px;
            /* Consistent height */
            box-sizing: border-box;
            /* Include padding in height calculation */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .filter-section button:hover {
            background: var(--clear-btn-hover);
        }

        .search-section {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            padding: 18px;
            background: var(--container-bg);
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            transition: box-shadow 0.3s ease;
        }

        .search-section:hover {
            box-shadow: var(--card-shadow-hover);
        }

        .search-section.show {
            display: flex;
        }

        .search-section input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            min-width: 200px;
            flex: 1;
            background: var(--container-bg);
            color: var(--text-primary);
        }

        .search-section button {
            padding: 8px 16px;
            background: var(--search-btn-bg);
            color: var(--refresh-btn-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .search-section button:nth-child(3) {
            background: var(--clear-btn-bg);
            /* Different color for clear button */
        }

        .search-section button:hover {
            background: var(--search-btn-hover);
        }

        .search-section button:nth-child(3):hover {
            background: var(--clear-btn-hover);
            /* Different hover for clear button */
        }



        .search-toggle-btn {
            background: #17a2b8 !important;
            /* Override default button color */
            display: flex !important;
            align-items: center !important;
            gap: 4px !important;
        }

        .search-toggle-btn:hover {
            background: #138496 !important;
        }

        .search-results {
            margin-bottom: 20px;
            padding: 20px;
            background: var(--container-bg);
            border-radius: 20px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .search-results h3 {
            margin-top: 0;
            color: var(--text-primary);
            text-align: center;
        }

        .search-results ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .search-results li {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            color: var(--text-tertiary);
        }

        .search-results li:hover {
            background-color: var(--search-result-hover);
        }

        .search-results .result-title {
            font-weight: bold;
            color: #4da6ff;
        }

        .search-results .result-author {
            font-style: italic;
            color: var(--text-light);
            font-size: 0.9em;
        }

        .search-results .result-preview {
            margin-top: 4px;
            color: var(--text-tertiary);
            font-size: 0.9em;
        }

        /* Mobile-specific styles for filter section */
        @media (max-width: 767px) {
            .filter-section {
                flex-direction: row;
                flex-wrap: nowrap;
                /* Keep items in a single line */
                align-items: center;
                padding: 8px;
                margin: 5px;
                gap: 3px;
                min-height: 40px;
            }

            .filter-section label {
                font-size: 0.65rem;
                white-space: nowrap;
                margin: 0;
                flex-shrink: 0;
                min-height: 34px;
                /* Consistent height for mobile */
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 0 2px;
                /* Uniform padding for mobile */
            }

            .filter-section select {
                min-width: 0;
                font-size: 0.65rem;
                padding: 2px 4px;
                /* Adjusted padding for better height consistency */
                flex: 1 1 auto;
                height: 34px;
                /* Fixed height to ensure consistency */
                min-height: 34px;
                /* Consistent height for mobile */
                max-width: 70px;
                /* Further reduce width to fit all elements */
                flex-basis: 70px;
                box-sizing: border-box;
                /* Include padding in height calculation */
                line-height: 1.2;
                /* Control text alignment inside the select */
            }

            .filter-section button {
                font-size: 0.65rem;
                padding: 2px 4px;
                min-height: 34px;
                /* Consistent height for mobile */
                white-space: nowrap;
                flex: 0 0 auto;
                /* Prevent button from shrinking */
                min-width: 50px;
                /* Ensure minimum button width for tap targets */
                box-sizing: border-box;
                /* Include padding in height calculation */
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .search-toggle-btn {
                min-width: 45px !important;
                /* Smaller width for search button on mobile */
                padding: 2px 3px !important;
                /* Smaller padding on mobile */
                font-size: 0.6rem !important;
                /* Smaller font on mobile */
            }
        }

        /* Stack elements on very narrow screens */
        @media (max-width: 400px) {
            .filter-section {
                flex-wrap: wrap;
                /* Allow wrapping if too narrow */
                flex-direction: row;
                align-content: center;
            }
        }

        /* Mobile-specific styles for search section */
        @media (max-width: 767px) {
            .search-section {
                flex-direction: row;
                flex-wrap: wrap;
                padding: 8px;
                margin: 5px;
                gap: 4px;
            }

            .search-section input {
                font-size: 0.8rem;
                padding: 5px;
                min-width: 100px;
                flex: 2;
                min-height: 30px;
            }

            .search-section button {
                font-size: 0.8rem;
                padding: 5px 8px;
                min-height: 30px;
                flex: 1;
            }
        }

        @media (max-width: 480px) {
            .search-section {
                flex-direction: column;
            }

            .search-section input {
                width: 100%;
            }

            .search-section button {
                width: 100%;
            }
        }

        /* Poetry-specific styling */
        strong {
            color: #667eea;
            font-weight: bold;
        }

        p {
            margin: 10px 0;
        }

        mark {
            background-color: #ffeb3b;
            padding: 0 2px;
            border-radius: 2px;
        }

        .floating-refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--refresh-btn-gradient-start) 0%, var(--refresh-btn-gradient-end) 100%);
            color: white;
            border: none;
            font-size: 22px;
            cursor: pointer;
            box-shadow: var(--card-shadow-hover);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
            pointer-events: auto;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        .floating-refresh-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(254, 44, 85, 0.4);
            animation: none;
        }

        /* Mobile-specific styles for floating button */
        @media (max-width: 767px) {
            .floating-refresh-btn {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }

        /* Waterfall Flow Layout */
        .waterfall-container {
            display: none;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px 5px;
            /* Reduced from 20px 10px to save space */
        }

        .waterfall-container.active {
            display: block;
        }

        .waterfall-content {
            column-count: 2;
            column-gap: 12px;
            /* Reduced from 20px to save space */
            /* Enhanced background with subtle pattern */
            background:
                linear-gradient(90deg, rgba(254, 44, 85, 0.02) 1px, transparent 1px),
                linear-gradient(rgba(254, 44, 85, 0.02) 1px, transparent 1px),
                var(--bg-gradient-start);
            background-size: 50px 50px;
        }

        @media (max-width: 1024px) {
            .waterfall-content {
                column-count: 2;
            }
        }

        @media (max-width: 767px) {
            .waterfall-content {
                column-count: 1;
            }
        }

        /* On very wide screens, allow 3 columns */
        @media (min-width: 1400px) {
            .waterfall-content {
                column-count: 3;
            }
        }

        .waterfall-card {
            display: block;
            background: var(--container-bg);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 15px;
            /* Increased from 12px for better spacing */
            break-inside: avoid;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            height: 340px;
            /* Increased from 300px for better proportions */
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(254, 44, 85, 0.08);
            /* Subtle border for depth */
            /* Enhanced texture effects */
            position: relative;
            background: var(--container-bg); /* Base background */
        }

        .waterfall-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;

            /* Subtle texture using SVG noise pattern */
            background-image:
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.15) 1.5px, transparent 2px),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.15) 1.5px, transparent 2px),
                radial-gradient(circle at 40% 40%, rgba(0, 0, 0, 0.08) 1px, transparent 1.5px),
                radial-gradient(circle at 60% 60%, rgba(0, 0, 0, 0.08) 1px, transparent 1.5px),
                /* Subtle noise texture */
                url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            background-size: 60px 60px, 70px 70px, 45px 45px, 35px 35px, 256px 256px;

            /* Set transparency and blend mode for natural texture effect */
            opacity: 0.5;
            mix-blend-mode: overlay;

            pointer-events: none; /* Ensure pseudo-element doesn't interfere with mouse events */
            border-radius: 20px; /* Match card border-radius */
        }

        .waterfall-card:hover::before {
            /* Enhanced texture effect on hover */
            background-image:
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.2) 1.5px, transparent 2px),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.2) 1.5px, transparent 2px),
                radial-gradient(circle at 40% 40%, rgba(0, 0, 0, 0.1) 1px, transparent 1.5px),
                radial-gradient(circle at 60% 60%, rgba(0, 0, 0, 0.1) 1px, transparent 1.5px),
                /* More prominent noise on hover */
                url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.1'/%3E%3C/svg%3E");
            background-size: 60px 60px, 70px 70px, 45px 45px, 35px 35px, 256px 256px;
            opacity: 0.6;
        }

        .waterfall-card:hover {
            transform: translateY(-5px) scale(1.02);
            /* Added subtle scale */
            box-shadow: var(--card-shadow-hover);
            /* Enhanced texture effect on hover with more intensity */
            background-image:
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.2) 1.5px, transparent 2px),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.2) 1.5px, transparent 2px),
                radial-gradient(circle at 40% 40%, rgba(0, 0, 0, 0.1) 1px, transparent 1.5px),
                radial-gradient(circle at 60% 60%, rgba(0, 0, 0, 0.1) 1px, transparent 1.5px),
                /* Add subtle noise on hover for extra texture */
                url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
            background-size: 50px 50px, 60px 60px, 40px 40px, 30px 30px, 256px 256px;
        }

        .color-block {
            width: 100%;
            height: 200px;
            /* Increased from 170px for better text visibility */
            display: block;
            position: relative;
            /* Base gradient for background */
            background:
                linear-gradient(135deg, rgba(0, 0, 0, 0.05) 0%, rgba(255, 255, 255, 0.05) 100%);
            transition: all 0.3s ease;
        }

        .color-block::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;

            /* Rice paper texture using SVG pattern */
            background-image:
                /* Base texture - subtle paper */
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.15'/%3E%3C/svg%3E"),
                /* Additional canvas-like pattern */
                repeating-linear-gradient(
                    0deg,
                    rgba(0, 0, 0, 0.03) 0px,
                    rgba(0, 0, 0, 0.03) 1px,
                    transparent 1px,
                    transparent 2px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(0, 0, 0, 0.03) 0px,
                    rgba(0, 0, 0, 0.03) 1px,
                    transparent 1px,
                    transparent 2px
                );
            background-size:
                100px 100px,
                4px 4px,
                4px 4px;

            /* Set transparency and blend mode for natural texture effect */
            opacity: 0.3;
            mix-blend-mode: multiply;

            pointer-events: none; /* Ensure pseudo-element doesn't interfere with mouse events */
        }

        .color-block:hover::after {
            /* Enhanced texture effect on hover */
            background-image:
                /* Base texture - more prominent on hover */
                url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.25'/%3E%3C/svg%3E"),
                /* Additional canvas-like pattern */
                repeating-linear-gradient(
                    0deg,
                    rgba(0, 0, 0, 0.05) 0px,
                    rgba(0, 0, 0, 0.05) 1px,
                    transparent 1px,
                    transparent 2px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(0, 0, 0, 0.05) 0px,
                    rgba(0, 0, 0, 0.05) 1px,
                    transparent 1px,
                    transparent 2px
                );
            background-size:
                100px 100px,
                4px 4px,
                4px 4px;
            opacity: 0.4;
        }

        .overlay-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            padding: 20px;
        }

        .dark-mode .overlay-text {
            color: #ffffff;
        }

        /* Mode 1: Vertical layout (suitable for 5/7-character poems) */
        .layout-vertical {
            flex-direction: row-reverse;
            /* Ancient Chinese reads from right to left */
            gap: 12px;
        }

        .layout-vertical .poem-line {
            writing-mode: vertical-rl;
            /* Vertical text */
            text-orientation: upright;
            font-family: 'Noto Serif SC', serif;
            font-size: 1.4rem;
            /* Vertical text can be larger */
            letter-spacing: 0.3em;
            /* Increase letter spacing for more breathing room */
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
            /* Decorative line */
            padding-left: 8px;
        }

        .layout-vertical .poem-line:last-child {
            border-left: none;
        }

        .dark-mode .layout-vertical .poem-line {
            color: rgba(255, 255, 255, 0.98);
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        /* Mode 2: Horizontal center layout (suitable for ci/named phrases) */
        .layout-horizontal-center {
            flex-direction: column;
            gap: 16px;
        }

        .layout-horizontal-center .poem-line {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.3rem;
            letter-spacing: 0.1em;
            color: white;
            text-align: center;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .dark-mode .layout-horizontal-center .poem-line {
            color: #ffffff;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
        }

        /* Add decoration like quotes for horizontal quotes */
        .layout-horizontal-center::before {
            content: "" ";
 font-family: serif;
            font-size: 4rem;
            position: absolute;
            top: 10px;
            left: 15px;
            opacity: 0.3;
            color: white;
        }

        /* Fallback for default layout - keep the original styling */
        .layout-horizontal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.2rem;
            /* Increased from 1rem for better readability */
            font-weight: 500;
            text-align: center;
            width: 98%;
            /* Reduced from 85% for better centering */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.9);
            /* Enhanced shadow for better contrast */
            z-index: 10;
            /* Allow text to wrap to multiple lines */
            white-space: normal;
            word-wrap: break-word;
            overflow: hidden;
            /* Keep text within bounds */
            line-height: 1.8;
            /* Increased from 1.6 for seven-character poems */
            letter-spacing: 0.05em;
            /* Better spacing for Chinese characters */
            font-family: 'Noto Serif SC', 'STSong', 'Songti SC', serif;
            /* Use Chinese typography for proper character alignment */
        }

        .seal-decoration {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 28px;
            height: 28px;
            background:
                radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.4) 0%, transparent 40%),
                linear-gradient(135deg, #c81e1e, #8a0a0a);
            color: white;
            border-radius: 4px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: serif;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            z-index: 11;
            opacity: 0.9;
            /* Add texture to the seal */
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
        }

        .color-block-container {
            position: relative;
            width: 100%;
            height: 200px;
            /* Increased from 170px for better text visibility */
            border-radius: 20px 20px 0 0;
            overflow: hidden;
        }

        .waterfall-content-section {
            padding: 12px 15px;
            /* Increased from 4px 6px for better spacing */
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 4px;
            /* Add gap between title and author */
            /* Paper-like texture background */
            background:
                /* Base color with subtle texture */
                linear-gradient(0deg, rgba(255, 255, 255, 0.9) 0%, rgba(245, 245, 240, 0.9) 100%),
                /* Paper fiber texture */
                repeating-linear-gradient(
                    0deg,
                    rgba(0, 0, 0, 0.02) 0px,
                    rgba(0, 0, 0, 0.02) 1px,
                    transparent 1px,
                    transparent 2px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(0, 0, 0, 0.02) 0px,
                    rgba(0, 0, 0, 0.02) 1px,
                    transparent 1px,
                    transparent 2px
                );
            /* Subtle inner shadow for depth */
            box-shadow:
                inset 2px 2px 4px rgba(0, 0, 0, 0.05),
                inset -2px -2px 4px rgba(255, 255, 255, 0.5);
        }

        .dark-mode .waterfall-content-section {
            /* Paper-like texture background for dark mode */
            background:
                /* Base color with subtle texture */
                linear-gradient(0deg, rgba(40, 40, 40, 0.9) 0%, rgba(30, 30, 30, 0.9) 100%),
                /* Paper fiber texture */
                repeating-linear-gradient(
                    0deg,
                    rgba(255, 255, 255, 0.02) 0px,
                    rgba(255, 255, 255, 0.02) 1px,
                    transparent 1px,
                    transparent 2px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(255, 255, 255, 0.02) 0px,
                    rgba(255, 255, 255, 0.02) 1px,
                    transparent 1px,
                    transparent 2px
                );
            /* Subtle inner shadow for depth in dark mode */
            box-shadow:
                inset 2px 2px 4px rgba(0, 0, 0, 0.2),
                inset -2px -2px 4px rgba(80, 80, 80, 0.1);
        }

        .waterfall-title {
            font-size: 1rem;
            /* Increased from 0.9rem for better readability */
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .waterfall-author {
            font-size: 0.8rem;
            /* Increased from 0.75rem for better readability */
            color: var(--text-tertiary);
            margin: 0;
            /* Removed margin, using gap in parent instead */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .poem-content.symmetric-layout {
            display: flex;
        }

        .poem-content.waterfall-layout {
            display: none;
        }

        .poem-content.waterfall-active {
            display: none;
        }

        .poem-content.symmetric-active {
            display: flex;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>古典诗词</h1>
            <div class="subtitle">品味千年文化，感受诗词之美</div>
            <button id="menuToggle" class="menu-toggle" title="菜单">
                🎋
            </button>
        </header>

        <div class="controls">
            <div class="filter-section">
                <label for="authorFilter"></label>
                <select id="authorFilter" onchange="filterByAuthor()">
                    <option value="">作者</option>
                </select>
                <label for="poemList"></label>
                <select id="poemList" onchange="selectPoem()">
                    <option value="">作品</option>
                </select>
                <button class="refresh-btn" onclick="clearFilter()">清除</button>
                <button class="refresh-btn search-toggle-btn" onclick="toggleSearch()">🔍 搜诗词</button>
                <button class="refresh-btn" id="layoutToggle" onclick="toggleLayout()">瀑布流</button>
            </div>

            <!-- Search Section (Initially Hidden) -->
            <div id="searchSection" class="search-section" style="display: none;">
                <input type="text" id="searchInput" placeholder="搜索诗歌标题或正文..." onkeypress="handleSearchKeyPress(event)">
                <button class="refresh-btn" onclick="performSearch()">搜索</button>
                <button class="refresh-btn" onclick="hideSearch()">收起</button>
            </div>

            <!-- Search Results Section -->
            <div id="searchResults" class="search-results" style="display: none;">
                <h3>搜索结果</h3>
                <ul id="searchResultsList"></ul>
            </div>
        </div>

        <div class="poem-content">
            <div class="poem-section">
                <div class="image-section">
                    <img id="poemImage" class="poem-image fade-in" src="" alt="诗词配图">
                </div>
                <div class="text-section">
                    <div id="loading" class="loading">诗词加载中...</div>

                    <div id="poemTextContent"
                        style="display: none; width: 100%; display: flex; flex-direction: column; align-items: center;">

                        <!-- 头部组合：标题+作者 -->
                        <div class="poem-header-group">
                            <div class="poem-meta"
                                style="margin-bottom: 10px; display: flex; justify-content: center; gap: 10px;">
                                <!-- 搜索按钮保留 -->
                                <button id="inlineSearchBtn" class="inline-search-btn" title="搜索诗词赏析">🔍</button>
                                <button onclick="copyPoemToClipboard()" class="inline-search-btn"
                                    title="复制诗词">📋</button>
                                <button id="favoriteToggleBtn" class="inline-search-btn" title="收藏此诗词">
                                    ♡
                                </button>
                                <button id="ai-interpret-btn" class="ai-interpret-btn" title="AI解读诗词">
                                    💡
                                </button>
                            </div>
                            <div style="position: relative; width: 100%; min-height: 60px;">
                                <h2 id="poemTitle" class="poem-title positioned-title"></h2>
                            </div>
                            <div class="poem-author-badge">
                                <span id="poemDynasty" class="dynasty-tag">唐</span> <!-- 动态年份 -->
                                <span id="poemAuthor"></span>
                            </div>
                        </div>

                        <!-- 正文容器 -->
                        <div class="poem-verse-container">
                            <div id="poemVerse" class="poem-verse"></div>
                            <!-- 大印章 (will be updated dynamically) -->
                            <div class="seal-decoration main-seal" id="mainTypeSeal">诗</div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="desc-section">
                <div id="poemDescContent" style="display: none;">
                    <div class="poem-desc" id="poemDesc"></div>
                </div>
            </div>
        </div>

        <!-- Waterfall Flow Container -->
        <div id="waterfallContainer" class="waterfall-container">
            <div id="waterfallContent" class="waterfall-content">
                <!-- Waterfall cards will be dynamically generated here -->
            </div>
        </div>

        <!-- Floating Refresh Button -->
        <button class="floating-refresh-btn" onclick="refreshContent()" title="刷新内容">
            ♻️
        </button>

        <footer>
            <p>Designed by 苑广山| 随机展示经典诗词</p>
        </footer>

        <!-- Menu Overlay -->
        <div id="menuOverlay" class="menu-overlay">
            <div class="menu-content">
                <div class="menu-header">
                    <h3 class="menu-title">菜单</h3>
                    <button id="closeMenuBtn" class="close-menu-btn" title="关闭">×</button>
                </div>
                <div class="menu-options">
                    <!-- History Section -->
                    <div class="menu-section">
                        <button class="menu-option" id="historyBtn">
                            <span>🕒</span> 历史记录
                        </button>
                        <div id="historySection" class="history-list" style="display: none;">
                            <h4>历史记录</h4>
                            <div id="historyList"></div>
                        </div>
                    </div>

                    <!-- Favorites Section -->
                    <div class="menu-section">
                        <button class="menu-option" id="favoritesBtn">
                            <span>❤️</span> 我的收藏
                        </button>
                        <div id="favoritesSection" class="favorites-list" style="display: none;">
                            <h4>我的收藏</h4>
                            <div id="favoritesList"></div>
                        </div>
                    </div>

                    <!-- Dark Mode Toggle -->
                    <div class="menu-section">
                        <button class="menu-option" id="darkModeToggle">
                            <span>🌙</span> 切换模式
                        </button>
                    </div>

                    <!-- About Section -->
                    <div class="menu-section">
                        <button class="menu-option" id="aboutBtn">
                            <span>ℹ️</span> 关于
                        </button>
                        <div id="aboutSection" class="about-section"
                            style="display: none; padding: 20px; color: var(--text-primary);">
                            <h4>关于本站</h4>
                            <p style="margin-top: 10px; line-height: 1.6;">
                                本站致力于弘扬中华传统文化，为您随机展示唐诗宋词的经典之作。
                            </p>
                            <p style="margin-top: 10px; line-height: 1.6;">
                                我们提供 AI 深度赏析功能，助您更好地理解诗词意境。
                            </p>
                            <p style="margin-top: 20px; font-size: 0.9rem; color: var(--text-tertiary);">
                                Version 3.0.0<br>
                                Designed by 苑广山
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Store all poems and ci globally after first fetch
            let allPoems = null;
            let allCi = null;
            let allCombined = null; // Combined poems and ci

// Author data
window.AUTHOR_DATA = [
  {
    "id": "tang_libai",
    "name": "李白",
    "pinyin": "Li Bai",
    "dynasty": "唐",
    "titles": ["诗仙", "青莲居士"],
    "life_span": "701-762",
    "bio": "祖籍陇西成纪，据传出生于西域碎叶城，后迁居四川江油。天宝初年供奉翰林，因得罪权贵被赐金放还。一生好入名山游，喜饮酒，豪气纵横。晚年受安史之乱牵连被流放夜郎，遇赦得还，最终病逝于当涂。",
    "achievements": "中国浪漫主义诗歌的巅峰。其诗想象奇特，感情强烈，意境奇伟，将中国诗歌的想象力推向了前所未有的高度。现存诗歌900余首。",
    "style": "豪迈奔放，清新飘逸，想象丰富，夸张大胆，具有浓厚的道家色彩。",
    "tags": ["浪漫主义", "乐府", "绝句", "唐诗"],
    "works": [
      { "title": "静夜思", "line": "举头望明月，低头思故乡" },
      { "title": "将进酒", "line": "天生我材必有用，千金散尽还复来" },
      { "title": "望庐山瀑布", "line": "飞流直下三千尺，疑是银河落九天" }
    ]
  },
  {
    "id": "tang_dufu",
    "name": "杜甫",
    "pinyin": "Du Fu",
    "dynasty": "唐",
    "titles": ["诗圣", "杜工部", "杜少陵"],
    "life_span": "712-770",
    "bio": "河南巩县人。生于大唐盛世，亲历安史之乱，一生饱经战乱与流离。晚年漂泊四川、湖南一带，生活困苦，多以诗自遣，时为官吏。其诗记录了唐代由盛转衰的历史巨变。",
    "achievements": "中国现实主义诗歌的集大成者。其诗被称为“诗史”，深刻反映了社会矛盾和人民疾苦。在律诗的格律技巧上达到了炉火纯青的境界。",
    "style": "沉郁顿挫，忧国忧民，格律严谨，语言精练，博大精深。",
    "tags": ["现实主义", "律诗", "诗史", "唐诗"],
    "works": [
      { "title": "春望", "line": "国破山河在，城春草木深" },
      { "title": "登高", "line": "无边落木萧萧下，不尽长江滚滚来" },
      { "title": "茅屋为秋风所破歌", "line": "安得广厦千万间，大庇天下寒士俱欢颜" }
    ]
  },
  {
    "id": "tang_wangwei",
    "name": "王维",
    "pinyin": "Wang Wei",
    "dynasty": "唐",
    "titles": ["诗佛", "王右丞"],
    "life_span": "701-761",
    "bio": "河东蒲州人。精通诗、书、画、音乐。早年有政治抱负，晚年看空政局，隐居蓝田辋川，过着半官半隐的生活，笃信佛教。",
    "achievements": "盛唐山水田园诗派的代表人物。苏轼在《东坡题跋》中评价他「味摩诘之诗，诗中有画；观摩诘之画，画中有诗」。开创了水墨山水画派。",
    "style": "清新淡远，自然空灵，诗中有画，富含禅意，多写山水田园之乐。",
    "tags": ["山水田园", "禅意", "五言", "唐诗"],
    "works": [
      { "title": "相思", "line": "红豆生南国，春来发几枝" },
      { "title": "山居秋暝", "line": "明月松间照，清泉石上流" },
      { "title": "九月九日忆山东兄弟", "line": "独在异乡为异客，每逢佳节倍思亲" }
    ]
  },
  {
    "id": "tang_menghaoran",
    "name": "孟浩然",
    "pinyin": "Meng Haoran",
    "dynasty": "唐",
    "titles": ["孟山人"],
    "life_span": "689-740",
    "bio": "襄州襄阳人。早年隐居鹿门山，四十岁入长安应进士不第，一生大半在隐居和漫游中度过，未曾入仕（仅做过短暂幕僚）。与王维并称“王孟”。",
    "achievements": "盛唐山水田园诗派的第一人。他的诗开启了盛唐清淡自然的诗风，对后世山水诗影响巨大。",
    "style": "语淡而味终，清旷冲淡，不尚雕饰，多写隐居闲适和羁旅愁思。",
    "tags": ["山水田园", "隐逸", "五言", "唐诗"],
    "works": [
      { "title": "春晓", "line": "春眠不觉晓，处处闻啼鸟" },
      { "title": "宿建德江", "line": "野旷天低树，江清月近人" },
      { "title": "过故人庄", "line": "开轩面场圃，把酒话桑麻" }
    ]
  },
  {
    "id": "tang_lishangyin",
    "name": "李商隐",
    "pinyin": "Li Shangyin",
    "dynasty": "唐",
    "titles": ["小李杜(李)", "玉溪生"],
    "life_span": "813-858",
    "bio": "怀州河内人。处于晚唐衰败时期，卷入“牛李党争”的政治旋涡，备受排挤，一生潦倒不得志。感情生活丰富而曲折。",
    "achievements": "晚唐诗歌的最高成就代表。他的诗歌构思新奇，擅长用典，特别是他的“无题”诗，将朦胧诗的艺术推向高峰。",
    "style": "朦胧绮丽，深情绵邈，致密婉曲，善于用典，意蕴幽微。",
    "tags": ["晚唐", "无题诗", "咏史", "七言"],
    "works": [
      { "title": "锦瑟", "line": "此情可待成追忆，只是当时已惘然" },
      { "title": "无题·相见时难别亦难", "line": "春蚕到死丝方尽，蜡炬成灰泪始干" },
      { "title": "夜雨寄北", "line": "何当共剪西窗烛，却话巴山夜雨时" }
    ]
  },
  {
    "id": "tang_dumu",
    "name": "杜牧",
    "pinyin": "Du Mu",
    "dynasty": "唐",
    "titles": ["小李杜(杜)", "杜樊川"],
    "life_span": "803-852",
    "bio": "京兆万年人，宰相杜佑之孙。年轻时即有忧国忧民之心，关注军事与政治。生性风流倜傥，曾在扬州任职，留下许多风流佳话。",
    "achievements": "晚唐杰出的诗人与散文家。其七言绝句意境清新，咏史诗气魄豪健，议论纵横，别开生面。",
    "style": "俊爽豪健，明丽跌宕，寓意深远，多含讽喻。",
    "tags": ["晚唐", "咏史", "七绝", "豪放"],
    "works": [
      { "title": "清明", "line": "借问酒家何处有，牧童遥指杏花村" },
      { "title": "泊秦淮", "line": "商女不知亡国恨，隔江犹唱后庭花" },
      { "title": "阿房宫赋", "line": "楚人一炬，可怜焦土" }
    ]
  },
  {
    "id": "tang_liuchangqing",
    "name": "刘长卿",
    "pinyin": "Liu Changqing",
    "dynasty": "唐",
    "titles": ["五言长城", "刘随州"],
    "life_span": "709-786",
    "bio": "河间人。刚正不阿，两度遭贬。其诗在当时负盛名，主要活动于中唐初期。",
    "achievements": "擅长五言诗，自许为“五言长城”。是中唐前期著名的山水诗人，对律诗的定型有一定贡献。",
    "style": "清雅简淡，含蓄深沉，多写贬谪迁流之感和山水景物。",
    "tags": ["五言", "山水", "中唐"],
    "works": [
      { "title": "逢雪宿芙蓉山主人", "line": "柴门闻犬吠，风雪夜归人" },
      { "title": "送灵澈上人", "line": "荷笠带斜阳，青山独归远" }
    ]
  },
  {
    "id": "tang_weiyingwu",
    "name": "韦应物",
    "pinyin": "Wei Yingwu",
    "dynasty": "唐",
    "titles": ["韦苏州"],
    "life_span": "737-792",
    "bio": "京兆长安人。早年为豪纵侠少，作为玄宗侍卫横行乡里。安史之乱后折节读书，做官清廉，晚年任苏州刺史。",
    "achievements": "中唐山水田园派的代表，是继陶渊明、王维、孟浩然之后的重要山水诗人。",
    "style": "高雅闲淡，古朴自然，冲淡深婉，寄情山水。",
    "tags": ["山水田园", "五言", "中唐"],
    "works": [
      { "title": "滁州西涧", "line": "春潮带雨晚来急，野渡无人舟自横" },
      { "title": "寄全椒山中道士", "line": "落叶满空山，何处寻行迹" }
    ]
  },
  {
    "id": "song_sushi",
    "name": "苏轼",
    "pinyin": "Su Shi",
    "dynasty": "宋",
    "titles": ["东坡居士", "苏仙（别号或民间称号）"],
    "life_span": "1037-1101",
    "bio": "眉州眉山人，“唐宋八大家”之一。仕途极为坎坷，因反对王安石变法被贬，后又因“乌台诗案”几致死地，贬谪黄州、惠州、儋州。生性豁达，热爱生活（美食、书画）。",
    "achievements": "北宋文坛领袖，词坛豪放派的开创者。他打破了词为“艳科”的传统，提高了词的文学地位。诗、词、文、书、画均达登峰造极之境。",
    "style": "豪放豁达，清新豪健，题材广阔，兼具婉约，善用比喻和夸张。",
    "tags": ["豪放派", "宋词", "全才", "唐宋八大家"],
    "works": [
      { "title": "水调歌头", "line": "但愿人长久，千里共婵娟" },
      { "title": "念奴娇·赤壁怀古", "line": "大江东去，浪淘尽，千古风流人物" },
      { "title": "定风波", "line": "一蓑烟雨任平生" }
    ]
  },
  {
    "id": "song_xinqiji",
    "name": "辛弃疾",
    "pinyin": "Xin Qiji",
    "dynasty": "宋",
    "titles": ["稼轩居士", "词中之龙"],
    "life_span": "1140-1207",
    "bio": "历城人。出生于金国境内，青年时聚众抗金，率五十骑突袭金营生擒叛徒。归南宋后壮志难酬，被迫退隐山居，心中始终不忘收复中原。",
    "achievements": "南宋豪放派词人的集大成者，与苏轼并称“苏辛”。现存词六百多首，数量为宋人第一。开拓了词的意境，以文为词。",
    "style": "沉雄豪迈，悲壮激烈，笔力雄健，善用典故，充满爱国热情。",
    "tags": ["豪放派", "爱国", "宋词", "苏辛"],
    "works": [
      { "title": "青玉案·元夕", "line": "众里寻他千百度，蓦然回首，那人却在，灯火阑珊处" },
      { "title": "破阵子", "line": "醉里挑灯看剑，梦回吹角连营" },
      { "title": "永遇乐·京口北固亭怀古", "line": "想当年，金戈铁马，气吞万里如虎" }
    ]
  },
  {
    "id": "song_liuyong",
    "name": "柳永",
    "pinyin": "Liu Yong",
    "dynasty": "宋",
    "titles": ["柳三变", "柳屯田"],
    "life_span": "984-1053",
    "bio": "福建崇安（今武夷山）人。仕途失意，长期流连于秦楼楚馆，熟悉市民生活。自称“奉旨填词”，晚年才做小官。是第一位专业词人。",
    "achievements": "北宋婉约派代表，大力发展慢词（长调），改变了小令独霸的局面。其词在市井中广为流传，“凡有井水处，皆能歌柳词”。",
    "style": "通俗生动，善于铺叙，情景交融，多写都市繁华与男女离别相思。",
    "tags": ["婉约派", "慢词", "宋词", "市井"],
    "works": [
      { "title": "雨霖铃", "line": "多情自古伤离别，更那堪，冷落清秋节" },
      { "title": "蝶恋花", "line": "衣带渐宽终不悔，为伊消得人憔悴" },
      { "title": "望海潮", "line": "东南形胜，三吴都会，钱塘自古繁华" }
    ]
  },
  {
    "id": "song_zhoubangyan",
    "name": "周邦彦",
    "pinyin": "Zhou Bangyan",
    "dynasty": "宋",
    "titles": ["清真居士", "词家之冠"],
    "life_span": "1056-1121",
    "bio": "钱塘人。精通音律，曾任大晟府提举（皇家音乐机构最高长官）。集北宋词法之大成。",
    "achievements": "格律派词人的代表。他规范了词的格律，讲究章法结构，对后世（特别是南宋吴文英、姜夔）影响极大。",
    "style": "格律严整，富艳精工，曲折变化，音律和谐，善于化用前人诗句。",
    "tags": ["婉约派", "格律", "宋词", "大晟府"],
    "works": [
      { "title": "兰陵王·柳", "line": "柳阴直，烟里丝丝弄碧" },
      { "title": "苏幕遮", "line": "叶上初阳干宿雨，水面清圆，一一风荷举" },
      { "title": "少年游", "line": "并刀如水，吴盐胜雪，纤手破新橙" }
    ]
  },
  {
    "id": "song_wuwenying",
    "name": "吴文英",
    "pinyin": "Wu Wenying",
    "dynasty": "宋",
    "titles": ["梦窗", "词中李商隐"],
    "life_span": "1200-1260",
    "bio": "四明人。一生未仕，作为布衣终老，主要游历于苏州、杭州一带，充当权门的清客。",
    "achievements": "南宋后期婉约派的重要代表。现存词340余首，数量仅次于辛弃疾、苏轼、刘辰翁。",
    "style": "密丽深幽，结构复杂，辞藻雕琢，意象跳跃，被称为“七宝楼台”。",
    "tags": ["婉约派", "梦窗词", "宋词"],
    "works": [
      { "title": "风入松", "line": "黄蜂频扑秋千索，有当时、纤手香凝" },
      { "title": "唐多令", "line": "何处合成愁，离人心上秋" }
    ]
  },
  {
    "id": "song_jiangkui",
    "name": "姜夔",
    "pinyin": "Jiang Kui",
    "dynasty": "宋",
    "titles": ["白石道人"],
    "life_span": "1155-1221",
    "bio": "饶州鄱阳人。一生布衣，精通音乐，常自度曲（自己作曲自己填词）。生活清贫，依靠卖字与朋友接济为生。",
    "achievements": "南宋骚雅词派的代表。留下了珍贵的旁谱（宋代乐谱），是研究宋代音乐的重要资料。",
    "style": "清空骚雅，格调高冷，瘦硬清刚，意境幽冷。",
    "tags": ["婉约派", "音乐家", "自度曲", "宋词"],
    "works": [
      { "title": "扬州慢", "line": "二十四桥仍在，波心荡，冷月无声" },
      { "title": "暗香", "line": "旧时月色，算几番照我，梅边吹笛" }
    ]
  },
  {
    "id": "song_yanjidao",
    "name": "晏几道",
    "pinyin": "Yan Jidao",
    "dynasty": "宋",
    "titles": ["小山", "小晏"],
    "life_span": "1038-1110",
    "bio": "抚州临川人，宰相晏殊的第七子。早年生活富裕，晚年家道中落，生活潦倒。性格孤傲，不愿向权贵低头。",
    "achievements": "北宋初期婉约派的重要词人。与其父并称“二晏”。",
    "style": "情致深婉，真挚感人，多写爱情与相思，语言清新流丽，有“富贵气”。",
    "tags": ["婉约派", "二晏", "宋词"],
    "works": [
      { "title": "临江仙", "line": "落花人独立，微雨燕双飞" },
      { "title": "鹧鸪天", "line": "舞低杨柳楼心月，歌尽桃花扇底风" }
    ]
  },
  {
    "id": "song_hezhu",
    "name": "贺铸",
    "pinyin": "He Zhu",
    "dynasty": "宋",
    "titles": ["贺梅子", "庆湖遗老"],
    "life_span": "1052-1125",
    "bio": "卫州人，宋太祖贺皇后族孙。长相丑陋（人称“贺鬼头”）但文武双全，侠气纵横。一生沉沦下僚，郁郁不得志。",
    "achievements": "北宋词坛上风格独特的词人，能诗能文。在词史上被称为“豪放之先声”。",
    "style": "风格多样，兼具豪放与婉约。既有英雄豪侠之气，又有儿女柔情。",
    "tags": ["宋词", "豪放", "婉约"],
    "works": [
      { "title": "青玉案", "line": "一川烟草，满城风絮，梅子黄时雨" },
      { "title": "六州歌头", "line": "少年侠气，交结五都雄" }
    ]
  },
  {
    "id": "tang_baijuyi",
    "name": "白居易",
    "pinyin": "Bai Juyi",
    "dynasty": "唐",
    "titles": ["香山居士", "诗魔"],
    "life_span": "772-846",
    "bio": "祖籍山西太原，出生于河南新郑。年轻时家境贫寒，早年颠沛流离，对社会底层生活有深刻体验。历任校书郎、县尉、左拾遗、江州司马、杭州刺史、刑部尚书等职。",
    "achievements": "中唐现实主义诗人，与元稹共同倡导新乐府运动，主张「文章合为时而著，歌诗合为事而作」。其诗语言平易近人，影响广泛，后世有言「童子解吟长恨曲，胡儿能唱琵琶篇」。",
    "style": "语言平易近人，通俗易懂，关注民生疾苦，题材广泛，多讽谕诗，善叙事长篇。",
    "tags": ["现实主义", "新乐府", "讽谕", "长篇叙事诗"],
    "works": [
      { "title": "琵琶行", "line": "同是天涯沦落人，相逢何必曾相识" },
      { "title": "长恨歌", "line": "天长地久有时尽，此恨绵绵无绝期" },
      { "title": "赋得古原草送别", "line": "野火烧不尽，春风吹又生" }
    ]
  },
   {
   "id": "modern_maozedong",
   "name": "毛泽东",
   "pinyin": "Mao Zedong",
   "dynasty": "现代",  // 这是关键字段
   "titles": ["主席", "诗人"],
   "life_span": "1893-1976",
   "bio": "中国共产党、中国人民解放军、中华人民共和国的主要缔造者...",
   "achievements": "诗词气势磅礴，意境宏大...",
   "style": "豪放激昂，气势恢宏...",
   "tags": ["现代", "领袖", "革命", "豪放"],
   "works": [
     { "title": "沁园春·雪", "line": "北国风光，千里冰封，万里雪飘" },
     { "title": "沁园春·长沙", "line": "独立寒秋，湘江北去，橘子洲头" },
     { "title": "七律·长征", "line": "红军不怕远征难，万水千山只等闲" }
   ]
 },
  {
    "id": "tang_censhen",
    "name": "岑参",
    "pinyin": "Cen Shen",
    "dynasty": "唐",
    "titles": ["岑嘉州"],
    "life_span": "715-770",
    "bio": "荆州江陵人。两次出塞，深入西北边疆，亲历军旅生活，是盛唐边塞诗派的代表人物之一。曾任嘉州刺史，故称“岑嘉州”。",
    "achievements": "盛唐边塞诗派的杰出代表，与高适并称“高岑”。其诗题材广阔，意境奇绝，想象丰富，色彩瑰丽，富有浪漫主义色彩。",
    "style": "奇情壮丽，想象丰富，气势豪迈，善于描绘边塞风光，色彩绚烂，风格雄奇。",
    "tags": ["边塞诗", "浪漫主义", "雄奇", "边疆"],
    "works": [
      { "title": "白雪歌送武判官归京", "line": "忽如一夜春风来，千树万树梨花开" },
      { "title": "走马川行奉送封大夫出师西征", "line": "君不见走马川行雪海边，平沙莽莽黄入天" },
      { "title": "逢入京使", "line": "马上相逢无纸笔，凭君传语报平安" }
    ]
  },
  {
    "id": "tang_gaoshi",
    "name": "高适",
    "pinyin": "Gao Shi",
    "dynasty": "唐",
    "titles": ["高常侍"],
    "life_span": "704-765",
    "bio": "渤海蓨县人。早年家境贫寒，游历各地，年近五十才中进士。曾任彭州、蜀州刺史，后官至散骑常侍，故称“高常侍”。是盛唐时期唯一做到高官的诗人。",
    "achievements": "盛唐边塞诗派的代表人物，与岑参并称“高岑”。其诗笔力雄健，气势奔放，洋溢着盛唐时期特有的奋发进取、昂扬乐观的精神。",
    "style": "笔力雄健，意境雄浑，语言凝练，格调高昂，多反映边塞军旅生活和壮志豪情。",
    "tags": ["边塞诗", "雄健", "豪放", "现实主义"],
    "works": [
      { "title": "燕歌行", "line": "战士军前半死生，美人帐下犹歌舞" },
      { "title": "别董大", "line": "莫愁前路无知己，天下谁人不识君" },
      { "title": "塞上听吹笛", "line": "借问梅花何处落，风吹一夜满关山" }
    ]
  },
  {
    "id": "tang_wangchangling",
    "name": "王昌龄",
    "pinyin": "Wang Changling",
    "dynasty": "唐",
    "titles": ["王江宁", "七绝圣手", "诗家天子"],
    "life_span": "698-757",
    "bio": "京兆长安人。开元十五年进士及第，曾任汜水尉、江宁丞等职，故称“王江宁”。后贬龙标尉，李白有诗《闻王昌龄左迁龙标遥有此寄》记述此事。",
    "achievements": "盛唐著名边塞诗人，以七言绝句见长，被誉为“七绝圣手”，在盛唐诗人中七言绝句成就最高。其诗意境高远，语言流畅，格调清刚。",
    "style": "清刚劲健，情韵并茂，意境高远，格律谨严，尤善七绝，被誉为“诗家天子”。",
    "tags": ["七绝", "边塞诗", "清刚", "意境"],
    "works": [
      { "title": "出塞", "line": "秦时明月汉时关，万里长征人未还" },
      { "title": "芙蓉楼送辛渐", "line": "洛阳亲友如相问，一片冰心在玉壶" },
      { "title": "从军行", "line": "黄沙百战穿金甲，不破楼兰终不还" }
    ]
  },
  {
    "id": "tang_li_he",
    "name": "李贺",
    "pinyin": "Li He",
    "dynasty": "唐",
    "titles": ["诗鬼", "长吉"],
    "life_span": "790-816",
    "bio": "河南福昌人。七岁能词章，名动京师。因父名晋肃，“晋”“进”同音，被讥为犯嫌名，不得参加进士考试。后任奉礼郎，三年后辞官回乡，年仅27岁便英年早逝。",
    "achievements": "中唐浪漫主义诗人，与李白、李商隐合称“唐代三李”。其诗想象奇特，构思精巧，词采瑰丽，风格独特，人称“长吉体”。",
    "style": "想象奇特，构思精巧，词采瑰丽，意境新奇，风格诡异，善用神话传说，富有浪漫主义色彩。",
    "tags": ["浪漫主义", "瑰丽", "奇特", "鬼才"],
    "works": [
      { "title": "李凭箜篌引", "line": "昆山玉碎凤凰叫，芙蓉泣露香兰笑" },
      { "title": "雁门太守行", "line": "黑云压城城欲摧，甲光向日金鳞开" },
      { "title": "南园", "line": "男儿何不带吴钩，收取关山五十州" }
    ]
  },
  {
    "id": "song_luyou",
    "name": "陆游",
    "pinyin": "Lu You",
    "dynasty": "宋",
    "titles": ["放翁", "龟堂老人"],
    "life_span": "1125-1210",
    "bio": "越州山阴人。出身于书香门第，少时亲历靖康之难，深感国破家亡之痛，故终生以恢复中原为志。参加进士考试被秦桧所抑，孝宗时始得重用。一生著作丰富，现存诗作九千余首。",
    "achievements": "南宋伟大的爱国诗人，与尤袤、杨万里、范成大并称“中兴四大诗人”。其诗风格多样，以豪放为主，兼有婉约、清新等风格，是中国古代创作诗歌最多的诗人之一。",
    "style": "风格多样，以豪放悲壮为主，感情强烈，语言平易晓畅，内容丰富，多表现爱国情怀。",
    "tags": ["爱国", "中兴四大诗人", "豪放", "多产"],
    "works": [
      { "title": "示儿", "line": "王师北定中原日，家祭无忘告乃翁" },
      { "title": "书愤", "line": "出师一表真名世，千载谁堪伯仲间" },
      { "title": "钗头凤", "line": "山盟虽在，锦书难托" }
    ]
  },
  {
    "id": "yuan_yuanhaowen",
    "name": "元好问",
    "pinyin": "Yuan Haowen",
    "dynasty": "金末元初",
    "titles": ["遗山先生", "河东先生"],
    "life_span": "1190-1257",
    "bio": "生于金朝，历经金末战乱，为北方文学代表人物。金亡后不仕，潜心著述，编撰《中州集》，保存了金代文献。在文学批评和史学方面都有很高成就。",
    "achievements": "金末元初最重要的文学家，被尊为「北方文雄」，一代文宗。其诗风格多样，内容丰富，词作艺术成就极高，有「词坛北宗」之誉。",
    "style": "风格多样，内容丰富，情感真挚，既有豪放之气，又有婉约之致，重视文学的社会责任。",
    "tags": ["文雄", "一代文宗", "婉约豪放", "文学批评"],
    "works": [
      { "title": "摸鱼儿·雁丘词", "line": "问世间，情是何物，直教生死相许" },
      { "title": "论诗绝句", "line": "文章巧与世情违，自是诗人苦处多" },
      { "title": "岐阳", "line": "百二关河草不横，十年戎马暗秦京" }
    ]
  },
  {
    "id": "ming_yuqian",
    "name": "于谦",
    "pinyin": "Yu Qian",
    "dynasty": "明",
    "titles": ["于少保", "忠肃"],
    "life_span": "1398-1457",
    "bio": "浙江钱塘人。明代著名政治家、军事家。正统十四年土木堡之变后，力排南迁之议，坚决主张抗战，保卫北京，取得北京保卫战的胜利。后被诬陷处死，后平反。",
    "achievements": "明代著名政治家、军事家，以其爱国精神和政治手腕闻名。其诗多表现高洁品格和爱国情怀，如《石灰吟》流传千古。",
    "style": "刚直不阿，情真意切，语言质朴，寓意深刻，多表现高洁品格和爱国情怀。",
    "tags": ["爱国", "政治家", "刚直", "品格"],
    "works": [
      { "title": "石灰吟", "line": "粉骨碎身全不怕，要留清白在人间" },
      { "title": "咏煤炭", "line": "但愿苍生俱饱暖，不辞辛苦出山林" },
      { "title": "入京", "line": "清风两袖朝天去，免得闾阎话短长" }
    ]
  },
  {
    "id": "qing_gongzizhen",
    "name": "龚自珍",
    "pinyin": "Gong Zizhen",
    "dynasty": "清",
    "titles": ["定盦", "璱人"],
    "life_span": "1792-1841",
    "bio": "浙江仁和人。出身于世代官宦家庭，曾任内阁中书、礼部主事等职。主张革新，提倡经世致用，是近代启蒙思想的先驱。后辞官南归，暴卒于丹阳。",
    "achievements": "清代思想家、文学家，近代启蒙思想的先驱。其诗风格独特，寓意深刻，敢于揭露社会黑暗，具有鲜明的现实主义精神。",
    "style": "风格独特，寓意深刻，语言新颖，情感强烈，敢于批判现实，富于时代精神。",
    "tags": ["启蒙思想家", "经世致用", "批判现实", "时代精神"],
    "works": [
      { "title": "己亥杂诗", "line": "我劝天公重抖擞，不拘一格降人才" },
      { "title": "己亥杂诗", "line": "落红不是无情物，化作春泥更护花" },
      { "title": "病梅馆记", "line": "安得此段好风月，护此千枝万蕊开" }
    ]
  },
  {
    "id": "tang_wangbo",
    "name": "王勃",
    "pinyin": "Wang Bo",
    "dynasty": "唐",
    "titles": ["王江州"],
    "life_span": "650-676",
    "bio": "绛州龙门人。出身于书香门第，自幼聪慧，六岁能文，九岁作《指瑕》十卷，十四岁应幽素科试及第。曾任虢州参军，后因事被废。与杨炯、卢照邻、骆宾王并称“初唐四杰”。",
    "achievements": "初唐四杰之首，扭转了齐梁以来的宫体诗风，其诗多慷慨悲壮之气，对唐诗发展有重要贡献。代表作《滕王阁序》中骈文名句「落霞与孤鹜齐飞，秋水共长天一色」传颂千古。",
    "style": "风格高华，意境开阔，气势宏大，语言清新，多抒发豪迈之情和人生感慨。",
    "tags": ["初唐四杰", "骈文", "豪迈", "气势"],
    "works": [
      { "title": "送杜少府之任蜀州", "line": "海内存知己，天涯若比邻" },
      { "title": "滕王阁序", "line": "落霞与孤鹜齐飞，秋水共长天一色" },
      { "title": "滕王阁诗", "line": "闲云潭影日悠悠，物换星移几度秋" }
    ]
  },
  {
    "id": "song_wentianxiang",
    "name": "文天祥",
    "pinyin": "Wen Tianxiang",
    "dynasty": "宋",
    "titles": ["文山", "浮休道人"],
    "life_span": "1236-1283",
    "bio": "吉州庐陵人。宝祐四年状元，历任湖南提刑、知赣州等职。元军南下时，组织义军抵抗，后被俘，宁死不屈，最终殉难。其人格精神影响深远。",
    "achievements": "南宋末年政治家、文学家、民族英雄。其诗歌表达了强烈的爱国情怀和不屈的民族气节，《过零丁洋》中人生自古谁无死，留取丹心照汗青千古传诵。",
    "style": "风格沉郁悲壮，充满爱国激情，语言朴实而感情真挚，体现忠贞不屈的民族气节。",
    "tags": ["爱国", "民族英雄", "忠贞", "悲壮"],
    "works": [
      { "title": "过零丁洋", "line": "人生自古谁无死，留取丹心照汗青" },
      { "title": "正气歌", "line": "天地有正气，杂然赋流形" },
      { "title": "扬子江", "line": "臣心一片磁针石，不指南方不肯休" }
    ]
  },
  {
    "id": "ming_xiawanchun",
    "name": "夏完淳",
    "pinyin": "Xia Wanchun",
    "dynasty": "明末清初",
    "titles": ["存古", "小影"],
    "life_span": "1631-1647",
    "bio": "松江华亭人。五岁知五经，九岁善词赋古文，十五岁从军抗清，十七岁英勇就义，是著名的少年诗人和抗清英雄。其诗多抒发爱国情怀。",
    "achievements": "明末清初著名诗人、抗清英雄。其诗风格慷慨悲凉，情感激昂，虽年少但作品成就很高，被誉为神童诗人。",
    "style": "风格慷慨悲壮，语言质朴而感情强烈，充满爱国热情和民族气节。",
    "tags": ["爱国", "神童", "抗清", "悲壮"],
    "works": [
      { "title": "别云间", "line": "三年羁旅客，今日又南冠" },
      { "title": "别云间", "line": "已知泉路近，欲别故乡难" },
      { "title": "即事", "line": "复楚情何极，亡秦气未平" }
    ]
  },
  {
    "id": "tang_liye",
    "name": "李冶",
    "pinyin": "Li Ye",
    "dynasty": "唐",
    "titles": ["女道士", "李季兰"],
    "life_span": "730-784",
    "bio": "乌程人，唐代著名女诗人。幼时即有诗才，后出家为女道士。与刘长卿、皎然等诗人有交往，其诗多抒发个人情怀，情调感伤。",
    "achievements": "唐代著名女诗人，与薛涛、鱼玄机、刘采春并称“唐代四大女诗人”。其诗风格清雅，以五言见长，尤以寄赠之作最为出色。",
    "style": "风格清雅自然，情感细腻，语言朴素而意境深远，多表现女性内心世界。",
    "tags": ["女诗人", "女道士", "清雅", "五言"],
    "works": [
      { "title": "八至", "line": "至近至远东西，至深至浅清溪" },
      { "title": "明月夜留别", "line": "离人无语月无声，明月有光人有情" },
      { "title": "相思", "line": "人道海水深，不抵相思半" }
    ]
  },
  {
    "id": "tang_xuetao",
    "name": "薛涛",
    "pinyin": "Xue Tao",
    "dynasty": "唐",
    "titles": ["薛校书"],
    "life_span": "768-832",
    "bio": "字洪度，长安人。因家境贫寒，沦为乐妓，但才华横溢，善作诗，与元稹、白居易等著名诗人有交往。曾被召入宫中，后返回成都。",
    "achievements": "唐代著名女诗人，与刘采春、李冶、鱼玄机并称“唐代四大女诗人”。制作的“薛涛笺”流传后世，影响深远。",
    "style": "风格清丽，情韵悠长，善用比兴手法，语言清雅而不艳俗，格律谨严。",
    "tags": ["女诗人", "薛涛笺", "清丽", "情韵"],
    "works": [
      { "title": "春望词", "line": "花开不同赏，花落不同悲" },
      { "title": "十离诗", "line": "犬不恋主逐云走，羊知跪乳谢春晖" },
      { "title": "池上双鸟", "line": "双栖绿池上，朝暮共飞还" }
    ]
  },
  {
    "id": "tang_yuxuanji",
    "name": "鱼玄机",
    "pinyin": "Yu Xuanji",
    "dynasty": "唐",
    "titles": ["玄机", "鱼幼微"],
    "life_span": "844-871",
    "bio": "晚唐女诗人，长安人。初为李亿妾，后入道观为女道士。其诗多抒写个人身世之感和闺阁情怀，风格清丽。",
    "achievements": "晚唐著名女诗人，与李冶、薛涛、刘采春并称为“唐代四大女诗人”。其诗情感真挚，语言清丽，艺术成就较高。",
    "style": "风格清丽自然，情感真挚，语言流美，多抒发个人情怀和女性的内心世界。",
    "tags": ["女诗人", "晚唐", "清丽", "闺阁"],
    "works": [
      { "title": "赠邻女", "line": "易求无价宝，难得有心郎" },
      { "title": "江陵愁望有寄", "line": "枫叶千枝复万枝，江桥掩映暮帆迟" },
      { "title": "闺怨", "line": "含情欲说宫中事，鹦鹉前头不敢言" }
    ]
  },
  {
    "id": "tang_chenziang",
    "name": "陈子昂",
    "pinyin": "Chen Zi'ang",
    "dynasty": "唐",
    "titles": ["陈拾遗", "伯玉"],
    "life_span": "661-702",
    "bio": "梓州射洪人。初唐著名诗人，曾任右拾遗。主张革新文学，反对齐梁浮艳诗风，提倡汉魏风骨。其诗骨气端翔，音情顿挫，风格高雅。",
    "achievements": "初唐诗文革新人物之一，提出“风骨”、“兴寄”的创作主张，对唐诗发展影响深远。其《感遇》三十八首、《登幽州台歌》为传世名作。",
    "style": "风格高雅，气势宏大，情感深沉，语言质朴有力，富于哲理，具有风骨之美。",
    "tags": ["初唐", "风骨", "革新", "哲理"],
    "works": [
      { "title": "登幽州台歌", "line": "前不见古人，后不见来者" },
      { "title": "感遇", "line": "兰若生春夏，芊蔚何青青" },
      { "title": "晚次乐乡县", "line": "故乡杳无际，日暮且孤征" }
    ]
  },
  {
    "id": "tang_zhangjiuling",
    "name": "张九龄",
    "pinyin": "Zhang Jiuling",
    "dynasty": "唐",
    "titles": ["文献公", "张曲江"],
    "life_span": "678-740",
    "bio": "韶州曲江人。唐玄宗开元年间的名相，以直言敢谏闻名。罢相后专心文学创作，诗风清淡雅致，为盛唐山水田园诗派的先驱者之一。",
    "achievements": "唐代著名政治家、文学家，其诗风清淡自然，对盛唐诗歌的发展有重要影响。被誉为“岭南第一人”。",
    "style": "风格清淡雅致，语言洗练，意境深远，多托物寓意，富有哲理。",
    "tags": ["政治家", "清淡", "托物寓意", "哲理"],
    "works": [
      { "title": "望月怀远", "line": "海上生明月，天涯共此时" },
      { "title": "感遇", "line": "兰叶春葳蕤，桂华秋皎洁" },
      { "title": "归燕", "line": "海燕岁微渺，乘春亦暂来" }
    ]
  },
  {
    "id": "warring_states_quyuan",
    "name": "屈原",
    "pinyin": "Qu Yuan",
    "dynasty": "战国",
    "titles": ["三闾大夫", "屈平"],
    "life_span": "约公元前340年-约公元前278年",
    "bio": "芈姓，屈氏，名平，字原，又自云名正则，字灵均。战国时期楚国诗人，中国浪漫主义文学的奠基人，被誉为“中华诗祖”、“辞赋之祖”。因遭贵族排挤诽谤，被流放，后见楚国被秦国攻破，绝望投汨罗江而死。",
    "achievements": "中国浪漫主义诗歌的开创者，楚辞体的创立者。其作品标志着中国诗歌从集体歌唱到个人独创的高峰，主要作品有《离骚》、《九歌》、《九章》、《天问》等。",
    "style": "浪漫主义色彩浓郁，想象奇特丰富，感情奔放，语言瑰丽，多用香草美人比兴手法。",
    "tags": ["浪漫主义", "楚辞", "离骚", "爱国诗人"],
    "works": [
      { "title": "离骚", "line": "路漫漫其修远兮，吾将上下而求索" },
      { "title": "九歌·湘夫人", "line": "袅袅兮秋风，洞庭波兮木叶下" },
      { "title": "渔父", "line": "举世皆浊我独清，众人皆醉我独醒" }
    ]
  },
  {
    "id": "jin_taoyuanming",
    "name": "陶渊明",
    "pinyin": "Tao Yuanming",
    "dynasty": "东晋",
    "titles": ["五柳先生", "靖节先生"],
    "life_span": "365-427",
    "bio": "字元亮，又名潜，私谥“靖节”，世称靖节先生。浔阳柴桑人。曾任江州祭酒、建威参军、镇军参军、彭泽县令等职，因不愿为五斗米折腰，解印去职，归隐田园。",
    "achievements": "中国第一位田园诗人，被誉为“古今隐逸诗人之宗”。开创了田园诗一体，为古典诗歌开辟了一个新的境界。作品有《陶渊明集》。",
    "style": "平淡自然，朴实醇厚，意境深远，富有生活气息，多描写田园风光和隐逸生活。",
    "tags": ["田园诗", "隐逸", "五言", "东晋"],
    "works": [
      { "title": "归园田居", "line": "采菊东篱下，悠然见南山" },
      { "title": "饮酒", "line": "结庐在人境，而无车马喧" },
      { "title": "桃花源记", "line": "黄发垂髫，并怡然自乐" }
    ]
  },
  {
    "id": "song_liqingzhao",
    "name": "李清照",
    "pinyin": "Li Qingzhao",
    "dynasty": "宋",
    "titles": ["易安居士"],
    "life_span": "1084-约1155",
    "bio": "号易安居士，齐州章丘人。宋代女词人，婉约词派代表，有“千古第一才女”之称。其夫为金石学家赵明诚。南渡后经历国破家亡之痛。",
    "achievements": "宋代重要的女词人，其词作情感细腻，语言清丽，艺术成就极高。提出“词别是一家”的观点，强调词的音乐性和抒情性。",
    "style": "前期词风清丽明快，后期词风沉郁哀婉，语言精炼，善于白描，音调优美。",
    "tags": ["婉约派", "女词人", "宋词", "才女"],
    "works": [
      { "title": "声声慢", "line": "寻寻觅觅，冷冷清清，凄凄惨惨戚戚" },
      { "title": "醉花阴", "line": "莫道不销魂，帘卷西风，人比黄花瘦" },
      { "title": "如梦令", "line": "知否，知否？应是绿肥红瘦" }
    ]
  },
  {
    "id": "tang_wentingyun",
    "name": "温庭筠",
    "pinyin": "Wen Tingyun",
    "dynasty": "唐",
    "titles": ["温八叉", "温庭云"],
    "life_span": "约812-约870",
    "bio": "本名岐，字飞卿，太原人。才思敏捷，每入试，押官韵，八叉手而成八韵，故有“温八叉”之称。仕途不得志，多游历江湖，晚年流落而终。",
    "achievements": "花间派鼻祖，被誉为“花间派第一词人”。在词史上与韦庄齐名，并称“温韦”。对词的发展有重要贡献，是第一位专力作词的文人。",
    "style": "词风秾丽精工，注重文采和声情，多写闺怨离愁，色彩艳丽，辞藻华丽。",
    "tags": ["花间派", "词人", "精工", "艳丽"],
    "works": [
      { "title": "菩萨蛮", "line": "小山重叠金明灭，鬓云欲度香腮雪" },
      { "title": "更漏子", "line": "梧桐树，三更雨，不道离情正苦" },
      { "title": "梦江南", "line": "梳洗罢，独倚望江楼" }
    ]
  },
  {
    "id": "tang_weizhuang",
    "name": "韦庄",
    "pinyin": "Wei Zhuang",
    "dynasty": "唐",
    "titles": ["韦端己"],
    "life_span": "约836-910",
    "bio": "字端己，京兆杜陵人。诗人韦应物四世孙。早年屡试不第，黄巢起义时，流落江南，后入蜀依王建，为西川节度判官。前蜀建立后，官至宰相。",
    "achievements": "晚唐诗人、词人，花间派重要作家，与温庭筠并称“温韦”。其词以清新的语言、真挚的情感著称，对词的发展有重要贡献。",
    "style": "词风清丽疏朗，语言自然流畅，情感真挚，长于叙事，多白描手法。",
    "tags": ["花间派", "词人", "疏朗", "温韦"],
    "works": [
      { "title": "菩萨蛮", "line": "人人尽说江南好，游人只合江南老" },
      { "title": "女冠子", "line": "春日游，杏花吹满头" },
      { "title": "思帝乡", "line": "春日游，志得意满，笑看红尘" }
    ]
  },
  {
    "id": "fivedynasties_liyu",
    "name": "李煜",
    "pinyin": "Li Yu",
    "dynasty": "五代十国·南唐",
    "titles": ["李后主", "词帝"],
    "life_span": "937-978",
    "bio": "南唐最后一位皇帝。精通书画音律。亡国前词风绮丽，亡国后被宋太宗软禁，词风骤变，抒写亡国之痛与身世之悲。卒于北宋，传言被赐死。",
    "achievements": "“变伶工之词为士大夫之词”。他将词的题材从闺阁离情扩大到家国身世之感，提升了词的境界，对宋词兴盛有着开创性影响。",
    "style": "直抒胸臆，深沉悲壮，不加雕饰，情感真挚动人，具有极强的感染力。",
    "tags": ["五代", "婉约", "亡国之音", "词帝"],
    "works": [
      { "title": "虞美人", "line": "问君能有几多愁？恰似一江春水向东流" },
      { "title": "相见欢", "line": "剪不断，理还乱，是离愁" },
      { "title": "浪淘沙令", "line": "流水落花春去也，天上人间" }
    ]
  },
  {
    "id": "song_ouyangxiu",
    "name": "欧阳修",
    "pinyin": "Ouyang Xiu",
    "dynasty": "宋",
    "titles": ["醉翁", "六一居士"],
    "life_span": "1007-1072",
    "bio": "字永叔，号醉翁，晚号六一居士。吉州永丰人。幼时家贫，以荻画地学书。天圣八年进士及第，官至翰林学士、枢密副使、参知政事。谥号“文忠”。",
    "achievements": "“唐宋八大家”之一，北宋诗文革新运动的领袖。在诗词文各个方面都有很高成就，对苏轼等后辈影响极大。编撰《新唐书》，独撰《新五代史》。",
    "style": "诗风平易自然，词风清新婉约，散文流畅自然，主张文以载道，反对浮华文风。",
    "tags": ["唐宋八大家", "诗文革新", "北宋", "文忠"],
    "works": [
      { "title": "蝶恋花", "line": "庭院深深深几许，杨柳堆烟，帘幕无重数" },
      { "title": "醉翁亭记", "line": "醉翁之意不在酒，在乎山水之间也" },
      { "title": "生查子", "line": "月上柳梢头，人约黄昏后" }
    ]
  },
  {
    "id": "song_fanzhongyan",
    "name": "范仲淹",
    "pinyin": "Fan Zhongyan",
    "dynasty": "宋",
    "titles": ["文正"],
    "life_span": "989-1052",
    "bio": "字希文，苏州吴县人。少时孤贫，勤学苦读，真宗大中祥符八年进士。官至参知政事，以龙图阁学士身份戍边西北，号令严明，西夏人称之为“范老子”。",
    "achievements": "北宋政治家、文学家，其政治思想和文学创作都具有重要意义。词作虽不多，但意境开阔，为苏轼等人的豪放词风开创了先河。",
    "style": "词风苍凉悲壮，意境开阔，多反映边塞军旅生活，风格豪放刚健。",
    "tags": ["政治家", "边塞词", "先驱", "豪放"],
    "works": [
      { "title": "渔家傲", "line": "塞下秋来风景异，衡阳雁去无留意" },
      { "title": "苏幕遮", "line": "碧云天，黄叶地，秋色连波，波上寒烟翠" },
      { "title": "岳阳楼记", "line": "先天下之忧而忧，后天下之乐而乐" }
    ]
  },
  {
    "id": "song_yanshu",
    "name": "晏殊",
    "pinyin": "Yan Shu",
    "dynasty": "宋",
    "titles": ["晏元献", "大晏"],
    "life_span": "991-1055",
    "bio": "抚州临川人。北宋著名政治家、文学家，官至宰相。神童出身，提拔了范仲淹、欧阳修等一大批人才。",
    "achievements": "北宋初期词坛的领袖。其词主要抒写士大夫的闲雅生活，开启了宋词“富贵气”的风气。",
    "style": "雍容华贵，闲雅清丽，理性的深情，善于在淡淡的忧愁中蕴含哲理。",
    "tags": ["婉约派", "宰相", "大晏", "宋词"],
    "works": [
      { "title": "浣溪沙", "line": "无可奈何花落去，似曾相识燕归来" },
      { "title": "蝶恋花", "line": "昨夜西风凋碧树，独上高楼，望尽天涯路" }
    ]
  },
    {
    "id": "tang_hanyu",
    "name": "韩愈",
    "pinyin": "Han Yu",
    "dynasty": "唐",
    "titles": ["韩昌黎", "文公", "世称「百代文宗」"],
    "life_span": "768-824",
    "bio": "河南河阳人。唐代古文运动的倡导者，被列为“唐宋八大家”之首。性情刚直，因谏迎佛骨被贬潮州。其诗气势雄伟，炼字精奇，甚至“以文为诗”，对宋诗影响甚大。",
    "achievements": "文章巨公，诗坛领袖。提倡“文以载道”，恢复儒家道统。其诗力求新奇，险怪生涩，开创了“韩孟诗派”。",
    "style": "雄奇险怪，气势磅礴，以文为诗，议论纵横，好奇尚硬。",
    "tags": ["唐宋八大家", "古文运动", "险怪", "唐诗"],
    "works": [
      { "title": "早春呈水部张十八员外", "line": "天街小雨润如酥，草色遥看近却无" },
      { "title": "左迁至蓝关示侄孙湘", "line": "云横秦岭家何在？雪拥蓝关马不前" },
      { "title": "师说", "line": "师者，所以传道受业解惑也" }
    ]
  },
  {
    "id": "tang_liuzongyuan",
    "name": "柳宗元",
    "pinyin": "Liu Zongyuan",
    "dynasty": "唐",
    "titles": ["柳河东", "柳柳州"],
    "life_span": "773-819",
    "bio": "河东人。唐宋八大家之一，与韩愈并称“韩柳”。积极参与政治革新（永贞革新），失败后被贬永州、柳州。在贬谪生活中写下了大量优秀的山水游记和寓言。",
    "achievements": "古文运动的核心人物，山水游记（如《永州八记》）是中国文学史上的丰碑。其诗峭拔矫健，清冷幽峭，独树一帜。",
    "style": "清冷幽峭，峻洁拔俗，寓意深远，多抒发贬谪后的抑郁孤愤。",
    "tags": ["唐宋八大家", "山水游记", "寓言", "唐诗"],
    "works": [
      { "title": "江雪", "line": "千山鸟飞绝，万径人踪灭" },
      { "title": "渔翁", "line": "烟销日出不见人，欸乃一声山水绿" },
      { "title": "小石潭记", "line": "凄神寒骨，悄怆幽邃" }
    ]
  },
  {
    "id": "tang_zhangruoxu",
    "name": "张若虚",
    "pinyin": "Zhang Ruoxu",
    "dynasty": "唐",
    "titles": ["吴中四士"],
    "life_span": "约660-约720",
    "bio": "扬州人。曾任兖州兵曹。与贺知章、张旭、包融并称“吴中四士”。存诗仅两首，但仅凭一首《春江花月夜》便足以名垂千古。",
    "achievements": "“孤篇盖全唐”。《春江花月夜》洗净了六朝宫体的脂粉气，创造了幽美邈远的意境，被闻一多誉为“诗中的诗，顶峰上的顶峰”。",
    "style": "清丽婉转，意境空明，富有哲理，音律和谐，情景交融。",
    "tags": ["孤篇盖全唐", "吴中四士", "乐府", "唐诗"],
    "works": [
      { "title": "春江花月夜", "line": "春江潮水连海平，海上明月共潮生" },
      { "title": "春江花月夜", "line": "江畔何人初见月？江月何年初照人？" }
    ]
  },
  {
    "id": "tang_cuihao",
    "name": "崔颢",
    "pinyin": "Cui Hao",
    "dynasty": "唐",
    "titles": ["才名"],
    "life_span": "704-754",
    "bio": "汴州人。开元十一年进士。早年诗风轻薄，晚年风格变得雄浑奔放。传说李白登黄河楼见其诗，感叹“眼前有景道不得，崔颢题诗在上头”。",
    "achievements": "盛唐著名诗人，其《黄鹤楼》被推为唐人七律第一，气势宏大，意境苍茫。",
    "style": "气势宏大，意境开阔，风格雄浑，语言流畅自然。",
    "tags": ["七律第一", "盛唐", "黄鹤楼"],
    "works": [
      { "title": "黄鹤楼", "line": "昔人已乘黄鹤去，此地空余黄鹤楼" },
      { "title": "长干曲", "line": "君家何处住，妾住在横塘" }
    ]
  },
  {
    "id": "tang_wangzhihuan",
    "name": "王之涣",
    "pinyin": "Wang Zhihuan",
    "dynasty": "唐",
    "titles": ["边塞诗人"],
    "life_span": "688-742",
    "bio": "并州人。性格豪放，常击剑悲歌。存诗仅六首，但绝句成就极高，多被谱入管弦，广为传唱。",
    "achievements": "盛唐著名的边塞诗人。其绝句意境开阔，气势磅礴，言简意赅，具有极强的艺术感染力。",
    "style": "大气磅礴，意境开阔，慷慨悲壮，格调高昂。",
    "tags": ["边塞诗", "绝句", "盛唐"],
    "works": [
      { "title": "登鹳雀楼", "line": "欲穷千里目，更上一层楼" },
      { "title": "凉州词", "line": "羌笛何须怨杨柳，春风不度玉门关" }
    ]
  },
  {
    "id": "song_qinguan",
    "name": "秦观",
    "pinyin": "Qin Guan",
    "dynasty": "宋",
    "titles": ["秦少游", "婉约宗主"],
    "life_span": "1049-1100",
    "bio": "高邮人。“苏门四学士”之一。仕途坎坷，一生屡遭贬谪。性格柔弱，多愁善感，其词多写男女情爱和身世之感。",
    "achievements": "北宋婉约派的代表作家，被誉为“婉约之宗”。其词情韵兼胜，将词的柔媚特质发挥到了极致，对后世影响深远。",
    "style": "情感深挚，词风婉丽，语言轻柔，意境凄迷，善于描写微妙的心理变化。",
    "tags": ["婉约派", "苏门四学士", "宋词"],
    "works": [
      { "title": "鹊桥仙", "line": "两情若是久长时，又岂在朝朝暮暮" },
      { "title": "踏莎行·郴州旅舍", "line": "雾失楼台，月迷津渡，桃源望断无寻处" },
      { "title": "满庭芳", "line": "山抹微云，天连衰草，画角声断谯门" }
    ]
  },
  {
    "id": "song_yuefei",
    "name": "岳飞",
    "pinyin": "Yue Fei",
    "dynasty": "宋",
    "titles": ["岳武穆", "民族英雄"],
    "life_span": "1103-1142",
    "bio": "相州汤阴人。南宋抗金名将，军事家。率领“岳家军”抗击金兵，屡立战功，却被秦桧以“莫须有”罪名杀害。谥号武穆。",
    "achievements": "著名的民族英雄，其词作虽少，但气势磅礴，充满爱国主义激情，激励了无数后人。",
    "style": "慷慨激昂，气壮山河，悲壮激烈，忠义贯日。",
    "tags": ["爱国", "豪放", "名将", "宋词"],
    "works": [
      { "title": "满江红", "line": "三十功名尘与土，八千里路云和月" },
      { "title": "小重山", "line": "欲将心事付瑶琴，知音少，弦断有谁听" }
    ]
  },
  {
    "id": "song_fanchengda",
    "name": "范成大",
    "pinyin": "Fan Chengda",
    "dynasty": "宋",
    "titles": ["石湖居士"],
    "life_span": "1126-1193",
    "bio": "苏州吴县人。南宋名臣，曾使金不辱使命。晚年隐居石湖。与杨万里、陆游、尤袤并称“中兴四大诗人”。",
    "achievements": "南宋田园诗的集大成者。其《四时田园杂兴》六十首，全面生动地描写了农村的自然风光和农民的生活劳动，具有很高的艺术价值。",
    "style": "清新自然，平易流畅，富有生活气息，观察细腻。",
    "tags": ["田园诗", "中兴四大诗人", "南宋"],
    "works": [
      { "title": "四时田园杂兴", "line": "童孙未解供耕织，也傍桑阴学种瓜" },
      { "title": "横塘", "line": "年年送客横塘路，细雨垂杨系画船" }
    ]
  },
  {
    "id": "tang_yuanzhen",
    "name": "元稹",
    "pinyin": "Yuan Zhen",
    "dynasty": "唐",
    "titles": ["元微之", "元才子"],
    "life_span": "779-831",
    "bio": "河南洛阳人。与白居易同科及第，结为终生诗友，共同倡导新乐府运动，世称“元白”。曾任宰相。其悼亡诗最为著名。",
    "achievements": "中唐著名诗人，新乐府运动的倡导者之一。其悼亡诗情真意切，感人至深，被称为“古今悼亡诗之绝唱”。",
    "style": "语言浅近，感情真挚，平易通俗，多写身边琐事和个人情感。",
    "tags": ["元白", "悼亡诗", "新乐府", "中兴"],
    "works": [
      { "title": "离思五首·其四", "line": "曾经沧海难为水，除却巫山不是云" },
      { "title": "遣悲怀", "line": "诚知此恨人人有，贫贱夫妻百事哀" },
      { "title": "行宫", "line": "寥落古行宫，宫花寂寞红" }
    ]
  },
  {
    "id": "tang_jiazhou",
    "name": "贾岛",
    "pinyin": "Jia Dao",
    "dynasty": "唐",
    "titles": ["诗奴", "苦吟诗人"],
    "life_span": "779-843",
    "bio": "范阳人。早年出家为僧，法号无本。后还俗应举。以苦吟著称，传说在驴背上推敲“僧推月下门”之句，冲撞了韩愈仪仗，反被赏识。",
    "achievements": "中唐苦吟诗派的代表人物，与孟郊并称“郊寒岛瘦”。其诗讲究炼字炼句，格律严谨，意境清奇。",
    "style": "清奇幽微，苦吟锤炼，格律严谨，多写荒寒凄苦之境。",
    "tags": ["苦吟", "推敲", "五律", "唐诗"],
    "works": [
      { "title": "题李凝幽居", "line": "鸟宿池边树，僧敲月下门" },
      { "title": "剑客", "line": "十年磨一剑，霜刃未曾试" },
      { "title": "寻隐者不遇", "line": "只在此山中，云深不知处" }
    ]
  },
  {
    "id": "tang_mengjiao",
    "name": "孟郊",
    "pinyin": "Meng Jiao",
    "dynasty": "唐",
    "titles": ["诗囚"],
    "life_span": "751-814",
    "bio": "湖州武康人。一生穷困潦倒，五十岁才中进士。性格孤僻，不仅苦吟，而且多写世态炎凉和个人穷愁。",
    "achievements": "韩孟诗派的代表人物。其诗多写穷愁苦恨，但也留下了歌颂母爱的千古绝唱《游子吟》。",
    "style": "峭硬奇险，寒苦凄清，情感强烈，直抒胸臆。",
    "tags": ["苦吟", "韩孟诗派", "五言"],
    "works": [
      { "title": "游子吟", "line": "谁言寸草心，报得三春晖" },
      { "title": "登科后", "line": "春风得意马蹄疾，一日看尽长安花" }
    ]
  },
  {
    "id": "tang_hezhizhang",
    "name": "贺知章",
    "pinyin": "He Zhizhang",
    "dynasty": "唐",
    "titles": ["四明狂客", "秘书外监"],
    "life_span": "659-744",
    "bio": "越州永兴人。武后证圣元年状元。性格旷达，好饮酒，与李白、张旭等友善，是“饮中八仙”之一。晚年致仕还乡。",
    "achievements": "盛唐前期著名诗人。其诗清新通俗，真率自然，富有生活情趣。其草书也极负盛名。",
    "style": "清新自然，豁达率真，语言通俗，富有生活气息。",
    "tags": ["吴中四士", "饮中八仙", "七绝"],
    "works": [
      { "title": "回乡偶书", "line": "少小离家老大回，乡音无改鬓毛衰" },
      { "title": "咏柳", "line": "不知细叶谁裁出，二月春风似剪刀" }
    ]
  },
  {
    "id": "tang_zhangji_maple",
    "name": "张继",
    "pinyin": "Zhang Ji",
    "dynasty": "唐",
    "titles": ["张懿孙"],
    "life_span": "约715-779",
    "bio": "襄州人。天宝十二年进士。生平事迹不详，流传下的诗作不多，但一首《枫桥夜泊》让他名留青史。",
    "achievements": "以一首《枫桥夜泊》闻名于世，该诗成为描写羁旅愁思的千古绝唱，影响远及日本。",
    "style": "清远深秀，意境幽深，情感真挚，善于写景抒情。",
    "tags": ["羁旅", "唐诗", "七绝"],
    "works": [
      { "title": "枫桥夜泊", "line": "月落乌啼霜满天，江枫渔火对愁眠" },
      { "title": "枫桥夜泊", "line": "姑苏城外寒山寺，夜半钟声到客船" }
    ]
  },
  {
    "id": "song_jiangjie",
    "name": "蒋捷",
    "pinyin": "Jiang Jie",
    "dynasty": "宋",
    "titles": ["樱桃进士", "竹山先生"],
    "life_span": "约1245-1305",
    "bio": "阳羡人。咸淳十年进士。宋亡后隐居不仕，保持民族气节。因词中有“流光容易把人抛，红了樱桃，绿了芭蕉”之句，人称“樱桃进士”。",
    "achievements": "南宋末年著名词人，与周密、王沂孙、张炎并称“宋末四大家”。其词多抒发亡国之痛和身世之感，格调凄清。",
    "style": "凄清悲凉，炼字精深，音律谐婉，多表现时光流逝和亡国之痛。",
    "tags": ["宋末四大家", "婉约", "亡国"],
    "works": [
      { "title": "一剪梅", "line": "流光容易把人抛，红了樱桃，绿了芭蕉" },
      { "title": "虞美人·听雨", "line": "少年听雨歌楼上，红烛昏罗帐" },
      { "title": "虞美人·听雨", "line": "而今听雨僧庐下，鬓已星星也" }
    ]
  },
  {
    "id": "song_shidazu",
    "name": "史达祖",
    "pinyin": "Shi Dazu",
    "dynasty": "宋",
    "titles": ["梅溪"],
    "life_span": "1163-1220",
    "bio": "汴京人。一生未仕，主要在权臣韩侂胄府中做幕僚。精通音律，善咏物词。",
    "achievements": "南宋咏物词的代表作家。其词刻画入微，体物精细，被认为是姜夔之后格律派的劲敌。",
    "style": "刻画工丽，体物精微，形神兼备，辞藻华美。",
    "tags": ["咏物", "婉约", "宋词"],
    "works": [
      { "title": "双双燕", "line": "还相雕梁藻井，又软语、商量不定" },
      { "title": "绮罗香", "line": "做冷欺花，将烟困柳，千里偷催春暮" }
    ]
  },
  {
    "id": "song_zhangyan",
    "name": "张炎",
    "pinyin": "Zhang Yan",
    "dynasty": "宋",
    "titles": ["山中白云", "乐笑翁"],
    "life_span": "1248-1320",
    "bio": "临安人。出身世家，宋亡后家道中落，落魄江湖。精通音律，著有词学专著《词源》。",
    "achievements": "南宋最后一位重要词人，“宋末四大家”之一。其词学理论对后世影响巨大，推崇“清空”与“骚雅”。",
    "style": "清空骚雅，凄清哀怨，格律严谨，多写家国之痛。",
    "tags": ["宋末四大家", "词学", "清空"],
    "works": [
      { "title": "解连环", "line": "楚江空晚，恨离群万里，恍然惊散" },
      { "title": "高阳台", "line": "当年燕子知何处，但苔深韦曲，草暗斜川" }
    ]
  },
  {
    "id": "tang_zhangxu",
    "name": "张旭",
    "pinyin": "Zhang Xu",
    "dynasty": "唐",
    "titles": ["草圣", "张长史"],
    "life_span": "约675-约750",
    "bio": "吴郡人。性格豪放，嗜酒，常醉后呼号狂走，挥毫落纸。其草书与李白的诗歌、裴旻的剑舞并称“三绝”。",
    "achievements": "唐代最杰出的书法家之一，也是吴中四士之一。其诗虽不多，但写景写意清新脱俗，具有浓郁的江南风味。",
    "style": "清新自然，意境幽远，与其狂草书风大异其趣。",
    "tags": ["草圣", "吴中四士", "七绝"],
    "works": [
      { "title": "山中留客", "line": "山光物态弄春晖，莫为轻阴便拟归" },
      { "title": "桃花溪", "line": "桃花尽日随流水，洞在清溪何处边" }
    ]
  },
  {
    "id": "song_zhangxiaoxiang",
    "name": "张孝祥",
    "pinyin": "Zhang Xiaoxiang",
    "dynasty": "宋",
    "titles": ["于湖居士"],
    "life_span": "1132-1170",
    "bio": "历阳乌江人。绍兴二十四年状元。力主抗金，曾因得罪秦桧而仕途受阻。其词风豪迈，深受苏轼影响。",
    "achievements": "南宋豪放派的重要词人，上承苏轼，下启辛弃疾。其《念奴娇·过洞庭》被誉为神品。",
    "style": "豪放旷达，气势宏大，格调高雅，但也兼具婉约之美。",
    "tags": ["豪放派", "状元", "宋词"],
    "works": [
      { "title": "念奴娇·过洞庭", "line": "玉鉴琼田三万顷，着我扁舟一叶" },
      { "title": "六州歌头", "line": "长淮望断，关塞莽然平" }
    ]
  },
  {
    "id": "tang_hanwo",
    "name": "韩偓",
    "pinyin": "Han Wo",
    "dynasty": "唐",
    "titles": ["韩翰林"],
    "life_span": "844-923",
    "bio": "京兆万年人，李商隐之姨甥。晚唐大臣，忠于唐室，拒绝与朱温合作，晚年流寓福建。",
    "achievements": "“香奁体”的代表诗人，早年多写艳情，晚年诗风苍凉感伤，生动反映了唐末战乱的现实。",
    "style": "早年绮丽香艳，晚年沉郁顿挫，苍凉悲壮。",
    "tags": ["香奁体", "晚唐", "现实主义"],
    "works": [
      { "title": "已凉", "line": "碧阑干外绣帘垂，猩色屏风画折枝" },
      { "title": "安抚", "line": "天下有山犹避地，南头无路可投鞭" }
    ]
  },
  {
    "id": "tang_lishi_border",
    "name": "李益",
    "pinyin": "Li Yi",
    "dynasty": "唐",
    "titles": ["李十郎"],
    "life_span": "748-829",
    "bio": "姑臧人。大历四年进士。曾从军西北，对边塞生活有切身了解。晚年性格多疑（成语“李益销魂”典出《温庭筠集》，为后人所引）。",
    "achievements": "中唐边塞诗的代表人物。其七言绝句成就极高，被誉为“有盛唐之风”，当时乐工多争唱其词。",
    "style": "雄浑悲壮，意境苍凉，节奏明快，音乐感强。",
    "tags": ["边塞诗", "七绝", "中唐"],
    "works": [
      { "title": "夜上受降城闻笛", "line": "不知何处吹芦管，一夜征人尽望乡" },
      { "title": "江南曲", "line": "嫁得瞿塘贾，朝朝误妾期" }
    ]
  },
  {
    "id": "unknown_author",
    "name": "无名氏",
    "pinyin": "Anonymous",
    "dynasty": "历代",
    "titles": ["佚名"],
    "life_span": "不详",
    "bio": "指历史上姓名失传的作者。在中国文学史上，许多优秀的民歌、古诗（如《古诗十九首》）和词作都是无名氏所作。",
    "achievements": "留下了大量反映人民生活、情感真挚的民间歌谣和文人佳作。",
    "style": "风格多样，多质朴自然，情感真挚动人。",
    "tags": ["乐府", "民歌", "古诗十九首"],
    "works": [
      { "title": "金缕衣", "line": "劝君莫惜金缕衣，劝君惜取少年时" },
      { "title": "古诗十九首", "line": "盈盈一水间，脉脉不得语" },
      { "title": "杂诗", "line": "近乡情更怯，不敢问来人" }
    ]
  },
  {
    "id": "song_zhangxian",
    "name": "张先",
    "pinyin": "Zhang Xian",
    "dynasty": "宋",
    "titles": ["张三影", "张子野"],
    "life_span": "990-1078",
    "bio": "湖州乌程人。北宋词人，与柳永同时。官至都官郎中。享高寿，八十岁仍纳妾，苏轼曾作诗调侃“一树梨花压海棠”。",
    "achievements": "沟通宋词由小令向慢词过渡的重要人物。因善写影（“云破月来花弄影”等三句），人称“张三影”。",
    "style": "婉丽典雅，含蓄蕴藉，善于炼字，多写士大夫的闲情逸致。",
    "tags": ["张三影", "婉约", "过渡"],
    "works": [
      { "title": "天仙子", "line": "云破月来花弄影" },
      { "title": "青门引", "line": "那堪更被明月，隔墙送过秋千影" }
    ]
  },
  {
    "id": "song_zhoumi",
    "name": "周密",
    "pinyin": "Zhou Mi",
    "dynasty": "宋",
    "titles": ["草窗", "四水潜夫"],
    "life_span": "1232-1298",
    "bio": "济南人（寓居杭州）。宋末元初重要词人、笔记作家。宋亡后隐居不仕，专注于著述，记录了南宋都城的繁华与旧闻。",
    "achievements": "“宋末四大家”之一。其笔记《武林旧事》是研究南宋城市生活的重要史料。词风雅丽，多黍离之悲。",
    "style": "格律严谨，辞藻精丽，意境凄清，多怀旧故国。",
    "tags": ["宋末四大家", "笔记", "怀古"],
    "works": [
      { "title": "一萼红", "line": "步障深沈，东风元自，愁谢海棠" },
      { "title": "高阳台", "line": "照野旌旗，朝天车马，平沙万里天低" }
    ]
  },
  {
    "id": "tang_xuhun",
    "name": "许浑",
    "pinyin": "Xu Hun",
    "dynasty": "唐",
    "titles": ["许丁卯", "千首诗"],
    "life_span": "791-858",
    "bio": "润州丹阳人。晚唐最具影响力的诗人之一。一生不作古诗，专攻律诗。因喜用“水”字，被称为“许浑千首湿”。",
    "achievements": "晚唐律诗的代表人物。其诗格律精严，对仗工整，多写登高怀古和水乡秋景，有“晚唐第一”之誉。",
    "style": "格律精密，属对工整，意境苍凉，多怀古伤今。",
    "tags": ["律诗", "晚唐", "怀古"],
    "works": [
      { "title": "咸阳城东楼", "line": "山雨欲来风满楼" },
      { "title": "金陵怀古", "line": "英雄一去豪华尽，惟有青山枕长河" }
    ]
  },
  {
    "id": "song_liukezhuang",
    "name": "刘克庄",
    "pinyin": "Liu Kezhuang",
    "dynasty": "宋",
    "titles": ["后村居士"],
    "life_span": "1187-1269",
    "bio": "莆田人。南宋后期豪放派词人的领袖，辛派词人的后劲。仕途沉浮，多次被罢官。一生笔耕不辍，诗词数量极大。",
    "achievements": "“江湖诗派”的领袖人物。其词豪放悲壮，继承了辛弃疾的传统，反映了爱国精神和对现实的不满。",
    "style": "豪放浅切，纵横博大，痛快淋漓，兼具诙谐。",
    "tags": ["豪放派", "江湖诗派", "辛派"],
    "works": [
      { "title": "贺新郎·送陈真州", "line": "北望神州路，试平章、这场公事，怎生分付" },
      { "title": "玉楼春", "line": "男儿西北有神州，莫滴水西桥下泪" }
    ]
  },
  {
    "id": "tang_hanhong",
    "name": "韩翃",
    "pinyin": "Han Hong",
    "dynasty": "唐",
    "titles": ["大历十才子"],
    "life_span": "715-793",
    "bio": "南阳人。天宝十三年进士。大历十才子之一。因“春城无处不飞花”一句被德宗赏识，特赐金吾卫职。",
    "achievements": "大历诗风的代表人物之一。其诗多写送别酬赠，风格流丽华美，擅长七言绝句。",
    "style": "流丽华美，兴象宛转，辞藻清艳。",
    "tags": ["大历十才子", "寒食"],
    "works": [
      { "title": "寒食", "line": "春城无处不飞花，寒食东风御柳斜" },
      { "title": "寒食", "line": "日暮汉宫传蜡烛，轻烟散入五侯家" }
    ]
  },
  {
    "id": "song_wangyisun",
    "name": "王沂孙",
    "pinyin": "Wang Yisun",
    "dynasty": "宋",
    "titles": ["碧山", "中仙"],
    "life_span": "约1230-1291",
    "bio": "会稽人。宋亡后曾任元朝学官，内心深感矛盾痛苦。与周密、张炎等交往密切。",
    "achievements": "“宋末四大家”之一，咏物词的大师。他借咏物寄托亡国之痛，意蕴深微，极尽曲折含蓄之能事。",
    "style": "咏物寄意，凄清哀怨，含蓄深婉，寄托遥深。",
    "tags": ["宋末四大家", "咏物", "亡国"],
    "works": [
      { "title": "眉妩·新月", "line": "千古盈亏休问，叹慢磨玉镜，铸就长更" },
      { "title": "齐天乐·蝉", "line": "病翼惊秋，枯形阅世，消得斜阳几度" }
    ]
  },
  {
    "id": "song_chaochongzhi",
    "name": "晁冲之",
    "pinyin": "Chao Chongzhi",
    "dynasty": "宋",
    "titles": ["晁具茨"],
    "life_span": "不详",
    "bio": "济州巨野人。晁补之的堂弟。隐居具茨山，生活清苦。苏门四学士之后的重要诗人。",
    "achievements": "工诗善画，词作虽少但风格清丽，受苏轼、黄庭坚影响。",
    "style": "清丽自然，不事雕琢，多写田园隐居之乐。",
    "tags": ["苏门", "隐居"],
    "works": [
      { "title": "临江仙", "line": "一枕新凉眠客舍，听秋雨，转梧桐" },
      { "title": "汉宫春", "line": "潇洒江梅，向竹梢疏处，横两三枝" }
    ]
  },
  {
    "id": "tang_zhugingyu",
    "name": "朱庆馀",
    "pinyin": "Zhu Qingyu",
    "dynasty": "唐",
    "titles": ["秘书省校书郎"],
    "life_span": "约797-约851",
    "bio": "越州人。宝历二年进士。受张籍赏识。其诗中最著名的是行卷诗《闺意献张水部》，巧妙探问考试结果。",
    "achievements": "以一首借喻诗名扬天下。其诗清新宛转，多写闺情和日常生活。",
    "style": "清新流丽，含蓄蕴藉，善于比兴。",
    "tags": ["行卷", "闺意", "近体诗"],
    "works": [
      { "title": "闺意献张水部", "line": "妆罢低声问夫婿，画眉深浅入时无" },
      { "title": "宫词", "line": "寂寂花时闭院门，美人相并立琼轩" }
    ]
  },
  {
    "id": "tang_zuyong",
    "name": "祖咏",
    "pinyin": "Zu Yong",
    "dynasty": "唐",
    "titles": ["王维诗友"],
    "life_span": "699-746",
    "bio": "洛阳人。开元十二年进士。与王维是好友。曾因《终南望余雪》一诗，虽只写四句便交卷，却被赞为意尽，终获录取。",
    "achievements": "盛唐山水田园诗人之一。其诗多写山水景色，意境清丽，构思精巧。",
    "style": "清丽峭拔，凝练省净，意境清幽。",
    "tags": ["山水田园", "五绝", "盛唐"],
    "works": [
      { "title": "终南望余雪", "line": "林表明霁色，城中增暮寒" },
      { "title": "望蓟门", "line": "少小虽非投笔吏，论功还欲请长缨" }
    ]
  },
  {
    "id": "tang_zhanghu",
    "name": "张祜",
    "pinyin": "Zhang Hu",
    "dynasty": "唐",
    "titles": ["处士"],
    "life_span": "约785-849",
    "bio": "清河人。一生布衣，未曾入仕，以处士终身。人称“张处士”。曾因诗句被白居易称赞，但仕途受阻。晚年隐居丹阳。",
    "achievements": "中晚唐著名诗人。擅长宫词，描写宫怨题材极为出色，有“故国三千里，深宫二十年”之名句。其题咏名胜的绝句也颇具特色。",
    "style": "格调凄清，风骨凝练，宫词哀怨动人，写景如画。",
    "tags": ["宫词", "绝句", "处士"],
    "works": [
      { "title": "宫词", "line": "故国三千里，深宫二十年" },
      { "title": "题金陵渡", "line": "潮落夜江斜月里，两三星火是瓜洲" }
    ]
  },
  {
    "id": "song_liuchenweng",
    "name": "刘辰翁",
    "pinyin": "Liu Chenweng",
    "dynasty": "宋",
    "titles": ["须溪"],
    "life_span": "1232-1297",
    "bio": "吉州庐陵人。宋亡后，隐居不仕，埋头著述。他是南宋末年爱国词人的代表之一，也是著名的文学批评家（评点过《世说新语》等）。",
    "achievements": "“辛派”词人的继承者。词风苍凉悲壮，多写家国之痛，常在词中运用民间口语，风格独特。",
    "style": "苍凉悲壮，情感真挚，风格豪放，善用比兴。",
    "tags": ["辛派", "爱国", "遗民"],
    "works": [
      { "title": "兰陵王·丙子送春", "line": "春去也，飞红万点愁如海" },
      { "title": "柳梢青·春感", "line": "铁马蒙毡，银花洒泪，春入愁城" }
    ]
  },
  {
    "id": "song_chaobuzhi",
    "name": "晁补之",
    "pinyin": "Chao Buzhi",
    "dynasty": "宋",
    "titles": ["归来子", "苏门四学士"],
    "life_span": "1053-1110",
    "bio": "巨野人。“苏门四学士”之一。才气纵横，曾任吏部员外郎，后遭贬谪。晚年修葺陶渊明故居，自号归来子。",
    "achievements": "北宋著名文学家。诗词兼擅，词风受苏轼影响，豪放与婉约并重，风格高旷。",
    "style": "豪放飘逸，清丽自然，气象雄伟，有时也流露感伤。",
    "tags": ["苏门四学士", "豪放", "宋词"],
    "works": [
      { "title": "摸鱼儿", "line": "买得一枝春欲放，泪染轻匀" },
      { "title": "水龙吟", "line": "想佩环月夜，归来化作，此花幽独" }
    ]
  },
  {
    "id": "tang_liufangping",
    "name": "刘方平",
    "pinyin": "Liu Fangping",
    "dynasty": "唐",
    "titles": ["隐士"],
    "life_span": "710-778",
    "bio": "河南洛阳人。匈奴后裔。一生未仕，隐居颖水、汝河之滨。擅长绘画，善写乡野景物。",
    "achievements": "擅长绝句，写景细致入微，清新自然。其《月夜》一诗描写春夜景色，细腻动人。",
    "style": "清新自然，细致入微，富有生活情趣。",
    "tags": ["绝句", "写景", "隐逸"],
    "works": [
      { "title": "月夜", "line": "更深月色半人家，北斗阑干南斗斜" },
      { "title": "春怨", "line": "寂寞空庭春欲晚，梨花满地不开门" }
    ]
  },
  {
    "id": "tang_madai",
    "name": "马戴",
    "pinyin": "Ma Dai",
    "dynasty": "唐",
    "titles": ["晚唐诗人"],
    "life_span": "799-869",
    "bio": "曲阳人。武宗会昌四年进士。曾任监察御史，后被贬。长期流落北方边塞，对边疆生活有深刻体验。",
    "achievements": "晚唐著名诗人。其诗多写羁旅怀乡和边塞风光，格调苍凉，骨气奇高，被严羽《沧浪诗话》列为晚唐之冠。",
    "style": "清刚劲健，苍凉悲壮，格律严谨，意境深远。",
    "tags": ["晚唐", "边塞", "怀乡"],
    "works": [
      { "title": "楚江怀古", "line": "猿啼洞庭树，人在木兰舟" },
      { "title": "灞上秋居", "line": "落叶他乡树，寒灯独夜人" }
    ]
  },
  {
    "id": "tang_shenquanqi",
    "name": "沈佺期",
    "pinyin": "Shen Quanqi",
    "dynasty": "唐",
    "titles": ["沈宋"],
    "life_span": "约650-713",
    "bio": "相州内黄人。武后时期著名宫廷诗人。曾因受贿入狱，后流放。与宋之问齐名，并称“沈宋”。",
    "achievements": "唐代律诗定型的关键人物之一。他在五七言律诗的格律完善方面做出了巨大贡献，使律诗体制最终成熟。",
    "style": "格律严谨，声律和谐，词藻华丽，多应制之作，后期也有感伤之作。",
    "tags": ["律诗奠基", "宫廷诗", "沈宋"],
    "works": [
      { "title": "独不见", "line": "卢家少妇郁金堂，海燕双栖玳瑁梁" },
      { "title": "杂诗", "line": "闻道黄龙戍，频年不解兵" }
    ]
  },
  {
    "id": "tang_songzhiwen",
    "name": "宋之问",
    "pinyin": "Song Zhiwen",
    "dynasty": "唐",
    "titles": ["沈宋"],
    "life_span": "约656-712",
    "bio": "汾州人。武后时的宫廷诗人。才华横溢但品行有争议。与沈佺期致力于律诗体制的改革。",
    "achievements": "五言律诗的奠基人之一。确实了律诗的平仄粘对规律，对唐代律诗的成熟有重大贡献。",
    "style": "辞藻华美，对仗工整，音韵铿锵，多应制诗。",
    "tags": ["律诗奠基", "宫廷诗", "沈宋"],
    "works": [
      { "title": "渡汉江", "line": "近乡情更怯，不敢问来人" },
      { "title": "灵隐寺", "line": "楼观沧海日，门对浙江潮" }
    ]
  },
  {
    "id": "song_zhangyuangan",
    "name": "张元干",
    "pinyin": "Zhang Yuangan",
    "dynasty": "宋",
    "titles": ["芦川居士"],
    "life_span": "1091-1161",
    "bio": "福州永福人。北宋末南宋初词人。曾参加太学保卫战，力主抗金，反对和议。因送别李纲、胡铨被除名。",
    "achievements": "南宋初期豪放派词人的先驱。其词慷慨悲壮，直抒胸臆，继承了苏轼的豪放风格，并对辛弃疾产生影响。",
    "style": "慷慨悲壮，刚健有力，激昂愤激，充满爱国激情。",
    "tags": ["豪放派", "爱国", "先驱"],
    "works": [
      { "title": "贺新郎·送胡邦衡", "line": "天意从来高难问，况人情、老易悲难诉" },
      { "title": "贺新郎·寄李伯纪", "line": "曳杖危楼去，斗垂天、沧波万顷，月流烟渚" }
    ]
  },
  {
    "id": "tang_luobinwang",
    "name": "骆宾王",
    "pinyin": "Luo Binwang",
    "dynasty": "唐",
    "titles": ["初唐四杰"],
    "life_span": "约619-约687",
    "bio": "义乌人。七岁能诗，号称神童。曾随徐敬业起兵反对武则天，撰写《为徐敬业讨武曌檄》，气势非凡，连武则天读后都感叹“宰相之过也”。兵败后下落不明。",
    "achievements": "“初唐四杰”之一。擅长七言歌行，极大地推动了七言诗的发展。其咏物诗《咏鹅》家喻户晓。",
    "style": "才气横溢，格调高昂，辞藻华丽，气势磅礴。",
    "tags": ["初唐四杰", "神童", "歌行"],
    "works": [
      { "title": "咏鹅", "line": "鹅，鹅，鹅，曲项向天歌" },
      { "title": "在狱咏蝉", "line": "露重飞难进，风多响易沉" },
      { "title": "为徐敬业讨武曌檄", "line": "一抔之土未干，六尺之孤安在" }
    ]
  },
  {
    "id": "song_zhaoji",
    "name": "赵佶",
    "pinyin": "Zhao Ji",
    "dynasty": "宋",
    "titles": ["宋徽宗", "道君皇帝"],
    "life_span": "1082-1135",
    "bio": "北宋皇帝。政治昏庸，致使北宋灭亡，被金兵俘虏，死于五国城。但在艺术上造诣极高，自创“瘦金体”书法。",
    "achievements": "杰出的书画家，词作虽不多，但亡国后的词作情感真挚，凄凉哀婉，与李煜相近。",
    "style": "凄清哀婉，情感真挚，多抒发亡国之痛和羁旅之思。",
    "tags": ["皇帝", "书画家", "亡国之音"],
    "works": [
      { "title": "燕山亭", "line": "天遥地远，万水千山，知他故宫何处" },
      { "title": "眼儿媚", "line": "玉京曾忆昔繁华，万里帝王家" }
    ]
  },
  {
    "id": "tang_quan_de_yu",
    "name": "权德舆",
    "pinyin": "Quan Deyu",
    "dynasty": "唐",
    "titles": ["权文公"],
    "life_span": "759-818",
    "bio": "天水略阳人。唐德宗、宪宗时期的宰相。博学多才，在当时文坛极有威望，主张诗歌应有关教化。",
    "achievements": "中唐台阁体诗人的代表。诗风雅正，多应制酬唱之作，但也有清丽可喜的小诗。",
    "style": "雍容典雅，平和中正，由于地位显赫，多台阁气息。",
    "tags": ["宰相", "台阁体", "绝句"],
    "works": [
      { "title": "玉台体", "line": "近来无限伤心事，谁与话长更" },
      { "title": "岭上逢久别者", "line": "十年曾一别，征路此相逢" }
    ]
  },
  {
    "id": "tang_huangfuran",
    "name": "皇甫冉",
    "pinyin": "Huangfu Ran",
    "dynasty": "唐",
    "titles": ["大历十才子(疑)"],
    "life_span": "716-769",
    "bio": "丹阳人。天宝十五年状元。历官左金吾兵曹、无锡尉。处于盛唐与中唐交替之际。",
    "achievements": "诗才敏捷，擅长写景咏物。其诗风清新流丽，多写江南风光和送别离情。",
    "style": "清新流丽，情致婉转，语言优美。",
    "tags": ["状元", "吴中", "送别"],
    "works": [
      { "title": "春思", "line": "莺啼燕语报新年，马邑龙堆路几千" },
      { "title": "淮口寄江苏", "line": "东流复东流，今古长如斯" }
    ]
  },
  {
    "id": "song_wangguan",
    "name": "王观",
    "pinyin": "Wang Guan",
    "dynasty": "宋",
    "titles": ["逐客"],
    "life_span": "1035-1100",
    "bio": "如皋人。与秦观是同乡好友，也是苏轼的门生。因触怒高太后被罢官。自号“逐客”。",
    "achievements": "北宋词人。词风清丽，善于构思，多写离别相思。《卜算子·送鲍浩然之浙东》尤为著名。",
    "style": "清丽自然，构思新颖，比喻生动，富有情趣。",
    "tags": ["苏门", "婉约", "送别"],
    "works": [
      { "title": "卜算子", "line": "水是眼波横，山是眉峰聚" },
      { "title": "卜算子", "line": "若到江南赶上春，千万和春住" }
    ]
  },
  {
    "id": "tang_duxunhe",
    "name": "杜荀鹤",
    "pinyin": "Du Xunhe",
    "dynasty": "唐",
    "titles": ["诗中老杜(自比)"],
    "life_span": "846-904",
    "bio": "池州石埭人。相传为杜牧出妾之子。晚唐诗人，一生仕途坎坷，历经战乱。直到晚年才中进士。",
    "achievements": "晚唐现实主义诗人。其诗多反映晚唐战乱给人民带来的痛苦，被称为“诗中之谶”。语言通俗浅近。",
    "style": "通俗浅近，平易自然，忧愤深广，多写民生疾苦。",
    "tags": ["晚唐", "现实主义", "通俗"],
    "works": [
      { "title": "小松", "line": "时人不识凌云木，直待凌云始道高" },
      { "title": "再经胡城县", "line": "今来县宰加朱绂，便是生灵血染成" }
    ]
  },
  {
    "id": "tang_jiaoran",
    "name": "僧皎然",
    "pinyin": "Jiao Ran",
    "dynasty": "唐",
    "titles": ["诗僧", "谢灵运十世孙"],
    "life_span": "720-804",
    "bio": "湖州人。俗姓谢，南朝山水诗人谢灵运的十世孙。唐代著名诗僧，与韦应物、颜真卿等交往甚密。",
    "achievements": "唐代诗僧的代表。著有《诗式》，对诗歌理论有重要贡献。其诗多写山水禅意，清雅闲淡。",
    "style": "清雅闲淡，禅意盎然，超凡脱俗，语言洗练。",
    "tags": ["诗僧", "诗论", "禅意"],
    "works": [
      { "title": "寻陆鸿渐不遇", "line": "近种篱边菊，秋来未著花" },
      { "title": "访戴天山道士", "line": "犬吠水声中，桃花带露浓" }
    ]
  },
  {
    "id": "tang_wanghan",
    "name": "王翰",
    "pinyin": "Wang Han",
    "dynasty": "唐",
    "titles": ["豪侠"],
    "life_span": "687-726",
    "bio": "并州晋阳人。家资富饶，性格豪放，喜好饮酒游乐。虽然诗名不显，但一首《凉州词》足矣。",
    "achievements": "以七言绝句《凉州词》闻名于世，被誉为唐代边塞诗的压卷之作。",
    "style": "豪放旷达，悲壮慷慨，富有浪漫主义色彩。",
    "tags": ["边塞诗", "七绝", "盛唐"],
    "works": [
      { "title": "凉州词", "line": "葡萄美酒夜光杯，欲饮琵琶马上催" },
      { "title": "凉州词", "line": "醉卧沙场君莫笑，古来征战几人回" }
    ]
  }
];

            // Helper function to get dynasty by author name
            function getDynastyByAuthorName(authorName) {
                if (!window.AUTHOR_DATA) return '未知';

                const author = window.AUTHOR_DATA.find(a => a.name === authorName);
                return author ? author.dynasty : '未知';
            }

            let filteredPoems = null; // Store currently filtered poems

            // Image cache to store latest 20 images
            let imageCache = [];
            const MAX_CACHE_SIZE = 20;

            // Function to add image to cache
            function addToImageCache(imgUrl) {
                // Check if image is already in cache
                const existingIndex = imageCache.indexOf(imgUrl);
                if (existingIndex !== -1) {
                    // Move to front if already in cache
                    imageCache.splice(existingIndex, 1);
                } else if (imageCache.length >= MAX_CACHE_SIZE) {
                    // Remove oldest item if cache is full
                    imageCache.pop();
                }
                // Add to front of cache
                imageCache.unshift(imgUrl);
            }

            // Function to get a random cached image
            function getRandomCachedImage() {
                if (imageCache.length === 0) {
                    return null;
                }
                // Return a random image from the cache
                return imageCache[Math.floor(Math.random() * imageCache.length)];
            }

            // Define color palettes with enhanced color schemes
            const colorPalettes = [
                // First color group - based on #00695B teal green
                ['#00695B', '#2F9C8D', '#148374', '#005045', '#00362F', '#006927', '#004269', '#5B0069', '#695B00', '#69000E', '#260069', '#426900', '#692700', '#690043', '#88485e', '#316742', '#006771', '#635587', '#7c5233', '#405e8d', '#685b2a', '#7c4c75', '#874b46'],
                // Second color group - based on #88485E purple pink
                ['#88485E', '#BB96A2', '#A26E80', '#6F2A41', '#55142A', '#88487E', '#885248', '#5E8848', '#485E88', '#7E8848', '#488872', '#524888', '#488852', '#487E88', '#7c4c76', '#316743', '#006771', '#4f6330', '#0d6586', '#685b2a', '#02695b', '#415e8d', '#316743', '#006771'],
                // Third color group - based on #AF52DE purple blue
                ['#AF52DE', '#CC9AE5', '#D081F7', '#912BC5', '#760CAB', '#6952DE', '#DE52C7', '#DEAF52', '#52DEAF', '#DE6952', '#81DE52', '#52C7DE', '#C7DE52', '#52DE69', '#3f75ff', '#e121a2', '#a57000', '#008b89', '#d8481d', '#009001', '#0088a4', '#778200', '#008d66'],
                // Fourth color group - based on #657786 blue gray
                ['#657786', '#867465', '#658684', '#656686', '#866577', '#778665', '#846586', '#678665', '#94A8B9', '#9098A0', '#42596D', '#263E53', '#877466', '#777561', '#876f69'],
                // Additional LCH color groups
                ['#8fe4d2', '#65b9a9', '#3b9081', '#00695B', '#88485e', '#316742', '#006771', '#635587', '#7c5233', '#405e8d', '#685b2a', '#7c4c75', '#874b46'],
                ['#ffc4d5', '#dd95ac', '#b26e84', '#88485E', '#02695b', '#7c4c76', '#316743', '#4f6330', '#0d6586', '#685b2a', '#02695b', '#415e8d', '#316743', '#006771'],
                ['#f2d2ff', '#e3a4ff', '#d174ff', '#AF52DE', '#009001', '#778200', '#008d66', '#a57000', '#008b89', '#d8481d', '#009001', '#0088a4', '#778200', '#008d66'],
                ['#cadeee', '#a7baca', '#8598a8', '#657786', '#817263', '#5e7980', '#707487', '#886e72', '#6d7865', '#846e7c', '#817263', '#637a6d', '#876f69', '#777561']
            ];

            // Function to get a random color from the defined palettes
            function getRandomColor() {
                // Select a random palette
                const palette = colorPalettes[Math.floor(Math.random() * colorPalettes.length)];
                // Select a random color from that palette
                return palette[Math.floor(Math.random() * palette.length)];
            }

            // Function to fetch and cache Tang poems
            async function fetchAndCachePoems() {
                if (allPoems !== null) {
                    return allPoems;
                }

                const CACHE_KEY = 'tang_poems_cache_v2'; // Updated cache key to force refresh
                const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

                // Check if we have cached data and it's still valid
                const cachedData = localStorage.getItem(CACHE_KEY);
                if (cachedData) {
                    const { data, timestamp } = JSON.parse(cachedData);
                    const now = Date.now();

                    if (now - timestamp < CACHE_DURATION) {
                        // Cache is still valid - store in memory for subsequent requests
                        allPoems = data;
                        console.log("Using cached Tang poem data");
                        return allPoems;
                    }
                }

                // Fetch new data from the XML file
                try {
                    console.log("Fetching fresh Tang poem data from API...");
                    const response = await fetch('https://wealth.want.biz/pages/poem.xml');
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const xmlText = await response.text();
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlText, "text/xml");

                    // Extract poem data from XML
                    const poemNodes = xmlDoc.querySelectorAll('node');
                    const poems = [];

                    poemNodes.forEach(node => {
                        const title = node.querySelector('title')?.textContent || '';
                        const auth = node.querySelector('auth')?.textContent || '';
                        const type = node.querySelector('type')?.textContent || '';
                        const content = node.querySelector('content')?.textContent || '';
                        const desc = node.querySelector('desc')?.textContent || '';

                        // Create a search link for analysis if no description is available
                        const searchQuery = encodeURIComponent(`${auth || ''} ${title || ''}`);
                        const searchLink = `https://chat.baidu.com/search?word=${searchQuery}&setype=csaitab`;

                        let finalDesc = desc;
                        if (!desc || desc.trim() === '') {
                            // If no description exists, create one with the AI search link
                            finalDesc = `<div style="margin-top: 10px; padding: 10px; background-color: #e9ecef; border-radius: 5px; text-align: center;"><a href="${searchLink}" target="_blank" style="color: #007bff; text-decoration: none; font-weight: bold;">🔍 点击搜索诗词赏析</a></div>`;
                        } else {
                            // If description exists, prepend the AI search link above the description
                            finalDesc = `<div style="margin-top: 10px; padding: 10px; background-color: #e9ecef; border-radius: 5px; text-align: center;"><a href="${searchLink}" target="_blank" style="color: #007bff; text-decoration: none; font-weight: bold;">🔍 点击搜索诗词赏析</a></div><br><br>${desc}`;
                        }

                        poems.push({
                            title: title,
                            auth: auth,
                            type: type,
                            content: content,
                            desc: finalDesc,
                            source: 'poem' // Mark as poem
                        });
                    });

                    // Cache the fetched data
                    const cacheData = {
                        data: poems,
                        timestamp: Date.now()
                    };
                    localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));

                    // Store in memory for subsequent requests
                    allPoems = poems;

                    console.log(`Fetched and cached ${poems.length} Tang poems`);
                    return allPoems;
                } catch (error) {
                    console.error('Error fetching Tang poem data:', error);

                    // If fetching failed, try to return cached data even if it's expired
                    if (cachedData) {
                        const { data } = JSON.parse(cachedData);
                        console.warn("Using expired cached Tang poem data due to fetch error");
                        // Store expired data in memory temporarily
                        allPoems = data;
                        return allPoems;
                    }

                    // If no cached data is available, return an empty array
                    allPoems = [];
                    return allPoems;
                }
            }

            // Function to fetch and cache Song ci
            async function fetchAndCacheCi() {
                if (allCi !== null) {
                    return allCi;
                }

                const CACHE_KEY = 'song_ci_cache_v2'; // Updated cache key to force refresh
                const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

                // Check if we have cached data and it's still valid
                const cachedData = localStorage.getItem(CACHE_KEY);
                if (cachedData) {
                    const { data, timestamp } = JSON.parse(cachedData);
                    const now = Date.now();

                    if (now - timestamp < CACHE_DURATION) {
                        // Cache is still valid - store in memory for subsequent requests
                        allCi = data;
                        console.log("Using cached Song ci data");
                        return allCi;
                    }
                }

                // Fetch new data from the JSON file
                try {
                    console.log("Fetching fresh Song ci data from API...");
                    const response = await fetch('https://wealth.want.biz/pages/songci.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const ciData = await response.json();

                    // Process ci data to match poem structure
                    const processedCi = ciData.map(ci => {
                        // Create a search link for analysis if no description is available
                        const searchQuery = encodeURIComponent(`${ci.author || ''} ${ci.rhythmic || ''}`);
                        const searchLink = `https://chat.baidu.com/search?word=${searchQuery}&setype=csaitab`;

                        let desc = '';
                        if (ci.tags && ci.tags.length > 0) {
                            // Place the search link above the tags
                            desc = `<div style="margin-top: 10px; padding: 10px; background-color: #e9ecef; border-radius: 5px; text-align: center;"><a href="${searchLink}" target="_blank" style="color: #007bff; text-decoration: none; font-weight: bold;">🔍 点击搜索诗词赏析</a></div><br><br>标签: ${ci.tags.join(', ')}`;
                        } else {
                            desc = `<div style="margin-top: 10px; padding: 10px; background-color: #e9ecef; border-radius: 5px; text-align: center;"><a href="${searchLink}" target="_blank" style="color: #007bff; text-decoration: none; font-weight: bold;">🔍 点击搜索诗词赏析</a></div>`;
                        }

                        return {
                            title: ci.rhythmic || '未知词牌', // Use rhythmic as title
                            auth: ci.author || '未知作者',
                            type: '宋词', // Mark as Song ci
                            content: ci.paragraphs ? ci.paragraphs.join('<br>') : '无内容',
                            desc: desc,
                            source: 'ci' // Mark as ci
                        };
                    });

                    // Cache the fetched data
                    const cacheData = {
                        data: processedCi,
                        timestamp: Date.now()
                    };
                    localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));

                    // Store in memory for subsequent requests
                    allCi = processedCi;

                    console.log(`Fetched and cached ${processedCi.length} Song ci`);
                    return allCi;
                } catch (error) {
                    console.error('Error fetching Song ci data:', error);

                    // If fetching failed, try to return cached data even if it's expired
                    if (cachedData) {
                        const { data } = JSON.parse(cachedData);
                        console.warn("Using expired cached Song ci data due to fetch error");
                        // Store expired data in memory temporarily
                        allCi = data;
                        return allCi;
                    }

                    // If no cached data is available, return an empty array
                    allCi = [];
                    return allCi;
                }
            }

            // Function to fetch and combine both poems and ci
            async function fetchAndCombineAll() {
                if (allCombined !== null) {
                    return allCombined;
                }

                // Fetch both poems and ci in parallel
                const [poems, ci] = await Promise.all([
                    fetchAndCachePoems(),
                    fetchAndCacheCi()
                ]);

                // Combine both arrays
                allCombined = [...poems, ...ci];
                console.log(`Combined ${poems.length} Tang poems and ${ci.length} Song ci, total ${allCombined.length} entries`);

                return allCombined;
            }

            // Function to get a random poem from cached data
            async function getRandomPoem() {
                // Use filtered poems if available, otherwise use combined poems and ci
                if (filteredPoems && filteredPoems.length > 0) {
                    const randomIndex = Math.floor(Math.random() * filteredPoems.length);
                    return filteredPoems[randomIndex];
                } else {
                    // Use combined poems and ci
                    const allItems = await fetchAndCombineAll();
                    if (allItems.length === 0) {
                        console.warn("No poems or ci available");
                        return null;
                    }
                    const randomIndex = Math.floor(Math.random() * allItems.length);
                    return allItems[randomIndex];
                }
            }

            // Function to get a random image URL from various sources with fallbacks
            function getRandomImageUrl(fallbackNum = 1) {
                const timestamp = Date.now();
                switch (fallbackNum) {
                    case 1:
                        // Primary source: picsum with random seed
                        return `https://picsum.photos/seed/${timestamp}/400/300`;
                    case 2:
                        // Fallback 1: picsum without seed (random image)
                        return `https://picsum.photos/400/300?random=${timestamp}`;
                    case 3:
                        // Fallback 2: Unsplash source with random seed
                        return `https://source.unsplash.com/400x300/?nature,random&ts=${timestamp}`;
                    case 4:
                        // Fallback 3: Pexel source with random seed
                        return `https://images.pexels.com/photos/3225517/pexels-photo-3225517.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=400&h=300&ts=${timestamp}`;
                    case 5:
                        // Local fallback: base64 encoded placeholder image
                        return `data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjY2NjIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkPDpXNpIFBvaWN0cnkgUGxhY2Vob2xkZXI8L3RleHQ+PC9zdmc+`;
                    default:
                        // Last resort: simple placeholder if all other sources fail
                        return `https://placehold.co/400x300/cccccc/666666?text=诗词配图`;
                }
            }

            // Function to get a random poem from filtered data
            async function getRandomPoem() {
                // Use filtered poems if available, otherwise use combined poems and ci
                if (filteredPoems && filteredPoems.length > 0) {
                    const randomIndex = Math.floor(Math.random() * filteredPoems.length);
                    return filteredPoems[randomIndex];
                } else {
                    // Use combined poems and ci
                    const allItems = await fetchAndCombineAll();
                    if (allItems.length === 0) {
                        console.warn("No poems or ci available");
                        return null;
                    }
                    const randomIndex = Math.floor(Math.random() * allItems.length);
                    return allItems[randomIndex];
                }
            }

            // Function to determine if poem is suitable for vertical layout
            function isVerticalLayoutPoem(poem) {
                const content = poem.content.replace(/\s+/g, ''); // Remove whitespace
                const sentences = content.split(/[。！？!?]/).filter(s => s.trim() !== '');

                // Check if it's a 5-character or 7-character regulated verse
                const firstLineLen = sentences[0] ? sentences[0].replace(/[，,]/g, '').length : 0;
                const isRegular = (firstLineLen === 5 || firstLineLen === 7) &&
                    sentences.every(s => {
                        const cleanLen = s.replace(/[，,]/g, '').length;
                        return cleanLen === firstLineLen * 2 || cleanLen === firstLineLen;
                    });

                // Suitable for vertical layout if it's a regular 5/7 character poem and not too long
                return isRegular && content.length <= 64;
            }

            // Function to determine if poem is a 7-character regulated verse (七言诗)
            function isRegularPoem(poem) {
                const content = poem.content.replace(/\s+/g, ''); // Remove whitespace
                const sentences = content.split(/[。！？!?]/).filter(s => s.trim() !== '');

                // 获取第一句长度（通常是 5 或 7）
                const firstLineLen = sentences[0] ? sentences[0].replace(/[，,]/g, '').length : 0;

                // 允许 5言 或 7言，且每句长度要一致
                const isRegular = (firstLineLen === 5 || firstLineLen === 7) &&
                    sentences.every(s => {
                        const cleanLen = s.replace(/[，,]/g, '').length;
                        // 一句可能是5/7字，或者是一联10/14字
                        return cleanLen === firstLineLen * 2 || cleanLen === firstLineLen;
                    });

                return isRegular;
            }

            // 【修改 2】 通用的成对格式化函数 (原 formatSevenCharacterPoem)
            function formatCoupletPoem(poem) {
                // 关键点：filter(line => line !== '') 会自动把造成大间距的空行过滤掉！
                const lines = poem.content.split('\n').map(line => line.trim()).filter(line => line !== '');

                const formattedLines = [];
                for (let i = 0; i < lines.length; i += 2) {
                    if (i + 1 < lines.length) {
                        // 成对输出
                        formattedLines.push(`<div class="couplet-row">${lines[i]}<br>${lines[i + 1]}</div>`);
                    } else {
                        // 落单的最后一句
                        formattedLines.push(`<div class="couplet-row">${lines[i]}</div>`);
                    }
                }
                return formattedLines.join('');
            }

            // Function to insert line breaks at commas and periods for better layout
            function insertLineBreaksAtPunctuation(content) {
                // 先规范化换行符，过滤空行，再处理标点符号
                // 首先，将内容按换行符分割并过滤空行
                const lines = content.split('\n')
                    .map(line => line.trim())
                    .filter(line => line !== '');

                // 重新组合内容，但确保格式整洁
                let processed = lines.join('\n');

                // 然后添加标点符号后的换行
                processed = processed
                    .replace(/([，,])(?!\n)/g, '$1\n') // 在逗号后添加换行（如果没有已经存在的换行）
                    .replace(/([？?])(?!\n)/g, '$1\n'); // 在句号后添加换行（如果没有已经存在的换行）

                // 最后，将所有换行符统一转换为 <br> 标签
                processed = processed.replace(/\n/g, '<br>');

                // 处理可能出现的多个连续 <br> 标签
                processed = processed
                    .replace(/(<br>\s*){3,}/g, '<br><div class="poem-paragraph-break"></div><br>') // 3+ brs to br + paragraph break + br
                    .replace(/(<br>\s*){2}/g, '<br>'); // 2 brs to single br to avoid double spacing

                return processed;
            }

            // Function to load a random poem and image
            async function loadRandomPoem() {
                // Show loading
                document.getElementById('loading').style.display = 'block';
                document.getElementById('poemTextContent').style.display = 'none';
                document.getElementById('poemDescContent').style.display = 'none';

                // Get random poem
                const poem = await getRandomPoem();

                if (!poem) {
                    document.getElementById('loading').innerHTML = '诗词加载失败，请稍后再试';
                    return;
                }

                // 1. 设置基本信息
                document.getElementById('poemTitle').textContent = poem.title;
                document.getElementById('poemAuthor').textContent = poem.auth;

                // 优化：尝试从 type 中提取朝代，如果没有则默认显示诗词类型
                const dynastyElement = document.getElementById('poemDynasty');
                const typeSealElement = document.getElementById('mainTypeSeal');

                // Get actual dynasty from author data instead of just based on source
                const authorDynasty = getDynastyByAuthorName(poem.auth);

                if (poem.source === 'ci') {
                    dynastyElement.textContent = authorDynasty;
                    dynastyElement.style.backgroundColor = '#88485E'; // 宋词用紫红色
                    typeSealElement.textContent = '词'; // 词类型
                } else {
                    dynastyElement.textContent = authorDynasty; // Use actual author dynasty
                    dynastyElement.style.backgroundColor = '#FE2C55'; // 唐诗用小红书红
                    typeSealElement.textContent = '诗'; // 诗类型
                }

                // 2. 智能排版逻辑 (复用 analyzePoemLayout)
                // 注意：这里我们稍微改一下，如果是 analyzePoemLayout 返回 vertical，我们就用竖排
                // 但对于主展示区，我们可以稍微放宽竖排的条件（比如只要是律诗绝句都竖排，不受32字限制，因为空间大）

                const content = poem.content;
                const verseElement = document.getElementById('poemVerse');

                // 清除之前的类
                verseElement.className = 'poem-verse';

                // 简单判断：不包含逗号且句子长度整齐的，或者你是用 analyzePoemLayout
                const layoutInfo = analyzePoemLayout(poem);

                if (layoutInfo.mode === 'vertical') {
                    verseElement.classList.add('vertical-mode');
                    // 竖排时，换行符保留，且标点符号可能会影响美观，可以考虑用空格替换标点，或者保留
                    // 这里直接保留原文排版 but add line breaks at punctuation
                    verseElement.innerHTML = insertLineBreaksAtPunctuation(poem.content);
                } else {
                    verseElement.classList.add('horizontal-mode');
                    // 横排居中，适合长短句
                    // 【修改 3】 只要是格律诗（五言或七言），且行数足够，就使用成对布局
                    // 这样就能利用 .couplet-row 的 CSS 来控制间距，消灭大空行
                    if (isRegularPoem(poem) && poem.content.split('\n').length >= 2) {
                        verseElement.innerHTML = formatCoupletPoem(poem);
                    } else {
                        // 其他长短句（词）继续使用默认排版
                        verseElement.innerHTML = insertLineBreaksAtPunctuation(poem.content);
                    }
                }

                // 3. 赏析内容处理 (优先显示缓存的 AI 赏析)
                const cachedInterpretation = getInterpretationFromCache(poem.title, poem.auth);
                const descElement = document.getElementById('poemDesc');

                if (cachedInterpretation) {
                    // 如果有缓存，显示 AI 赏析
                    const separator = '<div style="border-top: 1px dashed #ddd; margin: 20px 0;"></div>';
                    const aiBadge = '<div style="display:inline-block; background:linear-gradient(90deg, #6366f1, #8b5cf6); color:white; padding:2px 8px; border-radius:12px; font-size:0.8rem; margin-bottom:10px; font-weight:bold;">✨ AI 深度赏析 <span onclick="regenerateAnalysis(event)" style="cursor:pointer; margin-left:10px; font-size:0.8em; opacity:0.8; border-bottom:1px solid white;" title="重新生成解读">🔄 重新生成</span></div>';
                    descElement.innerHTML = poem.desc + separator + aiBadge + markdownToHtml(cachedInterpretation);
                } else {
                    // 否则显示默认注释
                    descElement.innerHTML = poem.desc;
                }

                // Update image with multiple fallbacks and timeout
                const img = document.getElementById('poemImage');
                let currentFallback = 1;
                const maxFallbacks = 6; // Primary + 4 fallbacks + 1 local fallback
                let timeoutId;

                // Function to try loading next fallback image
                function tryNextFallback() {
                    if (currentFallback < maxFallbacks) {
                        currentFallback++;
                        // Clear previous timeout
                        if (timeoutId) {
                            clearTimeout(timeoutId);
                        }
                        // Set a new timeout for this fallback
                        timeoutId = setTimeout(() => {
                            console.log(`Image loading timeout for fallback ${currentFallback}, trying next...`);
                            if (currentFallback < maxFallbacks) {
                                tryNextFallback();
                            } else {
                                // All fallbacks exhausted, show content without image and indicate failure
                                handleImageFailure();
                            }
                        }, 15000); // 5 seconds timeout for each fallback

                        img.src = getRandomImageUrl(currentFallback);
                    } else {
                        // All fallbacks exhausted, show content without image and indicate failure
                        handleImageFailure();
                    }
                }

                // Function to handle the case when all image sources fail
                function handleImageFailure() {
                    console.warn("All image loading attempts failed, displaying content without image");

                    // Hide loading indicator
                    document.getElementById('loading').style.display = 'none';

                    // Show poem content
                    document.getElementById('poemTextContent').style.display = 'block';
                    document.getElementById('poemDescContent').style.display = 'block';

                    // Apply fade-in animation and add seal
                    document.getElementById('poemTextContent').classList.add('fade-in');
                    document.getElementById('poemDescContent').classList.add('fade-in');


                    // Optionally, add a visual indicator that image loading failed
                    const img = document.getElementById('poemImage');
                    img.onerror = null; // Remove error handler to prevent loops
                    img.onload = null;  // Remove load handler
                }

                // Set up image event handlers
                img.onload = function () {
                    // Add loaded image to cache
                    addToImageCache(img.src);
                    // Clear timeout on successful load
                    if (timeoutId) {
                        clearTimeout(timeoutId);
                    }
                    // Show content once image is loaded
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('poemTextContent').style.display = 'block';
                    document.getElementById('poemDescContent').style.display = 'block';
                    document.getElementById('poemTextContent').classList.add('fade-in');
                    document.getElementById('poemDescContent').classList.add('fade-in');

                };

                img.onerror = function () {
                    console.log(`Image loading error for fallback ${currentFallback}, trying next...`);
                    // If we have cached images, try using one as a fallback
                    const cachedImage = getRandomCachedImage();
                    if (cachedImage && currentFallback >= maxFallbacks - 1) { // Only try cached on last attempt
                        console.log(`Using cached image as final fallback: ${cachedImage}`);
                        img.src = cachedImage;
                        return; // Don't try next fallback, try the cached image instead
                    }
                    // Try next fallback image
                    tryNextFallback();
                };

                // Set the new image source with primary URL
                img.src = getRandomImageUrl(currentFallback);

                // Set timeout for primary image
                timeoutId = setTimeout(() => {
                    console.log(`Image loading timeout for fallback ${currentFallback}, trying next...`);
                    if (currentFallback < maxFallbacks) {
                        tryNextFallback();
                    } else {
                        // Try cached image if available before showing content without image
                        const cachedImage = getRandomCachedImage();
                        if (cachedImage) {
                            console.log(`Using cached image as final fallback due to timeout: ${cachedImage}`);
                            img.src = cachedImage;
                        } else {
                            // All fallbacks exhausted, show content without image and indicate failure
                            handleImageFailure();
                        }
                    }
                }, 5000); // 5 seconds timeout for primary image

                // Show content immediately if this is the first load (image might take time)
                setTimeout(() => {
                    if (document.getElementById('loading').style.display === 'block') {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('poemTextContent').style.display = 'block';
                        document.getElementById('poemDescContent').style.display = 'block';
                        document.getElementById('poemTextContent').classList.add('fade-in');
                        document.getElementById('poemDescContent').classList.add('fade-in');

                    }
                }, 300); // Show content after 300ms if image hasn't loaded yet
            }

            // Function to populate author filter dropdown
            async function populateAuthorFilter() {
                const authorsWithCount = await getAllAuthors();
                const authorFilter = document.getElementById('authorFilter');

                // Clear existing options except the first one
                authorFilter.innerHTML = '<option value="">全部作者</option>';

                // Add authors with poem counts to the dropdown
                authorsWithCount.forEach(authorObj => {
                    const option = document.createElement('option');
                    option.value = authorObj.name;
                    option.textContent = `${authorObj.name} (${authorObj.count})`;
                    authorFilter.appendChild(option);
                });
            }

            // Function to get all authors sorted by poem count
            async function getAllAuthors() {
                // Use combined poems and ci for author list
                const allItems = await fetchAndCombineAll();

                // Count items per author
                const authorCount = {};
                allItems.forEach(item => {
                    if (authorCount[item.auth]) {
                        authorCount[item.auth]++;
                    } else {
                        authorCount[item.auth] = 1;
                    }
                });

                // Create array of {name, count} objects and sort by count (descending)
                const authorsWithCount = Object.entries(authorCount).map(([name, count]) => ({
                    name: name,
                    count: count
                }));

                // Sort by poem count (descending), then by name (ascending) for ties
                authorsWithCount.sort((a, b) => {
                    if (b.count !== a.count) {
                        return b.count - a.count; // Sort by count descending
                    }
                    return a.name.localeCompare(b.name); // Sort by name ascending for ties
                });

                return authorsWithCount;
            }

            // Function to filter poems by author
            async function filterByAuthor() {
                const selectedAuthor = document.getElementById('authorFilter').value;
                const allItems = await fetchAndCombineAll();

                if (selectedAuthor === '') {
                    filteredPoems = allItems;
                } else {
                    // Extract just the author name (before the parentheses)
                    const authorName = selectedAuthor.split(' (')[0];
                    filteredPoems = allItems.filter(item => item.auth === authorName);
                }

                // Update poem list dropdown
                updatePoemListDropdown();
            }

            // Function to update poem list dropdown based on filtered poems
            function updatePoemListDropdown() {
                const poemList = document.getElementById('poemList');

                // Clear existing options except the first one
                poemList.innerHTML = '<option value="">选择作品</option>';

                if (filteredPoems && filteredPoems.length > 0) {
                    filteredPoems.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.title;
                        option.textContent = item.title;
                        poemList.appendChild(option);
                    });
                }
            }

            // Function to select a specific poem
            async function selectPoem() {
                const selectedTitle = document.getElementById('poemList').value;

                if (selectedTitle) {
                    // Find the selected poem in the filtered poems
                    const poem = filteredPoems.find(p => p.title === selectedTitle);
                    if (poem) {
                        displayPoem(poem);
                    }
                }
            }

            // Function to display a specific poem
            function displayPoem(poem) {
                // Show loading
                document.getElementById('loading').style.display = 'block';
                document.getElementById('poemTextContent').style.display = 'none';
                document.getElementById('poemDescContent').style.display = 'none';

                // 1. 设置基本信息
                document.getElementById('poemTitle').textContent = poem.title;
                document.getElementById('poemAuthor').textContent = poem.auth;

                // 优化：尝试从 type 中提取朝代，如果没有则默认显示诗词类型
                const dynastyElement = document.getElementById('poemDynasty');
                const typeSealElement = document.getElementById('mainTypeSeal');

                // Get actual dynasty from author data instead of just based on source
                const authorDynasty = getDynastyByAuthorName(poem.auth);

                if (poem.source === 'ci') {
                    dynastyElement.textContent = authorDynasty;
                    dynastyElement.style.backgroundColor = '#88485E'; // 宋词用紫红色
                    typeSealElement.textContent = '词'; // 词类型
                } else {
                    dynastyElement.textContent = authorDynasty; // Use actual author dynasty
                    dynastyElement.style.backgroundColor = '#FE2C55'; // 唐诗用小红书红
                    typeSealElement.textContent = '诗'; // 诗类型
                }

                // 2. 智能排版逻辑 (复用 analyzePoemLayout)
                // 注意：这里我们稍微改一下，如果是 analyzePoemLayout 返回 vertical，我们就用竖排
                // 但对于主展示区，我们可以稍微放宽竖排的条件（比如只要是律诗绝句都竖排，不受32字限制，因为空间大）

                const content = poem.content;
                const verseElement = document.getElementById('poemVerse');

                // 清除之前的类
                verseElement.className = 'poem-verse';

                // 简单判断：不包含逗号且句子长度整齐的，或者你是用 analyzePoemLayout
                const layoutInfo = analyzePoemLayout(poem);

                if (layoutInfo.mode === 'vertical') {
                    verseElement.classList.add('vertical-mode');
                    // 竖排时，换行符保留，且标点符号可能会影响美观，可以考虑用空格替换标点，或者保留
                    // 这里直接保留原文排版 but add line breaks at punctuation
                    verseElement.innerHTML = insertLineBreaksAtPunctuation(poem.content);
                } else {
                    verseElement.classList.add('horizontal-mode');
                    // 横排居中，适合长短句
                    // 【修改 3】 只要是格律诗（五言或七言），且行数足够，就使用成对布局
                    // 这样就能利用 .couplet-row 的 CSS 来控制间距，消灭大空行
                    if (isRegularPoem(poem) && poem.content.split('\n').length >= 2) {
                        verseElement.innerHTML = formatCoupletPoem(poem);
                    } else {
                        // 其他长短句（词）继续使用默认排版
                        verseElement.innerHTML = insertLineBreaksAtPunctuation(poem.content);
                    }
                }

                // Debug: Log the desc content to console
                // console.log("Poem desc content:", poem.desc);
                // console.log("Poem source:", poem.source);

                // 3. 赏析内容处理 (优先显示缓存的 AI 赏析)
                const cachedInterpretation = getInterpretationFromCache(poem.title, poem.auth);
                const descElement = document.getElementById('poemDesc');

                if (cachedInterpretation) {
                    // 如果有缓存，显示 AI 赏析
                    const separator = '<div style="border-top: 1px dashed #ddd; margin: 20px 0;"></div>';
                    const aiBadge = '<div style="display:inline-block; background:linear-gradient(90deg, #6366f1, #8b5cf6); color:white; padding:2px 8px; border-radius:12px; font-size:0.8rem; margin-bottom:10px; font-weight:bold;">✨ AI 深度赏析 <span onclick="regenerateAnalysis(event)" style="cursor:pointer; margin-left:10px; font-size:0.8em; opacity:0.8; border-bottom:1px solid white;" title="重新生成解读">🔄 重新生成</span></div>';
                    descElement.innerHTML = poem.desc + separator + aiBadge + markdownToHtml(cachedInterpretation);
                } else {
                    // 否则显示默认注释
                    descElement.innerHTML = poem.desc;
                }

                // Update image with multiple fallbacks and timeout
                const img = document.getElementById('poemImage');
                let currentFallback = 1;
                const maxFallbacks = 6; // Primary + 4 fallbacks + 1 local fallback
                let timeoutId;

                // Function to try loading next fallback image
                function tryNextFallback() {
                    if (currentFallback < maxFallbacks) {
                        currentFallback++;
                        // Clear previous timeout
                        if (timeoutId) {
                            clearTimeout(timeoutId);
                        }
                        // Set a new timeout for this fallback
                        timeoutId = setTimeout(() => {
                            console.log(`Image loading timeout for fallback ${currentFallback}, trying next...`);
                            if (currentFallback < maxFallbacks) {
                                tryNextFallback();
                            } else {
                                // All fallbacks exhausted, show content without image and indicate failure
                                handleImageFailure();
                            }
                        }, 5000); // 5 seconds timeout for each fallback

                        img.src = getRandomImageUrl(currentFallback);
                    } else {
                        // All fallbacks exhausted, show content without image and indicate failure
                        handleImageFailure();
                    }
                }

                // Function to handle the case when all image sources fail
                function handleImageFailure() {
                    console.warn("All image loading attempts failed, displaying content without image");

                    // Hide loading indicator
                    document.getElementById('loading').style.display = 'none';

                    // Show poem content
                    document.getElementById('poemTextContent').style.display = 'block';
                    document.getElementById('poemDescContent').style.display = 'block';

                    // Apply fade-in animation and add seal
                    document.getElementById('poemTextContent').classList.add('fade-in');
                    document.getElementById('poemDescContent').classList.add('fade-in');


                    // Optionally, add a visual indicator that image loading failed
                    const img = document.getElementById('poemImage');
                    img.onerror = null; // Remove error handler to prevent loops
                    img.onload = null;  // Remove load handler
                }

                // Set up image event handlers
                img.onload = function () {
                    // Add loaded image to cache
                    addToImageCache(img.src);
                    // Clear timeout on successful load
                    if (timeoutId) {
                        clearTimeout(timeoutId);
                    }
                    // Show content once image is loaded
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('poemTextContent').style.display = 'block';
                    document.getElementById('poemDescContent').style.display = 'block';
                    document.getElementById('poemTextContent').classList.add('fade-in');
                    document.getElementById('poemDescContent').classList.add('fade-in');

                };

                img.onerror = function () {
                    console.log(`Image loading error for fallback ${currentFallback}, trying next...`);
                    // If we have cached images, try using one as a fallback
                    const cachedImage = getRandomCachedImage();
                    if (cachedImage && currentFallback >= maxFallbacks - 1) { // Only try cached on last attempt
                        console.log(`Using cached image as final fallback: ${cachedImage}`);
                        img.src = cachedImage;
                        return; // Don't try next fallback, try the cached image instead
                    }
                    // Try next fallback image
                    tryNextFallback();
                };

                // Set the new image source with primary URL
                img.src = getRandomImageUrl(currentFallback);

                // Set timeout for primary image
                timeoutId = setTimeout(() => {
                    console.log(`Image loading timeout for fallback ${currentFallback}, trying next...`);
                    if (currentFallback < maxFallbacks) {
                        tryNextFallback();
                    } else {
                        // Try cached image if available before showing content without image
                        const cachedImage = getRandomCachedImage();
                        if (cachedImage) {
                            console.log(`Using cached image as final fallback due to timeout: ${cachedImage}`);
                            img.src = cachedImage;
                        } else {
                            // All fallbacks exhausted, show content without image and indicate failure
                            handleImageFailure();
                        }
                    }
                }, 5000); // 5 seconds timeout for primary image

                // Show content immediately if this is the first load (image might take time)
                setTimeout(() => {
                    if (document.getElementById('loading').style.display === 'block') {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('poemTextContent').style.display = 'block';
                        document.getElementById('poemDescContent').style.display = 'block';
                        document.getElementById('poemTextContent').classList.add('fade-in');
                        document.getElementById('poemDescContent').classList.add('fade-in');

                    }
                }, 300); // Show content after 300ms if image hasn't loaded yet
            }

            // Function to clear filters
            function clearFilter() {
                document.getElementById('authorFilter').value = '';
                document.getElementById('poemList').value = '';
                filteredPoems = allCombined; // Reset to all combined data (poems and ci)
                updatePoemListDropdown();
            }

            // Function to perform search
            async function performSearch() {
                const searchTerm = document.getElementById('searchInput').value.trim();
                if (!searchTerm) {
                    alert('请输入搜索关键词');
                    return;
                }

                const allItems = await fetchAndCombineAll();
                const searchResults = [];

                // Search in title and content
                allItems.forEach(item => {
                    const title = item.title.toLowerCase();
                    const content = item.content.toLowerCase();
                    const auth = item.auth.toLowerCase();
                    const desc = item.desc.toLowerCase();

                    if (title.includes(searchTerm.toLowerCase()) ||
                        content.includes(searchTerm.toLowerCase()) ||
                        auth.includes(searchTerm.toLowerCase()) ||
                        desc.includes(searchTerm.toLowerCase())) {
                        // Create a preview of where the match occurred
                        let preview = '';
                        if (content.includes(searchTerm.toLowerCase())) {
                            const matchIndex = content.indexOf(searchTerm.toLowerCase());
                            const start = Math.max(0, matchIndex - 20);
                            const end = Math.min(content.length, matchIndex + searchTerm.length + 20);
                            preview = '...' + content.substring(start, end) + '...';
                        } else {
                            preview = content.substring(0, 60) + '...';
                        }

                        searchResults.push({
                            ...item,
                            preview: preview
                        });
                    }
                });

                displaySearchResults(searchResults, searchTerm);
            }

            // Function to handle Enter key in search input
            function handleSearchKeyPress(event) {
                if (event.key === 'Enter') {
                    performSearch();
                }
            }

            // Function to display search results
            function displaySearchResults(results, searchTerm) {
                const resultsContainer = document.getElementById('searchResults');
                const resultsList = document.getElementById('searchResultsList');

                if (results.length === 0) {
                    resultsList.innerHTML = '<li>未找到匹配的诗歌</li>';
                } else {
                    resultsList.innerHTML = '';

                    results.forEach((poem, index) => {
                        const li = document.createElement('li');
                        li.innerHTML = `
            <div class="result-title">${highlightText(poem.title, searchTerm)}</div>
            <div class="result-author">作者: ${highlightText(poem.auth, searchTerm)}</div>
            <div class="result-preview">${highlightText(poem.preview, searchTerm)}</div>
          `;
                        li.onclick = () => selectSearchResult(poem);
                        resultsList.appendChild(li);
                    });
                }

                resultsContainer.style.display = 'block';
            }

            // Function to highlight search term in text
            function highlightText(text, searchTerm) {
                if (!searchTerm) return text;

                const regex = new RegExp(`(${searchTerm})`, 'gi');
                return text.replace(regex, '<mark>$1</mark>');
            }

            // Function to select a search result
            function selectSearchResult(poem) {
                displayPoem(poem);

                // Close search results and search section
                document.getElementById('searchResults').style.display = 'none';
                document.getElementById('searchSection').style.display = 'none';
                document.getElementById('searchInput').value = '';
            }

            // Function to clear search
            function clearSearch() {
                document.getElementById('searchInput').value = '';
                document.getElementById('searchResults').style.display = 'none';
            }

            // Function to toggle search section
            function toggleSearch() {
                const searchSection = document.getElementById('searchSection');
                const isCurrentlyVisible = searchSection.style.display !== 'none';

                if (isCurrentlyVisible) {
                    hideSearch();
                } else {
                    searchSection.style.display = 'flex';
                    // Focus on the search input when showing
                    document.getElementById('searchInput').focus();
                }
            }

            // Function to hide search section
            function hideSearch() {
                document.getElementById('searchSection').style.display = 'none';
                document.getElementById('searchResults').style.display = 'none';
                document.getElementById('searchInput').value = '';
            }

            // Load a random poem when the page loads
            window.onload = async function () {
                // Preload both poems and ci data
                await fetchAndCombineAll();
                // Initialize filteredPoems to all combined data
                filteredPoems = allCombined;
                await loadRandomPoem();
                await populateAuthorFilter(); // Populate the author filter after poems are loaded

                console.log("Page loaded. Combined data count:", allCombined ? allCombined.length : 0);
                console.log("Tang poem count:", allPoems ? allPoems.length : 0);
                console.log("Song ci count:", allCi ? allCi.length : 0);
            };

            // Add keyboard support (press spacebar for next poem)
            document.addEventListener('keydown', function (event) {
                if (event.code === 'Space') {
                    event.preventDefault();
                    loadRandomPoem();
                }
            });

            // Function to open Baidu search for current poem
            function openCurrentPoemSearch() {
                const titleElement = document.getElementById('poemTitle');
                const authorElement = document.getElementById('poemAuthor');

                let title = '';
                let author = '';

                if (titleElement) {
                    title = titleElement.textContent || titleElement.innerText;
                }

                if (authorElement) {
                    author = authorElement.textContent || authorElement.innerText;
                }

                // Create search query
                const searchQuery = encodeURIComponent(`${author} ${title}`);
                const searchUrl = `https://chat.baidu.com/search?word=${searchQuery}&setype=csaitab`;

                // Open search in a new tab/window
                window.open(searchUrl, '_blank');
            }

            document.addEventListener('DOMContentLoaded', function () {
                // Add event listener for inline search button
                const inlineSearchBtn = document.getElementById('inlineSearchBtn');
                if (inlineSearchBtn) {
                    inlineSearchBtn.addEventListener('click', openCurrentPoemSearch);
                }

                const darkModeToggle = document.getElementById('darkModeToggle');
                const body = document.body;

                // Check for saved theme preference or respect system preference
                const currentTheme = localStorage.getItem('theme');
                if (currentTheme === 'dark') {
                    body.classList.add('dark-mode');
                    darkModeToggle.innerHTML = '<span>☀️</span> 切换模式'; // Sun icon when in dark mode
                } else if (currentTheme === 'light') {
                    body.classList.remove('dark-mode');
                    darkModeToggle.innerHTML = '<span>🌙</span> 切换模式'; // Moon icon when in light mode
                } else {
                    // Check system preference
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        body.classList.add('dark-mode');
                        darkModeToggle.innerHTML = '<span>☀️</span> 切换模式';
                    } else {
                        body.classList.remove('dark-mode');
                        darkModeToggle.innerHTML = '<span>🌙</span> 切换模式';
                    }
                }

                darkModeToggle.addEventListener('click', function () {
                    body.classList.toggle('dark-mode');

                    if (body.classList.contains('dark-mode')) {
                        darkModeToggle.innerHTML = '<span>☀️</span> 切换模式';
                        localStorage.setItem('theme', 'dark');
                    } else {
                        darkModeToggle.innerHTML = '<span>🌙</span> 切换模式';
                        localStorage.setItem('theme', 'light');
                    }
                });

                // Menu functionality
                const menuToggle = document.getElementById('menuToggle');
                const menuOverlay = document.getElementById('menuOverlay');
                const closeMenuBtn = document.getElementById('closeMenuBtn');
                const historyBtn = document.getElementById('historyBtn');
                const favoritesBtn = document.getElementById('favoritesBtn');
                const aboutBtn = document.getElementById('aboutBtn');
                const historySection = document.getElementById('historySection');
                const favoritesSection = document.getElementById('favoritesSection');
                const aboutSection = document.getElementById('aboutSection');
                const historyList = document.getElementById('historyList');
                const favoritesList = document.getElementById('favoritesList');

                // Toggle menu
                menuToggle.addEventListener('click', function () {
                    menuOverlay.classList.add('active');
                });

                // Close menu
                closeMenuBtn.addEventListener('click', function () {
                    menuOverlay.classList.remove('active');
                    // Hide sections when closing
                    historySection.style.display = 'none';
                    favoritesSection.style.display = 'none';
                    aboutSection.style.display = 'none';
                });

                // Close menu when clicking on overlay
                menuOverlay.addEventListener('click', function (e) {
                    if (e.target === menuOverlay) {
                        menuOverlay.classList.remove('active');
                        // Hide sections when closing
                        historySection.style.display = 'none';
                        favoritesSection.style.display = 'none';
                        aboutSection.style.display = 'none';
                    }
                });

                // Show history section
                historyBtn.addEventListener('click', function () {
                    favoritesSection.style.display = 'none';
                    aboutSection.style.display = 'none';
                    historySection.style.display = 'block';
                    loadHistoryList();
                });

                // Show favorites section
                favoritesBtn.addEventListener('click', function () {
                    historySection.style.display = 'none';
                    aboutSection.style.display = 'none';
                    favoritesSection.style.display = 'block';
                    loadFavoritesList();
                });

                // Show about section
                aboutBtn.addEventListener('click', function () {
                    historySection.style.display = 'none';
                    favoritesSection.style.display = 'none';
                    aboutSection.style.display = 'block';
                });

                // History functionality
                const HISTORY_KEY = 'poem_history';
                const MAX_HISTORY = 50; // Store max 50 history items

                // Add poem to history
                function addToHistory(poem) {
                    if (!poem || !poem.title || !poem.auth) return;

                    const history = getHistoryFromStorage();
                    const newEntry = {
                        title: poem.title,
                        author: poem.auth,
                        source: poem.source || 'poem'
                    };

                    // Remove any existing entry with same title and author
                    const filteredHistory = history.filter(item =>
                        !(item.title === newEntry.title && item.author === newEntry.author)
                    );

                    // Add new entry to the beginning
                    filteredHistory.unshift(newEntry);

                    // Keep only the most recent MAX_HISTORY entries
                    if (filteredHistory.length > MAX_HISTORY) {
                        filteredHistory.splice(MAX_HISTORY);
                    }

                    localStorage.setItem(HISTORY_KEY, JSON.stringify(filteredHistory));
                }

                // Get history from storage
                function getHistoryFromStorage() {
                    try {
                        const history = localStorage.getItem(HISTORY_KEY);
                        return history ? JSON.parse(history) : [];
                    } catch (e) {
                        console.error('Error reading history from localStorage:', e);
                        return [];
                    }
                }

                // Load and display history list
                function loadHistoryList() {
                    const history = getHistoryFromStorage();
                    historyList.innerHTML = '';

                    if (history.length === 0) {
                        historyList.innerHTML = '<p style="padding: 10px; text-align: center; color: var(--text-tertiary);">暂无历史记录</p>';
                        return;
                    }

                    history.forEach((item, index) => {
                        const historyItem = document.createElement('div');
                        historyItem.className = 'history-item';
                        historyItem.innerHTML = `
                            <div class="title">${item.title}</div>
                            <div class="author">${item.author}</div>
                        `;
                        historyItem.addEventListener('click', function () {
                            searchAndDisplayPoem(item.title, item.author);
                            menuOverlay.classList.remove('active');
                            historySection.style.display = 'none';
                        });
                        historyList.appendChild(historyItem);
                    });
                }

                // Favorites functionality
                const FAVORITES_KEY = 'poem_favorites';
                const MAX_FAVORITES = 100; // Store max 100 favorite items

                // Toggle favorite status
                function toggleFavorite(poem) {
                    if (!poem || !poem.title || !poem.auth) return;

                    const isFavorite = isPoemFavorite(poem);
                    const favorites = getFavoritesFromStorage();
                    const favoriteEntry = {
                        title: poem.title,
                        author: poem.auth,
                        source: poem.source || 'poem'
                    };

                    if (isFavorite) {
                        // Remove from favorites
                        const filteredFavorites = favorites.filter(item =>
                            !(item.title === favoriteEntry.title && item.author === favoriteEntry.author)
                        );
                        localStorage.setItem(FAVORITES_KEY, JSON.stringify(filteredFavorites));
                    } else {
                        // Add to favorites
                        // Remove any existing entry first to avoid duplicates
                        const filteredFavorites = favorites.filter(item =>
                            !(item.title === favoriteEntry.title && item.author === favoriteEntry.author)
                        );

                        // Add new entry to the beginning
                        filteredFavorites.unshift(favoriteEntry);

                        // Keep only MAX_FAVORITES entries
                        if (filteredFavorites.length > MAX_FAVORITES) {
                            filteredFavorites.splice(MAX_FAVORITES);
                        }

                        localStorage.setItem(FAVORITES_KEY, JSON.stringify(filteredFavorites));
                    }
                }

                // Check if a poem is in favorites
                function isPoemFavorite(poem) {
                    if (!poem || !poem.title || !poem.auth) return false;

                    const favorites = getFavoritesFromStorage();
                    return favorites.some(item =>
                        item.title === poem.title && item.author === poem.auth
                    );
                }

                // Get favorites from storage
                function getFavoritesFromStorage() {
                    try {
                        const favorites = localStorage.getItem(FAVORITES_KEY);
                        return favorites ? JSON.parse(favorites) : [];
                    } catch (e) {
                        console.error('Error reading favorites from localStorage:', e);
                        return [];
                    }
                }

                // Load and display favorites list
                function loadFavoritesList() {
                    const favorites = getFavoritesFromStorage();
                    favoritesList.innerHTML = '';

                    if (favorites.length === 0) {
                        favoritesList.innerHTML = '<p style="padding: 10px; text-align: center; color: var(--text-tertiary);">暂无收藏</p>';
                        return;
                    }

                    favorites.forEach((item, index) => {
                        const favoriteItem = document.createElement('div');
                        favoriteItem.className = 'favorite-item';
                        favoriteItem.innerHTML = `
                            <div class="title">${item.title}</div>
                            <div class="author">${item.author}</div>
                        `;
                        favoriteItem.addEventListener('click', function () {
                            searchAndDisplayPoem(item.title, item.author);
                            menuOverlay.classList.remove('active');
                            favoritesSection.style.display = 'none';
                        });
                        favoritesList.appendChild(favoriteItem);
                    });
                }

                // Function to search and display a specific poem by title and author
                async function searchAndDisplayPoem(title, author) {
                    // Fetch all poems if not already loaded
                    await fetchAndCombineAll();

                    // Find the poem in the combined data
                    const poem = allCombined.find(p =>
                        p.title === title && p.auth === author
                    );

                    if (poem) {
                        displayPoem(poem);
                    } else {
                        alert('未找到该诗词');
                    }
                }

                // Add favorite button to poem display (we'll add this functionality later)
                // For now, we'll add a function to check favorite status when a poem is displayed
                function updateFavoriteButton() {
                    const poemTitle = document.getElementById('poemTitle').textContent;
                    const poemAuthor = document.getElementById('poemAuthor').textContent;

                    if (!poemTitle || !poemAuthor) return;

                    const currentPoem = {
                        title: poemTitle,
                        auth: poemAuthor
                    };

                    const isFav = isPoemFavorite(currentPoem);
                    // We'll add the favorite button later
                }

                // Add functionality to store current poem to history when it's displayed
                // We'll modify the displayPoem function to add to history
                const originalDisplayPoem = window.displayPoem || displayPoem;
                window.displayPoem = function (poem) {
                    originalDisplayPoem.call(this, poem);
                    // Add to history after poem is displayed
                    setTimeout(() => {
                        addToHistory(poem);
                    }, 500); // Small delay to ensure the poem is fully displayed
                };

                // Also modify the showPoemDetail function to add to history
                const originalShowPoemDetail = window.showPoemDetail || showPoemDetail;
                window.showPoemDetail = function (poem) {
                    originalShowPoemDetail.call(this, poem);
                    // Add to history after poem is displayed
                    setTimeout(() => {
                        addToHistory(poem);
                    }, 500); // Small delay to ensure the poem is fully displayed
                };

                // Modify the loadRandomPoem function to add to history
                const originalLoadRandomPoem = window.loadRandomPoem || loadRandomPoem;
                window.loadRandomPoem = async function () {
                    // Get a random poem first, then display it with history tracking
                    // Respect filtered poems if any author is selected
                    let itemsToUse;
                    if (filteredPoems && filteredPoems.length > 0) {
                        // Use filtered poems if available (author selected)
                        itemsToUse = filteredPoems;
                    } else {
                        // Otherwise use all combined items
                        itemsToUse = await fetchAndCombineAll();
                    }

                    if (itemsToUse.length === 0) {
                        console.warn("No poems or ci available");
                        return null;
                    }
                    const randomIndex = Math.floor(Math.random() * itemsToUse.length);
                    const poem = itemsToUse[randomIndex];

                    // Call the original display function
                    displayPoem(poem);

                    // Add to history after poem is displayed
                    setTimeout(() => {
                        addToHistory(poem);
                    }, 500); // Small delay to ensure the poem is fully displayed
                };

                // Add favorites toggle button functionality
                const favoriteToggleBtn = document.getElementById('favoriteToggleBtn');

                if (favoriteToggleBtn) {
                    // Function to update the favorite button based on current poem
                    function updateFavoriteButton() {
                        if (!favoriteToggleBtn) return;

                        const poemTitle = document.getElementById('poemTitle').textContent;
                        const poemAuthor = document.getElementById('poemAuthor').textContent;

                        if (!poemTitle || !poemAuthor) return;

                        const currentPoem = {
                            title: poemTitle,
                            auth: poemAuthor
                        };

                        const isFav = isPoemFavorite(currentPoem);

                        // Update button appearance
                        favoriteToggleBtn.innerHTML = isFav ? '❤️' : '♡';
                        favoriteToggleBtn.title = isFav ? '取消收藏' : '收藏此诗词';
                    }

                    // Add click event to the favorite toggle button
                    favoriteToggleBtn.addEventListener('click', function () {
                        const poemTitle = document.getElementById('poemTitle').textContent;
                        const poemAuthor = document.getElementById('poemAuthor').textContent;

                        if (!poemTitle || !poemAuthor) return;

                        // We need to get the full poem object to toggle favorite
                        // This will be done in the context of the currently displayed poem
                        const currentPoem = {
                            title: poemTitle,
                            auth: poemAuthor
                        };

                        // In a more complete implementation, we would have access to the full poem object
                        // For now, we'll create a temporary object with the necessary fields
                        // and update the favorites list
                        toggleFavorite(currentPoem);

                        // Update the button appearance
                        updateFavoriteButton();

                        // Show feedback to user
                        const isFav = isPoemFavorite(currentPoem);
                        const feedback = isFav ? '已收藏' : '已取消收藏';

                        // Show temporary feedback
                        const originalTitle = favoriteToggleBtn.title;
                        favoriteToggleBtn.title = feedback;
                        setTimeout(() => {
                            favoriteToggleBtn.title = originalTitle;
                            updateFavoriteButton();
                        }, 2000);
                    });

                    // Update the favorites button when poem content changes
                    // We'll call this function after a poem is displayed
                    const originalDisplayPoem = window.displayPoem || displayPoem;
                    window.displayPoem = function (poem) {
                        originalDisplayPoem.call(this, poem);
                        // Add to history after poem is displayed
                        setTimeout(() => {
                            addToHistory(poem);
                            updateFavoriteButton();
                            // Add click event to poem author to make it clickable
                            addAuthorClickEvent();
                        }, 500); // Small delay to ensure the poem is fully displayed
                    };

                    const originalShowPoemDetail = window.showPoemDetail || showPoemDetail;
                    window.showPoemDetail = function (poem) {
                        originalShowPoemDetail.call(this, poem);
                        // Add to history after poem is displayed
                        setTimeout(() => {
                            addToHistory(poem);
                            updateFavoriteButton();
                            // Add click event to poem author to make it clickable
                            addAuthorClickEvent();
                        }, 500); // Small delay to ensure the poem is fully displayed
                    };
                }
            });

            // Toggle layout between symmetric and waterfall
            function toggleLayout() {
                const symmetricContainer = document.querySelector('.poem-content');
                const waterfallContainer = document.getElementById('waterfallContainer');
                const layoutToggle = document.getElementById('layoutToggle');

                if (symmetricContainer.style.display === 'none') {
                    // Switch to symmetric layout
                    symmetricContainer.style.display = 'flex';
                    waterfallContainer.classList.remove('active');
                    layoutToggle.textContent = '瀑布流';
                    generateWaterfallContent(); // Generate waterfall content if needed
                } else {
                    // Switch to waterfall layout
                    symmetricContainer.style.display = 'none';
                    waterfallContainer.classList.add('active');
                    layoutToggle.textContent = '默认布局';
                    generateWaterfallContent(); // Generate waterfall content
                }
            }


            // Generate waterfall content from poem data
            function generateWaterfallContent() {
                const waterfallContent = document.getElementById('waterfallContent');
                // Only generate if content is not already there or if we want to refresh
                if (allCombined && allCombined.length > 0) {
                    waterfallContent.innerHTML = ''; // Clear existing content

                    // Select 12 random poems from allCombined (increased from 10)
                    const randomPoems = getRandomPoems(allCombined, 12);

                    randomPoems.forEach((poem, index) => {
                        const card = document.createElement('div');
                        card.className = 'waterfall-card';
                        card.onclick = function () {
                            showPoemDetail(poem);
                        };

                        // Analyze layout for the poem
                        const layoutInfo = analyzePoemLayout(poem);

                        // Generate lines HTML
                        let linesHtml = '';
                        layoutInfo.lines.forEach(line => {
                            if (line) linesHtml += `<div class="poem-line">${line}</div>`;
                        });

                        // Generate a random color for the background
                        const backgroundColor = getRandomColor();

                        // Limit title and author length to prevent overflow
                        let title = layoutInfo.title;
                        if (title.length > 12) {
                            title = title.substring(0, 12) + '...';
                        }

                        let author = layoutInfo.author;
                        if (author.length > 8) {
                            author = author.substring(0, 8) + '...';
                        }

                        // Determine the appropriate seal based on poem type
                        const sealText = poem.source === 'ci' ? '词' : '诗';

                        card.innerHTML = `
            <div class="color-block-container">
              <div class="color-block" style="background-color: ${backgroundColor};">
                 <!-- This class changes based on mode dynamically -->
                 <div class="overlay-text layout-${layoutInfo.mode}">
                   ${linesHtml}
                 </div>

                 <!-- Add seal decoration for aesthetic enhancement (with type-specific character) -->
                 <div class="seal-decoration">${sealText}</div>
              </div>
            </div>
            <div class="waterfall-content-section">
              <h3 class="waterfall-title">${title}</h3>
              <p class="waterfall-author">${author}</p>
            </div>
          `;
                        waterfallContent.appendChild(card);
                    });
                }
            }

            // Function to get a specified number of random poems from an array
            function getRandomPoems(poemsArray, count) {
                // Create a copy of the array to avoid modifying the original
                const arrayCopy = [...poemsArray];
                const shuffled = arrayCopy.sort(() => 0.5 - Math.random());
                // Return the first 'count' elements or all elements if array is smaller
                return shuffled.slice(0, Math.min(count, shuffled.length));
            }

            // Break text into lines with maximum specified length
            function breakTextIntoLines(text, maxLength) {
                if (!text) return '';

                // First, split by periods to ensure sentences end at periods
                const sentences = text.split('。');
                const result = [];

                for (let i = 0; i < sentences.length; i++) {
                    // Only add the period back if it wasn't the last element from a text that ended with a period
                    let sentence = sentences[i];

                    // Check if this is not the last segment or if the original text didn't end with a period
                    const isLastSegment = (i === sentences.length - 1);
                    const originalTextEndedWithPeriod = (i === sentences.length - 1 && sentence === '');

                    if (!originalTextEndedWithPeriod) {
                        sentence += '。';
                    } else {
                        // If it's an empty string because text ended with a period, skip it
                        continue;
                    }

                    // Special handling for Chinese poetry (especially 7-character verses) and long sentences
                    if (sentence.length > maxLength) {
                        // For Chinese poetry, try to break at natural boundaries
                        // If we have a 七言诗 (7-character verse), keep it as one line if possible
                        if (sentence.includes('。') && sentence.length <= maxLength + 2) {
                            // If the sentence with period is only slightly over the limit, include it
                            result.push(sentence);
                        } else {
                            // For very long sentences, break them into smaller chunks
                            let start = 0;
                            while (start < sentence.length) {
                                const chunk = sentence.substring(start, Math.min(start + maxLength, sentence.length));
                                result.push(chunk);
                                start += maxLength;
                            }
                        }
                    } else {
                        // Check if we can add this sentence to the current line without exceeding maxLength
                        if (result.length === 0) {
                            // First sentence goes directly to result
                            result.push(sentence);
                        } else {
                            const currentLine = result[result.length - 1];
                            if ((currentLine + sentence).length <= maxLength) {
                                // Add to current line if it doesn't exceed maxLength
                                result[result.length - 1] += sentence;
                            } else {
                                // Start a new line
                                result.push(sentence);
                            }
                        }
                    }
                }

                return result.join('<br>');
            }

            // Show detailed poem view when clicking a card
            function showPoemDetail(poem) {
                // 1. 设置基本信息
                document.getElementById('poemTitle').textContent = poem.title;
                document.getElementById('poemAuthor').textContent = poem.auth;

                // 优化：尝试从 type 中提取朝代，如果没有则默认显示诗词类型
                const dynastyElement = document.getElementById('poemDynasty');
                const typeSealElement = document.getElementById('mainTypeSeal');

                // Get actual dynasty from author data instead of just based on source
                const authorDynasty = getDynastyByAuthorName(poem.auth);

                if (poem.source === 'ci') {
                    dynastyElement.textContent = authorDynasty;
                    dynastyElement.style.backgroundColor = '#88485E'; // 宋词用紫红色
                    typeSealElement.textContent = '词'; // 词类型
                } else {
                    dynastyElement.textContent = authorDynasty; // Use actual author dynasty
                    dynastyElement.style.backgroundColor = '#FE2C55'; // 唐诗用小红书红
                    typeSealElement.textContent = '诗'; // 诗类型
                }

                // 2. 智能排版逻辑 (复用 analyzePoemLayout)
                // 注意：这里我们稍微改一下，如果是 analyzePoemLayout 返回 vertical，我们就用竖排
                // 但对于主展示区，我们可以稍微放宽竖排的条件（比如只要是律诗绝句都竖排，不受32字限制，因为空间大）

                const content = poem.content;
                const verseElement = document.getElementById('poemVerse');

                // 清除之前的类
                verseElement.className = 'poem-verse';

                // 简单判断：不包含逗号且句子长度整齐的，或者你是用 analyzePoemLayout
                const layoutInfo = analyzePoemLayout(poem);

                if (layoutInfo.mode === 'vertical') {
                    verseElement.classList.add('vertical-mode');
                    // 竖排时，换行符保留，且标点符号可能会影响美观，可以考虑用空格替换标点，或者保留
                    // 这里直接保留原文排版 but add line breaks at punctuation
                    verseElement.innerHTML = insertLineBreaksAtPunctuation(poem.content);
                } else {
                    verseElement.classList.add('horizontal-mode');
                    // 横排居中，适合长短句
                    // 【修改 3】 只要是格律诗（五言或七言），且行数足够，就使用成对布局
                    // 这样就能利用 .couplet-row 的 CSS 来控制间距，消灭大空行
                    if (isRegularPoem(poem) && poem.content.split('\n').length >= 2) {
                        verseElement.innerHTML = formatCoupletPoem(poem);
                    } else {
                        // 其他长短句（词）继续使用默认排版
                        verseElement.innerHTML = insertLineBreaksAtPunctuation(poem.content);
                    }
                }

                // 3. 赏析内容处理 (优先显示缓存的 AI 赏析)
                const cachedInterpretation = getInterpretationFromCache(poem.title, poem.auth);
                const descElement = document.getElementById('poemDesc');

                if (cachedInterpretation) {
                    // 如果有缓存，显示 AI 赏析
                    const separator = '<div style="border-top: 1px dashed #ddd; margin: 20px 0;"></div>';
                    const aiBadge = '<div style="display:inline-block; background:linear-gradient(90deg, #6366f1, #8b5cf6); color:white; padding:2px 8px; border-radius:12px; font-size:0.8rem; margin-bottom:10px; font-weight:bold;">✨ AI 深度赏析 <span onclick="regenerateAnalysis(event)" style="cursor:pointer; margin-left:10px; font-size:0.8em; opacity:0.8; border-bottom:1px solid white;" title="重新生成解读">🔄 重新生成</span></div>';
                    descElement.innerHTML = poem.desc + separator + aiBadge + markdownToHtml(cachedInterpretation);
                } else {
                    // 否则显示默认注释
                    descElement.innerHTML = poem.desc;
                }

                // Update the image
                const img = document.getElementById('poemImage');
                // Try to add current src to cache if it's loaded successfully
                img.onload = function () {
                    addToImageCache(img.src);
                };
                img.src = getRandomImageUrl(0);
                img.onerror = function () {
                    this.onerror = null;
                    // Try cached image first, then fallback to random image
                    const cachedImage = getRandomCachedImage();
                    if (cachedImage) {
                        this.src = cachedImage;
                    } else {
                        this.src = 'https://picsum.photos/600/400?random=' + Math.floor(Math.random() * 1000);
                    }
                };

                // Show the content sections
                document.getElementById('loading').style.display = 'none';
                document.getElementById('poemTextContent').style.display = 'block';
                document.getElementById('poemDescContent').style.display = 'block';

                // Apply fade-in animation
                document.getElementById('poemTextContent').classList.remove('fade-in');
                document.getElementById('poemDescContent').classList.remove('fade-in');
                // Trigger reflow
                void document.getElementById('poemTextContent').offsetWidth;
                void document.getElementById('poemDescContent').offsetWidth;
                document.getElementById('poemTextContent').classList.add('fade-in');
                document.getElementById('poemDescContent').classList.add('fade-in');


                // Switch to symmetric layout to show details
                const symmetricContainer = document.querySelector('.poem-content');
                const waterfallContainer = document.getElementById('waterfallContainer');
                const layoutToggle = document.getElementById('layoutToggle');

                symmetricContainer.style.display = 'flex';
                waterfallContainer.classList.remove('active');
                layoutToggle.textContent = '瀑布流';
            }

            // Copy poem to clipboard function (优化二: 添加"复制/分享"功能)
            function copyPoemToClipboard() {
                const title = document.getElementById('poemTitle').textContent;
                const author = document.getElementById('poemAuthor').textContent;
                // 获取原始文本，把 <br> 换回换行符
                const verseHtml = document.getElementById('poemVerse').innerHTML;
                const verse = verseHtml.replace(/<br\s*\/?>/gi, '\n').replace(/&nbsp;/g, ' ');

                const textToCopy = `【${title}】\n${author}\n\n${verse}\n\n---- 来自苑广山古典诗词小站`;

                navigator.clipboard.writeText(textToCopy).then(() => {
                    // 简单的提示 feedback
                    const btn = document.querySelector('button[title="复制诗词"]');
                    if (btn) {
                        const originalText = '📋'; // Store original icon
                        btn.innerHTML = '✅';

                        // Clear any existing timeouts to prevent conflicts
                        if (btn.timeoutId) {
                            clearTimeout(btn.timeoutId);
                        }

                        // Set timeout to reset the button icon
                        btn.timeoutId = setTimeout(() => {
                            btn.innerHTML = originalText;
                            btn.timeoutId = null; // Clear the reference
                        }, 2000);
                    }
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    // Optionally provide feedback to user
                    const btn = document.querySelector('button[title="复制诗词"]');
                    if (btn) {
                        btn.innerHTML = '❌';
                        if (btn.timeoutId) {
                            clearTimeout(btn.timeoutId);
                        }
                        btn.timeoutId = setTimeout(() => {
                            btn.innerHTML = '📋';
                            btn.timeoutId = null;
                        }, 2000);
                    }
                });
            }

            // New: intelligent poem layout analysis
            function analyzePoemLayout(poem) {
                const content = poem.content.replace(/\s+/g, ''); // Remove whitespace
                const sentences = content.split(/[。！？!?]/).filter(s => s.trim() !== '');

                // 1. Check if it's a 5-character or 7-character regulated verse (整齐的格律)
                // Simple check: see if the first line length is 5 or 7
                const firstLineLen = sentences[0] ? sentences[0].replace(/[，,]/g, '').length : 0;
                const isRegular = (firstLineLen === 5 || firstLineLen === 7) &&
                    sentences.every(s => {
                        const cleanLen = s.replace(/[，,]/g, '').length;
                        return cleanLen === firstLineLen * 2 || cleanLen === firstLineLen;
                    });

                let displayLines = [];
                let layoutMode = 'horizontal'; // Default horizontal layout

                if (isRegular && content.length <= 32) {
                    // 2. If it's a short 5/7-character poem (like a jueju), suitable for vertical display
                    layoutMode = 'vertical';
                    // Split the poem into lines by punctuation
                    displayLines = content.split(/[，。！？!?]/).filter(s => s.trim() !== '');
                } else {
                    // 3. If it's a long poem or ci (with uneven lines), just show a random couplet
                    // Prefer selecting middle sentences, avoid very short ones
                    const validCouplets = [];
                    // Try splitting by sentence punctuation, then by commas for couplets
                    for (let s of sentences) {
                        const parts = s.split(/[，,]/);
                        if (parts.length >= 2) {
                            // This is a complete sentence with commas, likely a couplet
                            if (parts[0].length + parts[1].length < 20) { // Limit length
                                validCouplets.push(parts[0] + '，' + parts[1]);
                            }
                        }
                    }

                    if (validCouplets.length > 0) {
                        // Randomly take a couplet
                        const randomCouplet = validCouplets[Math.floor(Math.random() * validCouplets.length)];
                        // Replace commas with line breaks for display
                        displayLines = randomCouplet.split(/[，,]/);
                        layoutMode = 'horizontal-center'; // Quote mode suitable for center alignment
                    } else {
                        // Fallback: take first two sentences
                        if (sentences.length >= 2) {
                            displayLines = [sentences[0].split(/[，,]/)[0] || '', sentences[0].split(/[，,]/)[1] || ''];
                        } else if (sentences.length === 1) {
                            const parts = sentences[0].split(/[，,]/);
                            displayLines = [parts[0] || '', parts[1] || ''];
                        } else {
                            displayLines = ['诗词内容', '诗词内容'];
                        }
                        layoutMode = 'horizontal-center';
                    }
                }

                return {
                    lines: displayLines,
                    mode: layoutMode,
                    title: poem.title,
                    author: poem.auth
                };
            }

            // Function to refresh content based on current layout
            function refreshContent() {
                const waterfallContainer = document.getElementById('waterfallContainer');

                if (waterfallContainer.classList.contains('active')) {
                    // If in waterfall layout, refresh the waterfall content with new random poems
                    generateWaterfallContent();
                } else {
                    // If in symmetric layout, load a new random poem
                    // Make sure to respect the currently filtered poems if any author is selected
                    loadRandomPoem();
                }
            }

            // Function to get AI interpretation of the poem
            async function getPoemInterpretation() {
                const title = document.getElementById('poemTitle').textContent;
                const author = document.getElementById('poemAuthor').textContent;
                const verse = document.getElementById('poemVerse').textContent;
                const desc = document.getElementById('poemDesc').textContent;

                // Show loading state
                const searchBtn = document.getElementById('ai-interpret-btn');
                const originalContent = searchBtn.innerHTML;
                searchBtn.innerHTML = '🔄';
                searchBtn.disabled = true;

                try {
                    // Create a prompt for the AI
                    const prompt = `请为以下古诗词提供深度解读和赏析，使用Markdown格式输出，包含以下部分：
1. 诗词背景与作者心境
2. 逐句解析（如果诗句较短可合并解析）
3. 艺术手法与修辞特点
4. 主题思想与情感内涵
5. 文学价值与影响

诗词题目：${title}
作者：${author}
诗词内容：
${verse}

原注释：${desc}

请以标准Markdown格式返回，确保格式正确，段落清晰。`;

                    // Call the real AI API to get poem interpretation
                    const interpretation = await getRealPoemInterpretation(title, author, verse, desc);

                    // Prepare poem info for the new page
                    const poemInfo = {
                        title: title,
                        author: author,
                        dynasty: getDynastyFromSource(), // You'll need to define this function
                        type: getPoemType() // You'll need to define this function
                    };

                    // Show interpretation in modal instead of opening new page
                    showInterpretationModal(interpretation, poemInfo);

                } catch (error) {
                    console.error('Error getting poem interpretation:', error);
                    alert('获取诗词解读失败，请稍后重试');
                } finally {
                    // Restore button
                    searchBtn.innerHTML = originalContent;
                    searchBtn.disabled = false;
                }
            }

            // Configuration for API
            const API_DOMAIN = 'https://aiproxy.want.biz/';
            const API_PREFIX = API_DOMAIN.replace(/\/+$/, '');
            const DEFAULT_TIMEOUT = 120; // 秒

            const MODELS = [
                { id: 'gemini-pro-latest', name: '💎Pro' },
                { id: 'gemini-flash-lite-latest', name: '⚡️Flash' },
                { id: 'kimi-k2-0905-preview', name: '🛰️K2' },
                { id: 'deepseek-reasoner', name: '✈️DS' },
            ];
            const DEFAULT_MODEL_ID = 'gemini-flash-lite-latest';

            // Core prompt template configuration
            const PROMPT_TEMPLATES = {
                '深度': '请对以下内容进行全面且深入的分析,结构化地呈现观点。首先提出核心论点，然后分点展开详细论述，并结合相关背景知识或案例。文章风格要求专业、严谨，篇幅不少于3000字。请将最终输出格式化为**Markdown**。',
                '文章': '你是一位感情细腻的作家，思想睿智，能够从不同角度发掘题材的新颖角度，善于观察，勤于思考，善用修辞手法，如无特殊说明，一般不少于2000字，写作风格请务必要借鉴余秋雨和吴晓波的风格，越相似越好。文章完成后起一个适合发表在自媒体上的标题，不多于40字，标题格式为：# 标题，放在第一行，第二行开始为正文内容。请将最终输出格式化为**Markdown**。',
                '翻译': '你是一位资深的中英双语翻译，如果是中文，请将其翻译为准确的英文，如果是英文请翻译为中文。如果翻译后的英文中有不易理解的单词，请解释清楚。请将最终输出格式化为**Markdown**。',
                '诗词': '请为以下古诗词提供深度解读和赏析，使用Markdown格式输出，包含以下部分：1. 诗词背景与作者心境 2. 逐句解析（如果诗句较短可合并解析） 3. 艺术手法与修辞特点 4. 主题思想与情感内涵 5. 文学价值与影响'
                // ... Other templates can be added as needed, but the core requirement is to return Markdown
            };
            const DEFAULT_TEMPLATE_KEY = '诗词';

            // Tool functions
            function toDisplayString(any) {
                if (any == null) return '';
                if (typeof any === 'string') return any;
                try { return JSON.stringify(any, null, 2); } catch { return String(any); }
            }

            // API wrapper
            async function requestJSON(method, path, payload) {
                const url = `${API_PREFIX}${path.startsWith('/') ? path : `/${path}`}`;

                // Use fetch API in browser environment
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), DEFAULT_TIMEOUT * 1000);

                try {
                    const response = await fetch(url, {
                        method: method,
                        headers: { 'Content-Type': 'application/json', Accept: 'application/json' },
                        body: payload ? JSON.stringify(payload) : null,
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        let errorData = {};
                        try {
                            errorData = await response.json();
                        } catch {
                            errorData = { message: await response.text() };
                        }
                        throw new Error(`API请求失败 (HTTP ${response.status}): ${errorData.error?.message || toDisplayString(errorData)}`);
                    }
                    return await response.json();
                } catch (e) {
                    clearTimeout(timeoutId);
                    if (e.name === 'AbortError') {
                        throw new Error(`网络请求超时 (超过 ${DEFAULT_TIMEOUT} 秒)`);
                    }
                    throw new Error(`网络或API错误: ${e.message}`);
                }
            }

            // Helper to regenerate analysis
            async function regenerateAnalysis(event) {
                if (event) event.stopPropagation();

                const title = document.getElementById('poemTitle').textContent;
                const author = document.getElementById('poemAuthor').textContent;
                const verse = document.getElementById('poemVerse').innerText; // Use innerText to get text content
                // Note: poemDesc might contain the AI analysis now, so we should try to get the original desc if possible.
                // But for regeneration, the prompt mainly needs title, author, and verse. 
                // The 'desc' in prompt is 'Original Annotation', which we might lose if we just read poemDesc.
                // Ideally we should store the current poem object globally or fetch it again.
                // For simplicity, we'll try to extract the part before the separator if it exists, or just use what's there.
                let desc = document.getElementById('poemDesc').innerHTML;
                if (desc.includes('border-top: 1px dashed #ddd')) {
                    desc = desc.split('<div style="border-top: 1px dashed #ddd')[0];
                }

                const descElement = document.getElementById('poemDesc');
                // Show loading state
                const separator = '<div style="border-top: 1px dashed #ddd; margin: 20px 0;"></div>';
                const loadingBadge = '<div style="display:inline-block; background:linear-gradient(90deg, #6366f1, #8b5cf6); color:white; padding:2px 8px; border-radius:12px; font-size:0.8rem; margin-bottom:10px; font-weight:bold;">✨ AI 正在重新思考...</div>';
                descElement.innerHTML = desc + separator + loadingBadge + '<div class="loading-spinner" style="margin: 20px auto;"></div>';

                try {
                    // Force refresh = true
                    const result = await getRealPoemInterpretation(title, author, verse, desc, true);

                    // Update UI
                    const aiBadge = '<div style="display:inline-block; background:linear-gradient(90deg, #6366f1, #8b5cf6); color:white; padding:2px 8px; border-radius:12px; font-size:0.8rem; margin-bottom:10px; font-weight:bold;">✨ AI 深度赏析 <span onclick="regenerateAnalysis(event)" style="cursor:pointer; margin-left:10px; font-size:0.8em; opacity:0.8; border-bottom:1px solid white;" title="重新生成解读">🔄 重新生成</span></div>';
                    descElement.innerHTML = desc + separator + aiBadge + markdownToHtml(result);

                } catch (error) {
                    console.error("Regeneration failed:", error);
                    descElement.innerHTML = desc + separator + `<div style="color:red;">重新生成失败: ${error.message}</div>`;
                }
            }

            // Core AI call interface
            async function explainText(text, model) {
                // Assuming the AI service exposes the endpoint at /ai/explain
                return await requestJSON('POST', '/ai/explain', { text, model });
            }

            // Cache configuration for AI interpretations
            const AI_CACHE_KEY = 'poem_ai_interpretations_v1';

            // Helper to get interpretation from cache
            function getInterpretationFromCache(title, author) {
                try {
                    const cache = localStorage.getItem(AI_CACHE_KEY);
                    if (!cache) return null;

                    const cacheObj = JSON.parse(cache);
                    const key = `${title}-${author}`;
                    return cacheObj[key] || null;
                } catch (e) {
                    console.error('Error reading from cache:', e);
                    return null;
                }
            }

            // Helper to save interpretation to cache
            function saveInterpretationToCache(title, author, content) {
                try {
                    const cache = localStorage.getItem(AI_CACHE_KEY);
                    let cacheObj = {};
                    if (cache) {
                        cacheObj = JSON.parse(cache);
                    }

                    const key = `${title}-${author}`;
                    cacheObj[key] = content;

                    localStorage.setItem(AI_CACHE_KEY, JSON.stringify(cacheObj));
                    console.log(`Saved interpretation for ${title} to cache`);
                } catch (e) {
                    console.error('Error saving to cache:', e);
                }
            }

            // Main function to get AI interpretation of the poem
            async function getRealPoemInterpretation(title, author, verse, desc, forceRefresh = false) {
                // 1. Check cache first (unless forced refresh)
                if (!forceRefresh) {
                    const cachedInterpretation = getInterpretationFromCache(title, author);
                    if (cachedInterpretation) {
                        console.log(`[Poetry AI] Found cached interpretation for ${title}`);
                        return cachedInterpretation;
                    }
                }

                const finalSystemPrompt = PROMPT_TEMPLATES['诗词'] || PROMPT_TEMPLATES[DEFAULT_TEMPLATE_KEY];

                const textToInterpret = `诗词题目：${title}
作者：${author}
诗词内容：
${verse}

原注释：${desc}`;

                // Combine final text to send to the model: system instruction + separator + user input
                const finalText = finalSystemPrompt ? `${finalSystemPrompt}\n\n---\n\n${textToInterpret.trim()}` : textToInterpret.trim();

                console.log(`[Poetry AI] 正在使用模型: ${DEFAULT_MODEL_ID} 进行处理...`);

                try {
                    const resultData = await explainText(finalText, DEFAULT_MODEL_ID);

                    // The API now returns data in a structure with an 'explanation' field, fallback to 'data', 'text', or the result directly
                    const markdownResult = resultData.explanation || resultData.data || resultData.text || resultData;

                    if (typeof markdownResult !== 'string' || !markdownResult.trim()) {
                        throw new Error(`API返回结果格式不正确，未找到有效的文本内容。Raw: ${toDisplayString(resultData)}`);
                    }

                    const finalResult = markdownResult.trim();

                    // 2. Save to cache on success
                    saveInterpretationToCache(title, author, finalResult);

                    return finalResult;

                } catch (error) {
                    console.error("[Poetry AI] 错误:", error);
                    // Also package error message in Markdown format for display
                    return `**AI 诗词解读失败**\n\n错误详情:\n\`\`\`\n${error.message}\n\`\`\`\n请检查 API 域名 (${API_PREFIX}) 和模型配置是否正确。`;
                }
            }

            // Helper function to get dynasty from source (you'll need to adapt this to your data structure)
            function getDynastyFromSource() {
                // This should get the dynasty from the current poem data
                // For now returning a generic value
                const dynastyElement = document.getElementById('poemDynasty');
                return dynastyElement ? dynastyElement.textContent : '未知';
            }

            // Helper function to get poem type
            function getPoemType() {
                // This should get the poem type (诗/词)
                const typeSealElement = document.getElementById('mainTypeSeal');
                return typeSealElement ? typeSealElement.textContent : '诗词';
            }

            // Function to display interpretation in modal
            function showInterpretationModal(interpretation, poemInfo) {
                // Update modal title with poem info
                document.getElementById('modalTitle').innerHTML = `诗词解读`;

                // Convert markdown to HTML and display content
                document.getElementById('interpretationContent').innerHTML = markdownToHtml(interpretation);

                // Show the modal
                document.getElementById('interpretationModal').style.display = 'flex';
            }

            // Function to close the modal
            function closeInterpretationModal() {
                document.getElementById('interpretationModal').style.display = 'none';
            }

            // Function to copy modal content
            function copyModalContent() {
                // Get poem information
                const title = document.getElementById('poemTitle').textContent;
                const author = document.getElementById('poemAuthor').textContent;
                const dynasty = document.getElementById('poemDynasty').textContent;

                // Get poem verse content
                const verseHtml = document.getElementById('poemVerse').innerHTML;
                const verse = verseHtml.replace(/<br\s*\/?>/gi, '\n').replace(/&nbsp;/g, ' ');

                // Get interpretation content
                const contentToCopy = document.getElementById('interpretationContent').innerText;

                // Combine poem info with interpretation
                const fullContent = `【${title}】\n${dynasty}·${author}\n\n${verse}\n\n${contentToCopy}\n\n---- 来自苑广山古典诗词小站`;

                navigator.clipboard.writeText(fullContent)
                    .then(() => {
                        // Show temporary success message
                        const copyBtn = document.getElementById('copyModalBtn');
                        const originalText = copyBtn.innerHTML;
                        copyBtn.innerHTML = '✓';

                        setTimeout(() => {
                            copyBtn.innerHTML = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('复制失败:', err);
                        alert('复制失败，请手动选择文本进行复制');
                    });
            }

            // Function to copy author information
            function copyAuthorInfo() {
                // Get the current author name from the modal
                const authorName = document.querySelector('.author-name-large')?.textContent?.split(' ')[0] || '未知作者';

                // Get all the author information from the modal
                const authorTitles = Array.from(document.querySelectorAll('.author-title-tag')).map(tag => tag.textContent).join(', ');
                const authorLife = document.querySelector('.author-life')?.textContent?.replace('生卒年：', '') || '';
                const authorBio = document.querySelector('.author-text')?.textContent || '';
                const authorAchievements = document.querySelectorAll('.author-text')[1]?.textContent || '';
                const authorStyle = document.querySelectorAll('.author-text')[2]?.textContent || '';

                // Get all works
                const works = Array.from(document.querySelectorAll('.author-work-item')).map(item => {
                    const title = item.querySelector('.work-title')?.textContent || '';
                    const line = item.querySelector('.work-line')?.textContent || '';
                    return `${title}: ${line}`;
                }).join('\n');

                // Combine all information
                let fullContent = `【${authorName} 作者介绍】\n\n`;

                if (authorTitles) {
                    fullContent += `称号: ${authorTitles}\n`;
                }

                if (authorLife) {
                    fullContent += `生卒年: ${authorLife}\n`;
                }

                fullContent += `\n【生平简介】\n${authorBio}\n`;

                if (authorAchievements) {
                    fullContent += `\n【文学成就】\n${authorAchievements}\n`;
                }

                if (authorStyle) {
                    fullContent += `\n【风格特点】\n${authorStyle}\n`;
                }

                if (works) {
                    fullContent += `\n【代表作品】\n${works}\n`;
                }

                fullContent += `\n---- 来自苑广山古典诗词小站`;

                navigator.clipboard.writeText(fullContent)
                    .then(() => {
                        // Show temporary success message
                        const copyBtn = document.getElementById('copyAuthorModalBtn');
                        const originalText = copyBtn.innerHTML;
                        copyBtn.innerHTML = '✓';

                        setTimeout(() => {
                            copyBtn.innerHTML = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('作者信息复制失败:', err);
                        alert('作者信息复制失败，请手动选择文本进行复制');
                    });
            }

            // Function to convert markdown to HTML (simplified version)
            function markdownToHtml(md) {
                if (!md) return '';

                // Simple markdown conversion
                let html = md
                    // Headers
                    .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                    .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                    .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                    // Bold
                    .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
                    // Italic
                    .replace(/\*(.*)\*/gim, '<em>$1</em>')
                    // Links
                    .replace(/\[(.*?)\]\((.*?)\)/gim, '<a href="$2">$1</a>')
                    // Code blocks
                    .replace(/```([\s\S]*?)```/gim, '<pre><code>$1</code></pre>')
                    // Inline code
                    .replace(/`(.*?)`/gim, '<code>$1</code>')
                    // Blockquotes
                    .replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>')
                    // Unordered lists
                    .replace(/^\- (.*$)/gim, '<li>$1</li>')
                    // Ordered lists (need to handle numbering)
                    .replace(/^\d+\. (.*$)/gim, '<li>$1</li>')
                    // Paragraphs (replace double newlines)
                    .replace(/\n\n/gim, '</p><p>')
                    .replace(/\n/gim, '<br>');

                // Clean up
                html = html.replace(/<p><\/p>/gim, '');
                html = `<p>${html}</p>`;

                // Handle lists - wrap in ul/ol tags
                html = html.replace(/<p><li>/gim, '<ul><li>')
                    .replace(/<\/li><\/p>/gim, '</li></ul>')
                    .replace(/<\/li><li>/gim, '</li><li>');

                // Handle ordered lists
                html = html.replace(/<p><li>/gim, '<ol><li>')
                    .replace(/<\/li><\/p>/gim, '</li></ol>');

                return html;
            }

            // Add event listener to the AI interpretation button
            document.addEventListener('DOMContentLoaded', function () {
                const aiInterpretBtn = document.getElementById('ai-interpret-btn');
                if (aiInterpretBtn) {
                    aiInterpretBtn.addEventListener('click', getPoemInterpretation);
                }

                // Add event listeners for modal
                document.getElementById('closeModalBtn').addEventListener('click', closeInterpretationModal);
                document.getElementById('copyModalBtn').addEventListener('click', copyModalContent);

                // Add event listeners for author modal
                const copyAuthorModalBtn = document.getElementById('copyAuthorModalBtn');
                if (copyAuthorModalBtn) {
                    copyAuthorModalBtn.addEventListener('click', copyAuthorInfo);
                }

                // Close modal when clicking on overlay
                document.getElementById('interpretationModal').addEventListener('click', function (e) {
                    if (e.target === this) {
                        closeInterpretationModal();
                    }
                });

                // Add scroll event listener for auto-refresh functionality (only in waterfall mode)
                let isRefreshing = false; // Prevent multiple simultaneous refreshes
                let lastScrollTop = 0;
                let hasReachedBottom = false; // Flag to track if user reached bottom

                window.addEventListener('scroll', function () {
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    const waterfallContainer = document.getElementById('waterfallContainer');

                    // Only enable auto-refresh in waterfall mode
                    if (waterfallContainer.classList.contains('active')) {
                        // Check if user has reached near the bottom of the page
                        if ((window.scrollY + window.innerHeight) >= document.body.offsetHeight - 50) {
                            hasReachedBottom = true;
                        } else {
                            // Only reset if scrolling down away from bottom
                            if (scrollTop > lastScrollTop) {
                                hasReachedBottom = false;
                            }
                        }

                        // Check if user was at bottom and started scrolling down (away from bottom)
                        if (hasReachedBottom && scrollTop > lastScrollTop && lastScrollTop > 0) {
                            if (!isRefreshing) {
                                isRefreshing = true;

                                // Add slight delay to avoid triggering during page load animations
                                setTimeout(async function () {
                                    // Waterfall mode: add 10 more poems
                                    await addMorePoemsToWaterfall();

                                    // Reset flags after successful refresh
                                    hasReachedBottom = false;
                                    isRefreshing = false;
                                }, 100);
                            }
                        }
                    }

                    // Update last scroll position
                    lastScrollTop = scrollTop;
                });
            });

            // Function to add more poems to waterfall (10 at a time)
            async function addMorePoemsToWaterfall() {
                if (!allCombined || allCombined.length === 0) {
                    await fetchAndCombineAll();
                }

                const waterfallContent = document.getElementById('waterfallContent');

                // Select 10 random poems to add
                const randomPoems = getRandomPoems(allCombined, 10);

                randomPoems.forEach((poem, index) => {
                    const card = document.createElement('div');
                    card.className = 'waterfall-card';
                    card.onclick = function () {
                        showPoemDetail(poem);
                    };

                    // Analyze layout for the poem
                    const layoutInfo = analyzePoemLayout(poem);

                    // Generate lines HTML
                    let linesHtml = '';
                    layoutInfo.lines.forEach(line => {
                        if (line) linesHtml += `<div class="poem-line">${line}</div>`;
                    });

                    // Generate a random color for the background
                    const backgroundColor = getRandomColor();

                    // Limit title and author length to prevent overflow
                    let title = layoutInfo.title;
                    if (title.length > 12) {
                        title = title.substring(0, 12) + '...';
                    }

                    let author = layoutInfo.author;
                    if (author.length > 8) {
                        author = author.substring(0, 8) + '...';
                    }

                    // Determine the appropriate seal based on poem type
                    const sealText = poem.source === 'ci' ? '词' : '诗';

                    card.innerHTML = `
        <div class="color-block-container">
          <div class="color-block" style="background-color: ${backgroundColor};">
             <!-- This class changes based on mode dynamically -->
             <div class="overlay-text layout-${layoutInfo.mode}">
               ${linesHtml}
             </div>

             <!-- Add seal decoration for aesthetic enhancement (with type-specific character) -->
             <div class="seal-decoration">${sealText}</div>
          </div>
        </div>
        <div class="waterfall-content-section">
          <h3 class="waterfall-title">${title}</h3>
          <p class="waterfall-author">${author}</p>
        </div>
      `;
                    waterfallContent.appendChild(card);
                });
            }
                        // Author Modal Logic
                    
                    // Function to show author info
                    function showAuthorInfo(authorName) {
                        console.log('Showing info for:', authorName);
                        const author = window.AUTHOR_DATA.find(a => a.name === authorName);
                        
                        if (!author) {
                            console.log('No info found for author:', authorName);
                            return;
                        }

                        const authorModal = document.getElementById('authorModal');
                        const authorModalContent = document.getElementById('authorModalContent');
                        
                        if (!authorModal || !authorModalContent) {
                            console.error('Author modal elements not found!');
                            return;
                        }

                        // Build modal content
                        let titlesHtml = author.titles.map(t => `<span class="author-title-tag">${t}</span>`).join('');
                        let tagsHtml = author.tags.map(t => `<span class="author-title-tag" style="background: #e0f2f1; color: #00695c;">${t}</span>`).join('');
                        
                        let worksHtml = author.works.map(w => `
                            <li class="author-work-item">
                                <div class="work-title">《${w.title}》</div>
                                <div class="work-line">${w.line}</div>
                            </li>
                        `).join('');

                        const html = `
                            <div class="author-header">
                                <div class="author-avatar">${author.name[0]}</div>
                                <div class="author-basic-info">
                                    <div class="author-name-large">${author.name} <span style="font-size: 1rem; font-weight: normal; color: #666;">(${author.dynasty})</span></div>
                                    <div class="author-titles">${titlesHtml}</div>
                                    <div class="author-titles" style="margin-top: 5px;">${tagsHtml}</div>
                                    <div class="author-life" style="margin-top: 5px;">生卒年：${author.life_span}</div>
                                </div>
                            </div>
                            
                            <div class="author-section">
                                <div class="author-section-title">生平简介</div>
                                <div class="author-text">${author.bio}</div>
                            </div>
                            
                            <div class="author-section">
                                <div class="author-section-title">文学成就</div>
                                <div class="author-text">${author.achievements}</div>
                            </div>
                            
                            <div class="author-section">
                                <div class="author-section-title">风格特点</div>
                                <div class="author-text">${author.style}</div>
                            </div>
                            
                            <div class="author-section">
                                <div class="author-section-title">代表作品</div>
                                <ul class="author-works-list">
                                    ${worksHtml}
                                </ul>
                            </div>
                        `;

                        authorModalContent.innerHTML = html;
                        
                        // Show modal with high z-index
                        authorModal.style.zIndex = '2001'; 
                        authorModal.style.display = 'flex';
                        // Force reflow
                        void authorModal.offsetWidth;
                        authorModal.style.opacity = '1';
                        authorModal.style.visibility = 'visible';
                    }

                    // Function to add click event to author element
                    function addAuthorClickEvent() {
                        const poemAuthorElement = document.getElementById('poemAuthor');
                        if (poemAuthorElement) {
                            // Remove any existing event listeners to avoid duplicates
                            poemAuthorElement.onclick = null;

                            // Add click event to poem author to show author info
                            poemAuthorElement.addEventListener('click', function() {
                                const authorName = this.textContent.trim();
                                if (authorName) {
                                    showAuthorInfo(authorName);
                                }
                            });

                            // Add CSS to make it look clickable
                            poemAuthorElement.style.cursor = 'pointer';
                            poemAuthorElement.style.transition = 'all 0.2s';
                            poemAuthorElement.style.borderBottom = '1px dashed transparent';

                            // Add hover effect
                            poemAuthorElement.addEventListener('mouseenter', function() {
                                this.style.color = 'var(--xhs-pink)';
                                this.style.borderBottomColor = 'var(--xhs-pink)';
                            });

                            poemAuthorElement.addEventListener('mouseleave', function() {
                                this.style.color = '';
                                this.style.borderBottomColor = 'transparent';
                            });
                        }
                    }

                    // Initialize modal events when DOM is ready
                    document.addEventListener('DOMContentLoaded', function() {
                        const authorModal = document.getElementById('authorModal');
                        const closeAuthorModalBtn = document.getElementById('closeAuthorModalBtn');
                        
                        // Close modal event
                        if (closeAuthorModalBtn && authorModal) {
                            closeAuthorModalBtn.addEventListener('click', () => {
                                authorModal.style.display = 'none';
                                authorModal.style.opacity = '0';
                                setTimeout(() => {
                                    authorModal.style.visibility = 'hidden';
                                }, 300);
                            });
                        }

                        // Close on outside click
                        if (authorModal) {
                            window.addEventListener('click', (e) => {
                                if (e.target === authorModal) {
                                    authorModal.style.display = 'none';
                                    authorModal.style.opacity = '0';
                                    setTimeout(() => {
                                        authorModal.style.visibility = 'hidden';
                                    }, 300);
                                }
                            });
                        }
                        
                        // Add visual cue style dynamically
                        const style = document.createElement('style');
                        style.innerHTML = `
                            #poemAuthor { cursor: pointer !important; }
                            #authorModal { z-index: 2001 !important; }
                        `;
                        document.head.appendChild(style);
                    });
                </script>

        <!-- AI Interpretation Modala -->
        <div id="interpretationModal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle" class="modal-title">诗词解读</h2>
                    <div class="modal-actions">
                        <button id="copyModalBtn" class="copy-modal-btn" title="复制内容">📋</button>
                        <button id="closeModalBtn" class="close-modal-btn" title="关闭">×</button>
                    </div>
                </div>
                <div id="interpretationContent" class="interpretation-content"></div>
            </div>
        </div>

        <!-- Modal Styles -->
        <style>
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                backdrop-filter: blur(5px);
            }

            .modal-content {
                background: var(--container-bg);
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                width: 90%;
                max-width: 900px;
                max-height: 90vh;
                display: flex;
                flex-direction: column;
                overflow: hidden;
                position: relative;
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 20px 25px 15px;
                border-bottom: 1px solid var(--border-color);
                background: var(--container-bg);
                border-radius: 20px 20px 0 0;
            }

            .modal-title {
                margin: 0;
                font-size: 1.5rem;
                color: var(--xhs-pink);
                font-family: 'Noto Serif SC', serif;
            }

            .modal-actions {
                display: flex;
                gap: 15px;
            }

            .close-modal-btn,
            .copy-modal-btn {
                background: var(--bg-lighter);
                border: none;
                width: 36px;
                height: 36px;
                border-radius: 50%;
                font-size: 1.2rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--text-primary);
                transition: all 0.3s ease;
            }

            .close-modal-btn:hover,
            .copy-modal-btn:hover {
                background: var(--xhs-pink-lighter);
                color: white;
                transform: scale(1.1);
            }

            .interpretation-content {
                padding: 25px;
                overflow-y: auto;
                max-height: calc(90vh - 150px);
                line-height: 1.7;
                font-size: 1.1rem;
            }

            .interpretation-content h1,
            .interpretation-content h2,
            .interpretation-content h3,
            .interpretation-content h4,
            .interpretation-content h5,
            .interpretation-content h6 {
                margin-top: 1.5em;
                margin-bottom: 0.8em;
                color: var(--text-primary);
                font-family: 'Noto Serif SC', serif;
            }

            .interpretation-content h1 {
                font-size: 1.8em;
                border-bottom: 2px solid var(--xhs-pink-lighter);
                padding-bottom: 0.3em;
            }

            .interpretation-content h2 {
                font-size: 1.6em;
                border-bottom: 1px solid var(--border-color);
                padding-bottom: 0.3em;
            }

            .interpretation-content h3 {
                font-size: 1.4em;
            }

            .interpretation-content p {
                margin-bottom: 1em;
                text-align: justify;
            }

            .interpretation-content ul,
            .interpretation-content ol {
                margin: 1em 0;
                padding-left: 1.5em;
            }

            .interpretation-content li {
                margin: 0.5em 0;
            }

            .interpretation-content blockquote {
                margin: 1.5em 0;
                padding: 1em 1.5em;
                border-left: 4px solid var(--xhs-pink-lighter);
                background-color: var(--xhs-pink-pale);
                font-style: italic;
            }

            .interpretation-content code {
                background-color: var(--bg-light);
                padding: 0.2em 0.4em;
                border-radius: 3px;
                font-family: monospace;
                font-size: 0.9em;
            }

            .interpretation-content pre {
                background-color: var(--bg-light);
                padding: 1.5em;
                border-radius: 8px;
                overflow-x: auto;
                margin: 1.5em 0;
            }

            .interpretation-content pre code {
                background: none;
                padding: 0;
            }

            .interpretation-content a {
                color: #4da6ff;
                text-decoration: underline;
            }

            .interpretation-content a:hover {
                color: #66b3ff;
            }
        </style>
    <!-- Author Info Modal -->
    <div id="authorModal" class="modal-overlay" style="display: none;">
        <div class="modal-content author-modal-content">
            <div class="modal-header">
                <h2 id="authorModalTitle" class="modal-title">作者介绍</h2>
                <div class="modal-actions">
                    <button id="copyAuthorModalBtn" class="copy-modal-btn" title="复制作者信息">📋</button>
                    <button id="closeAuthorModalBtn" class="close-modal-btn" title="关闭">×</button>
                </div>
            </div>
            <div id="authorModalContent" class="author-modal-body">
                <!-- Content will be dynamically populated -->
            </div>
        </div>
    </div>

    <!-- Author Modal Styles -->
    <style>
        .author-modal-content {
            max-width: 600px !important;
            background: var(--container-bg);
            display: flex;
            flex-direction: column;
        }

        .author-modal-body {
            padding: 5px 25px 25px 25px; /* Add proper left/right spacing and bottom padding */
            max-height: calc(90vh - 150px); /* Account for header height */
            overflow-y: auto; /* Enable vertical scrolling */
            flex: 1;
            line-height: 1.6;
        }

        .author-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        .author-avatar {
            width: 80px;
            height: 80px;
            background: var(--xhs-pink-pale);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--xhs-pink);
            margin-right: 20px;
            border: 3px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .author-basic-info {
            flex: 1;
        }

        .author-name-large {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-family: 'Noto Serif SC', serif;
        }

        .author-titles {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 5px;
        }

        .author-title-tag {
            background: var(--xhs-pink-pale);
            color: var(--xhs-pink);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .author-life {
            color: var(--text-tertiary);
            font-size: 0.9rem;
        }

        .author-section {
            margin-bottom: 20px;
        }

        .author-section-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 10px;
            border-left: 4px solid var(--xhs-pink);
            padding-left: 10px;
        }

        .author-text {
            line-height: 1.6;
            color: var(--text-secondary);
            font-size: 0.95rem;
            text-align: justify;
        }

        .author-works-list {
            list-style: none;
            padding: 0;
        }

        .author-work-item {
            background: var(--bg-lighter);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid var(--xhs-pink-light);
        }

        .work-title {
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .work-line {
            color: var(--text-tertiary);
            font-size: 0.9rem;
            font-style: italic;
        }
        
        /* Make author name clickable */
        #poemAuthor {
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px dashed transparent;
        }
        
        #poemAuthor:hover {
            color: var(--xhs-pink);
            border-bottom-color: var(--xhs-pink);
        }
    </style>
</body>

</html>