<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>今日一言 - 书签样式</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* 渐变背景 */
        .gradient-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e6e9e9 0%, #a3b5bf 100%);
            transition: background 1s ease;
            z-index: -1;
        }
        
        /* 顶部导航栏 */
        .nav-bar {
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 0 16px;
        }
        
        .nav-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        
        .back-button {
            position: absolute;
            left: 16px;
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .back-button svg {
            width: 24px;
            height: 24px;
            fill: #333;
        }
        
        /* 主内容区 */
        .content-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }
        
        /* 书签样式卡片 */
        .calligraphy-view {
            background-color: rgba(255, 255, 255, 0.85);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 0.5px solid #D0D0D0;
            width: 280px;
            height: 500px;
            position: relative;
            display: flex;
            flex-direction: column;
            margin-bottom: 70px;
            overflow: hidden;
        }
        
        /* 左上角竖向小方块装饰 */
        .square-decorations {
            position: absolute;
            top: 25px;
            left: 25px;
            display: flex;
            flex-direction: column;
            z-index: 3;
        }
        
        .square {
            width: 10px;
            height: 10px;
            margin-bottom: 5px;
            transition: background-color 0.5s ease;
        }
        
        /* 初始颜色，将在JS中动态改变 */
        .square-1 { background-color: rgba(200, 50, 50, 0.7); }
        .square-2 { background-color: rgba(50, 150, 50, 0.7); }
        .square-3 { background-color: rgba(50, 50, 200, 0.7); }
        .square-4 { background-color: rgba(200, 150, 50, 0.7); }
        .square-5 { background-color: rgba(150, 50, 150, 0.7); }
        
        /* 书签底部几何渐变效果 */
        .geometric-decoration {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 120px;
            z-index: 1;
            overflow: hidden;
        }
        
        .geo-shape {
            position: absolute;
            opacity: 0.1;
        }
        
        .geo-shape-1 {
            bottom: -30px;
            left: -30px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #505050;
        }
        
        .geo-shape-2 {
            bottom: -50px;
            right: -20px;
            width: 100px;
            height: 100px;
            background: #505050;
            transform: rotate(45deg);
        }
        
        .geo-shape-3 {
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 30px;
            background: #505050;
            opacity: 0.05;
        }
        
        /* 竖排文字区域 */
        .quote-container {
            flex: 1;
            padding: 30px 30px 30px 30px;
            display: flex;
            justify-content: flex-end;
            overflow: hidden;
            position: relative;
            z-index: 2;
        }
        
        /* 竖排文字 */
        .vertical-text {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-size: 28px;
            color: #333;
            line-height: 1.6;
            letter-spacing: 3px;
            max-height: 400px;
            margin-right: 10px;
            font-weight: 500;
        }
        
        /* 底部区域 */
        .footer-area {
            height: 80px;
            display: flex;
            padding: 0 25px 25px 25px;
            align-items: flex-end;
            position: relative;
            z-index: 2;
        }
        
        /* 印章 */
        .seal {
            width: 70px;
            height: 70px;
            position: relative;
        }
        
        .seal-circle {
            width: 100%;
            height: 100%;
            border: 2px solid #dd2c2c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.8;
        }
        
        .seal-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #dd2c2c;
            font-size: 36px;
            font-weight: 600;
            opacity: 0.9;
        }
        
        /* 来源 */
        .source-text {
            flex: 1;
            font-size: 15px;
            color: #666;
            padding-left: 10px;
            line-height: 1.5;
            font-weight: 500;
            position: relative;
            z-index: 5;
        }
        
        /* 按钮区域 */
        .button-area {
            display: flex;
            justify-content: space-between;
            padding: 0 30px;
            margin-bottom: 20px;
        }
        
        .button {
            width: 120px;
            height: 45px;
            border-radius: 25px;
            background-color: #505050;
            color: white;
            font-weight: bold;
            font-size: 16px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .button:hover {
            background-color: #333333;
        }
        
        .button:active {
            transform: scale(0.98);
        }
        
        /* 加载状态 */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .loading.visible {
            visibility: visible;
            opacity: 1;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 小方块动画 */
        @keyframes squarePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* 提示消息 */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .toast.visible {
            opacity: 1;
            visibility: visible;
        }
        
        /* 自适应调整 */
        @media (max-height: 700px) {
            .calligraphy-view {
                height: 450px;
            }
            
            .vertical-text {
                font-size: 26px;
            }
        }
        
        @media (max-height: 600px) {
            .calligraphy-view {
                height: 400px;
            }
            
            .vertical-text {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- 渐变背景 -->
    <div class="gradient-background" id="gradientBg"></div>
    
    <!-- 顶部导航栏 -->
    <div class="nav-bar">
        <button class="back-button" id="backButton">
            <svg viewBox="0 0 24 24">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
        </button>
        <div class="nav-title">今日一言</div>
    </div>
    
    <!-- 主内容区 -->
    <div class="content-container">
        <!-- 书签样式卡片 -->
        <div class="calligraphy-view">
            <!-- 左上角竖向小方块装饰 -->
            <div class="square-decorations">
                <div class="square square-1"></div>
                <div class="square square-2"></div>
                <div class="square square-3"></div>
                <div class="square square-4"></div>
                <div class="square square-5"></div>
            </div>
            
            <!-- 书签底部几何装饰 -->
            <div class="geometric-decoration">
                <div class="geo-shape geo-shape-1"></div>
                <div class="geo-shape geo-shape-2"></div>
                <div class="geo-shape geo-shape-3"></div>
            </div>
            
            <!-- 竖排文字区域 -->
            <div class="quote-container">
                <div class="vertical-text" id="quoteText">加载中...</div>
            </div>
            
            <!-- 底部区域 -->
            <div class="footer-area">
                <!-- 印章 -->
                <div class="seal">
                    <div class="seal-circle"></div>
                    <div class="seal-text">印</div>
                </div>
                
                <!-- 来源 -->
                <div class="source-text" id="sourceText"></div>
            </div>
        </div>
        
        <!-- 按钮区域 -->
        <div class="button-area">
            <button class="button" id="copyButton">复制文字</button>
            <button class="button" id="refreshButton">换一句</button>
        </div>
    </div>
    
    <!-- 加载状态 -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>
    
    <!-- 提示消息 -->
    <div class="toast" id="toast"></div>
    
    <script>
        // 全局变量
        let currentHitokoto = "";
        let currentSource = "";
        
        // DOM元素
        const gradientBg = document.getElementById('gradientBg');
        const quoteText = document.getElementById('quoteText');
        const sourceText = document.getElementById('sourceText');
        const copyButton = document.getElementById('copyButton');
        const refreshButton = document.getElementById('refreshButton');
        const backButton = document.getElementById('backButton');
        const loading = document.getElementById('loading');
        const toast = document.getElementById('toast');
        const squares = document.querySelectorAll('.square');
        
        // 显示加载状态
        function showLoading() {
            loading.classList.add('visible');
        }
        
        // 隐藏加载状态
        function hideLoading() {
            loading.classList.remove('visible');
        }
        
        // 显示提示消息
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('visible');
            
            setTimeout(() => {
                toast.classList.remove('visible');
            }, 2000);
        }
        
        // 生成随机HSLA颜色
        function getRandomColor(opacity) {
            const hue = Math.floor(Math.random() * 360);
            const saturation = Math.floor(Math.random() * 30) + 60; // 60-90%
            const lightness = Math.floor(Math.random() * 20) + 40; // 40-60%
            return `hsla(${hue}, ${saturation}%, ${lightness}%, ${opacity})`;
        }
        
        // 为小方块设置随机颜色并触发动画
        function animateSquares() {
            squares.forEach((square, index) => {
                // 延迟设置颜色，创造波浪效果
                setTimeout(() => {
                    square.style.backgroundColor = getRandomColor(0.7);
                    square.style.animation = 'none';
                    void square.offsetWidth; // 触发重绘
                    square.style.animation = `squarePulse 1s ease ${index * 0.2}s`;
                }, index * 100);
            });
        }
        
        // 获取随机古风渐变配色
        function getRandomGradient() {
            const gradients = [
                // 淡雅山水
                'linear-gradient(135deg, #e6e9e9 0%, #a3b5bf 100%)',
                // 竹青
                'linear-gradient(135deg, #dce4db 0%, #b6c8ba 100%)',
                // 浅棕素雅
                'linear-gradient(135deg, #ebe1ce 0%, #c7b79f 100%)',
                // 淡青花瓷
                'linear-gradient(135deg, #dde9eb 0%, #b0cdd4 100%)',
                // 米黄宣纸
                'linear-gradient(135deg, #f5ecd9 0%, #e2d3b5 100%)',
                // 古墨淡彩
                'linear-gradient(135deg, #eee9e2 0%, #ccc6bc 100%)',
                // 青瓷
                'linear-gradient(135deg, #d1e9e3 0%, #a9cdc3 100%)'
            ];
            
            return gradients[Math.floor(Math.random() * gradients.length)];
        }
        
        // 设置渐变背景和几何形状颜色
        function setRandomBackground() {
            // 设置主背景
            const gradient = getRandomGradient();
            gradientBg.style.background = gradient;
            
            // 从渐变提取颜色用于几何形状
            const accentColor = gradient.includes('#a3b5bf') ? '#3B5C73' : 
                            gradient.includes('#b6c8ba') ? '#5A7D5A' :
                            gradient.includes('#c7b79f') ? '#8A7558' :
                            gradient.includes('#b0cdd4') ? '#5797A6' :
                            gradient.includes('#e2d3b5') ? '#AA9166' :
                            gradient.includes('#ccc6bc') ? '#7E7766' :
                            '#57A894';
                            
            // 更新几何形状颜色
            document.querySelectorAll('.geo-shape').forEach(shape => {
                shape.style.background = accentColor;
            });
            
            // 更新左上角小方块颜色
            animateSquares();
        }
        
        // 从一言API获取数据
        async function fetchHitokoto() {
            showLoading();
            showToast('正在获取今日一言...');
            
            try {
                const response = await fetch('https://v1.hitokoto.cn/?c=a&c=b&c=c&c=d&c=e&c=f&c=g&c=h&c=i&c=j&c=k');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data && data.hitokoto) {
                    // 保存数据
                    currentHitokoto = data.hitokoto;
                    currentSource = data.from_who ? 
                        `${data.from_who}《${data.from}》` : 
                        data.from;
                    
                    // 更新UI
                    quoteText.textContent = currentHitokoto;
                    sourceText.textContent = currentSource;
                    
                    // 设置新背景和几何形状
                    setRandomBackground();
                    
                    // 发送到微信接口
                    sendToWeChat(currentHitokoto, currentSource);
                    
                    console.log('一言数据:', data);
                } else {
                    showToast('未获取到有效数据');
                }
            } catch (error) {
                console.error('获取一言失败:', error);
                showToast('获取失败，请重试');
            } finally {
                hideLoading();
            }
        }
        
        // 发送一言到微信接口
        async function sendToWeChat(content, title) {
            try {
                // 将来源信息也包含在内容中
                const fullContent = `${content}\n\n—— ${title}`;
                
                const response = await fetch('https://api.yuangs.cc/weixinpush', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        msgtype: "text",
                        title: "一言",
                        content: fullContent,
                        to_user: "@all"
                    })
                });
                
                if (!response.ok) {
                    console.error('发送到微信接口失败:', response.status);
                }
            } catch (error) {
                console.error('发送到微信接口错误:', error);
            }
        }
        
        // 复制文字到剪贴板
        function copyText() {
            const textToCopy = `${currentHitokoto}\n${currentSource}`;
            
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    showToast('已复制到剪贴板');
                    // 复制成功后触发小方块动画
                    animateSquares();
                })
                .catch(err => {
                    console.error('复制失败:', err);
                    showToast('复制失败，请重试');
                });
        }
        
        // 为小方块添加交互效果
        squares.forEach(square => {
            square.addEventListener('mouseenter', () => {
                square.style.backgroundColor = getRandomColor(0.9);
            });
        });
        
        // 事件监听
        copyButton.addEventListener('click', copyText);
        refreshButton.addEventListener('click', fetchHitokoto);
        backButton.addEventListener('click', () => {
            // 如果在独立网页中，可以改为返回上一页
            // history.back();
            showToast('退出按钮被点击');
            animateSquares(); // 点击返回按钮也触发小方块动画
        });
        
        // 页面加载时获取一言
        document.addEventListener('DOMContentLoaded', fetchHitokoto);
    </script>
</body>
</html>