<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>文本一键美化 · HTML 生成器</title>
  <style>
    :root{
      --bg:#0b0c0f;
      --panel:#121418;
      --card:#151922;
      --text:#e7e9ee;
      --muted:#9aa3b2;
      --primary:#7c9cff;
      --accent:#6ae3ff;
      --code-bg:#0f1320;
      --border:#1f2430;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:14px;
    }
    [data-theme="light"]{
      --bg:#f7f8fb;
      --panel:#ffffff;
      --card:#ffffff;
      --text:#1a1f2b;
      --muted:#606a7a;
      --primary:#3b6cff;
      --accent:#00bcd4;
      --code-bg:#f2f5ff;
      --border:#e7eaf1;
      --shadow:0 10px 24px rgba(23, 31, 56, .12);
    }
    html,body{height:100%}
    body{
      margin:0;
      background:radial-gradient(1200px 600px at 80% -10%, rgba(124,156,255,.20), transparent 60%),
                 radial-gradient(800px 500px at -10% 10%, rgba(106,227,255,.18), transparent 55%),
                 var(--bg);
      color:var(--text);
      font:16px/1.6 -apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","Noto Sans CJK SC",sans-serif;
    }
    .wrap{
      max-width:980px;
      margin:20px auto 80px;
      padding:0 16px;
    }
    .hero{
      margin-top:18px;
      margin-bottom:14px;
      display:flex; gap:14px; align-items:center; flex-wrap:wrap;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      padding:12px 14px; border-radius:14px;
      background:linear-gradient(145deg, rgba(124,156,255,.14), rgba(106,227,255,.12));
      border:1px solid rgba(124,156,255,.25);
      box-shadow: var(--shadow);
    }
    .brand svg{width:24px;height:24px}
    .brand strong{font-size:16px;letter-spacing:.3px}
    .toolbar{
      margin-top:6px;
      display:flex; flex-wrap:wrap; gap:10px;
    }
    .toolbar .btn{
      appearance:none; border:1px solid var(--border);
      background:var(--panel); color:var(--text);
      padding:10px 14px; border-radius:12px; cursor:pointer;
      transition:.2s ease; font-size:14px;
    }
    .toolbar .btn.primary{
      background:linear-gradient(135deg, var(--primary), var(--accent));
      border:none; color:white; font-weight:600;
      box-shadow:0 8px 20px rgba(124,156,255,.25);
    }
    .toolbar .btn:hover{transform:translateY(-1px); box-shadow: var(--shadow)}
    .grid{
      display:grid; grid-template-columns:1fr; gap:14px; margin-top:10px;
    }
    @media (min-width: 900px){
      .grid{ grid-template-columns: 1fr 1fr; }
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .head{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 14px; border-bottom:1px solid var(--border);
      background:linear-gradient(180deg, rgba(255,255,255,.02), transparent);
    }
    .card .head .title{font-weight:600; letter-spacing:.3px}
    .card .body{padding:12px}
    textarea{
      width:100%; min-height:320px; resize:vertical;
      background:var(--panel); color:var(--text);
      border:1px solid var(--border); border-radius:10px;
      padding:12px 14px; line-height:1.65;
      outline:none;
    }
    .hint{margin-top:8px; color:var(--muted); font-size:13px}
    .preview{
      padding:10px 14px 20px;
    }
    .doc{
      max-width:720px; margin:0 auto;
    }
    .doc h1,.doc h2,.doc h3,.doc h4{
      margin:1.2em 0 .6em; line-height:1.35;
    }
    .doc h1{font-size:30px}
    .doc h2{font-size:24px; border-bottom:1px dashed var(--border); padding-bottom:.3em}
    .doc h3{font-size:20px}
    .doc p{margin:.7em 0}
    .doc a{color:var(--primary); text-decoration:none}
    .doc a:hover{text-decoration:underline}
    .doc blockquote{
      margin:1em 0; padding:.8em 1em; border-left:4px solid var(--primary);
      background:linear-gradient(0deg, rgba(124,156,255,.08), rgba(106,227,255,.08));
      border-radius:8px;
    }
    .doc pre{
      background:var(--code-bg); color:var(--text);
      padding:12px 14px; border-radius:10px; overflow:auto;
      border:1px solid var(--border);
    }
    .doc code{
      background:var(--code-bg); padding:.18em .4em; border-radius:6px;
      border:1px solid var(--border);
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:.92em;
    }
    .doc pre code{background:transparent; border:none; padding:0}
    .doc hr{border:0; height:1px; background:linear-gradient(90deg, transparent, var(--border), transparent); margin:18px 0}
    .toc{
      background:var(--panel); border:1px dashed var(--border); border-radius:12px; padding:10px 12px; margin:10px 0 16px;
    }
    .toc strong{display:block; margin-bottom:6px}
    .toc a{display:block; color:var(--muted); padding:4px 0}
    .toc a:hover{color:var(--text)}
    .footer{
      margin-top:12px; color:var(--muted); font-size:12px; text-align:center;
    }
    .badge{
      display:inline-block; padding:.18em .6em; border-radius:999px;
      background:linear-gradient(135deg, rgba(124,156,255,.18), rgba(106,227,255,.18));
      border:1px solid rgba(124,156,255,.35); color:var(--text); font-size:12px;
      margin-left:6px;
    }
    .tools-row{display:flex; gap:8px; flex-wrap:wrap}
    .tools-row input[type="text"]{
      flex:1; min-width:140px; padding:8px 10px; border-radius:10px;
      border:1px solid var(--border); background:var(--panel); color:var(--text);
      outline:none;
    }
    /* print */
    @media print{
      body{background:#fff}
      .toolbar,.editor-card{display:none}
      .card{border:none; box-shadow:none}
      .wrap{margin:0; padding:0}
      .doc{max-width:auto}
    }
  </style>
</head>
<body data-theme="dark">
  <div class="wrap">
    <div class="hero">
      <div class="brand" aria-label="brand">
        <svg viewBox="0 0 24 24" fill="none">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#7c9cff"/><stop offset="100%" stop-color="#6ae3ff"/>
            </linearGradient>
          </defs>
          <path d="M12 2l7.5 4.3v11.4L12 22l-7.5-4.3V6.3L12 2z" stroke="url(#g1)" stroke-width="1.2" />
          <circle cx="12" cy="12" r="3.6" stroke="url(#g1)" stroke-width="1.2"/>
        </svg>
        <strong>文本一键美化</strong>
        <span class="badge">Markdown → HTML</span>
      </div>
      <div class="toolbar">
        <button class="btn primary" id="btn-render">美化预览</button>
        <button class="btn" id="btn-copy">复制 HTML</button>
        <button class="btn" id="btn-export">导出 .html</button>
        <button class="btn" id="btn-print">打印/存 PDF</button>
        <button class="btn" id="btn-theme">切换浅/深色</button>
      </div>
    </div>

    <div class="grid">
      <div class="card editor-card">
        <div class="head">
          <div class="title">原始文本 / Markdown</div>
          <div class="tools-row">
            <input id="title-input" type="text" placeholder="可选：页面标题（空则自动从 # 一级标题提取）" />
          </div>
        </div>
        <div class="body">
          <textarea id="editor" placeholder="在这里粘贴你的内容（支持常用 Markdown：# 标题、- 列表、> 引用、**粗体**、`代码`、```代码块``` 等）"></textarea>
          <div class="hint">提示：也可通过 URL 传参 ?text=URL编码内容&autorun=1 自动渲染。</div>
        </div>
      </div>

      <div class="card">
        <div class="head">
          <div class="title">预览</div>
          <div class="tools-row">
            <span id="word-count" class="badge" title="字数">0 字</span>
          </div>
        </div>
        <div class="body preview">
          <div id="preview" class="doc">
            <p class="hint">右侧将展示美化后的 HTML。点击“美化预览”或开启 URL autorun 试试。</p>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">无依赖 · 离线可用 · 兼容移动端 · 支持 URL 传参与打印导出</div>
  </div>

  <script>
    // 工具函数
    const $ = sel => document.querySelector(sel);
    function escapeHtml(s){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
    function getQuery(){
      const q = {};
      const s = location.search.replace(/^\?/,'').split('&').filter(Boolean);
      for(const kv of s){
        const [k,v=''] = kv.split('=');
        try{ q[decodeURIComponent(k)] = decodeURIComponent(v.replace(/\+/g,' ')); }
        catch{ q[k]=v; }
      }
      return q;
    }
    function slugify(t){
      return t.toLowerCase()
        .replace(/[^\w\u4e00-\u9fa5]+/g,'-')
        .replace(/^-+|-+$/g,'')
        .slice(0,64) || ('s'+Math.random().toString(36).slice(2,8));
    }

    // 简易 Markdown -> HTML（支持常用语法）
    function mdToHtml(md){
      // 保护代码块
      const fences = [];
      md = md.replace(/\r\n?/g, '\n');
      md = md.replace(/```([\s\S]*?)```/g, (_, code) => {
        fences.push(code);
        return `\uE000CODE${fences.length-1}\uE000`;
      });

      // 块级处理：引用、分隔线、标题、列表、段落
      const lines = md.split('\n');
      let html = '';
      let inUL = false, inOL = false, inQuote = false;

      function closeLists(){
        if(inUL){ html += '</ul>'; inUL=false; }
        if(inOL){ html += '</ol>'; inOL=false; }
      }
      function closeQuote(){
        if(inQuote){ html += '</blockquote>'; inQuote=false; }
      }

      for(let i=0;i<lines.length;i++){
        let line = lines[i];

        // 水平线
        if (/^\s*(-{3,}|\*{3,}|_{3,})\s*$/.test(line)){
          closeLists(); closeQuote();
          html += '<hr/>'; continue;
        }

        // 标题
        const m = line.match(/^(\s{0,3})(#{1,6})\s+(.+)$/);
        if(m){
          closeLists(); closeQuote();
          const level = m[2].length;
          const text = inline(m[3].trim());
          const id = slugify(text.replace(/<[^>]+>/g,''));
          html += `<h${level} id="${id}">${text}</h${level}>`;
          continue;
        }

        // 引用
        if (/^\s{0,3}>\s?/.test(line)){
          if(!inQuote){ closeLists(); html += '<blockquote>'; inQuote=true; }
          line = line.replace(/^\s{0,3}>\s?/, '');
          html += `<p>${inline(line)}</p>`;
          continue;
        }else{
          closeQuote();
        }

        // 有序/无序 列表
        const olm = line.match(/^\s{0,3}(\d+)\.\s+(.+)/);
        const ulm = line.match(/^\s{0,3}([-+*])\s+(.+)/);
        if(olm){
          if(!inOL){ closeLists(); html += '<ol>'; inOL=true; }
          html += `<li>${inline(olm[2])}</li>`;
          continue;
        }else if(ulm){
          if(!inUL){ closeLists(); html += '<ul>'; inUL=true; }
          html += `<li>${inline(ulm[2])}</li>`;
          continue;
        }else{
          closeLists();
        }

        // 空行
        if(/^\s*$/.test(line)){ html += ''; continue; }

        // 段落
        html += `<p>${inline(line)}</p>`;
      }
      closeLists(); closeQuote();

      // 还原代码块
      html = html.replace(/\uE000CODE(\d+)\uE000/g, (_, idx) => {
        const code = fences[+idx] || '';
        return `<pre><code>${escapeHtml(code)}</code></pre>`;
      });

      return html;

      // 行内语法：行内代码、粗体、斜体、链接
      function inline(s){
        s = escapeHtml(s);
        // 链接 [text](url)
        s = s.replace(/\[([^\]]+)\]\(([^)\s]+)(?:\s+"([^"]+)")?\)/g, (m, t, url, title) => {
          const tt = title ? ` title="${escapeHtml(title)}"` : '';
          return `<a href="${url}" target="_blank" rel="noopener"${tt}>${t}</a>`;
        });
        // 粗体/斜体（先粗体）
        s = s.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
        s = s.replace(/\*([^*]+)\*/g, '<em>$1</em>');
        // 行内代码
        s = s.replace(/`([^`]+)`/g, '<code>$1</code>');
        return s;
      }
    }

    // 基于 <h1~h3> 自动生成目录
    function buildTOC(container){
      const heads = container.querySelectorAll('h1, h2, h3');
      if(!heads.length) return '';
      let toc = '<div class="toc"><strong>目录</strong>';
      heads.forEach(h=>{
        const lvl = +h.tagName.slice(1);
        const pad = (lvl-1)*10;
        toc += `<a href="#${h.id}" style="padding-left:${pad}px">${h.textContent}</a>`;
      });
      toc += '</div>';
      return toc;
    }

    // 统计字数（中英混合大致估算）
    function countWords(s){
      s = s.trim();
      if(!s) return 0;
      // 中文按字，英文/数字按词
      const cn = (s.match(/[\u4e00-\u9fa5]/g)||[]).length;
      const en = (s.replace(/[\u4e00-\u9fa5]/g,'').match(/\b[\w'-]+\b/g)||[]).length;
      return cn + en;
    }

    // 渲染流程
    function render(){
      const raw = $('#editor').value || '';
      const html = mdToHtml(raw);
      const temp = document.createElement('div');
      temp.innerHTML = html;

      // TOC
      const toc = buildTOC(temp);

      // 页面标题：显式输入 > H1 > 默认
      const titleInput = $('#title-input').value.trim();
      const h1 = temp.querySelector('h1');
      const pageTitle = titleInput || (h1 ? h1.textContent.trim() : '美化文档');

      // 将 TOC 插到首个块元素前
      const doc = $('#preview');
      doc.innerHTML = '';
      const docInner = document.createElement('div');
      docInner.className = 'doc';
      docInner.innerHTML = toc + temp.innerHTML;
      doc.appendChild(docInner);

      document.title = pageTitle + ' · 文本美化';
      $('#word-count').textContent = `${countWords(raw)} 字`;
    }

    // 主题切换
    function toggleTheme(){
      const root = document.body;
      root.dataset.theme = root.dataset.theme === 'light' ? 'dark' : 'light';
      try{ localStorage.setItem('theme', root.dataset.theme); }catch{}
    }
    (function initTheme(){
      try{
        const saved = localStorage.getItem('theme');
        if(saved) document.body.dataset.theme = saved;
        else{
          const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
          document.body.dataset.theme = prefersLight ? 'light' : 'dark';
        }
      }catch{}
    })();

    // 导出：将当前文档+样式打包为独立 HTML
    function exportHTML(){
      const css = Array.from(document.styleSheets)
        .map(ss=>{
          try{
            return Array.from(ss.cssRules).map(r=>r.cssText).join('\n');
          }catch(e){
            // 某些内联表因跨域策略不可读，这里只取本页内联第一段样式
            return '';
          }
        }).join('\n') || document.querySelector('style')?.innerHTML || '';
      const title = (document.title || '文档').replace(/[\\/:*?"<>|]/g,'-');
      const content = $('#preview').innerHTML;

      const html = `<!DOCTYPE html>
<html lang="zh-CN"><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>${title}</title>
<style>${css}</style>
</head><body data-theme="${document.body.dataset.theme}">
<div class="wrap"><div class="card"><div class="body preview">${content}</div></div></div>
</body></html>`;

      const blob = new Blob([html], {type:'text/html;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `${title}.html`;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 1000);

      // iOS Safari 可能不会真正“下载”，可提示用户使用分享/保存
    }

    // 复制 HTML 源码（预览容器内）
    async function copyHTML(){
      const html = $('#preview').innerHTML;
      try{
        await navigator.clipboard.writeText(html);
        alert('已复制美化后的 HTML 源码');
      }catch{
        // 兼容方案：创建隐藏文本域复制
        const ta = document.createElement('textarea');
        ta.value = html; ta.style.position='fixed'; ta.style.opacity='0';
        document.body.appendChild(ta);
        ta.select(); document.execCommand('copy');
        ta.remove();
        alert('已复制美化后的 HTML 源码');
      }
    }

    // 事件绑定
    $('#btn-render').addEventListener('click', render);
    $('#btn-print').addEventListener('click', ()=>window.print());
    $('#btn-export').addEventListener('click', exportHTML);
    $('#btn-copy').addEventListener('click', copyHTML);
    $('#btn-theme').addEventListener('click', toggleTheme);
    $('#editor').addEventListener('input', ()=>{
      const v = $('#editor').value || '';
      $('#word-count').textContent = `${countWords(v)} 字`;
    });

    // URL 传参：?text=...&autorun=1
    (function bootstrap(){
      const q = getQuery();
      if(q.text){
        try{
          $('#editor').value = q.text;
        }catch{ $('#editor').value = q.text; }
        if(q.title) $('#title-input').value = q.title;
        if(String(q.autorun||'').toLowerCase() === '1' || String(q.run||'') === '1'){
          render();
        }
      }else{
        // 提供一段示例，方便开箱即用
        const demo = `# jsbox与快捷指令结合有哪些好玩的用法

### 神器jsbox
SBox 可以被称为“神器”，尤其是在 iOS 平台上进行 JavaScript 脚本开发和自动化方面。它之所以被称为神器，主要有以下几个原因：

- 强大的原生能力封装（$http / $ui / $file / $location / $clipboard 等）
- 便捷的 UI 构建（Auto Layout 风格 $layout）
- 丰富的扩展接口（$qrcode / $share / $archiver / $chart 等）
- 多样的运行环境（主应用 / 扩展 / 小组件 / Shortcuts）
- 强大的调试工具（console / Inspector）
- 低门槛与高可玩性

### 将 JSBox 与“快捷指令”结合
- 用 JSBox 实现复杂逻辑，由快捷指令触发
- JSBox 做交互前端，调用快捷指令具体动作
- 数据互通：快捷指令将文本/图片传给 JSBox，JSBox 二次处理再回传
- 复杂工作流混排：简单步骤交给快捷指令，难点用 JSBox 解决

> 提示：点击上方“美化预览”，即可看到精美 HTML 效果。`;
        $('#editor').value = demo;
        $('#word-count').textContent = `${countWords(demo)} 字`;
      }
    })();
  </script>
</body>
</html>