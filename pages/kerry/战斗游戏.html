<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ˜æ–—æ¸¸æˆÂ·åœ°ç‹±ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Noto+Sans+SC:wght@400;700;900&display=swap');

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: #0a0a0a;
            overflow-x: hidden;
        }

        .font-battle {
            font-family: 'Black Ops One', cursive;
        }

        /* åœ°ç‹±ç«ç„°èƒŒæ™¯åŠ¨ç”» */
        .hell-bg {
            background: linear-gradient(180deg, #1a0000 0%, #0a0a0a 50%, #000000 100%);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        .fire-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 0, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 69, 0, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(220, 20, 60, 0.2) 0%, transparent 40%);
            animation: fireMove 8s ease-in-out infinite;
        }

        @keyframes fireMove {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.1); }
        }

        /* ç”Ÿå‘½å€¼æ¡åŠ¨ç”» */
        .health-bar-fill {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px currentColor;
        }

        .health-bar-fill.player-hp {
            background: linear-gradient(90deg, #0066ff, #00ccff);
            color: #00ccff;
        }

        .health-bar-fill.ai-hp {
            background: linear-gradient(90deg, #ff0000, #ff4444);
            color: #ff4444;
        }

        /* æ”»å‡»æŒ‰é’®ç‰¹æ•ˆ */
        .attack-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .attack-btn:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .attack-btn:active:not(:disabled) {
            transform: translateY(-2px);
        }

        .attack-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .attack-btn:hover::before {
            left: 100%;
        }

        .attack-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(100%);
        }

        /* ä¼¤å®³æ•°å­—åŠ¨ç”» */
        .damage-text {
            position: absolute;
            font-weight: 900;
            font-size: 2rem;
            pointer-events: none;
            animation: damageFloat 1s ease-out forwards;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 50;
        }

        @keyframes damageFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(0.5);
            }
            50% {
                transform: translateY(-30px) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(1);
            }
        }

        /* éœ‡åŠ¨æ•ˆæœ */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* æˆ˜æ–—è®°å½•æ»šåŠ¨ */
        .battle-log {
            scrollbar-width: thin;
            scrollbar-color: #444 #1a1a1a;
        }

        .battle-log::-webkit-scrollbar {
            width: 8px;
        }

        .battle-log::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .battle-log::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        /* é—ªçƒæ•ˆæœ */
        .flash {
            animation: flash 0.3s ease-out;
        }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; filter: brightness(2); }
        }

        /* è§’è‰²å¤´åƒè„‰å†² */
        .avatar-pulse {
            animation: avatarPulse 2s ease-in-out infinite;
        }

        @keyframes avatarPulse {
            0%, 100% { box-shadow: 0 0 20px currentColor; }
            50% { box-shadow: 0 0 40px currentColor, 0 0 60px currentColor; }
        }

        /* æ¸¸æˆç»“æŸé®ç½© */
        .game-over-overlay {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.85);
        }

        /* ç²’å­æ•ˆæœå®¹å™¨ */
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: particleFloat 3s infinite;
        }

        @keyframes particleFloat {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(50px); opacity: 0; }
        }
    </style>
</head>
<body class="text-white min-h-screen flex flex-col">

    <!-- èƒŒæ™¯ -->
    <div class="hell-bg"></div>
    <div class="fire-particles"></div>

    <!-- æ ‡é¢˜ -->
    <header class="text-center py-6 relative z-10">
        <h1 class="font-battle text-5xl md:text-7xl bg-clip-text text-transparent bg-gradient-to-b from-red-500 via-orange-500 to-yellow-500 drop-shadow-[0_0_15px_rgba(255,0,0,0.5)]">
            æˆ˜æ–—æ¸¸æˆÂ·åœ°ç‹±ç‰ˆ
        </h1>
        <p class="text-gray-400 mt-2 text-sm tracking-widest uppercase">Battle Game: Hell Edition</p>
    </header>

    <!-- ä¸»æ¸¸æˆåŒºåŸŸ -->
    <main class="flex-1 container mx-auto px-4 max-w-6xl relative z-10">
        
        <!-- æˆ˜æ–—åœºåœ° -->
        <div class="grid md:grid-cols-2 gap-8 mb-8">
            
            <!-- ç©å®¶1 -->
            <div id="player1-card" class="bg-gradient-to-b from-blue-900/20 to-black/40 border-2 border-blue-500/30 rounded-2xl p-6 relative overflow-hidden backdrop-blur-sm">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent"></div>
                
                <!-- è§’è‰²ä¿¡æ¯ -->
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-blue-900 flex items-center justify-center text-4xl shadow-[0_0_30px_rgba(0,100,255,0.5)] avatar-pulse text-blue-400">
                        âš”ï¸
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-blue-400">ç©å®¶1</h2>
                        <p class="text-blue-300/60 text-sm">äººç±»æˆ˜å£«</p>
                    </div>
                </div>

                <!-- ç”Ÿå‘½å€¼ -->
                <div class="mb-2 flex justify-between text-sm">
                    <span class="text-blue-300">ç”Ÿå‘½å€¼</span>
                    <span id="player1-hp-text" class="font-bold text-blue-400">100/100</span>
                </div>
                <div class="h-6 bg-black/50 rounded-full overflow-hidden border border-blue-500/30 relative">
                    <div id="player1-hp-bar" class="health-bar-fill player-hp h-full rounded-full" style="width: 100%"></div>
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/20"></div>
                </div>

                <!-- æ”»å‡»æŒ‰é’® -->
                <div class="grid grid-cols-2 gap-3 mt-6">
                    <button onclick="game.playerAttack('quick')" class="attack-btn bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white py-3 px-4 rounded-lg font-bold border border-blue-400/30 group">
                        <div class="text-sm">âš¡ å¿«é€Ÿæ–©å‡»</div>
                        <div class="text-xs text-blue-200/70 mt-1">ä¼¤å®³ 8-12 | å‘½ä¸­ç‡é«˜</div>
                    </button>
                    <button onclick="game.playerAttack('heavy')" class="attack-btn bg-gradient-to-r from-blue-800 to-indigo-700 hover:from-blue-700 hover:to-indigo-600 text-white py-3 px-4 rounded-lg font-bold border border-blue-400/30 group">
                        <div class="text-sm">ğŸ—¡ï¸ é‡å‡»</div>
                        <div class="text-xs text-blue-200/70 mt-1">ä¼¤å®³ 15-25 | å¯èƒ½miss</div>
                    </button>
                    <button onclick="game.playerAttack('fire')" class="attack-btn bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white py-3 px-4 rounded-lg font-bold border border-orange-400/30 group">
                        <div class="text-sm">ğŸ”¥ åœ°ç‹±ç«</div>
                        <div class="text-xs text-orange-200/70 mt-1">ä¼¤å®³ 20-30 | æ¶ˆè€—ç”Ÿå‘½</div>
                    </button>
                    <button onclick="game.playerAttack('heal')" class="attack-btn bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-500 hover:to-teal-500 text-white py-3 px-4 rounded-lg font-bold border border-green-400/30 group">
                        <div class="text-sm">ğŸ’š ç”Ÿå‘½æ±²å–</div>
                        <div class="text-xs text-green-200/70 mt-1">æ¢å¤ 10-15 | ä¼¤å®³5-8</div>
                    </button>
                </div>
            </div>

            <!-- åœ°ç‹±AI -->
            <div id="ai-card" class="bg-gradient-to-b from-red-900/20 to-black/40 border-2 border-red-500/30 rounded-2xl p-6 relative overflow-hidden backdrop-blur-sm">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-red-500 to-transparent"></div>
                
                <!-- AIä¿¡æ¯ -->
                <div class="flex items-center gap-4 mb-4 flex-row-reverse text-right">
                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-red-600 to-red-900 flex items-center justify-center text-4xl shadow-[0_0_30px_rgba(255,0,0,0.5)] avatar-pulse text-red-400">
                        ğŸ‘¹
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-red-400">åœ°ç‹±AI</h2>
                        <p class="text-red-300/60 text-sm">æ·±æ¸Šé¢†ä¸»</p>
                    </div>
                </div>

                <!-- ç”Ÿå‘½å€¼ -->
                <div class="mb-2 flex justify-between text-sm flex-row-reverse">
                    <span class="text-red-300">ç”Ÿå‘½å€¼</span>
                    <span id="ai-hp-text" class="font-bold text-red-400">100/100</span>
                </div>
                <div class="h-6 bg-black/50 rounded-full overflow-hidden border border-red-500/30 relative">
                    <div id="ai-hp-bar" class="health-bar-fill ai-hp h-full rounded-full" style="width: 100%"></div>
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/20"></div>
                </div>

                <!-- AIçŠ¶æ€æ˜¾ç¤º -->
                <div class="mt-6 p-4 bg-black/30 rounded-lg border border-red-500/20 min-h-[140px] flex items-center justify-center">
                    <div id="ai-thinking" class="text-center hidden">
                        <div class="inline-block animate-spin text-3xl mb-2">ğŸ”¥</div>
                        <p class="text-red-400 animate-pulse">åœ°ç‹±AIæ­£åœ¨æ€è€ƒ...</p>
                    </div>
                    <div id="ai-action" class="text-center">
                        <p class="text-gray-400 text-sm italic">ç­‰å¾…ç©å®¶è¡ŒåŠ¨...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- æˆ˜æ–—è®°å½• -->
        <div class="bg-black/40 border border-gray-700 rounded-xl p-4 backdrop-blur-sm">
            <h3 class="text-lg font-bold mb-3 flex items-center gap-2 text-gray-300">
                <span>ğŸ“œ</span>
                <span>æˆ˜æ–—è®°å½•</span>
                <span class="text-xs text-gray-500 font-normal ml-auto">æœ€æ–°è®°å½•åœ¨ä¸Š</span>
            </h3>
            <div id="battle-log" class="battle-log h-48 overflow-y-auto space-y-2 pr-2">
                <div class="text-gray-500 text-center italic py-8">æˆ˜æ–—å¼€å§‹ï¼é€‰æ‹©ä½ çš„æ”»å‡»æ–¹å¼...</div>
            </div>
        </div>

    </main>

    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div id="game-over" class="fixed inset-0 game-over-overlay z-50 hidden flex items-center justify-center">
        <div class="bg-gradient-to-b from-gray-900 to-black border-2 border-gray-600 rounded-2xl p-8 max-w-md w-full mx-4 text-center transform scale-100 transition-transform">
            <div id="game-over-icon" class="text-6xl mb-4">ğŸ†</div>
            <h2 id="game-over-title" class="text-4xl font-battle mb-2 text-white">èƒœåˆ©ï¼</h2>
            <p id="game-over-message" class="text-gray-400 mb-6">ä½ æˆ˜èƒœäº†åœ°ç‹±AIï¼</p>
            
            <div class="grid grid-cols-2 gap-4 mb-6 text-sm">
                <div class="bg-black/40 p-3 rounded-lg border border-gray-700">
                    <div class="text-gray-500">å‰©ä½™ç”Ÿå‘½</div>
                    <div id="final-hp" class="text-2xl font-bold text-blue-400">45</div>
                </div>
                <div class="bg-black/40 p-3 rounded-lg border border-gray-700">
                    <div class="text-gray-500">æˆ˜æ–—å›åˆ</div>
                    <div id="final-rounds" class="text-2xl font-bold text-yellow-400">12</div>
                </div>
            </div>

            <button onclick="game.restart()" class="w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-500 hover:to-orange-500 text-white py-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105 shadow-[0_0_20px_rgba(255,0,0,0.3)]">
                ğŸ”¥ å†æ¬¡æŒ‘æˆ˜åœ°ç‹± ğŸ”¥
            </button>
        </div>
    </div>

    <!-- ä¼¤å®³æ•°å­—å®¹å™¨ -->
    <div id="damage-container" class="fixed inset-0 pointer-events-none z-40"></div>

    <script>
        class BattleGame {
            constructor() {
                this.playerHP = 100;
                this.playerMaxHP = 100;
                this.aiHP = 100;
                this.aiMaxHP = 100;
                this.round = 0;
                this.isPlayerTurn = true;
                this.gameOver = false;
                this.logEntries = [];
                
                this.attackTypes = {
                    quick: { name: 'å¿«é€Ÿæ–©å‡»', minDmg: 8, maxDmg: 12, accuracy: 95, selfDamage: 0, color: '#3b82f6' },
                    heavy: { name: 'é‡å‡»', minDmg: 15, maxDmg: 25, accuracy: 75, selfDamage: 0, color: '#1e40af' },
                    fire: { name: 'åœ°ç‹±ç«', minDmg: 20, maxDmg: 30, accuracy: 85, selfDamage: 5, color: '#ea580c' },
                    heal: { name: 'ç”Ÿå‘½æ±²å–', minDmg: 5, maxDmg: 8, accuracy: 100, selfDamage: -15, color: '#059669' }
                };

                this.aiAttacks = [
                    { name: 'æš—å½±çˆª', minDmg: 10, maxDmg: 15, accuracy: 90 },
                    { name: 'æ·±æ¸Šçƒˆç„°', minDmg: 18, maxDmg: 25, accuracy: 80 },
                    { name: 'çµé­‚æ’•è£‚', minDmg: 25, maxDmg: 35, accuracy: 60 },
                    { name: 'é»‘æš—æ²»æ„ˆ', minDmg: 0, maxDmg: 0, heal: 15, accuracy: 100 }
                ];
            }

            getRandomDamage(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            checkHit(accuracy) {
                return Math.random() * 100 <= accuracy;
            }

            async playerAttack(type) {
                if (!this.isPlayerTurn || this.gameOver) return;

                const attack = this.attackTypes[type];
                this.setButtonsDisabled(true);
                
                // æ’­æ”¾æŒ‰é’®åŠ¨ç”»
                this.animateButton(type);
                
                await this.wait(300);

                // è®¡ç®—ä¼¤å®³
                let damage = 0;
                let isHit = this.checkHit(attack.accuracy);
                let message = '';
                let isCrit = Math.random() < 0.1; // 10%æš´å‡»

                if (isHit) {
                    damage = this.getRandomDamage(attack.minDmg, attack.maxDmg);
                    if (isCrit) damage = Math.floor(damage * 1.5);
                    
                    // å¤„ç†è‡ªä¼¤/æ²»ç–—
                    if (attack.selfDamage > 0) {
                        this.playerHP = Math.max(0, this.playerHP - attack.selfDamage);
                        this.showDamageNumber(attack.selfDamage, 'player1-card', '#ef4444');
                        this.flashElement('player1-card');
                    } else if (attack.selfDamage < 0) {
                        const heal = Math.abs(attack.selfDamage);
                        this.playerHP = Math.min(this.playerMaxHP, this.playerHP + heal);
                        this.showDamageNumber(heal, 'player1-card', '#22c55e', true);
                    }

                    // é€ æˆä¼¤å®³
                    if (damage > 0) {
                        this.aiHP = Math.max(0, this.aiHP - damage);
                        this.showDamageNumber(damage, 'ai-card', attack.color, false, isCrit);
                        this.shakeElement('ai-card');
                        this.flashElement('ai-card');
                    }

                    message = `ä½¿ç”¨ ${attack.name}`;
                    if (isCrit) message += ' [æš´å‡»!]';
                    if (attack.selfDamage > 0) message += ` (è‡ªæŸ${attack.selfDamage}ç”Ÿå‘½)`;
                    if (attack.selfDamage < 0) message += ` (æ¢å¤${Math.abs(attack.selfDamage)}ç”Ÿå‘½)`;
                } else {
                    message = `${attack.name} è¢«èº²å¼€äº†ï¼`;
                }

                this.addLog('player', message, isHit ? damage : 0);
                this.updateUI();

                if (this.checkGameOver()) return;

                this.isPlayerTurn = false;
                await this.wait(1000);
                this.aiTurn();
            }

            async aiTurn() {
                if (this.gameOver) return;

                // æ˜¾ç¤ºAIæ€è€ƒ
                document.getElementById('ai-thinking').classList.remove('hidden');
                document.getElementById('ai-action').classList.add('hidden');

                await this.wait(1500);

                // AIç­–ç•¥ï¼šç”Ÿå‘½å€¼ä½æ—¶æ›´å€¾å‘äºæ²»ç–—
                let availableAttacks = [...this.aiAttacks];
                if (this.aiHP < 30 && Math.random() < 0.6) {
                    availableAttacks = availableAttacks.filter(a => a.heal);
                    if (availableAttacks.length === 0) availableAttacks = [...this.aiAttacks];
                }

                const attack = availableAttacks[Math.floor(Math.random() * availableAttacks.length)];
                
                document.getElementById('ai-thinking').classList.add('hidden');
                document.getElementById('ai-action').classList.remove('hidden');

                let damage = 0;
                let isHit = this.checkHit(attack.accuracy);
                let message = '';
                let isCrit = Math.random() < 0.15; // AI 15%æš´å‡»

                if (attack.heal) {
                    const heal = attack.heal;
                    this.aiHP = Math.min(this.aiMaxHP, this.aiHP + heal);
                    this.showDamageNumber(heal, 'ai-card', '#22c55e', true);
                    message = `ä½¿ç”¨ ${attack.name} æ¢å¤äº† ${heal} ç”Ÿå‘½`;
                } else if (isHit) {
                    damage = this.getRandomDamage(attack.minDmg, attack.maxDmg);
                    if (isCrit) damage = Math.floor(damage * 1.5);
                    
                    this.playerHP = Math.max(0, this.playerHP - damage);
                    this.showDamageNumber(damage, 'player1-card', '#ef4444', false, isCrit);
                    this.shakeElement('player1-card');
                    this.flashElement('player1-card');
                    
                    message = `ä½¿ç”¨ ${attack.name}`;
                    if (isCrit) message += ' [æš´å‡»!]';
                } else {
                    message = `${attack.name} è¢«èº²å¼€äº†ï¼`;
                }

                this.addLog('ai', message, damage);
                this.updateUI();

                if (this.checkGameOver()) return;

                await this.wait(1000);
                this.isPlayerTurn = true;
                this.setButtonsDisabled(false);
                this.round++;
            }

            checkGameOver() {
                if (this.playerHP <= 0 || this.aiHP <= 0) {
                    this.gameOver = true;
                    const playerWon = this.aiHP <= 0;
                    
                    setTimeout(() => {
                        this.showGameOver(playerWon);
                    }, 1000);
                    return true;
                }
                return false;
            }

            showGameOver(playerWon) {
                const overlay = document.getElementById('game-over');
                const icon = document.getElementById('game-over-icon');
                const title = document.getElementById('game-over-title');
                const message = document.getElementById('game-over-message');
                const finalHp = document.getElementById('final-hp');
                const finalRounds = document.getElementById('final-rounds');

                overlay.classList.remove('hidden');
                
                if (playerWon) {
                    icon.textContent = 'ğŸ‘‘';
                    title.textContent = 'èƒœåˆ©ï¼';
                    title.className = 'text-4xl font-battle mb-2 text-yellow-400';
                    message.textContent = 'ä½ æˆ˜èƒœäº†åœ°ç‹±AIï¼Œè¯æ˜äº†ä½ çš„å®åŠ›ï¼';
                    finalHp.textContent = this.playerHP;
                    finalHp.className = 'text-2xl font-bold text-blue-400';
                } else {
                    icon.textContent = 'ğŸ’€';
                    title.textContent = 'æˆ˜è´¥...';
                    title.className = 'text-4xl font-battle mb-2 text-red-500';
                    message.textContent = 'ä½ çš„çµé­‚å·²è¢«åœ°ç‹±AIåå™¬...';
                    finalHp.textContent = 0;
                    finalHp.className = 'text-2xl font-bold text-red-400';
                }
                
                finalRounds.textContent = this.round;
            }

            restart() {
                this.playerHP = 100;
                this.aiHP = 100;
                this.round = 0;
                this.isPlayerTurn = true;
                this.gameOver = false;
                this.logEntries = [];
                
                document.getElementById('game-over').classList.add('hidden');
                document.getElementById('battle-log').innerHTML = '<div class="text-gray-500 text-center italic py-8">æ–°çš„æˆ˜æ–—å¼€å§‹ï¼é€‰æ‹©ä½ çš„æ”»å‡»æ–¹å¼...</div>';
                document.getElementById('ai-action').innerHTML = '<p class="text-gray-400 text-sm italic">ç­‰å¾…ç©å®¶è¡ŒåŠ¨...</p>';
                
                this.updateUI();
                this.setButtonsDisabled(false);
            }

            updateUI() {
                // æ›´æ–°ç”Ÿå‘½å€¼æ¡
                const playerPercent = (this.playerHP / this.playerMaxHP) * 100;
                const aiPercent = (this.aiHP / this.aiMaxHP) * 100;
                
                document.getElementById('player1-hp-bar').style.width = `${playerPercent}%`;
                document.getElementById('player1-hp-text').textContent = `${this.playerHP}/${this.playerMaxHP}`;
                
                document.getElementById('ai-hp-bar').style.width = `${aiPercent}%`;
                document.getElementById('ai-hp-text').textContent = `${this.aiHP}/${this.aiMaxHP}`;

                // ä½ç”Ÿå‘½å€¼è­¦å‘Š
                if (this.playerHP <= 30) {
                    document.getElementById('player1-hp-bar').classList.add('animate-pulse');
                } else {
                    document.getElementById('player1-hp-bar').classList.remove('animate-pulse');
                }
            }

            addLog(who, action, damage) {
                const log = document.getElementById('battle-log');
                const entry = document.createElement('div');
                const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
                
                let colorClass = who === 'player' ? 'text-blue-400' : 'text-red-400';
                let name = who === 'player' ? 'ç©å®¶1' : 'åœ°ç‹±AI';
                let damageText = damage > 0 ? `<span class="text-yellow-400 font-bold">-${damage}</span>` : '';
                
                entry.className = 'flex items-center gap-3 p-3 bg-white/5 rounded-lg border-l-4 ' + 
                    (who === 'player' ? 'border-blue-500' : 'border-red-500') + ' animate-[fadeIn_0.3s_ease-out]';
                
                entry.innerHTML = `
                    <span class="text-xs text-gray-500 font-mono">${time}</span>
                    <span class="font-bold ${colorClass}">${name}</span>
                    <span class="text-gray-300 flex-1">${action}</span>
                    ${damageText}
                `;
                
                // æ’å…¥åˆ°é¡¶éƒ¨
                if (log.children.length === 1 && log.children[0].classList.contains('text-center')) {
                    log.innerHTML = '';
                }
                
                log.insertBefore(entry, log.firstChild);
                
                // é™åˆ¶è®°å½•æ•°é‡
                while (log.children.length > 20) {
                    log.removeChild(log.lastChild);
                }
            }

            showDamageNumber(damage, targetId, color, isHeal = false, isCrit = false) {
                const target = document.getElementById(targetId);
                const rect = target.getBoundingClientRect();
                const container = document.getElementById('damage-container');
                
                const num = document.createElement('div');
                num.className = 'damage-text';
                num.style.color = color;
                num.style.left = `${rect.left + rect.width / 2 + (Math.random() * 40 - 20)}px`;
                num.style.top = `${rect.top + rect.height / 3}px`;
                
                if (isCrit) {
                    num.style.fontSize = '3rem';
                    num.textContent = isHeal ? `+${damage}â˜…` : `${damage}â˜…`;
                    num.style.textShadow = '0 0 20px currentColor';
                } else {
                    num.textContent = isHeal ? `+${damage}` : damage;
                }
                
                container.appendChild(num);
                setTimeout(() => num.remove(), 1000);
            }

            shakeElement(id) {
                const el = document.getElementById(id);
                el.classList.remove('shake');
                void el.offsetWidth; // è§¦å‘é‡æ’
                el.classList.add('shake');
            }

            flashElement(id) {
                const el = document.getElementById(id);
                el.classList.add('flash');
                setTimeout(() => el.classList.remove('flash'), 300);
            }

            animateButton(type) {
                // æŒ‰é’®å·²ç»åœ¨CSSä¸­å¤„ç†äº†hoveræ•ˆæœï¼Œè¿™é‡Œå¯ä»¥æ·»åŠ é¢å¤–é€»è¾‘
            }

            setButtonsDisabled(disabled) {
                const buttons = document.querySelectorAll('.attack-btn');
                buttons.forEach(btn => btn.disabled = disabled);
            }

            wait(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        const game = new BattleGame();

        // æ·»åŠ é”®ç›˜æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            if (!game.isPlayerTurn || game.gameOver) return;
            
            switch(e.key) {
                case '1': game.playerAttack('quick'); break;
                case '2': game.playerAttack('heavy'); break;
                case '3': game.playerAttack('fire'); break;
                case '4': game.playerAttack('heal'); break;
            }
        });
    </script>
</body>
</html>
