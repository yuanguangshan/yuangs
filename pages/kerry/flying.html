<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Dé£æœºä¿¯è§†æ¸¸æˆ - å®Œæ•´ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }

        .game-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .game-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
        }

        .game-stats {
            display: flex;
            gap: 30px;
            font-size: 1.1em;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .stat-label {
            font-size: 0.8em;
            opacity: 0.8;
            margin-bottom: 2px;
        }

        .stat-value {
            font-weight: bold;
            color: #4CAF50;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            perspective: 1000px;
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 50%, #8FBC8F 100%);
        }

        .terrain {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            transform-style: preserve-3d;
            animation: terrainMove 20s linear infinite;
        }

        @keyframes terrainMove {
            0% { transform: translateZ(0) rotateX(60deg); }
            100% { transform: translateZ(-2000px) rotateX(60deg); }
        }

        /* æœºåœºå’Œè·‘é“æ ·å¼ */
        .airport {
            position: absolute;
            width: 400px;
            height: 200px;
            left: 50%;
            bottom: 10%;
            transform: translateX(-50%);
            z-index: 10;
            transition: all 1s ease;
        }

        .runway {
            position: absolute;
            width: 300px;
            height: 40px;
            background: linear-gradient(90deg, #333, #555, #333);
            border: 2px solid #FFFF00;
            border-radius: 20px;
            left: 50%;
            bottom: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 20px rgba(255,255,0,0.5);
        }

        .runway::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 4px;
            background: repeating-linear-gradient(90deg, 
                white 0px, white 20px, 
                transparent 20px, transparent 40px);
            top: 50%;
            transform: translateY(-50%);
        }

        .runway-lights {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .runway-light {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #FFFF00;
            border-radius: 50%;
            animation: runwayBlink 2s infinite;
        }

        @keyframes runwayBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .airport-building {
            position: absolute;
            width: 80px;
            height: 60px;
            background: linear-gradient(135deg, #4A5568, #2D3748);
            border-radius: 5px;
            right: 20px;
            bottom: 20px;
        }

        .control-tower {
            position: absolute;
            width: 20px;
            height: 80px;
            background: linear-gradient(to top, #2D3748, #4A5568);
            right: 0px;
            bottom: 60px;
            border-radius: 3px;
        }

        .control-tower::after {
            content: "";
            position: absolute;
            width: 25px;
            height: 15px;
            background: #E53E3E;
            top: 0;
            left: -2.5px;
            border-radius: 3px;
            animation: towerLight 3s infinite;
        }

        @keyframes towerLight {
            0%, 90% { opacity: 1; }
            95%, 100% { opacity: 0.3; }
        }

        /* é™è½å¼•å¯¼çº¿ */
        .landing-guide {
            position: absolute;
            width: 3px;
            background: linear-gradient(to bottom, 
                rgba(255,255,0,0) 0%,
                rgba(255,255,0,0.8) 20%,
                rgba(255,255,0,0.8) 80%,
                rgba(255,255,0,0) 100%);
            transform-origin: bottom;
            z-index: 5;
            animation: guidePulse 2s infinite;
            display: none;
        }

        @keyframes guidePulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .mountain {
            position: absolute;
            width: 0;
            height: 0;
            transform-style: preserve-3d;
        }

        .mountain-face {
            position: absolute;
            background: linear-gradient(135deg, #8B4513, #A0522D);
            transform-origin: bottom;
        }

        .mountain-shadow {
            position: absolute;
            background: rgba(0,0,0,0.3);
            transform-origin: bottom;
        }

        .cloud {
            position: absolute;
            background: rgba(255,255,255,0.8);
            border-radius: 50px;
            animation: cloudFloat 15s linear infinite;
        }

        @keyframes cloudFloat {
            0% { transform: translateZ(0) translateY(0); }
            100% { transform: translateZ(-1500px) translateY(-20px); }
        }

        .tree {
            position: absolute;
            width: 8px;
            height: 20px;
            background: linear-gradient(to bottom, #228B22, #006400);
            border-radius: 4px;
            transform-style: preserve-3d;
        }

        .airplane {
            position: absolute;
            width: 60px;
            height: 60px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            transition: all 0.1s ease;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5));
        }

        .airplane.on-ground {
            transform: translate(-50%, -50%) scale(0.8);
        }

        .airplane.taking-off {
            animation: takeoffShake 0.5s ease-in-out;
        }

        @keyframes takeoffShake {
            0%, 100% { transform: translate(-50%, -50%) scale(0.8); }
            25% { transform: translate(-50%, -50%) scale(0.8) rotate(-1deg); }
            75% { transform: translate(-50%, -50%) scale(0.8) rotate(1deg); }
        }

        .airplane-body {
            position: absolute;
            width: 40px;
            height: 8px;
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            border-radius: 4px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .airplane-wing {
            position: absolute;
            width: 30px;
            height: 4px;
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            border-radius: 2px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .airplane-wing.left {
            transform: translate(-50%, -50%) rotate(-45deg) translateX(-15px);
        }

        .airplane-wing.right {
            transform: translate(-50%, -50%) rotate(45deg) translateX(15px);
        }

        .airplane-tail {
            position: absolute;
            width: 15px;
            height: 3px;
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            border-radius: 2px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) translateX(-25px);
        }

        .airplane-propeller {
            position: absolute;
            width: 20px;
            height: 2px;
            background: rgba(255,255,255,0.8);
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) translateX(20px);
            animation: propellerSpin 0.1s linear infinite;
            border-radius: 1px;
        }

        .airplane-propeller.slow {
            animation: propellerSpin 0.3s linear infinite;
        }

        @keyframes propellerSpin {
            0% { transform: translate(-50%, -50%) translateX(20px) rotate(0deg); }
            100% { transform: translate(-50%, -50%) translateX(20px) rotate(360deg); }
        }

        .obstacle {
            position: absolute;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #FF4444, #CC0000);
            border-radius: 50%;
            border: 3px solid #FFFF00;
            animation: obstacleMove 8s linear infinite;
            z-index: 50;
            box-shadow: 0 0 20px rgba(255,68,68,0.6);
        }

        @keyframes obstacleMove {
            0% { transform: translateZ(500px) scale(0.3); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateZ(-500px) scale(1.5); opacity: 0; }
        }

        .fuel-item {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #4CAF50, #2E7D32);
            border-radius: 50%;
            border: 2px solid #8BC34A;
            animation: fuelMove 10s linear infinite;
            z-index: 50;
            box-shadow: 0 0 15px rgba(76,175,80,0.6);
        }

        @keyframes fuelMove {
            0% { transform: translateZ(500px) scale(0.3); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateZ(-500px) scale(1.3); opacity: 0; }
        }

        .explosion {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, #FF6B00, #FF0000, transparent);
            animation: explode 0.6s ease-out forwards;
            z-index: 200;
        }

        @keyframes explode {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(2); opacity: 0; }
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #FFD700;
            border-radius: 50%;
            animation: particleFloat 2s ease-out forwards;
        }

        @keyframes particleFloat {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(145deg, #4CAF50, #45a049);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76,175,80,0.4);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.taxi {
            background: linear-gradient(145deg, #FF9800, #F57C00);
        }

        .control-btn.taxi:hover {
            box-shadow: 0 5px 15px rgba(255,152,0,0.4);
        }

        .fuel-bar {
            position: fixed;
            top: 80px;
            left: 20px;
            width: 200px;
            height: 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            border: 2px solid #4CAF50;
            overflow: hidden;
        }

        .fuel-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF4444, #FFEB3B, #4CAF50);
            border-radius: 8px;
            transition: width 0.3s ease;
            width: 100%;
        }

        .fuel-label {
            position: absolute;
            top: -25px;
            left: 0;
            color: white;
            font-size: 0.9em;
            font-weight: bold;
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            z-index: 1000;
            backdrop-filter: blur(15px);
            border: 2px solid #4CAF50;
            display: none;
        }

        .game-over h2 {
            color: #FF4444;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .game-over p {
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .restart-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(145deg, #4CAF50, #45a049);
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(76,175,80,0.4);
        }

        .instructions {
            position: fixed;
            top: 130px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            font-size: 0.9em;
            max-width: 280px;
        }

        .instructions h3 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .instructions p {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .status-indicator {
            position: fixed;
            top: 110px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            font-weight: bold;
            border: 2px solid;
            transition: all 0.3s ease;
        }

        .status-indicator.ground {
            color: #FF9800;
            border-color: #FF9800;
        }

        .status-indicator.airborne {
            color: #4CAF50;
            border-color: #4CAF50;
        }

        .status-indicator.landing {
            color: #2196F3;
            border-color: #2196F3;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @media (max-width: 768px) {
            .game-stats { gap: 15px; font-size: 1em; }
            .airplane { width: 50px; height: 50px; }
            .controls { bottom: 10px; gap: 10px; flex-wrap: wrap; }
            .control-btn { padding: 8px 15px; font-size: 0.8em; }
            .instructions { position: static; margin: 10px; max-width: none; }
            .fuel-bar { width: 150px; height: 15px; top: 70px; left: 10px; }
            .airport { width: 300px; height: 150px; }
            .runway { width: 200px; height: 30px; }
        }
    </style>
</head>
<body>
    <div class="game-header">
        <div class="game-title">âœˆï¸ 3Dé£è¡Œå†’é™© - å®Œæ•´ç‰ˆ</div>
        <div class="game-stats">
            <div class="stat-item">
                <div class="stat-label">å¾—åˆ†</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">è·ç¦»</div>
                <div class="stat-value" id="distance">0km</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">é«˜åº¦</div>
                <div class="stat-value" id="altitude">0m</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">é€Ÿåº¦</div>
                <div class="stat-value" id="speed">0km/h</div>
            </div>
        </div>
    </div>

    <div class="fuel-bar">
        <div class="fuel-label">ç‡ƒæ–™</div>
        <div class="fuel-fill" id="fuelFill"></div>
    </div>

    <div class="status-indicator ground" id="statusIndicator">
        åœ°é¢å¾…å‘½
    </div>

    <div class="game-container" id="gameContainer">
        <div class="terrain" id="terrain"></div>
        
        <!-- æœºåœº -->
        <div class="airport" id="airport">
            <div class="runway" id="runway">
                <div class="runway-lights">
                    <div class="runway-light" style="left: 10px; top: 5px;"></div>
                    <div class="runway-light" style="left: 50px; top: 5px;"></div>
                    <div class="runway-light" style="left: 90px; top: 5px;"></div>
                    <div class="runway-light" style="left: 130px; top: 5px;"></div>
                    <div class="runway-light" style="left: 170px; top: 5px;"></div>
                    <div class="runway-light" style="left: 210px; top: 5px;"></div>
                    <div class="runway-light" style="left: 250px; top: 5px;"></div>
                    
                    <div class="runway-light" style="left: 10px; bottom: 5px;"></div>
                    <div class="runway-light" style="left: 50px; bottom: 5px;"></div>
                    <div class="runway-light" style="left: 90px; bottom: 5px;"></div>
                    <div class="runway-light" style="left: 130px; bottom: 5px;"></div>
                    <div class="runway-light" style="left: 170px; bottom: 5px;"></div>
                    <div class="runway-light" style="left: 210px; bottom: 5px;"></div>
                    <div class="runway-light" style="left: 250px; bottom: 5px;"></div>
                </div>
            </div>
            <div class="airport-building"></div>
            <div class="control-tower"></div>
        </div>

        <!-- é™è½å¼•å¯¼çº¿ -->
        <div class="landing-guide" id="landingGuide"></div>
        
        <div class="airplane on-ground" id="airplane">
            <div class="airplane-propeller slow"></div>
            <div class="airplane-body"></div>
            <div class="airplane-wing left"></div>
            <div class="airplane-wing right"></div>
            <div class="airplane-tail"></div>
        </div>
    </div>

    <div class="controls">
        <button class="control-btn" id="upBtn">â¬†ï¸ ä¸Šå‡</button>
        <button class="control-btn" id="downBtn">â¬‡ï¸ ä¸‹é™</button>
        <button class="control-btn" id="leftBtn">â¬…ï¸ å·¦è½¬</button>
        <button class="control-btn" id="rightBtn">â¡ï¸ å³è½¬</button>
        <button class="control-btn taxi" id="taxiBtn">ğŸ›¬ æ»‘è¡Œ</button>
        <button class="control-btn" id="pauseBtn">â¸ï¸ æš‚åœ</button>
    </div>

    <div class="instructions">
        <h3>ğŸ® æ“ä½œè¯´æ˜</h3>
        <p><strong>é”®ç›˜ï¼š</strong> WASD æˆ– æ–¹å‘é”®æ§åˆ¶é£è¡Œ</p>
        <p><strong>æ»‘è¡Œï¼š</strong> T é”®æˆ–ç‚¹å‡»æ»‘è¡ŒæŒ‰é’®</p>
        <p><strong>èµ·é£ï¼š</strong> æ»‘è¡Œæ—¶æŒ‰ä¸Šé”®åŠ é€Ÿèµ·é£</p>
        <p><strong>é™è½ï¼š</strong> è¿”å›æœºåœºæ—¶å‡ºç°å¼•å¯¼çº¿</p>
        <p><strong>ç›®æ ‡ï¼š</strong> é¿å¼€çº¢è‰²éšœç¢ç‰©ï¼Œæ”¶é›†ç»¿è‰²ç‡ƒæ–™</p>
        <p><strong>æç¤ºï¼š</strong> æ³¨æ„ç‡ƒæ–™æ¶ˆè€—å’Œå®‰å…¨é™è½</p>
    </div>

    <div class="game-over" id="gameOver">
        <h2>æ¸¸æˆç»“æŸ</h2>
        <p>ä½ çš„å¾—åˆ†: <span id="finalScore">0</span></p>
        <p>é£è¡Œè·ç¦»: <span id="finalDistance">0</span>km</p>
        <button class="restart-btn" onclick="restartGame()">ğŸ”„ é‡æ–°å¼€å§‹</button>
    </div>

    <script>
        class AirplaneGame {
            constructor() {
                this.airplane = document.getElementById('airplane');
                this.terrain = document.getElementById('terrain');
                this.gameContainer = document.getElementById('gameContainer');
                this.airport = document.getElementById('airport');
                this.runway = document.getElementById('runway');
                this.landingGuide = document.getElementById('landingGuide');
                this.statusIndicator = document.getElementById('statusIndicator');
                
                // æ¸¸æˆçŠ¶æ€
                this.score = 0;
                this.distance = 0;
                this.fuel = 100;
                this.altitude = 0;
                this.speed = 0;
                this.isGameRunning = true;
                this.isPaused = false;
                
                // é£è¡ŒçŠ¶æ€
                this.flightState = 'ground'; // ground, taxiing, takeoff, airborne, landing
                this.isOnGround = true;
                this.isTaxiing = false;
                this.taxiSpeed = 0;
                this.takeoffSpeed = 0;
                
                // é£æœºä½ç½®
                this.airplaneX = 0;
                this.airplaneY = 200; // å¼€å§‹åœ¨è·‘é“ä¸Š
                this.airplaneRotation = 0;
                this.runwayPosition = 0; // åœ¨è·‘é“ä¸Šçš„ä½ç½®
                
                // æ¸¸æˆå¯¹è±¡æ•°ç»„
                this.obstacles = [];
                this.fuelItems = [];
                this.mountains = [];
                this.clouds = [];
                this.trees = [];
                
                // è¾“å…¥æ§åˆ¶
                this.keys = {};
                this.mouseControls = {};
                
                this.initializeGame();
                this.setupControls();
                this.generateTerrain();
                this.gameLoop();
            }
            
            initializeGame() {
                this.updateUI();
                this.updateFlightStatus();
                this.generateInitialObjects();
                
                // é£æœºå¼€å§‹åœ¨è·‘é“å·¦ç«¯
                this.airplane.style.transform = `translate(-50%, -50%) translate(${this.airplaneX}px, ${this.airplaneY}px)`;
            }
            
            setupControls() {
                // é”®ç›˜æ§åˆ¶
                document.addEventListener('keydown', (e) => {
                    this.keys[e.key.toLowerCase()] = true;
                    if (e.key === ' ') {
                        e.preventDefault();
                        this.togglePause();
                    }
                    if (e.key.toLowerCase() === 't') {
                        this.toggleTaxi();
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                });
                
                // é¼ æ ‡/è§¦æ‘¸æ§åˆ¶
                const buttons = {
                    upBtn: () => this.mouseControls.up = true,
                    downBtn: () => this.mouseControls.down = true,
                    leftBtn: () => this.mouseControls.left = true,
                    rightBtn: () => this.mouseControls.right = true,
                    taxiBtn: () => this.toggleTaxi(),
                    pauseBtn: () => this.togglePause()
                };
                
                Object.keys(buttons).forEach(id => {
                    const btn = document.getElementById(id);
                    btn.addEventListener('mousedown', buttons[id]);
                    btn.addEventListener('touchstart', buttons[id]);
                    if (id !== 'taxiBtn' && id !== 'pauseBtn') {
                        btn.addEventListener('mouseup', () => this.mouseControls = {});
                        btn.addEventListener('touchend', () => this.mouseControls = {});
                    }
                });
            }
            
            toggleTaxi() {
                if (this.isOnGround && !this.isPaused) {
                    this.isTaxiing = !this.isTaxiing;
                    this.flightState = this.isTaxiing ? 'taxiing' : 'ground';
                    this.updateFlightStatus();
                    
                    // æ›´æ–°èºæ—‹æ¡¨é€Ÿåº¦
                    const propeller = this.airplane.querySelector('.airplane-propeller');
                    if (this.isTaxiing) {
                        propeller.classList.remove('slow');
                    } else {
                        propeller.classList.add('slow');
                        this.taxiSpeed = 0;
                    }
                }
            }
            
            updateFlightStatus() {
                const statusText = {
                    ground: 'åœ°é¢å¾…å‘½',
                    taxiing: 'è·‘é“æ»‘è¡Œ',
                    takeoff: 'èµ·é£ä¸­...',
                    airborne: 'ç©ºä¸­é£è¡Œ',
                    landing: 'å‡†å¤‡é™è½'
                };
                
                const statusClass = {
                    ground: 'ground',
                    taxiing: 'ground',
                    takeoff: 'airborne',
                    airborne: 'airborne',
                    landing: 'landing'
                };
                
                this.statusIndicator.textContent = statusText[this.flightState];
                this.statusIndicator.className = `status-indicator ${statusClass[this.flightState]}`;
            }
            
            generateTerrain() {
                // ç”Ÿæˆå±±è„‰
                for (let i = 0; i < 20; i++) {
                    this.createMountain();
                }
                
                // ç”Ÿæˆäº‘æœµ
                for (let i = 0; i < 15; i++) {
                    this.createCloud();
                }
                
                // ç”Ÿæˆæ ‘æœ¨
                for (let i = 0; i < 50; i++) {
                    this.createTree();
                }
            }
            
            createMountain() {
                const mountain = document.createElement('div');
                mountain.className = 'mountain';
                
                const size = Math.random() * 200 + 100;
                const height = Math.random() * 150 + 100;
                
                mountain.style.left = Math.random() * 150 + '%';
                mountain.style.top = Math.random() * 150 + '%';
                mountain.style.borderLeft = `${size/2}px solid transparent`;
                mountain.style.borderRight = `${size/2}px solid transparent`;
                mountain.style.borderBottom = `${height}px solid #8B4513`;
                mountain.style.transform = `rotateX(90deg) translateZ(-${Math.random() * 200}px)`;
                mountain.style.filter = `hue-rotate(${Math.random() * 60}deg)`;
                
                this.terrain.appendChild(mountain);
                this.mountains.push(mountain);
            }
            
            createCloud() {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                
                const size = Math.random() * 60 + 40;
                cloud.style.width = size + 'px';
                cloud.style.height = size * 0.6 + 'px';
                cloud.style.left = Math.random() * 150 + '%';
                cloud.style.top = Math.random() * 50 + '%';
                cloud.style.animationDelay = Math.random() * 15 + 's';
                cloud.style.opacity = Math.random() * 0.5 + 0.3;
                
                // æ·»åŠ äº‘æœµçš„å°ç»„ä»¶
                for (let i = 0; i < 3; i++) {
                    const cloudPart = document.createElement('div');
                    cloudPart.style.position = 'absolute';
                    cloudPart.style.borderRadius = '50%';
                    cloudPart.style.background = 'inherit';
                    cloudPart.style.width = size * (0.3 + Math.random() * 0.4) + 'px';
                    cloudPart.style.height = size * (0.3 + Math.random() * 0.4) + 'px';
                    cloudPart.style.left = Math.random() * size + 'px';
                    cloudPart.style.top = Math.random() * size * 0.3 + 'px';
                    cloud.appendChild(cloudPart);
                }
                
                this.terrain.appendChild(cloud);
                this.clouds.push(cloud);
            }
            
            createTree() {
                const tree = document.createElement('div');
                tree.className = 'tree';
                
                tree.style.left = Math.random() * 150 + '%';
                tree.style.top = Math.random() * 150 + '%';
                tree.style.height = Math.random() * 15 + 15 + 'px';
                tree.style.transform = `rotateX(90deg) translateZ(-${Math.random() * 50}px)`;
                tree.style.animationDelay = Math.random() * 20 + 's';
                
                this.terrain.appendChild(tree);
                this.trees.push(tree);
            }
            
            generateInitialObjects() {
                // ç”Ÿæˆåˆå§‹éšœç¢ç‰©å’Œç‡ƒæ–™ï¼ˆåªåœ¨ç©ºä¸­é£è¡Œæ—¶ç”Ÿæˆï¼‰
                setInterval(() => {
                    if (this.isGameRunning && !this.isPaused && this.flightState === 'airborne') {
                        if (Math.random() < 0.3) {
                            this.createObstacle();
                        }
                        if (Math.random() < 0.2) {
                            this.createFuelItem();
                        }
                    }
                }, 2000);
            }
            
            createObstacle() {
                const obstacle = document.createElement('div');
                obstacle.className = 'obstacle';
                
                obstacle.style.left = Math.random() * 80 + 10 + '%';
                obstacle.style.top = Math.random() * 80 + 10 + '%';
                obstacle.style.animationDelay = '0s';
                
                this.gameContainer.appendChild(obstacle);
                this.obstacles.push(obstacle);
                
                // è‡ªåŠ¨æ¸…ç†
                setTimeout(() => {
                    if (obstacle.parentNode) {
                        obstacle.parentNode.removeChild(obstacle);
                    }
                    this.obstacles = this.obstacles.filter(obs => obs !== obstacle);
                }, 8000);
            }
            
            createFuelItem() {
                const fuelItem = document.createElement('div');
                fuelItem.className = 'fuel-item';
                
                fuelItem.style.left = Math.random() * 80 + 10 + '%';
                fuelItem.style.top = Math.random() * 80 + 10 + '%';
                fuelItem.style.animationDelay = '0s';
                
                this.gameContainer.appendChild(fuelItem);
                this.fuelItems.push(fuelItem);
                
                // è‡ªåŠ¨æ¸…ç†
                setTimeout(() => {
                    if (fuelItem.parentNode) {
                        fuelItem.parentNode.removeChild(fuelItem);
                    }
                    this.fuelItems = this.fuelItems.filter(fuel => fuel !== fuelItem);
                }, 10000);
            }
            
            updateAirplaneMovement() {
                if (this.isPaused || !this.isGameRunning) return;
                
                if (this.flightState === 'ground') {
                    // åœ°é¢å¾…å‘½çŠ¶æ€ï¼Œé£æœºä¸åŠ¨
                    this.speed = 0;
                    return;
                }
                
                if (this.flightState === 'taxiing') {
                    // æ»‘è¡ŒçŠ¶æ€
                    if (this.keys['w'] || this.keys['arrowup'] || this.mouseControls.up) {
                        this.taxiSpeed = Math.min(this.taxiSpeed + 0.5, 15);
                        this.runwayPosition += this.taxiSpeed;
                        
                        // æ£€æŸ¥èµ·é£æ¡ä»¶
                        if (this.taxiSpeed >= 12) {
                            this.flightState = 'takeoff';
                            this.airplane.classList.add('taking-off');
                            this.updateFlightStatus();
                            
                            setTimeout(() => {
                                this.takeOff();
                            }, 1000);
                        }
                    } else {
                        this.taxiSpeed = Math.max(this.taxiSpeed - 0.2, 0);
                        this.runwayPosition += this.taxiSpeed;
                    }
                    
                    // æ›´æ–°é£æœºåœ¨è·‘é“ä¸Šçš„ä½ç½®
                    this.airplaneX = -100 + (this.runwayPosition * 2);
                    this.speed = this.taxiSpeed * 10;
                    
                    // å·¦å³å¾®è°ƒ
                    if (this.keys['a'] || this.keys['arrowleft'] || this.mouseControls.left) {
                        this.airplaneY = Math.min(this.airplaneY + 1, 220);
                    }
                    if (this.keys['d'] || this.keys['arrowright'] || this.mouseControls.right) {
                        this.airplaneY = Math.max(this.airplaneY - 1, 180);
                    }
                    
                    return;
                }
                
                if (this.flightState === 'airborne') {
                    // ç©ºä¸­é£è¡Œ
                    const moveSpeed = 3;
                    let moved = false;
                    
                    // é”®ç›˜æ§åˆ¶
                    if (this.keys['w'] || this.keys['arrowup'] || this.mouseControls.up) {
                        this.airplaneY = Math.max(this.airplaneY - moveSpeed, -200);
                        this.altitude = Math.min(this.altitude + 10, 2000);
                        moved = true;
                    }
                    if (this.keys['s'] || this.keys['arrowdown'] || this.mouseControls.down) {
                        this.airplaneY = Math.min(this.airplaneY + moveSpeed, 200);
                        this.altitude = Math.max(this.altitude - 10, 100);
                        moved = true;
                    }
                    if (this.keys['a'] || this.keys['arrowleft'] || this.mouseControls.left) {
                        this.airplaneX = Math.max(this.airplaneX - moveSpeed, -300);
                        this.airplaneRotation = Math.max(this.airplaneRotation - 2, -15);
                        moved = true;
                    }
                    if (this.keys['d'] || this.keys['arrowright'] || this.mouseControls.right) {
                        this.airplaneX = Math.min(this.airplaneX + moveSpeed, 300);
                        this.airplaneRotation = Math.min(this.airplaneRotation + 2, 15);
                        moved = true;
                    }
                    
                    // è‡ªåŠ¨å›æ­£
                    if (!moved) {
                        this.airplaneRotation *= 0.9;
                    }
                    
                    // æ£€æŸ¥é™è½æ¡ä»¶
                    this.checkLandingCondition();
                }
                
                // æ›´æ–°é£æœºä½ç½®
                this.airplane.style.transform = `translate(-50%, -50%) translate(${this.airplaneX}px, ${this.airplaneY}px) rotate(${this.airplaneRotation}deg)`;
            }
            
            takeOff() {
                this.flightState = 'airborne';
                this.isOnGround = false;
                this.isTaxiing = false;
                this.airplane.classList.remove('on-ground', 'taking-off');
                this.altitude = 200;
                this.speed = 250;
                this.updateFlightStatus();
                
                // éšè—æœºåœº
                this.airport.style.transform = 'translateX(-50%) translateY(100px) scale(0.5)';
                this.airport.style.opacity = '0.3';
            }
            
            checkLandingCondition() {
                // å½“é£æœºå›åˆ°æ¥è¿‘èµ·å§‹ä½ç½®ä¸”é«˜åº¦è¾ƒä½æ—¶ï¼Œæ˜¾ç¤ºé™è½å¼•å¯¼
                if (Math.abs(this.airplaneX) < 50 && this.airplaneY > 100 && this.altitude < 300) {
                    if (this.flightState !== 'landing') {
                        this.flightState = 'landing';
                        this.updateFlightStatus();
                        this.showLandingGuide();
                        
                        // æ˜¾ç¤ºæœºåœº
                        this.airport.style.transform = 'translateX(-50%) translateY(0) scale(1)';
                        this.airport.style.opacity = '1';
                    }
                    
                    // æ£€æŸ¥é™è½
                    if (this.airplaneY > 180 && this.airplaneY < 220 && Math.abs(this.airplaneX) < 30) {
                        this.land();
                    }
                } else if (this.flightState === 'landing') {
                    this.flightState = 'airborne';
                    this.updateFlightStatus();
                    this.hideLandingGuide();
                    
                    // éšè—æœºåœº
                    this.airport.style.transform = 'translateX(-50%) translateY(100px) scale(0.5)';
                    this.airport.style.opacity = '0.3';
                }
            }
            
            showLandingGuide() {
                const guide = this.landingGuide;
                guide.style.display = 'block';
                
                // è®¡ç®—å¼•å¯¼çº¿ä½ç½®
                const airplaneRect = this.airplane.getBoundingClientRect();
                const runwayRect = this.runway.getBoundingClientRect();
                
                const startX = airplaneRect.left + airplaneRect.width / 2;
                const startY = airplaneRect.top + airplaneRect.height / 2;
                const endX = runwayRect.left + runwayRect.width / 2;
                const endY = runwayRect.top + runwayRect.height / 2;
                
                const length = Math.sqrt((endX - startX) ** 2 + (endY - startY) ** 2);
                const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI + 90;
                
                guide.style.height = length + 'px';
                guide.style.left = startX + 'px';
                guide.style.top = startY + 'px';
                guide.style.transform = `rotate(${angle}deg)`;
            }
            
            hideLandingGuide() {
                this.landingGuide.style.display = 'none';
            }
            
            land() {
                this.flightState = 'ground';
                this.isOnGround = true;
                this.airplane.classList.add('on-ground');
                this.altitude = 0;
                this.speed = 0;
                this.airplaneX = 0;
                this.airplaneY = 200;
                this.airplaneRotation = 0;
                this.runwayPosition = 0;
                this.updateFlightStatus();
                this.hideLandingGuide();
                
                // é™è½å¥–åŠ±
                this.score += 100;
                this.fuel = Math.min(this.fuel + 30, 100);
                
                // èºæ—‹æ¡¨å˜æ…¢
                const propeller = this.airplane.querySelector('.airplane-propeller');
                propeller.classList.add('slow');
                
                // æ˜¾ç¤ºæœºåœº
                this.airport.style.transform = 'translateX(-50%) translateY(0) scale(1)';
                this.airport.style.opacity = '1';
            }
            
            checkCollisions() {
                if (this.isPaused || !this.isGameRunning || this.flightState !== 'airborne') return;
                
                const airplaneRect = this.airplane.getBoundingClientRect();
                const centerX = airplaneRect.left + airplaneRect.width / 2;
                const centerY = airplaneRect.top + airplaneRect.height / 2;
                
                // æ£€æŸ¥éšœç¢ç‰©ç¢°æ’
                this.obstacles.forEach((obstacle, index) => {
                    const obstacleRect = obstacle.getBoundingClientRect();
                    const obsX = obstacleRect.left + obstacleRect.width / 2;
                    const obsY = obstacleRect.top + obstacleRect.height / 2;
                    
                    const distance = Math.sqrt((centerX - obsX) ** 2 + (centerY - obsY) ** 2);
                    
                    if (distance < 40) {
                        this.createExplosion(centerX, centerY);
                        this.gameOver();
                    }
                });
                
                // æ£€æŸ¥ç‡ƒæ–™æ”¶é›†
                this.fuelItems.forEach((fuelItem, index) => {
                    const fuelRect = fuelItem.getBoundingClientRect();
                    const fuelX = fuelRect.left + fuelRect.width / 2;
                    const fuelY = fuelRect.top + fuelRect.height / 2;
                    
                    const distance = Math.sqrt((centerX - fuelX) ** 2 + (centerY - fuelY) ** 2);
                    
                    if (distance < 35) {
                        this.collectFuel(fuelItem, index);
                        this.createParticleEffect(fuelX, fuelY, '#4CAF50');
                    }
                });
            }
            
            collectFuel(fuelItem, index) {
                this.fuel = Math.min(this.fuel + 20, 100);
                this.score += 50;
                
                // ç§»é™¤ç‡ƒæ–™é¡¹
                if (fuelItem.parentNode) {
                    fuelItem.parentNode.removeChild(fuelItem);
                }
                this.fuelItems.splice(index, 1);
            }
            
            createExplosion(x, y) {
                const explosion = document.createElement('div');
                explosion.className = 'explosion';
                explosion.style.left = x - 50 + 'px';
                explosion.style.top = y - 50 + 'px';
                
                document.body.appendChild(explosion);
                
                setTimeout(() => {
                    if (explosion.parentNode) {
                        explosion.parentNode.removeChild(explosion);
                    }
                }, 600);
            }
            
            createParticleEffect(x, y, color) {
                for (let i = 0; i < 8; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = x + 'px';
                    particle.style.top = y + 'px';
                    particle.style.background = color;
                    
                    const dx = (Math.random() - 0.5) * 100;
                    const dy = (Math.random() - 0.5) * 100;
                    particle.style.setProperty('--dx', dx + 'px');
                    particle.style.setProperty('--dy', dy + 'px');
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 2000);
                }
            }
            
            updateGameLogic() {
                if (this.isPaused || !this.isGameRunning) return;
                
                // åªåœ¨é£è¡Œä¸­æ›´æ–°è·ç¦»å’Œæ¶ˆè€—ç‡ƒæ–™
                if (this.flightState === 'airborne') {
                    this.distance += 0.1;
                    this.score += 1;
                    this.fuel -= 0.05;
                    
                    if (this.fuel <= 0) {
                        this.gameOver();
                    }
                    
                    // éšæœºé€Ÿåº¦å˜åŒ–
                    this.speed = 250 + Math.sin(Date.now() * 0.001) * 20;
                }
                
                this.updateUI();
            }
            
            updateUI() {
                document.getElementById('score').textContent = Math.floor(this.score);
                document.getElementById('distance').textContent = Math.floor(this.distance) + 'km';
                document.getElementById('altitude').textContent = Math.floor(this.altitude) + 'm';
                document.getElementById('speed').textContent = Math.floor(this.speed) + 'km/h';
                
                const fuelFill = document.getElementById('fuelFill');
                fuelFill.style.width = this.fuel + '%';
                
                // ç‡ƒæ–™è­¦å‘Š
                if (this.fuel < 30) {
                    fuelFill.style.animation = 'pulse 0.5s infinite';
                } else {
                    fuelFill.style.animation = '';
                }
            }
            
            togglePause() {
                this.isPaused = !this.isPaused;
                const pauseBtn = document.getElementById('pauseBtn');
                pauseBtn.textContent = this.isPaused ? 'â–¶ï¸ ç»§ç»­' : 'â¸ï¸ æš‚åœ';
                
                // æš‚åœåŠ¨ç”»
                const animations = document.querySelectorAll('.terrain, .obstacle, .fuel-item, .cloud, .runway-light, .control-tower');
                animations.forEach(el => {
                    el.style.animationPlayState = this.isPaused ? 'paused' : 'running';
                });
            }
            
            gameOver() {
                this.isGameRunning = false;
                
                // åœæ­¢æ‰€æœ‰åŠ¨ç”»
                const animations = document.querySelectorAll('.terrain, .obstacle, .fuel-item, .cloud, .runway-light, .control-tower');
                animations.forEach(el => {
                    el.style.animationPlayState = 'paused';
                });
                
                // æ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
                document.getElementById('finalScore').textContent = Math.floor(this.score);
                document.getElementById('finalDistance').textContent = Math.floor(this.distance);
                document.getElementById('gameOver').style.display = 'block';
            }
            
            gameLoop() {
                if (this.isGameRunning) {
                    this.updateAirplaneMovement();
                    this.checkCollisions();
                    this.updateGameLogic();
                }
                
                requestAnimationFrame(() => this.gameLoop());
            }
        }
        
        // å…¨å±€æ¸¸æˆå®ä¾‹
        let game;
        
        function startGame() {
            game = new AirplaneGame();
        }
        
        function restartGame() {
            // æ¸…ç†ç°æœ‰æ¸¸æˆ
            if (game) {
                const gameContainer = document.getElementById('gameContainer');
                const obstacles = gameContainer.querySelectorAll('.obstacle, .fuel-item');
                obstacles.forEach(obs => obs.remove());
                
                const terrain = document.getElementById('terrain');
                const terrainObjects = terrain.querySelectorAll('.mountain, .cloud, .tree');
                terrainObjects.forEach(obj => obj.remove());
            }
            
            // é‡ç½®UI
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('pauseBtn').textContent = 'â¸ï¸ æš‚åœ';
            
            // é‡ç½®é£æœºçŠ¶æ€
            const airplane = document.getElementById('airplane');
            airplane.className = 'airplane on-ground';
            const propeller = airplane.querySelector('.airplane-propeller');
            propeller.classList.add('slow');
            
            // é‡ç½®æœºåœº
            const airport = document.getElementById('airport');
            airport.style.transform = 'translateX(-50%) translateY(0) scale(1)';
            airport.style.opacity = '1';
            
            // å¯åŠ¨æ–°æ¸¸æˆ
            startGame();
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', () => {
            startGame();
        });
    </script>
</body>
</html>