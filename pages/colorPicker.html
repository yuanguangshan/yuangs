<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Picker - 颜色选择器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            padding: 10px;
            margin: 0;
        }

        .main-container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            gap: 10px;
            min-height: 80vh;  /* Set minimum height */
        }

        .controls-section {
            flex: 1;
            min-width: 350px;
            display: flex;
            flex-direction: column;
        }

        .results-section {
            flex: 1;
            min-width: 350px;
            display: flex;
            flex-direction: column;
        }

        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 10px;
        }

        .controls-section > .container,
        .results-section > .container {
            flex: 1 1 auto;  /* Allow containers to grow */
        }

        /* Specific styles for scrollable color grid containers */
        .color-grid {
            overflow-y: auto;
        }

        /* Set fixed heights to ensure alignment */
        #dynamicColorMatrix {
            min-height: 200px;
        }

        #presetColorMatrix {
            min-height: 120px;
        }

        #clipboardColorsMatrix {
            min-height: 80px;
        }

        .results-section {
            min-height: 1px; /* Ensure flex property works */
        }

        /* Floating copy button */
        .floating-copy-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #007AFF;
            color: white;
            border: none;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: transform 0.2s, background-color 0.2s;
        }

        .floating-copy-btn:hover {
            transform: scale(1.1);
            background: #0056b3;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.4em;
        }

        .input-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .input-mode-toggle {
            padding: 8px 15px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .input-field {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        .clear-btn {
            padding: 10px 15px;
            background: #FF3B30;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .color-preview {
            width: 60px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
        }

        .preview-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .rgb-bars {
            display: flex;
            align-items: flex-end;
            height: 30px;
            gap: 2px;
            margin-left: 10px;
        }

        .rgb-bar {
            width: 8px;
            background: red;
            border-radius: 2px;
            border: 0.5px solid lightgray;
        }

        .rgb-bar.green { background: green; }
        .rgb-bar.blue { background: blue; }

        .slider-container {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-label {
            width: 20px;
            font-weight: bold;
            font-size: 18px;
        }

        .slider {
            flex: 1;
        }

        .slider-value {
            width: 40px;
            text-align: center;
        }

        .palette-section {
            margin: 20px 0;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .mode-selector {
            margin-bottom: 15px;
        }

        .mode-buttons {
            display: flex;
            gap: 10px;
        }

        .mode-btn {
            padding: 8px 15px;
            background: #e0e0e0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .mode-btn.active {
            background: #007AFF;
            color: white;
        }

        .color-grid {
            display: grid;
            gap: 6px;
            margin-top: 10px;
        }

        .preset-colors {
            grid-template-columns: repeat(12, 1fr);
        }

        .dynamic-colors {
            grid-template-columns: repeat(15, 1fr);
        }

        .scheme-preview {
            grid-template-columns: repeat(6, 1fr);
        }

        .clipboard-colors {
            grid-template-columns: repeat(6, 1fr);
        }

        .color-item {
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
            position: relative;
        }

        .color-item.selected {
            border: 3px solid #007AFF;
            box-sizing: border-box;
        }

        .clipboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .restart-btn {
            padding: 5px 10px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-btn {
            width: 100%;
            padding: 15px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        .copy-btn:hover {
            background: #0056b3;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 12px;
        }

        .scheme-item {
            position: relative;
            height: 25px;
            border-radius: 3px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 1px;
        }

        .scheme-type {
            font-size: 6px;
            color: white;
            text-align: center;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        .scheme-hex {
            font-size: 5px;
            color: white;
            text-align: center;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h1 id="title">Apple设计色系</h1>
        <div style="display: flex; gap: 5px;">
            <button class="copy-btn" id="exportCurrentColor" style="background-color: #5C6BC0; padding: 6px 12px; font-size: 12px; margin: 0;">
                导出颜色
            </button>
            <button class="copy-btn" id="exportColorScheme" style="background-color: #AB47BC; padding: 6px 12px; font-size: 12px; margin: 0;">
                导出方案
            </button>
            <button class="copy-btn" id="exportPalette" style="background-color: #26A69A; padding: 6px 12px; font-size: 12px; margin: 0;">
                导出色盘
            </button>
        </div>
    </div>

    <div class="main-container">
        <div class="controls-section">
            <div class="container" style="padding: 10px;">
                <div class="clipboard-header" style="margin-bottom: 5px;">
                    <div id="clipboard-label">剪切板</div>
                    <div>
                        <button class="restart-btn" id="restartClipboardMonitorButton">重新监控</button>
                        <button class="restart-btn" id="manualClipboardCheckButton" style="background-color: #5C6BC0; margin-left: 5px;">手动检查</button>
                    </div>
                </div>
                <div class="color-grid clipboard-colors" id="clipboardColorsMatrix" style="max-height: 100px; overflow-y: auto;">
                    <!-- Clipboard colors will appear here -->
                </div>
            </div>

            <div class="container" style="padding: 10px;">
                <div class="input-section">
                    <button class="input-mode-toggle" id="inputModeToggle">HEX</button>
                    <input type="text" class="input-field" id="hexInput" placeholder="#FF0000" value="#007AFF">
                    <input type="text" class="input-field" id="rgbInput" placeholder="R,G,B" value="0, 122, 255" style="display: none;">
                    <button class="clear-btn" id="hexClearButton" style="display: none;">×</button>
                    <button class="clear-btn" id="rgbClearButton" style="display: none;">×</button>
                    <div class="rgb-bars" id="rgbColorBarsContainer" style="display: none;">
                        <div class="rgb-bar" id="redBar"></div>
                        <div class="rgb-bar green" id="greenBar"></div>
                        <div class="rgb-bar blue" id="blueBar"></div>
                    </div>
                    <div class="preview-container">
                        <div class="color-preview" id="currentColorPreview" style="background-color: #007AFF; color: white;">系统蓝</div>
                    </div>
                </div>
            </div>

            <div class="container" style="padding: 10px;">
                <div class="slider-container" style="margin: 3px 0;">
                    <div class="slider-label" style="color: #FF0000;">R</div>
                    <input type="range" min="0" max="255" class="slider" id="redSlider" value="0">
                    <div class="slider-value" id="redValueLabel">0</div>
                </div>
                <div class="slider-container" style="margin: 3px 0;">
                    <div class="slider-label" style="color: #00FF00;">G</div>
                    <input type="range" min="0" max="255" class="slider" id="greenSlider" value="122">
                    <div class="slider-value" id="greenValueLabel">122</div>
                </div>
                <div class="slider-container" style="margin: 3px 0;">
                    <div class="slider-label" style="color: #0000FF;">B</div>
                    <input type="range" min="0" max="255" class="slider" id="blueSlider" value="255">
                    <div class="slider-value" id="blueValueLabel">255</div>
                </div>
            </div>

            <div class="container" style="padding: 10px;">
                <div class="palette-section">
                    <div class="section-title">预设品牌色系</div>
                    <div style="margin-bottom: 5px; display: flex; align-items: center; gap: 5px;">
                        <label for="paletteSelector" style="font-size: 12px;">选择品牌:</label>
                        <select id="paletteSelector" style="padding: 3px; border-radius: 4px; border: 1px solid #ddd; font-size: 12px; flex: 1;">
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    <div class="color-grid preset-colors" id="presetColorMatrix">
                        <!-- Preset colors will be populated dynamically -->
                    </div>
                </div>
            </div>

            <div class="container" style="padding: 10px;">
                <div class="palette-section">
                    <div class="section-title">动态色阶模式</div>
                    <div class="mode-selector" style="margin-bottom: 5px;">
                        <div class="mode-buttons">
                            <button class="mode-btn active" data-index="0">邻近(固H)</button>
                            <button class="mode-btn" data-index="1">同饱和(固S)</button>
                            <button class="mode-btn" data-index="2">同明度(固V)</button>
                        </div>
                    </div>
                    <div class="color-grid dynamic-colors" id="dynamicColorMatrix">
                        <!-- Dynamic colors will be populated dynamically -->
                    </div>
                </div>
            </div>

        </div>

        <div class="results-section">
            <div class="container" style="padding: 10px;">
                <div class="palette-section">
                    <div class="section-title">配色方案预览</div>
                    <div class="color-grid scheme-preview" id="schemePreviewMatrix" style="max-height: 220px; overflow-y: auto; flex: 1;">
                        <!-- Scheme preview colors will appear here -->
                    </div>
                </div>
            </div>

            <div class="container">
                <div class="palette-section">
                    <div class="section-title">其他动态色阶</div>
                    <div id="dynamicComparisonContainer" style="flex: 1;">
                        <!-- Two dynamic color variations will be displayed here -->
                    </div>
                </div>
            </div>

            <div class="footer">
                <p>Color Picker 工具 - 保留所有JSBox功能</p>
            </div>
        </div>

        <!-- Floating copy button -->
        <button class="floating-copy-btn" id="floatingCopyButton" title="复制当前颜色">.Copy</button>
    </div>

    <script>
        // Color palette data
        const colorPalettes = {
          "Apple": {
            name: "Apple",
            colors: [
              // 官方 / 系统主色
              "#007AFF", // iOS 系统蓝 (Primary)
              "#34C759", // 系统绿 (Success)
              "#FF3B30", // 系统红 (Destructive)
              "#FF9500", // 系统橙 (Warning)
              "#FFCC00", // 系统黄
              "#FF2D55", // 系统粉 (Accent)
              "#AF52DE", // 系统紫
              // 近似官方 UI 扩展
              "#5856D6", // 蓝紫
              "#5AC8FA", // 浅蓝
              "#30B0C7", // 青蓝
              "#8E8E93", // 中性灰
              "#C7C7CC"  // 浅灰
            ]
          },
          "Google": {
            name: "Google Material",
            colors: [
              // Google Logo 四色（主色）
              "#4285F4", // Blue
              "#EA4335", // Red（更贴近新版）
              "#FBBC05", // Yellow
              "#34A853", // Green
              // 常用 Material 衍生色（选自 Material 500/400 段）
              "#5C6BC0", // Indigo 400
              "#AB47BC", // Purple 400
              "#00ACC1", // Cyan 600
              "#26A69A", // Teal 400
              "#FF7043", // Deep Orange 400
              "#EC407A", // Pink 400
              "#9E9E9E", // Grey 500
              "#FF5722"  // Deep Orange 500（强调）
            ]
          },
          "Meta": {
            name: "Meta",
            colors: [
              // Meta / Facebook 主色
              "#0081FB", // Meta 蓝
              "#1877F2", // Facebook 蓝
              "#0084FF", // FB 按钮蓝
              // WhatsApp / Messenger / Instagram 相关色（配色工具里实用）
              "#25D366", // WhatsApp 绿
              "#00A400", // 深绿 (变体)
              "#FF6B00", // 橙
              "#FF0080", // 品牌粉
              "#9B30FF", // 品牌紫
              "#00D4AA", // 青绿
              "#FF385C", // 桃红
              "#42B72A", // FB 辅助绿
              "#E4405F"  // Instagram 粉
            ]
          },
          "Twitter": {
            name: "Twitter",
            colors: [
              // 品牌主色 + 标准灰阶
              "#1DA1F2", // Twitter Blue
              "#14171A", // Dark text
              "#657786", // Mid gray
              "#AAB8C2", // Light gray
              "#E1E8ED", // Border gray
              "#F5F8FA", // Background
              // 衍生蓝色阶，用于 hover/press 等
              "#1C9CEA", // Hover
              "#0D8BD9", // 深一点蓝
              "#0074C2", // 更深
              "#005BA1", // 更深
              "#004680", // 近 navy
              "#003B5C"  // 极深蓝
            ]
          },
          "淘宝": {
            name: "淘宝",
            colors: [
              // 淘宝主色与常见变体
              "#FF4400", // 淘宝经典橙
              "#FF5000", // Logo 橙
              "#FF6600", // 较亮橙
              "#FF9000", // 偏黄橙
              // UI 中常见提示色扩展
              "#FFCA28", // 亮黄
              "#FFA726", // 橙黄
              "#FF7043", // 橙红
              "#E64340", // 红-错误/提示
              "#FF3E3E", // 亮红
              "#FA5151", // 粉红红
              "#FF8A65", // 暖橙
              "#FFB74D"  // 浅橙
            ]
          },
          "微信": {
            name: "微信",
            colors: [
              // 主绿系
              "#07C160", // 新版主绿
              "#09BB07", // 旧版绿
              "#2AAE67", // 中间绿
              "#00D65A", // 亮绿
              // 蓝 & 链接色
              "#10AEFF", // 亮蓝
              "#1485EE", // 按钮/链接蓝
              "#576B95", // 链接蓝灰
              // 状态/警示色
              "#FF6146", // 红
              "#FA5151", // 错误红
              "#FA9D3B", // 提示橙
              "#FFC300", // 黄
              "#3F51B5"  // 辅助蓝紫
            ]
          },
          "字节跳动": {
            name: "字节跳动",
            colors: [
              // 抖音品牌核心
              "#FE2C55", // 抖音红
              "#25F4EE", // 抖音蓝绿
              "#161823", // 深背景
              "#000000", // 黑
              "#FFFFFF", // 白
              // 视觉扩展（配色用）
              "#FF6B6B", // 亮红
              "#4ECDC4", // 青绿
              "#45B7D1", // 亮蓝
              "#74B9FF", // 浅蓝
              "#96CEB4", // 浅绿
              "#FFEAA7", // 浅黄
              "#DFE6E9"  // 浅灰
            ]
          },
          "小米": {
            name: "小米",
            colors: [
              // 品牌橙系
              "#FF6700", // 小米主橙
              "#FF8F1F", // 亮橙
              "#FFA940", // 更亮橙
              "#FFB84D", // 浅橙
              // 灰阶（从 UI 风格提取）
              "#E6E6E6", // 浅灰
              "#CCCCCC", // 中灰
              "#757575", // 深灰
              "#333333", // 文本深色
              // 常见活动/社区配色扩展
              "#FB7299", // 粉
              "#4A90E2", // 蓝
              "#50E3C2", // 青绿
              "#F5A623"  // 暖橙黄
            ]
          },
          "华为": {
            name: "华为",
            colors: [
              // 品牌红系
              "#E60012", // 华为红（主）
              "#C8161D", // 深红
              "#B91C22", // 更深红
              "#8B1014", // 暗红
              // 灰黑
              "#000000", // 黑
              "#424242", // 深灰
              "#757575", // 中灰
              "#BDBDBD", // 浅灰
              // 华为系常见蓝色 UI（参考华为云 / 企业产品）
              "#0050B3", // 深蓝
              "#1890FF", // 主蓝
              "#40A9FF", // 浅蓝
              "#69C0FF"  // 更浅蓝
            ]
          },
          "Spotify": {
            name: "Spotify",
            colors: [
              // 品牌绿 & 变体
              "#1DB954", // Spotify Green 主色
              "#1ED760", // 亮绿
              "#1AA34A", // 稍深绿
              "#169A3E", // 更深绿
              "#138636", // 深绿
              // UI 中常见灰黑
              "#191414", // 深背景
              "#282828", // 中深背景
              "#121212", // 极深背景
              "#535353", // 中灰
              "#B3B3B3", // 浅灰
              "#FFFFFF", // 白
              "#FF4F4F"  // 强调/错误红（方便工具使用）
            ]
          },
          "Microsoft": {
            name: "Microsoft",
            colors: [
              // Logo 四色
              "#F25022", // 橙
              "#7FBA00", // 绿
              "#00A4EF", // 蓝
              "#FFB900", // 黄
              // Fluent Design 常见 UI 色
              "#0078D4", // 主要蓝（按钮）
              "#005A9E", // 深蓝
              "#106EBE", // 辅助蓝
              "#2B88D8", // 亮一点的蓝
              "#D83B01", // 强调橙
              "#107C10", // 成功绿
              "#F3F2F1", // 浅背景
              "#605E5C"  // 深灰
            ]
          },
          "Amazon": {
            name: "Amazon",
            colors: [
              "#FF9900", // Amazon 橙 (主色)
              "#146EB4", // 深蓝（文字/链接常见）
              "#232F3E", // 顶部导航深色
              "#37475A", // 深蓝灰
              "#F3A847", // 辅助橙
              "#FFD814", // 黄色 (Amazon Prime / 强调)
              "#B12704", // 红 (价格/促销)
              "#111111", // 纯黑
              "#555555", // 中灰
              "#F3F3F3", // 浅灰背景
              "#E7E7E7", // 边框浅灰
              "#00A8E1"  // AWS 相关蓝
            ]
          },
          "Netflix": {
            name: "Netflix",
            colors: [
              "#E50914", // Netflix 红 (主色)
              "#B20710", // 深红
              "#F40612", // 亮红
              "#000000", // 黑
              "#141414", // 深背景
              "#221F1F", // 深灰
              "#FFFFFF", // 白
              "#B3B3B3", // 浅灰
              "#E5E5E5", // 更浅灰
              "#F5F5F1", // 面板背景
              "#FFB81C", // 强调黄（活动/促销）
              "#0073E6"  // 蓝（较少用，方便工具配色）
            ]
          },
          "YouTube": {
            name: "YouTube",
            colors: [
              "#FF0000", // YouTube 红 (主色)
              "#CC0000", // 深红
              "#E62117", // Logo 变体红
              "#282828", // 深灰背景
              "#212121", // 更深背景
              "#FFFFFF", // 白
              "#F1F1F1", // 浅灰背景
              "#AAAAAA", // 中灰
              "#606060", // 深灰
              "#3EA6FF", // 订阅/按钮蓝
              "#1D63D5", // 深蓝
              "#FFCC00"  // 警示/强调黄（扩展）
            ]
          },
          "Facebook": {
            name: "Facebook",
            colors: [
              "#1877F2", // FB 蓝 (主)
              "#166FE5", // 深一点蓝
              "#1B74E4", // 按钮蓝
              "#2D88FF", // 亮蓝
              "#E7F3FF", // 浅蓝背景
              "#F0F2F5", // 通用浅灰背景
              "#050505", // 文本黑
              "#65676B", // 中灰文本
              "#8A8D91", // 浅灰文本
              "#DADDE1", // 边框灰
              "#FFFFFF", // 白
              "#FF4949"  // 红 (通知/错误)
            ]
          },
          "Instagram": {
            name: "Instagram",
            colors: [
              // 主体为渐变，但配工具可拆成关键色
              "#E1306C", // 主粉红
              "#C13584", // 紫粉
              "#5851DB", // 蓝紫
              "#405DE6", // 蓝
              "#FD1D1D", // 红
              "#F56040", // 橙
              "#F77737", // 橙黄
              "#FCAF45", // 浅黄橙
              "#FFDC80", // 淡黄
              "#000000", // 黑
              "#262626", // 深灰
              "#FAFAFA"  // 浅灰背景
            ]
          },
          "LinkedIn": {
            name: "LinkedIn",
            colors: [
              "#0A66C2", // LinkedIn 蓝 (主)
              "#004182", // 深蓝
              "#0077B5", // 旧版蓝
              "#8D6CAB", // 紫
              "#F3F2EF", // 浅背景
              "#313335", // 深灰
              "#86888A", // 中灰
              "#CACCCE", // 浅灰
              "#FFFFFF", // 白
              "#00A0DC", // 浅蓝强调
              "#E68523", // 橙
              "#DD5143"  // 红
            ]
          },
          "Adobe": {
            name: "Adobe",
            colors: [
              "#FF0000", // Adobe 红 (主)
              "#F74902", // 橙红
              "#FF6A00", // 亮橙
              "#2E001F", // 深紫红背景
              "#000000", // 黑
              "#2D2D2D", // 深灰
              "#3F3F3F", // 中灰
              "#F5F5F5", // 浅灰
              "#31A8FF", // PS 蓝
              "#FF9A00", // AI 橙
              "#FF61F6", // XD 粉
              "#FFDC00"  // 黄色强调
            ]
          },
          "Samsung": {
            name: "Samsung",
            colors: [
              "#1428A0", // Samsung 蓝 (主)
              "#0057B8", // 深蓝
              "#0070C0", // 亮一点蓝
              "#000000", // 黑
              "#262626", // 深灰
              "#555555", // 中灰
              "#F4F4F4", // 浅灰背景
              "#FFFFFF", // 白
              "#20C997", // 青绿 (扩展)
              "#FF6F61", // 红 (促销/错误)
              "#FFC107", // 黄
              "#6C757D"  // 次要灰
            ]
          },
          "Slack": {
            name: "Slack",
            colors: [
              "#611F69", // Slack 紫 (主)
              "#4A154B", // 深紫
              "#36C5F0", // 蓝
              "#2EB67D", // 绿
              "#E01E5A", // 粉红
              "#ECB22E", // 黄
              "#F4F4F4", // 浅灰背景
              "#FFFFFF", // 白
              "#1D1D1D", // 文本黑
              "#616061", // 中灰
              "#9E9EA6", // 浅灰
              "#3F0E40"  // 更深紫
            ]
          },
          "Twitch": {
            name: "Twitch",
            colors: [
              "#9146FF", // Twitch 紫 (主)
              "#772CE8", // 深紫
              "#A970FF", // 亮紫
              "#5C16C5", // 深背景紫
              "#0E0E10", // 深背景
              "#18181B", // 更深灰
              "#FFFFFF", // 白
              "#EFEFF1", // 浅灰背景
              "#A0A0A0", // 中灰
              "#FF75E6", // 粉
              "#00F0FF", // 青蓝
              "#FF3B3B"  // 红 (警告/错误)
            ]
          },
          "GitHub": {
            name: "GitHub",
            colors: [
              "#24292E", // GitHub 深灰(接近黑，主导航)
              "#0366D6", // 主蓝
              "#2188FF", // 亮蓝
              "#79B8FF", // 浅蓝
              "#F9826C", // 橙红
              "#28A745", // 绿 (成功)
              "#F6F8FA", // 浅背景
              "#E1E4E8", // 边框灰
              "#6A737D", // 文本灰
              "#D73A49", // 红 (错误)
              "#FFFFFF", // 白
              "#000000"  // 黑
            ]
          },
          "Dribbble": {
            name: "Dribbble",
            colors: [
              "#EA4C89", // Dribbble 粉 (主)
              "#E84C88", // 变体粉
              "#C32361", // 深粉
              "#F8C1D9", // 浅粉
              "#F4F4F4", // 浅灰
              "#9E9EA7", // 中灰
              "#444444", // 深灰
              "#FFFFFF", // 白
              "#FF6F61", // 橙红
              "#8E44AD", // 紫
              "#3498DB", // 蓝
              "#2ECC71"  // 绿
            ]
          },
          "Behance": {
            name: "Behance",
            colors: [
              "#1769FF", // Behance 蓝 (主)
              "#0057FF", // 深蓝
              "#1E90FF", // 亮蓝
              "#000000", // 黑
              "#333333", // 深灰
              "#999999", // 中灰
              "#F5F5F5", // 浅灰背景
              "#FFFFFF", // 白
              "#FF3B3B", // 红
              "#FFB300", // 黄
              "#00C853", // 绿
              "#AA00FF"  // 紫
            ]
          },
          "Pinterest": {
            name: "Pinterest",
            colors: [
              "#E60023", // Pinterest 红 (主)
              "#AD081B", // 深红
              "#FF2447", // 亮红
              "#000000", // 黑
              "#111111", // 深灰
              "#767676", // 中灰
              "#E9E9E9", // 浅灰
              "#FFFFFF", // 白
              "#FFB900", // 黄
              "#00C1C1", // 青
              "#0084FF", // 蓝
              "#00B894"  // 绿
            ]
          },
          "Reddit": {
            name: "Reddit",
            colors: [
              "#FF4500", // Reddit 橙红 (主)
              "#FF5700", // 亮橙红
              "#FF8717", // 橙
              "#000000", // 黑
              "#1A1A1B", // 深背景
              "#31302F", // 深灰
              "#878A8C", // 中灰
              "#D7DADC", // 浅灰
              "#FFFFFF", // 白
              "#CEE3F8", // 浅蓝背景
              "#24A0ED", // 蓝
              "#46D160"  // 绿
            ]
          }
        };

        // Color name mapping
        const colorNameMap = {
          "#FFB6C1": { "en": "lightpink", "cn": "浅粉红" },
          "#FFC0CB": { "en": "pink", "cn": "粉红" },
          "#DC143C": { "en": "crimson", "cn": "猩红" },
          "#FFF0F5": { "en": "lavenderblush", "cn": "脸红的淡紫色" },
          "#DB7093": { "en": "palevioletred", "cn": "苍白的紫罗兰红色" },
          "#FF69B4": { "en": "hotpink", "cn": "热情的粉红" },
          "#FF1493": { "en": "deeppink", "cn": "深粉色" },
          "#C71585": { "en": "mediumvioletred", "cn": "适中的紫罗兰红色" },
          "#DA70D6": { "en": "orchid", "cn": "兰花的紫色" },
          "#D8BFD8": { "en": "thistle", "cn": "蓟" },
          "#DDA0DD": { "en": "plum", "cn": "李子" },
          "#EE82EE": { "en": "violet", "cn": "紫罗兰" },
          "#FF00FF": { "en": "magenta", "cn": "洋红" },
          "#8B008B": { "en": "darkmagenta", "cn": "深洋红色" },
          "#800080": { "en": "purple", "cn": "紫色" },
          "#BA55D3": { "en": "mediumorchid", "cn": "适中的兰花紫" },
          "#9400D3": { "en": "darkviolet", "cn": "深紫罗兰色" },
          "#9932CC": { "en": "darkorchid", "cn": "深兰花紫" },
          "#4B0082": { "en": "indigo", "cn": "靛青" },
          "#8A2BE2": { "en": "blueviolet", "cn": "深紫罗兰的蓝色" },
          "#9370DB": { "en": "mediumpurple", "cn": "适中的紫色" },
          "#7B68EE": { "en": "mediumslateblue", "cn": "适中的石板蓝" },
          "#6A5ACD": { "en": "slateblue", "cn": "石板蓝" },
          "#483D8B": { "en": "darkslateblue", "cn": "深石板蓝" },
          "#E6E6FA": { "en": "lavender", "cn": "熏衣草花的淡紫色" },
          "#F8F8FF": { "en": "ghostwhite", "cn": "幽灵的白色" },
          "#0000FF": { "en": "blue", "cn": "纯蓝" },
          "#0000CD": { "en": "mediumblue", "cn": "适中的蓝色" },
          "#191970": { "en": "midnightblue", "cn": "午夜的蓝色" },
          "#00008B": { "en": "darkblue", "cn": "深蓝色" },
          "#000080": { "en": "navy", "cn": "海军蓝" },
          "#4169E1": { "en": "royalblue", "cn": "皇家蓝" },
          "#6495ED": { "en": "cornflowerblue", "cn": "矢车菊的蓝色" },
          "#B0C4DE": { "en": "lightsteelblue", "cn": "淡钢蓝" },
          "#778899": { "en": "lightslategray", "cn": "浅石板灰" },
          "#708090": { "en": "slategray", "cn": "石板灰" },
          "#1E90FF": { "en": "dodgerblue", "cn": "道奇蓝" },
          "#F0F8FF": { "en": "aliceblue", "cn": "爱丽丝蓝" },
          "#4682B4": { "en": "steelblue", "cn": "钢蓝" },
          "#87CEFA": { "en": "lightskyblue", "cn": "淡蓝色" },
          "#87CEEB": { "en": "skyblue", "cn": "天蓝色" },
          "#00BFFF": { "en": "deepskyblue", "cn": "深天蓝" },
          "#ADD8E6": { "en": "lightblue", "cn": "淡蓝" },
          "#B0E0E6": { "en": "powderblue", "cn": "火药蓝" },
          "#5F9EA0": { "en": "cadetblue", "cn": "军校蓝" },
          "#F0FFFF": { "en": "azure", "cn": "蔚蓝色" },
          "#E0FFFF": { "en": "lightcyan", "cn": "淡青色" },
          "#AFEEEE": { "en": "paleturquoise", "cn": "苍白的绿宝石" },
          "#00FFFF": { "en": "cyan", "cn": "青色" },
          "#00CED1": { "en": "darkturquoise", "cn": "深绿宝石" },
          "#2F4F4F": { "en": "darkslategray", "cn": "深石板灰" },
          "#008B8B": { "en": "darkcyan", "cn": "深青色" },
          "#008080": { "en": "teal", "cn": "水鸭色" },
          "#48D1CC": { "en": "mediumturquoise", "cn": "适中的绿宝石" },
          "#20B2AA": { "en": "lightseagreen", "cn": "浅海洋绿" },
          "#40E0D0": { "en": "turquoise", "cn": "绿宝石" },
          "#7FFFAA": { "en": "aquamarine", "cn": "绿玉碧绿色" },
          "#00FA9A": { "en": "mediumspringgreen", "cn": "适中的春天的绿色" },
          "#F5FFFA": { "en": "mintcream", "cn": "薄荷奶油" },
          "#00FF7F": { "en": "springgreen", "cn": "春天的绿色" },
          "#3CB371": { "en": "mediumseagreen", "cn": "适中的海洋绿" },
          "#2E8B57": { "en": "seagreen", "cn": "海洋绿" },
          "#F0FFF0": { "en": "honeydew", "cn": "蜜瓜色" },
          "#90EE90": { "en": "lightgreen", "cn": "淡绿色" },
          "#98FB98": { "en": "palegreen", "cn": "苍白的绿色" },
          "#8FBC8F": { "en": "darkseagreen", "cn": "深海洋绿" },
          "#32CD32": { "en": "limegreen", "cn": "酸橙绿" },
          "#00FF00": { "en": "lime", "cn": "酸橙色" },
          "#7FFF00": { "en": "chartreuse", "cn": "查特酒绿" },
          "#7CFC00": { "en": "lawngreen", "cn": "草坪绿" },
          "#ADFF2F": { "en": "greenyellow", "cn": "绿黄色" },
          "#556B2F": { "en": "olivedrab", "cn": "橄榄土褐色" },
          "#6B8E23": { "en": "olivedrab", "cn": "橄榄军绿" },
          "#FAFAD2": { "en": "lightgoldenrodyellow", "cn": "浅秋麒麟黄" },
          "#FFFFF0": { "en": "ivory", "cn": "象牙" },
          "#FFFFE0": { "en": "lightyellow", "cn": "浅黄色" },
          "#FFFF00": { "en": "yellow", "cn": "纯黄" },
          "#808000": { "en": "olive", "cn": "橄榄" },
          "#BDB76B": { "en": "darkkhaki", "cn": "深卡其布" },
          "#FFFACD": { "en": "lemonchiffon", "cn": "柠檬薄纱" },
          "#EEE8AA": { "en": "palegoldenrod", "cn": "灰秋麒麟" },
          "#F0E68C": { "en": "khaki", "cn": "卡其布" },
          "#FFD700": { "en": "gold", "cn": "金" },
          "#FFF8DC": { "en": "cornsilk", "cn": "玉米色" },
          "#DAA520": { "en": "goldenrod", "cn": "秋麒麟" },
          "#FFFAF0": { "en": "floralwhite", "cn": "花的白色" },
          "#FDF5E6": { "en": "oldlace", "cn": "老饰带" },
          "#F5DEB3": { "en": "wheat", "cn": "小麦色" },
          "#FFE4B5": { "en": "moccasin", "cn": "鹿皮鞋" },
          "#FFA500": { "en": "orange", "cn": "橙色" },
          "#FFEFD5": { "en": "papayawhip", "cn": "番木瓜" },
          "#FFEBCD": { "en": "blanchedalmond", "cn": "漂白的杏仁" },
          "#FFDEAD": { "en": "navajowhite", "cn": "Navajo白" },
          "#FAEBD7": { "en": "antiquewhite", "cn": "古代的白色" },
          "#D2B48C": { "en": "tan", "cn": "晒黑" },
          "#DEB887": { "en": "burlywood", "cn": "结实的树" },
          "#FFE4C4": { "en": "bisque", "cn": "浓汤" },
          "#FF8C00": { "en": "darkorange", "cn": "深橙色" },
          "#FAF0E6": { "en": "linen", "cn": "亚麻布" },
          "#CD853F": { "en": "peru", "cn": "秘鲁" },
          "#FFDAB9": { "en": "peachpuff", "cn": "桃色" },
          "#F4A460": { "en": "sandybrown", "cn": "沙棕色" },
          "#D2691E": { "en": "chocolate", "cn": "巧克力" },
          "#8B4513": { "en": "saddlebrown", "cn": "马鞍棕色" },
          "#FFF5EE": { "en": "seashell", "cn": "海贝壳" },
          "#A0522D": { "en": "sienna", "cn": "黄土赭色" },
          "#FFA07A": { "en": "lightsalmon", "cn": "浅鲜肉色" },
          "#FF7F50": { "en": "coral", "cn": "珊瑚" },
          "#FF4500": { "en": "orangered", "cn": "橙红色" },
          "#E9967A": { "en": "darksalmon", "cn": "深鲜肉色" },
          "#FF6347": { "en": "tomato", "cn": "番茄" },
          "#FFE4E1": { "en": "mistyrose", "cn": "薄雾玫瑰" },
          "#FA8072": { "en": "salmon", "cn": "鲜肉色" },
          "#FFFAFA": { "en": "snow", "cn": "雪" },
          "#F08080": { "en": "lightcoral", "cn": "淡珊瑚色" },
          "#BC8F8F": { "en": "rosybrown", "cn": "玫瑰棕色" },
          "#CD5C5C": { "en": "indianred", "cn": "印度红" },
          "#FF0000": { "en": "red", "cn": "纯红" },
          "#A52A2A": { "en": "brown", "cn": "棕色" },
          "#B22222": { "en": "firebrick", "cn": "耐火砖" },
          "#8B0000": { "en": "darkred", "cn": "深红色" },
          "#800000": { "en": "maroon", "cn": "栗色" },
          "#FFFFFF": { "en": "white", "cn": "纯白" },
          "#F5F5F5": { "en": "whitesmoke", "cn": "白烟" },
          "#DCDCDC": { "en": "gainsboro", "cn": "淡灰色" },
          "#D3D3D3": { "en": "lightgrey", "cn": "浅灰色" },
          "#C0C0C0": { "en": "silver", "cn": "银白色" },
          "#A9A9A9": { "en": "darkgray", "cn": "深灰色" },
          "#808080": { "en": "gray", "cn": "灰色" },
          "#696969": { "en": "dimgray", "cn": "暗淡的灰色" },
          "#000000": { "en": "black", "cn": "纯黑" },
          "#FFC000": { "en": "amber", "cn": "琥珀色" },
          "#36454F": { "en": "charcoal", "cn": "深灰色" },
          "#E0115F": { "en": "ruby", "cn": "红宝石色" },
          "#8DB600": { "en": "applegreen", "cn": "苹果绿" },
          "#CD7F32": { "en": "bronze", "cn": "古铜色" },
          "#C8A2C8": { "en": "lilac", "cn": "紫丁香色" },
          "#FDBCB4": { "en": "skin", "cn": "皮肤色" },
          "#89CFF0": { "en": "babyblue", "cn": "浅蓝色" },
          // --- Art History Colors ---
          "#003153": { "en": "prussianblue", "cn": "普鲁士蓝" },
          "#E3A857": { "en": "vermeergold", "cn": "维米尔金" },
          "#A7472A": { "en": "terracotta", "cn": "陶土红" },
          "#4E5541": { "en": "renaissance-green", "cn": "文艺复兴绿" },
          "#F0E3C4": { "en": "impressionist-sky", "cn": "印象派天空" },
          "#FFDF00": { "en": "klimt-gold", "cn": "克里姆特金" },
          "#004B49": { "en": "artdeco-green", "cn": "装饰艺术绿" },
          "#A67B5B": { "en": "sepia", "cn": "乌贼墨色" },
          "#4A412A": { "en": "rembrandt-umber", "cn": "伦勃朗棕" },
          "#7393B3": { "en": "wedgwood-blue", "cn": "韦奇伍德蓝" },
          // --- Nature Colors ---
          "#5A6E4E": { "en": "mossgreen", "cn": "苔藓绿" },
          "#C2B280": { "en": "sandstone", "cn": "砂岩色" },
          "#343E40": { "en": "volcanicrock", "cn": "火山岩" },
          "#87A96B": { "en": "asparagus", "cn": "芦笋绿" },
          "#FBE7B2": { "en": "moonlight", "cn": "月光色" },
          "#081828": { "en": "deepocean", "cn": "深海" },
          "#FAD6A5": { "en": "desert-sand", "cn": "沙漠沙" },
          "#EEDC82": { "en": "sunflower", "cn": "向日葵黄" },
          "#B4D9EF": { "en": "glacier-blue", "cn": "冰川蓝" },
          "#3D2B1F": { "en": "dark-earth", "cn": "黑土" },
          // --- Materials & Gemstones Colors ---
          "#E5E4E2": { "en": "platinum", "cn": "铂金色" },
          "#B87333": { "en": "copper", "cn": "铜色" },
          "#0F52BA": { "en": "sapphire", "cn": "蓝宝石" },
          "#50C878": { "en": "emerald", "cn": "祖母绿" },
          "#E6D6C4": { "en": "pearl", "cn": "珍珠白" },
          "#702963": { "en": "amethyst", "cn": "紫水晶" },
          "#FBCEB1": { "en": "apricot", "cn": "杏仁" },
          "#30D5C8": { "en": "turquoise-gem", "cn": "绿松石" },
          "#D4AF37": { "en": "gold-metallic", "cn": "金属金" },
          // --- Global Traditional Colors ---
          "#6C3B2A": { "en": "wabisabi-brown", "cn": "侘寂棕 (日本)" },
          "#D7A279": { "en": "kuchiba", "cn": "朽叶 (日本)" },
          "#005745": { "en": "shibui-green", "cn": "涩绿 (日本)" },
          "#30415d": { "en": "majorelle-blue", "cn": "马若雷勒蓝 (摩洛哥)" },
          "#e05822": { "en": "terracotta-marrakech", "cn": "马拉喀什陶土 (摩洛哥)" },
          "#009B77": { "en": "malachite", "cn": "孔雀石 (埃及)" },
          "#8B5742": { "en": "mummy-brown", "cn": "木乃伊棕 (埃及)" },
          "#FF9933": { "en": "saffron", "cn": "藏红花 (印度)" },
          "#77DD77": { "en": "pastel-green", "cn": "马卡龙绿 (法国)" }
        };

        // Global variables
        let currentPalette = "Apple";
        let currentColor = { r: 0, g: 122, b: 255 };
        let clipboardColors = [];
        let clipboardMonitorInterval = null;
        let dynamicColorsCache = new Map();
        const MAX_CACHE_SIZE = 50;
        let modeIndex = 0; // Default to first mode

        // Function to clear dynamic colors cache
        function clearDynamicColorsCache() {
            dynamicColorsCache.clear();
        }

        // Dynamic delta calculation
        function calculateDynamicDeltas(hsv) {
            let valDelta;
            if (hsv.v < 0.1) {
                valDelta = 0.03;
            } else if (hsv.v < 0.3) {
                valDelta = 0.05;
            } else if (hsv.v < 0.6) {
                valDelta = 0.08;
            } else {
                valDelta = 0.1;
            }

            let satDelta;
            if (hsv.s < 0.1) {
                satDelta = 0.05;
            } else if (hsv.s < 0.3) {
                satDelta = 0.07;
            } else if (hsv.s < 0.6) {
                satDelta = 0.10;
            } else {
                satDelta = 0.12;
            }

            const hueDelta = 36;
            return { hueDelta, satDelta, valDelta };
        }

        // Get dynamic colors with caching
        function getDynamicColors(hsv, modeIndex) {
            const { h, s, v } = hsv;
            const cacheKey = `${modeIndex}-${h.toFixed(1)}-${s.toFixed(2)}-${v.toFixed(2)}`;

            if (dynamicColorsCache.has(cacheKey)) {
                return dynamicColorsCache.get(cacheKey);
            }

            const { hueDelta, satDelta, valDelta } = calculateDynamicDeltas(hsv);

            let colors = [];
            switch (modeIndex) {
                case 0: // 邻近(固H)
                    colors = generateColorMatrix(hsv, {
                        hueSteps: 1,
                        satSteps: 10,
                        valSteps: 10,
                        hueDelta: 0,
                        satDelta: satDelta,
                        valDelta: valDelta
                    });
                    break;
                case 1: // 同饱和(固S)
                    colors = generateColorMatrix(hsv, {
                        hueSteps: 10,
                        satSteps: 1,
                        valSteps: 10,
                        hueDelta: hueDelta,
                        satDelta: 0.1,
                        valDelta: valDelta
                    });
                    break;
                case 2: // 同明度(固V)
                    colors = generateColorMatrix(hsv, {
                        hueSteps: 10,
                        satSteps: 10,
                        valSteps: 1,
                        hueDelta: hueDelta,
                        satDelta: satDelta,
                        valDelta: 0.05
                    });
                    break;
                default:
                    colors = generateColorMatrix(hsv, {
                        hueSteps: 1,
                        satSteps: 10,
                        valSteps: 10,
                        hueDelta: 0,
                        satDelta: satDelta,
                        valDelta: valDelta
                    });
            }

            if (dynamicColorsCache.size >= MAX_CACHE_SIZE) {
                const firstKey = dynamicColorsCache.keys().next().value;
                dynamicColorsCache.delete(firstKey);
            }

            dynamicColorsCache.set(cacheKey, colors);
            return colors;
        }

        // Generate color matrix
        function generateColorMatrix(hsv, {
          hueSteps = 1,
          satSteps = 10,
          valSteps = 10,
          hueDelta = 0,
          satDelta = 0.12,
          valDelta = 0.06
        } = {}) {
          const centerSIdx = satSteps / 2;
          const centerVIdx = valSteps / 2;
          const totalColors = hueSteps * satSteps * valSteps;
          const colors = new Array(totalColors);
          let colorIndex = 0;

          for (let h_idx = 0; h_idx < hueSteps; h_idx++) {
            const newH = (hsv.h + h_idx * hueDelta) % 360;
            for (let s_idx = 0; s_idx < satSteps; s_idx++) {
              const newS = Math.max(0.1, Math.min(1.0, hsv.s + (s_idx - centerSIdx) * satDelta));
              for (let v_idx = 0; v_idx < valSteps; v_idx++) {
                const newV = Math.max(0.1, Math.min(1.0, hsv.v + (v_idx - centerVIdx) * valDelta));

                const rgb = hsvToRgb(newH, newS, newV);
                colors[colorIndex++] = rgbToHex(rgb.r, rgb.g, rgb.b);
              }
            }
          }
          return colors;
        }

        // Color conversion functions
        function rgbToHex(r, g, b) {
            const toHex = (val) => {
                const clamped = Math.round(Math.max(0, Math.min(255, val)));
                return clamped.toString(16).padStart(2, '0');
            };
            return `#${toHex(r)}${toHex(g)}${toHex(b)}`.toUpperCase();
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function hsvToRgb(h, s, v) {
            h = h % 360;
            if (h < 0) h += 360;

            if (s === 0) {
                const gray = Math.round(v * 255);
                return { r: gray, g: gray, b: gray };
            }

            const c = v * s;
            const x = c * (1 - Math.abs((h / 60) % 2 - 1));
            const m = v - c;

            let r, g, b;
            if (h < 60) {
                [r, g, b] = [c, x, 0];
            } else if (h < 120) {
                [r, g, b] = [x, c, 0];
            } else if (h < 180) {
                [r, g, b] = [0, c, x];
            } else if (h < 240) {
                [r, g, b] = [0, x, c];
            } else if (h < 300) {
                [r, g, b] = [x, 0, c];
            } else {
                [r, g, b] = [c, 0, x];
            }

            return {
                r: Math.round((r + m) * 255),
                g: Math.round((g + m) * 255),
                b: Math.round((b + m) * 255)
            };
        }

        function rgbToHsv(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const v = max;
            const d = max - min;
            const s = max === 0 ? 0 : d / max;

            let h;
            if (d === 0) {
                h = 0;
            } else {
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h *= 60;
            }

            return { h, s, v };
        }

        function getLuminance(r, g, b) {
            const a = [r, g, b].map(v => {
                v /= 255;
                return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
            });
            return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
        }

        function getContrastTextColor(hex) {
            const rgb = hexToRgb(hex);
            if (!rgb) return '#ffffff';

            const luminance = getLuminance(rgb.r, rgb.g, rgb.b);
            return luminance > 0.5 ? '#000000' : '#ffffff';
        }

        function colorsAreEqual(color1, color2) {
            const rgb1 = hexToRgb(color1);
            const rgb2 = hexToRgb(color2);

            if (!rgb1 || !rgb2) {
                return color1.toUpperCase() === color2.toUpperCase();
            }

            const tolerance = 2;
            return Math.abs(rgb1.r - rgb2.r) <= tolerance &&
                   Math.abs(rgb1.g - rgb2.g) <= tolerance &&
                   Math.abs(rgb1.b - rgb2.b) <= tolerance;
        }

        // Color name functions
        const colorNameCache = new Map();

        function getColorName(hex, preferChinese = true) {
            const normalizedHex = hex.toUpperCase();

            if (colorNameCache.has(normalizedHex)) {
                const cached = colorNameCache.get(normalizedHex);
                const displayName = preferChinese ? cached.cn : cached.en;
                return {
                    en: cached.en,
                    cn: cached.cn,
                    displayName: displayName,
                    fullName: `${cached.en} / ${cached.cn}`
                };
            }

            const colorData = colorNameMap[normalizedHex];
            if (colorData) {
                const displayName = preferChinese ? colorData.cn : colorData.en;
                const result = {
                    en: colorData.en,
                    cn: colorData.cn,
                    displayName: displayName,
                    fullName: `${colorData.en} / ${colorData.cn}`
                };

                colorNameCache.set(normalizedHex, colorData);
                return result;
            }

            return null;
        }

        function initializeColorNameCache() {
            for (const hex in colorNameMap) {
                colorNameCache.set(hex, colorNameMap[hex]);
            }
        }

        initializeColorNameCache();

        // Input validation
        function setColorFromHex(input) {
            if (!input || typeof input !== 'string') {
                return false;
            }

            let hex = input.trim();
            if (!hex) {
                return false;
            }

            const commaRgbMatch = hex.match(/^(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})$/);
            if (commaRgbMatch) {
                const r = parseInt(commaRgbMatch[1]);
                const g = parseInt(commaRgbMatch[2]);
                const b = parseInt(commaRgbMatch[3]);

                if (isNaN(r) || isNaN(g) || isNaN(b) ||
                    r < 0 || r > 255 || g < 0 || g > 255 || b < 0 || b > 255) {
                    return false;
                }

                const currentHex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);
                const newHex = rgbToHex(r, g, b);
                if (newHex !== currentHex) {
                    currentColor.r = r;
                    currentColor.g = g;
                    currentColor.b = b;
                }
                return true;
            }

            const spaceRgbMatch = hex.match(/^(\d{1,3})\s+(\d{1,3})\s+(\d{1,3})$/);
            if (spaceRgbMatch) {
                const r = parseInt(spaceRgbMatch[1]);
                const g = parseInt(spaceRgbMatch[2]);
                const b = parseInt(spaceRgbMatch[3]);

                if (isNaN(r) || isNaN(g) || isNaN(b) ||
                    r < 0 || r > 255 || g < 0 || g > 255 || b < 0 || b > 255) {
                    return false;
                }

                const currentHex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);
                const newHex = rgbToHex(r, g, b);
                if (newHex !== currentHex) {
                    currentColor.r = r;
                    currentColor.g = g;
                    currentColor.b = b;
                }
                return true;
            }

            if (!hex.startsWith("#")) {
                hex = "#" + hex;
            }

            if (!/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(hex)) {
                return false;
            }

            hex = hex.toUpperCase();

            const currentHex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);
            if (hex === currentHex) return true;

            const rgb = hexToRgb(hex);
            if (rgb) {
                currentColor.r = rgb.r;
                currentColor.g = rgb.g;
                currentColor.b = rgb.b;
                return true;
            }
            return false;
        }

        // Update preset palette
        function updatePresetPalette() {
            const colors = colorPalettes[currentPalette].colors;
            const currentHex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);

            const matrix = document.getElementById('presetColorMatrix');
            matrix.innerHTML = '';

            colors.forEach(color => {
                const isSelected = colorsAreEqual(color, currentHex);
                const colorName = getColorName(color, true);
                const displayText = colorName ? colorName.displayName.substring(0, 8) : "";

                const colorItem = document.createElement('div');
                colorItem.className = `color-item ${isSelected ? 'selected' : ''}`;
                colorItem.style.backgroundColor = color;
                colorItem.title = `${color} - ${displayText}`;
                colorItem.addEventListener('click', () => {
                    if (setColorFromHex(color)) {
                        updateColor();
                    }
                });

                matrix.appendChild(colorItem);
            });
        }

        // Update dynamic color palette
        function updateDynamicColorPalette() {
            const hsv = rgbToHsv(currentColor.r, currentColor.g, currentColor.b);
            const dynamicColors = getDynamicColors(hsv, modeIndex);
            const currentHex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);

            const matrix = document.getElementById('dynamicColorMatrix');
            matrix.innerHTML = '';

            // Use the appropriate grid layout based on mode to maintain 10x10 structure
            if (modeIndex === 0) { // 邻近(固H) - Fixed Hue, varying Sat and Val (10x10 grid)
                matrix.style.display = 'grid';
                matrix.style.gridTemplateColumns = 'repeat(10, 1fr)';
                matrix.style.gap = '2px';

                for (let i = 0; i < dynamicColors.length; i++) {
                    const color = dynamicColors[i];
                    const isSelected = colorsAreEqual(color, currentHex);
                    const colorName = getColorName(color, true);
                    const displayText = colorName ? colorName.displayName.substring(0, 8) : "";

                    const colorItem = document.createElement('div');
                    colorItem.className = `color-item ${isSelected ? 'selected' : ''}`;
                    colorItem.style.backgroundColor = color;
                    colorItem.style.fontSize = '6px';
                    colorItem.style.color = getContrastTextColor(color);
                    colorItem.textContent = displayText;
                    colorItem.title = `${color} - ${displayText}`;
                    colorItem.addEventListener('click', () => {
                        if (setColorFromHex(color)) {
                            updateColor();
                        }
                    });

                    matrix.appendChild(colorItem);
                }
            } else if (modeIndex === 1) { // 同饱和(固S) - Fixed Sat, varying Hue and Val
                matrix.style.display = 'grid';
                matrix.style.gridTemplateColumns = 'repeat(10, 1fr)';
                matrix.style.gap = '2px';

                for (let i = 0; i < dynamicColors.length; i++) {
                    const color = dynamicColors[i];
                    const isSelected = colorsAreEqual(color, currentHex);
                    const colorName = getColorName(color, true);
                    const displayText = colorName ? colorName.displayName.substring(0, 8) : "";

                    const colorItem = document.createElement('div');
                    colorItem.className = `color-item ${isSelected ? 'selected' : ''}`;
                    colorItem.style.backgroundColor = color;
                    colorItem.style.fontSize = '6px';
                    colorItem.style.color = getContrastTextColor(color);
                    colorItem.textContent = displayText;
                    colorItem.title = `${color} - ${displayText}`;
                    colorItem.addEventListener('click', () => {
                        if (setColorFromHex(color)) {
                            updateColor();
                        }
                    });

                    matrix.appendChild(colorItem);
                }
            } else if (modeIndex === 2) { // 同明度(固V) - Fixed Val, varying Hue and Sat
                matrix.style.display = 'grid';
                matrix.style.gridTemplateColumns = 'repeat(10, 1fr)';
                matrix.style.gap = '2px';

                for (let i = 0; i < dynamicColors.length; i++) {
                    const color = dynamicColors[i];
                    const isSelected = colorsAreEqual(color, currentHex);
                    const colorName = getColorName(color, true);
                    const displayText = colorName ? colorName.displayName.substring(0, 8) : "";

                    const colorItem = document.createElement('div');
                    colorItem.className = `color-item ${isSelected ? 'selected' : ''}`;
                    colorItem.style.backgroundColor = color;
                    colorItem.style.fontSize = '6px';
                    colorItem.style.color = getContrastTextColor(color);
                    colorItem.textContent = displayText;
                    colorItem.title = `${color} - ${displayText}`;
                    colorItem.addEventListener('click', () => {
                        if (setColorFromHex(color)) {
                            updateColor();
                        }
                    });

                    matrix.appendChild(colorItem);
                }
            }
        }

        // Update the other two dynamic color variations for comparison (excluding the current left panel mode)
        function updateDynamicComparison() {
            const hsv = rgbToHsv(currentColor.r, currentColor.g, currentColor.b);
            const currentHex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);

            const container = document.getElementById('dynamicComparisonContainer');
            container.innerHTML = '';

            // Show only the other two modes (not the one currently displayed in the left panel)
            for (let modeIdx = 1; modeIdx < 3; modeIdx++) {  // Skip mode 0 (邻近固H) since it's in the left panel
                const dynamicColors = getDynamicColors(hsv, modeIdx);

                const modeSection = document.createElement('div');
                modeSection.className = 'container';
                modeSection.style.marginBottom = '10px';
                modeSection.style.padding = '10px';

                const modeNames = ['邻近(固H)', '同饱和(固S)', '同明度(固V)'];
                const modeTitle = document.createElement('div');
                modeTitle.textContent = modeNames[modeIdx];
                modeTitle.style.fontWeight = 'bold';
                modeTitle.style.marginBottom = '5px';
                modeTitle.style.textAlign = 'center';
                modeSection.appendChild(modeTitle);

                const grid = document.createElement('div');
                grid.className = 'color-grid dynamic-colors';
                grid.style.display = 'grid';
                grid.style.gridTemplateColumns = 'repeat(10, 1fr)';
                grid.style.gap = '2px';

                // Show all colors for each mode (up to 100 to fill the 10x10 grid)
                for (let i = 0; i < Math.min(dynamicColors.length, 100); i++) {
                    const color = dynamicColors[i];
                    const isSelected = colorsAreEqual(color, currentHex);
                    const colorName = getColorName(color, true);
                    const displayText = colorName ? colorName.displayName.substring(0, 8) : "";

                    const colorItem = document.createElement('div');
                    colorItem.className = `color-item ${isSelected ? 'selected' : ''}`;
                    colorItem.style.backgroundColor = color;
                    colorItem.style.fontSize = '6px';
                    colorItem.style.color = getContrastTextColor(color);
                    colorItem.title = `${color} - ${displayText}`;
                    colorItem.addEventListener('click', () => {
                        if (setColorFromHex(color)) {
                            updateColor();
                        }
                    });

                    grid.appendChild(colorItem);
                }

                modeSection.appendChild(grid);
                container.appendChild(modeSection);
            }
        }


        // Update input fields
        function updateInputFields() {
            const hexColor = rgbToHex(currentColor.r, currentColor.g, currentColor.b);
            const rgbString = `${Math.round(currentColor.r)}, ${Math.round(currentColor.g)}, ${Math.round(currentColor.b)}`;

            document.getElementById('hexInput').value = hexColor;
            document.getElementById('rgbInput').value = rgbString;

            document.getElementById('hexClearButton').style.display = 'none';
            document.getElementById('rgbClearButton').style.display = 'none';
        }

        // Update RGB color bars
        function updateRGBColorBars() {
            const rgbContainer = document.getElementById('rgbColorBarsContainer');
            if (rgbContainer.style.display !== 'none') {
                const redHeight = Math.round((currentColor.r / 255) * 30);
                const greenHeight = Math.round((currentColor.g / 255) * 30);
                const blueHeight = Math.round((currentColor.b / 255) * 30);

                document.getElementById('redBar').style.height = redHeight + 'px';
                document.getElementById('greenBar').style.height = greenHeight + 'px';
                document.getElementById('blueBar').style.height = blueHeight + 'px';
            }
        }

        // Main update function
        function updateColor() {
            const hexColor = rgbToHex(currentColor.r, currentColor.g, currentColor.b);

            updateInputFields();
            updateRGBColorBars();

            document.getElementById('redSlider').value = currentColor.r;
            document.getElementById('greenSlider').value = currentColor.g;
            document.getElementById('blueSlider').value = currentColor.b;

            document.getElementById('redValueLabel').textContent = Math.round(currentColor.r);
            document.getElementById('greenValueLabel').textContent = Math.round(currentColor.g);
            document.getElementById('blueValueLabel').textContent = Math.round(currentColor.b);

            updateDynamicColorPalette();
            updatePresetPalette();

            const hexPreview = document.getElementById('currentColorPreview');
            hexPreview.style.backgroundColor = hexColor;
            hexPreview.textContent = getColorName(hexColor, true)?.displayName || hexColor;
            hexPreview.style.color = getContrastTextColor(hexColor);


            // Update input container background
            const inputContainer = document.querySelector('.input-section');
            inputContainer.style.backgroundColor = hexColor;
            inputContainer.style.color = getContrastTextColor(hexColor);

            // Update color schemes preview
            generateAndPreviewColorSchemes();

            // Update dynamic comparison
            updateDynamicComparison();
        }

        // Generate all color schemes for current color
        function generateAllSchemesForColor(baseColor) {
            const schemes = {};
            schemes.complementary = generateComplementaryScheme(baseColor);
            schemes.analogous = generateAnalogousScheme(baseColor);
            schemes.triadic = generateTriadicScheme(baseColor);
            schemes.tetradic = generateTetradicScheme(baseColor);
            schemes.monochromatic = generateMonochromaticScheme(baseColor);
            schemes['split-complementary'] = generateSplitComplementaryScheme(baseColor);
            // LCH-based schemes
            schemes['lch-complementary'] = generateLCHComplementaryScheme(baseColor);
            schemes['lch-analogous'] = generateLCHAnalogousScheme(baseColor);
            schemes['lch-triadic'] = generateLCHTriadicScheme(baseColor);
            schemes['lch-tetradic'] = generateLCHTetradicScheme(baseColor);
            schemes['lch-monochromatic'] = generateLCHMonochromaticScheme(baseColor);
            schemes['lch-split-complementary'] = generateLCHSplitComplementaryScheme(baseColor);
            schemes['lch-gradient'] = generateLCHGradients(baseColor);
            return schemes;
        }

        // Complementary scheme
        function generateComplementaryScheme(baseColor) {
            const rgb = hexToRgb(baseColor);
            if (!rgb) return [baseColor];

            const hsv = rgbToHsv(rgb.r, rgb.g, rgb.b);
            const complementaryHue = (hsv.h + 180) % 360;
            const complementaryRgb = hsvToRgb(complementaryHue, hsv.s, hsv.v);
            const complementaryHex = rgbToHex(complementaryRgb.r, complementaryRgb.g, complementaryRgb.b);

            return [baseColor, complementaryHex];
        }

        // Analogous scheme
        function generateAnalogousScheme(baseColor, angle = 30) {
            const rgb = hexToRgb(baseColor);
            if (!rgb) return [baseColor];

            const hsv = rgbToHsv(rgb.r, rgb.g, rgb.b);
            const hue1 = (hsv.h - angle + 360) % 360;
            const hue2 = (hsv.h + angle) % 360;

            const rgb1 = hsvToRgb(hue1, hsv.s, hsv.v);
            const rgb2 = hsvToRgb(hue2, hsv.s, hsv.v);

            const hex1 = rgbToHex(rgb1.r, rgb1.g, rgb1.b);
            const hex2 = rgbToHex(rgb2.r, rgb2.g, rgb2.b);

            return [hex1, baseColor, hex2];
        }

        // Triadic scheme
        function generateTriadicScheme(baseColor) {
            const rgb = hexToRgb(baseColor);
            if (!rgb) return [baseColor];

            const hsv = rgbToHsv(rgb.r, rgb.g, rgb.b);
            const hue1 = (hsv.h + 120) % 360;
            const hue2 = (hsv.h + 240) % 360;

            const rgb1 = hsvToRgb(hue1, hsv.s, hsv.v);
            const rgb2 = hsvToRgb(hue2, hsv.s, hsv.v);

            const hex1 = rgbToHex(rgb1.r, rgb1.g, rgb1.b);
            const hex2 = rgbToHex(rgb2.r, rgb2.g, rgb2.b);

            return [baseColor, hex1, hex2];
        }

        // Tetradic scheme
        function generateTetradicScheme(baseColor) {
            const rgb = hexToRgb(baseColor);
            if (!rgb) return [baseColor];

            const hsv = rgbToHsv(rgb.r, rgb.g, rgb.b);
            const hue1 = (hsv.h + 90) % 360;
            const hue2 = (hsv.h + 180) % 360;
            const hue3 = (hsv.h + 270) % 360;

            const rgb1 = hsvToRgb(hue1, hsv.s, hsv.v);
            const rgb2 = hsvToRgb(hue2, hsv.s, hsv.v);
            const rgb3 = hsvToRgb(hue3, hsv.s, hsv.v);

            const hex1 = rgbToHex(rgb1.r, rgb1.g, rgb1.b);
            const hex2 = rgbToHex(rgb2.r, rgb2.g, rgb2.b);
            const hex3 = rgbToHex(rgb3.r, rgb3.g, rgb3.b);

            return [baseColor, hex1, hex2, hex3];
        }

        // Monochromatic scheme
        function generateMonochromaticScheme(baseColor) {
            const rgb = hexToRgb(baseColor);
            if (!rgb) return [baseColor];

            const hsv = rgbToHsv(rgb.r, rgb.g, rgb.b);

            const variations = [
                { s: Math.max(0.2, hsv.s - 0.3), v: Math.min(0.9, hsv.v + 0.2) },
                { s: Math.max(0.1, hsv.s - 0.15), v: Math.min(1.0, hsv.v + 0.1) },
                { s: hsv.s, v: hsv.v },
                { s: Math.min(1.0, hsv.s + 0.15), v: Math.max(0.3, hsv.v - 0.1) },
                { s: Math.min(1.0, hsv.s + 0.3), v: Math.max(0.2, hsv.v - 0.2) }
            ];

            const result = variations.map(variation => {
                const newRgb = hsvToRgb(hsv.h, variation.s, variation.v);
                return rgbToHex(newRgb.r, newRgb.g, newRgb.b);
            });

            return result;
        }

        // Split complementary scheme
        function generateSplitComplementaryScheme(baseColor, angle = 30) {
            const rgb = hexToRgb(baseColor);
            if (!rgb) return [baseColor];

            const hsv = rgbToHsv(rgb.r, rgb.g, rgb.b);
            const complementaryHue = (hsv.h + 180) % 360;
            const splitHue1 = (complementaryHue - angle + 360) % 360;
            const splitHue2 = (complementaryHue + angle) % 360;

            const rgb1 = hsvToRgb(splitHue1, hsv.s, hsv.v);
            const rgb2 = hsvToRgb(splitHue2, hsv.s, hsv.v);

            const hex1 = rgbToHex(rgb1.r, rgb1.g, rgb1.b);
            const hex2 = rgbToHex(rgb2.r, rgb2.g, rgb2.b);

            return [baseColor, hex1, hex2];
        }

        // LCH conversion functions (simplified)
        function generateLCHComplementaryScheme(baseColor) {
            return generateComplementaryScheme(baseColor); // Fallback for HTML version
        }

        function generateLCHAnalogousScheme(baseColor, angle = 30) {
            return generateAnalogousScheme(baseColor, angle); // Fallback for HTML version
        }

        function generateLCHTriadicScheme(baseColor) {
            return generateTriadicScheme(baseColor); // Fallback for HTML version
        }

        function generateLCHTetradicScheme(baseColor) {
            return generateTetradicScheme(baseColor); // Fallback for HTML version
        }

        function generateLCHMonochromaticScheme(baseColor) {
            return generateMonochromaticScheme(baseColor); // Fallback for HTML version
        }

        function generateLCHSplitComplementaryScheme(baseColor, angle = 30) {
            return generateSplitComplementaryScheme(baseColor, angle); // Fallback for HTML version
        }

        function generateLCHGradients(baseColor, steps = 5) {
            const result = [];
            for (let i = 0; i < steps; i++) {
                result.push(baseColor); // Fallback for HTML version
            }
            return result;
        }

        // Generate and preview color schemes
        function generateAndPreviewColorSchemes() {
            const currentHex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);
            const schemes = generateAllSchemesForColor(currentHex);

            const previewMatrix = document.getElementById('schemePreviewMatrix');
            previewMatrix.innerHTML = '';

            for (let type in schemes) {
                const typeColors = schemes[type].slice(0, 3);
                const typeName = {
                    "complementary": "补色",
                    "analogous": "类似色",
                    "triadic": "三元色",
                    "tetradic": "四元色",
                    "monochromatic": "单色系",
                    "split-complementary": "分裂补色",
                    "lch-complementary": "LCH补色",
                    "lch-analogous": "LCH类似色",
                    "lch-triadic": "LCH三元色",
                    "lch-tetradic": "LCH四元色",
                    "lch-monochromatic": "LCH单色系",
                    "lch-split-complementary": "LCH分裂补色",
                    "lch-gradient": "LCH渐变"
                }[type] || "其他方案";

                typeColors.forEach(color => {
                    const schemeItem = document.createElement('div');
                    schemeItem.className = 'scheme-item';
                    schemeItem.style.backgroundColor = color;
                    schemeItem.title = `${typeName} - ${color}`;

                    const typeLabel = document.createElement('div');
                    typeLabel.className = 'scheme-type';
                    typeLabel.textContent = typeName;

                    const hexLabel = document.createElement('div');
                    hexLabel.className = 'scheme-hex';
                    hexLabel.textContent = color;

                    schemeItem.appendChild(typeLabel);
                    schemeItem.appendChild(hexLabel);

                    schemeItem.addEventListener('click', () => {
                        if (setColorFromHex(color)) {
                            updateColor();
                        }
                    });

                    previewMatrix.appendChild(schemeItem);
                });
            }
        }

        // Clipboard monitoring (simulated)
        function extractMultipleColors(value) {
            if (!value) return [];

            const colorSet = new Set();
            value = value.trim();

            // Find all HEX formats (#RRGGBB, #RGB)
            const hexRegex = /#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})\b/g;
            let hexMatch;
            while ((hexMatch = hexRegex.exec(value)) !== null) {
                let hex = hexMatch[0];
                if (hex.length === 4) {
                    hex = '#' + hex[1] + hex[1] + hex[2] + hex[2] + hex[3] + hex[3];
                }
                colorSet.add(hex.toUpperCase());
            }

            // Find all plain hex formats (RRGGBB, RGB)
            const plainHexRegex = /\b([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})\b/g;
            let plainHexMatch;
            while ((plainHexMatch = plainHexRegex.exec(value)) !== null) {
                const hexValue = plainHexMatch[0];
                if (!/^(0?[0-9]|1[0-9]|2[0-4]|25[0-5])$/.test(hexValue)) {
                    let formattedHex = hexValue;
                    if (formattedHex.length === 3) {
                        formattedHex = formattedHex[0] + formattedHex[0] + formattedHex[1] + formattedHex[1] + formattedHex[2] + formattedHex[2];
                    }
                    const upperHex = '#' + formattedHex.toUpperCase();
                    if (/^#([A-Fa-f0-9]{6})$/.test(upperHex)) {
                        colorSet.add(upperHex);
                    }
                }
            }

            // Find all RGB formats
            const rgbRegex = /rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/g;
            let rgbMatch;
            while ((rgbMatch = rgbRegex.exec(value)) !== null) {
                const r = Math.min(255, Math.max(0, parseInt(rgbMatch[1])));
                const g = Math.min(255, Math.max(0, parseInt(rgbMatch[2])));
                const b = Math.min(255, Math.max(0, parseInt(rgbMatch[3])));
                const hex = rgbToHex(r, g, b);
                colorSet.add(hex);
            }

            // Find all RGBA formats
            const rgbaRegex = /rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*[\d.]+\s*\)/g;
            let rgbaMatch;
            while ((rgbaMatch = rgbaRegex.exec(value)) !== null) {
                const r = Math.min(255, Math.max(0, parseInt(rgbaMatch[1])));
                const g = Math.min(255, Math.max(0, parseInt(rgbaMatch[2])));
                const b = Math.min(255, Math.max(0, parseInt(rgbaMatch[3])));
                const hex = rgbToHex(r, g, b);
                colorSet.add(hex);
            }

            return Array.from(colorSet);
        }

        function updateClipboardColorDisplay() {
            const matrix = document.getElementById('clipboardColorsMatrix');
            matrix.innerHTML = '';

            if (clipboardColors.length > 0) {
                document.getElementById('clipboard-label').textContent = `剪切板中发现 ${clipboardColors.length} 个颜色值:`;

                clipboardColors.forEach(color => {
                    const colorName = getColorName(color, true);
                    const displayText = colorName ? colorName.displayName : color;

                    const colorItem = document.createElement('div');
                    colorItem.className = 'color-item';
                    colorItem.style.backgroundColor = color;
                    colorItem.textContent = displayText;
                    colorItem.title = `${color} - ${displayText}`;
                    colorItem.style.fontSize = '8px';
                    colorItem.style.color = getContrastTextColor(color);
                    colorItem.addEventListener('click', () => {
                        if (setColorFromHex(color)) {
                            updateColor();
                        }
                    });

                    matrix.appendChild(colorItem);
                });
            } else {
                document.getElementById('clipboard-label').textContent = '剪切板中没有发现颜色值';
            }
        }

        function readClipboard() {
            if (navigator.clipboard && window.isSecureContext) {
                return navigator.clipboard.readText().catch(err => {
                    console.error('Failed to read clipboard contents: ', err);
                    return '';
                });
            } else {
                // Fallback for non-secure contexts or unsupported browsers
                return new Promise((resolve) => {
                    const text = prompt("请粘贴剪贴板内容:");
                    resolve(text || '');
                });
            }
        }

        async function checkClipboardForColors() {
            try {
                const clipboardText = await readClipboard();
                if (clipboardText) {
                    const foundColors = extractMultipleColors(clipboardText);
                    if (foundColors.length > 0) {
                        // Remove duplicates and add new colors to clipboardColors
                        foundColors.forEach(color => {
                            if (!clipboardColors.some(existingColor => colorsAreEqual(existingColor, color))) {
                                clipboardColors.push(color);
                            }
                        });
                        // Keep only the most recent 20 colors
                        if (clipboardColors.length > 20) {
                            clipboardColors = clipboardColors.slice(-20);
                        }
                        updateClipboardColorDisplay();
                        return true;
                    }
                }
            } catch (error) {
                console.error('Error reading clipboard:', error);
            }
            return false;
        }

        function startClipboardMonitoring() {
            // In a browser environment, we can't continuously monitor clipboard,
            // but we can check it periodically when user interacts with the page
            // Set up periodic check when user focuses on the page
            stopClipboardMonitoring(); // Clear any existing interval first

            // Check clipboard when page loads and every 10 seconds when page is focused
            checkClipboardForColors();

            // Set up interval to periodically check clipboard
            clipboardMonitorInterval = setInterval(async () => {
                await checkClipboardForColors();
            }, 10000); // Check every 10 seconds

            // Also check clipboard on keyup events for more responsive behavior
            document.addEventListener('keyup', async () => {
                await checkClipboardForColors();
            });
        }

        function stopClipboardMonitoring() {
            if (clipboardMonitorInterval) {
                clearInterval(clipboardMonitorInterval);
                clipboardMonitorInterval = null;
            }
        }

        // Initialize the UI
        function initUI() {
            // Set up palette selector
            const paletteNames = Object.keys(colorPalettes);
            const title = document.getElementById('title');
            title.textContent = `${colorPalettes[currentPalette].name}设计色系`;

            // Populate the palette selector dropdown
            const paletteSelector = document.getElementById('paletteSelector');
            paletteNames.forEach(paletteName => {
                const option = document.createElement('option');
                option.value = paletteName;
                option.textContent = colorPalettes[paletteName].name;
                if (paletteName === currentPalette) {
                    option.selected = true;
                }
                paletteSelector.appendChild(option);
            });

            // Add event listener to palette selector
            paletteSelector.addEventListener('change', function() {
                currentPalette = this.value;
                title.textContent = `${colorPalettes[currentPalette].name}设计色系`;
                updatePresetPalette();
            });

            // Set up mode buttons
            const modeButtons = document.querySelectorAll('.mode-btn');
            modeButtons[0].addEventListener('click', () => {
                modeIndex = 0;
                modeButtons.forEach(btn => btn.classList.remove('active'));
                modeButtons[0].classList.add('active');
                updateDynamicColorPalette();
                updateDynamicComparison();
            });

            modeButtons[1].addEventListener('click', () => {
                modeIndex = 1;
                modeButtons.forEach(btn => btn.classList.remove('active'));
                modeButtons[1].classList.add('active');
                updateDynamicColorPalette();
                updateDynamicComparison();
            });

            modeButtons[2].addEventListener('click', () => {
                modeIndex = 2;
                modeButtons.forEach(btn => btn.classList.remove('active'));
                modeButtons[2].classList.add('active');
                updateDynamicColorPalette();
                updateDynamicComparison();
            });

            // Initialize color display
            updateColor();
            updatePresetPalette();
            updateDynamicColorPalette();
            updateDynamicComparison();
            generateAndPreviewColorSchemes();

            // Set up input mode toggle
            const inputModeToggle = document.getElementById('inputModeToggle');
            const hexInput = document.getElementById('hexInput');
            const rgbInput = document.getElementById('rgbInput');
            const rgbColorBarsContainer = document.getElementById('rgbColorBarsContainer');
            const hexClearButton = document.getElementById('hexClearButton');
            const rgbClearButton = document.getElementById('rgbClearButton');

            inputModeToggle.addEventListener('click', () => {
                const currentMode = inputModeToggle.textContent;
                const isHexMode = currentMode === "HEX";

                inputModeToggle.textContent = isHexMode ? "RGB" : "HEX";
                hexInput.style.display = !isHexMode ? 'none' : 'block';
                rgbInput.style.display = isHexMode ? 'none' : 'block';
                rgbColorBarsContainer.style.display = isHexMode ? 'none' : 'flex';
                hexClearButton.style.display = 'none';
                rgbClearButton.style.display = 'none';

                // Update input fields with current values in the correct format
                const hexColor = rgbToHex(currentColor.r, currentColor.g, currentColor.b);
                const rgbString = `${Math.round(currentColor.r)}, ${Math.round(currentColor.g)}, ${Math.round(currentColor.b)}`;

                if (isHexMode) { // Switching to RGB mode
                    rgbInput.value = rgbString;
                    // Focus on the RGB input if it's now visible
                    setTimeout(() => {
                        if (rgbInput.style.display !== 'none') {
                            rgbInput.focus();
                        }
                    }, 10);
                } else { // Switching to HEX mode
                    hexInput.value = hexColor;
                    // Focus on the HEX input if it's now visible
                    setTimeout(() => {
                        if (hexInput.style.display !== 'none') {
                            hexInput.focus();
                        }
                    }, 10);
                }

                updateRGBColorBars();
            });

            // Set up input field events
            hexInput.addEventListener('input', function() {
                const txt = this.value.trim();
                hexClearButton.style.display = txt === '' ? 'none' : 'block';
                if (txt.length >= 6 && setColorFromHex(txt)) {
                    updateColor();
                }
            });

            hexInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    if (setColorFromHex(this.value)) {
                        updateColor();
                    } else if (this.value.trim() !== "") {
                        alert("无效颜色");
                    }
                    this.blur();
                }
            });

            rgbInput.addEventListener('input', function() {
                const txt = this.value.trim();
                rgbClearButton.style.display = txt === '' ? 'none' : 'block';
                if (txt !== "" && setColorFromHex(txt)) {
                    updateColor();
                }
            });

            rgbInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    if (setColorFromHex(this.value)) {
                        updateColor();
                    } else if (this.value.trim() !== "") {
                        alert("请输入正确的RGB格式");
                    }
                    this.blur();
                }
            });

            // Set up clear buttons
            hexClearButton.addEventListener('click', () => {
                hexInput.value = "";
                hexClearButton.style.display = 'none';
            });

            rgbClearButton.addEventListener('click', () => {
                rgbInput.value = "";
                rgbClearButton.style.display = 'none';
            });

            // Set up slider events
            document.getElementById('redSlider').addEventListener('input', function() {
                currentColor.r = parseInt(this.value);
                updateColor();
            });

            document.getElementById('greenSlider').addEventListener('input', function() {
                currentColor.g = parseInt(this.value);
                updateColor();
            });

            document.getElementById('blueSlider').addEventListener('input', function() {
                currentColor.b = parseInt(this.value);
                updateColor();
            });

            // Set up floating copy button
            document.getElementById('floatingCopyButton').addEventListener('click', function() {
                const hex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);
                navigator.clipboard.writeText(hex).then(() => {
                    // Brief visual feedback
                    const originalText = this.textContent;
                    const originalBg = this.style.backgroundColor;
                    this.textContent = '✓';
                    this.style.backgroundColor = '#4CAF50';

                    setTimeout(() => {
                        this.textContent = '.Copy';
                        this.style.backgroundColor = '';
                    }, 1000);
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    alert('复制失败，请手动复制');
                });
            });

            // Export functions
            function exportCurrentColor() {
                const hex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);
                const rgb = `rgb(${Math.round(currentColor.r)}, ${Math.round(currentColor.g)}, ${Math.round(currentColor.b)})`;
                const hsl = rgbToHsl(currentColor.r, currentColor.g, currentColor.b);

                const exportData = {
                    hex: hex,
                    rgb: rgb,
                    hsl: `hsl(${Math.round(hsl.h)}, ${Math.round(hsl.s * 100)}%, ${Math.round(hsl.v * 100)}%)`,
                    name: getColorName(hex)?.fullName || 'Unknown'
                };

                const exportText = `当前颜色:\nHEX: ${exportData.hex}\nRGB: ${exportData.rgb}\nHSL: ${exportData.hsl}\n名称: ${exportData.name}`;

                navigator.clipboard.writeText(exportText).then(() => {
                    alert('当前颜色信息已复制到剪切板');
                }).catch(() => {
                    // Fallback: show in a prompt
                    prompt('复制以下颜色信息:', exportText);
                });
            }

            function exportColorScheme() {
                const currentHex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);
                const schemes = generateAllSchemesForColor(currentHex);

                let exportText = `基于 ${currentHex} 的配色方案:\n\n`;

                for (let type in schemes) {
                    const colors = schemes[type];
                    const typeName = {
                        "complementary": "补色",
                        "analogous": "类似色",
                        "triadic": "三元色",
                        "tetradic": "四元色",
                        "monochromatic": "单色系",
                        "split-complementary": "分裂补色",
                        "lch-complementary": "LCH补色",
                        "lch-analogous": "LCH类似色",
                        "lch-triadic": "LCH三元色",
                        "lch-tetradic": "LCH四元色",
                        "lch-monochromatic": "LCH单色系",
                        "lch-split-complementary": "LCH分裂补色",
                        "lch-gradient": "LCH渐变"
                    }[type] || type;

                    exportText += `${typeName}: ${colors.join(', ')}\n`;
                }

                navigator.clipboard.writeText(exportText).then(() => {
                    alert('配色方案已复制到剪切板');
                }).catch(() => {
                    // Fallback: show in a prompt
                    prompt('复制以下配色方案:', exportText);
                });
            }

            function exportPalette() {
                const palette = colorPalettes[currentPalette];
                let exportText = `${palette.name} 色盘:\n\n`;

                palette.colors.forEach((color, index) => {
                    const colorName = getColorName(color)?.fullName || 'Unknown';
                    exportText += `${index + 1}. ${color} - ${colorName}\n`;
                });

                navigator.clipboard.writeText(exportText).then(() => {
                    alert(`${palette.name} 色盘已复制到剪切板`);
                }).catch(() => {
                    // Fallback: show in a prompt
                    prompt('复制以下色盘:', exportText);
                });
            }

            // Helper function to convert RGB to HSL
            function rgbToHsl(r, g, b) {
                r = r / 255;
                g = g / 255;
                b = b / 255;

                const max = Math.max(r, g, b);
                const min = Math.min(r, g, b);
                let h, s, l = (max + min) / 2;

                if (max === min) {
                    h = s = 0; // achromatic
                } else {
                    const d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);

                    switch (max) {
                        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / d + 2; break;
                        case b: h = (r - g) / d + 4; break;
                    }
                    h /= 6;
                }

                return { h: h * 360, s: s, v: l };
            }

            // Set up export buttons
            document.getElementById('exportCurrentColor').addEventListener('click', exportCurrentColor);
            document.getElementById('exportColorScheme').addEventListener('click', exportColorScheme);
            document.getElementById('exportPalette').addEventListener('click', exportPalette);

            // Set up restart clipboard monitor button
            document.getElementById('restartClipboardMonitorButton').addEventListener('click', async () => {
                await checkClipboardForColors();
                startClipboardMonitoring();
                alert("已重新开始监控剪切板");
            });

            // Add event listener to the manual clipboard check button that already exists in HTML
            document.getElementById('manualClipboardCheckButton').addEventListener('click', async () => {
                const found = await checkClipboardForColors();
                if (found) {
                    alert(`发现新颜色值并已添加到剪切板颜色区域`);
                } else {
                    alert('未在剪切板中发现颜色值');
                }
            });

            // Simulate clipboard check on page load
            startClipboardMonitoring();
        }

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', initUI);
    </script>
</body>
</html>